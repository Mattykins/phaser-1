(function(global,factory){if(typeof define==="function"&&define.amd){define(["exports","@swc/helpers","regenerator-runtime"],factory)}else if(typeof exports!=="undefined"){factory(exports,require("@swc/helpers"),require("regenerator-runtime"))}else{var mod={exports:{}};factory(mod.exports,global.helpers,global.regeneratorRuntime);global.phaser=mod.exports}})(this,function(_exports,swcHelpers,_regeneratorRuntime){"use strict";_regeneratorRuntime=swcHelpers.interopRequireDefault(_regeneratorRuntime);Object.defineProperty(_exports,"__esModule",{value:true});_exports.WebGL1=_exports.Animation=_exports.Scenes=_exports.Geom=_exports.Events=_exports.Time=_exports.Input=_exports.Game=_exports.Color=_exports.Display=_exports.Camera=_exports.Config=_exports.CreateGame=_exports.Scene=_exports.Loader=_exports.GameObjects=_exports.Device=_exports.Textures=_exports.Math=_exports.DOM=_exports.World=void 0;var _console,_console1,_results;var __defProp=Object.defineProperty;var __markAsModule=function(target){return __defProp(target,"__esModule",{value:true})};var __export=function(target,all){__markAsModule(target);for(var name in all)__defProp(target,name,{get:all[name],enumerable:true})};var animation_exports={};__export(animation_exports,{AddFrame:function(){return AddFrame},AddFrames:function(){return AddFrames},Animation:function(){return Animation},AnimationFrame:function(){return AnimationFrame},CalculateDuration:function(){return CalculateDuration},CreateAnimData:function(){return CreateAnimData},CreateAnimationFromAtlas:function(){return CreateAnimationFromAtlas},LinkFrames:function(){return LinkFrames},Play:function(){return Play},RemoveFrame:function(){return RemoveFrame},RemoveFrames:function(){return RemoveFrames}});function CalculateDuration(animation,frameRate,duration){var totalFrames=animation.frames.size;if(!Number.isFinite(duration)&&!Number.isFinite(frameRate)){animation.frameRate=24;animation.duration=24/totalFrames*1e3}else if(duration&&!Number.isFinite(frameRate)){animation.duration=duration;animation.frameRate=totalFrames/(duration/1e3)}else{animation.frameRate=frameRate;animation.duration=totalFrames/frameRate*1e3}animation.msPerFrame=1e3/animation.frameRate;return animation}function LinkFrames(animation){var totalFrames=animation.frames.size;if(totalFrames===0){return animation}var i=0;var framePercent=1/totalFrames;var firstFrame;var prevFrame2;for(var _i=0,_iter=animation.frames.values();_i<_iter.length;_i++){var frame2=_iter[_i];if(!prevFrame2){frame2.isFirst=true;animation.firstFrame=frame2;firstFrame=frame2}else{prevFrame2.nextFrame=frame2;frame2.prevFrame=prevFrame2}prevFrame2=frame2;i++;frame2.progress=framePercent*i;if(i===totalFrames){frame2.isLast=true;frame2.nextFrame=firstFrame;firstFrame.prevFrame=frame2}}return animation}function AddFrame(animation,frame2){animation.frames.add(frame2);CalculateDuration(animation,animation.frameRate);return LinkFrames(animation)}function AddFrames(animation){for(var _len=arguments.length,frames=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){frames[_key-1]=arguments[_key]}frames.forEach(function(frame2){animation.frames.add(frame2)});CalculateDuration(animation,animation.frameRate);return LinkFrames(animation)}var Animation=function(){"use strict";function _class(config){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"key",void 0);swcHelpers.defineProperty(this,"frames",void 0);swcHelpers.defineProperty(this,"firstFrame",void 0);swcHelpers.defineProperty(this,"msPerFrame",void 0);swcHelpers.defineProperty(this,"frameRate",void 0);swcHelpers.defineProperty(this,"duration",void 0);swcHelpers.defineProperty(this,"skipMissedFrames",void 0);swcHelpers.defineProperty(this,"delay",void 0);swcHelpers.defineProperty(this,"hold",void 0);swcHelpers.defineProperty(this,"repeat",void 0);swcHelpers.defineProperty(this,"repeatDelay",void 0);swcHelpers.defineProperty(this,"yoyo",void 0);swcHelpers.defineProperty(this,"showOnStart",void 0);swcHelpers.defineProperty(this,"hideOnComplete",void 0);swcHelpers.defineProperty(this,"paused",void 0);var key=config.key,_frames=config.frames,frames=_frames===void 0?[]:_frames,_frameRate=config.frameRate,frameRate=_frameRate===void 0?null:_frameRate,_duration=config.duration,duration=_duration===void 0?null:_duration,_skipMissedFrames=config.skipMissedFrames,skipMissedFrames=_skipMissedFrames===void 0?true:_skipMissedFrames,_delay=config.delay,delay=_delay===void 0?0:_delay,_repeat=config.repeat,repeat=_repeat===void 0?0:_repeat,_repeatDelay=config.repeatDelay,repeatDelay=_repeatDelay===void 0?0:_repeatDelay,_yoyo=config.yoyo,yoyo=_yoyo===void 0?false:_yoyo,_showOnStart=config.showOnStart,showOnStart=_showOnStart===void 0?false:_showOnStart,_hideOnComplete=config.hideOnComplete,hideOnComplete=_hideOnComplete===void 0?false:_hideOnComplete,_paused=config.paused,paused=_paused===void 0?false:_paused;this.key=key;this.skipMissedFrames=skipMissedFrames;this.delay=delay;this.repeat=repeat;this.repeatDelay=repeatDelay;this.yoyo=yoyo;this.showOnStart=showOnStart;this.hideOnComplete=hideOnComplete;this.paused=paused;this.frames=new Set(frames);CalculateDuration(this,frameRate,duration);LinkFrames(this)}swcHelpers.createClass(_class,[{key:"getTotalFrames",value:function getTotalFrames(){return this.frames.size}},{key:"destroy",value:function destroy(){this.frames.clear()}}]);return _class}();var AnimationFrame=function(){"use strict";function _class(texture,frame2){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"texture",void 0);swcHelpers.defineProperty(this,"frame",void 0);swcHelpers.defineProperty(this,"isFirst",false);swcHelpers.defineProperty(this,"isLast",false);swcHelpers.defineProperty(this,"isKeyFrame",false);swcHelpers.defineProperty(this,"nextFrame",void 0);swcHelpers.defineProperty(this,"prevFrame",void 0);swcHelpers.defineProperty(this,"duration",0);swcHelpers.defineProperty(this,"progress",0);this.texture=texture;this.frame=frame2}swcHelpers.createClass(_class,[{key:"destroy",value:function destroy(){this.texture=null;this.frame=null;this.nextFrame=null;this.prevFrame=null}}]);return _class}();function CreateAnimData(param,param1,param2,param3,param4,param5,param6,param7,param8,param9){var currentAnim=param===void 0?"":param,frameRate=param1===void 0?0:param1,duration=param2===void 0?0:param2,delay=param3===void 0?0:param3,repeat=param4===void 0?0:param4,repeatDelay=param5===void 0?0:param5,yoyo=param6===void 0?false:param6,hold=param7===void 0?0:param7,showOnStart=param8===void 0?false:param8,hideOnComplete=param9===void 0?false:param9;return{currentAnim:currentAnim,frameRate:frameRate,duration:duration,delay:delay,repeat:repeat,repeatDelay:repeatDelay,yoyo:yoyo,hold:hold,showOnStart:showOnStart,hideOnComplete:hideOnComplete,stopAfter:0,startFrame:0,timeScale:1,onStart:null,onRepeat:null,onComplete:null,nextFrameTime:0,repeatCount:0,isPlaying:false,forceRestart:false,pendingStart:false,playingForward:true}}function GetFramesInRange(texture,config){var _prefix=config.prefix,prefix=_prefix===void 0?"":_prefix,_start=config.start,start=_start===void 0?0:_start,_zeroPad=config.zeroPad,zeroPad=_zeroPad===void 0?0:_zeroPad,_suffix=config.suffix,suffix=_suffix===void 0?"":_suffix;var end=config.end;var output=[];var diff2=start<end?1:-1;end+=diff2;for(var i=start;i!==end;i+=diff2){var frameKey=prefix+i.toString().padStart(zeroPad,"0")+suffix;output.push(texture.getFrame(frameKey))}return output}var instance;var TextureManagerInstance={get:function(){return instance},set:function(manager){if(instance){throw new Error("Cannot instantiate TextureManager more than once")}instance=manager}};function GetTexture(key){return TextureManagerInstance.get().get(key)}var queue=[];var BindingQueue={add:function(texture,glConfig){queue.push({texture:texture,glConfig:glConfig})},get:function(){return queue},clear:function(){queue.length=0}};function UpdateFrameUVs(frame2){var x=frame2.x,y=frame2.y,width=frame2.width,height=frame2.height;var baseTextureWidth=frame2.texture.width;var baseTextureHeight=frame2.texture.height;frame2.u0=x/baseTextureWidth;frame2.v0=y/baseTextureHeight;frame2.u1=(x+width)/baseTextureWidth;frame2.v1=(y+height)/baseTextureHeight;return frame2}var Frame=function(){"use strict";function _class(texture,key,x,y,width,height){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"texture",void 0);swcHelpers.defineProperty(this,"key",void 0);swcHelpers.defineProperty(this,"x",void 0);swcHelpers.defineProperty(this,"y",void 0);swcHelpers.defineProperty(this,"width",void 0);swcHelpers.defineProperty(this,"height",void 0);swcHelpers.defineProperty(this,"trimmed",false);swcHelpers.defineProperty(this,"sourceSizeWidth",void 0);swcHelpers.defineProperty(this,"sourceSizeHeight",void 0);swcHelpers.defineProperty(this,"spriteSourceSizeX",void 0);swcHelpers.defineProperty(this,"spriteSourceSizeY",void 0);swcHelpers.defineProperty(this,"spriteSourceSizeWidth",void 0);swcHelpers.defineProperty(this,"spriteSourceSizeHeight",void 0);swcHelpers.defineProperty(this,"pivot",void 0);swcHelpers.defineProperty(this,"u0",void 0);swcHelpers.defineProperty(this,"v0",void 0);swcHelpers.defineProperty(this,"u1",void 0);swcHelpers.defineProperty(this,"v1",void 0);this.texture=texture;this.key=key;this.x=x;this.y=y;this.width=width;this.height=height;this.sourceSizeWidth=width;this.sourceSizeHeight=height;UpdateFrameUVs(this)}swcHelpers.createClass(_class,[{key:"destroy",value:function destroy(){this.texture=null}}]);return _class}();function SetFrameSize(frame2,width,height){frame2.width=width;frame2.height=height;frame2.sourceSizeWidth=width;frame2.sourceSizeHeight=height;return UpdateFrameUVs(frame2)}var Texture=function(){"use strict";function _class(image,width,height,glConfig){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"key","");swcHelpers.defineProperty(this,"locked",true);swcHelpers.defineProperty(this,"width",void 0);swcHelpers.defineProperty(this,"height",void 0);swcHelpers.defineProperty(this,"image",void 0);swcHelpers.defineProperty(this,"binding",void 0);swcHelpers.defineProperty(this,"firstFrame",void 0);swcHelpers.defineProperty(this,"frames",void 0);swcHelpers.defineProperty(this,"data",void 0);if(image){width=image.width;height=image.height}this.image=image;this.width=width;this.height=height;this.frames=new Map();this.data={};this.addFrame("__BASE",0,0,width,height);BindingQueue.add(this,glConfig)}swcHelpers.createClass(_class,[{key:"addFrame",value:function addFrame(key,x,y,width,height){if(this.frames.has(key)){return null}var frame2=new Frame(this,key,x,y,width,height);this.frames.set(key,frame2);if(!this.firstFrame||this.firstFrame.key==="__BASE"){this.firstFrame=frame2}return frame2}},{key:"getFrame",value:function getFrame(key){if(!key){return this.firstFrame}if(swcHelpers._instanceof(key,Frame)){key=key.key}var frame2=this.frames.get(key);if(!frame2){console.warn("Frame missing: ".concat(key));frame2=this.firstFrame}return frame2}},{key:"setSize",value:function setSize(width,height){this.width=width;this.height=height;var frame2=this.frames.get("__BASE");SetFrameSize(frame2,width,height)}},{key:"update",value:function update(image,glConfig){this.image=image;this.setSize(image.width,image.height);BindingQueue.add(this,glConfig)}},{key:"destroy",value:function destroy(){if(this.binding){this.binding.destroy()}this.frames.clear();this.binding=null;this.data=null;this.image=null;this.firstFrame=null}}]);return _class}();function CreateAnimationFromAtlas(config){var texture=swcHelpers._instanceof(config.texture,Texture)?config.texture:GetTexture(config.texture);var frames=[];GetFramesInRange(texture,config).forEach(function(frame2){frames.push(new AnimationFrame(texture,frame2))});return new Animation(swcHelpers.objectSpread({frames:frames},config))}function Play(animation,param){var config=param===void 0?{}:param;for(var _len=arguments.length,sprites=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){sprites[_key-2]=arguments[_key]}var data=CreateAnimData(animation.key,animation.frameRate,animation.duration,animation.delay,animation.repeat,animation.repeatDelay,animation.yoyo,animation.hold,animation.showOnStart,animation.hideOnComplete);Object.assign(data,config);data.nextFrameTime=animation.msPerFrame+data.delay;sprites.forEach(function(sprite){if(!sprite||!sprite.animData){return}var spriteAnimData=sprite.animData;if(spriteAnimData.isPlaying){if(sprite.currentAnimation!==animation){spriteAnimData.isPlaying=false;if(spriteAnimData.onComplete){spriteAnimData.onComplete(sprite,sprite.currentAnimation)}}else if(!data.forceRestart){return}}Object.assign(spriteAnimData,data);sprite.currentAnimation=animation;sprite.currentFrame=animation.firstFrame;sprite.play()});return sprites}function RemoveFrame(animation,frame2){animation.frames.delete(frame2);CalculateDuration(animation,animation.frameRate);return LinkFrames(animation)}function RemoveFrames(animation){for(var _len=arguments.length,frames=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){frames[_key-1]=arguments[_key]}frames.forEach(function(frame2){animation.frames.delete(frame2)});CalculateDuration(animation,animation.frameRate);return LinkFrames(animation)}var camera_exports={};__export(camera_exports,{StaticCamera:function(){return StaticCamera},WorldCamera:function(){return WorldCamera}});var TYPES_ENUM={i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64",eid:"eid"};var TYPES_NAMES={i8:"Int8",ui8:"Uint8",ui8c:"Uint8Clamped",i16:"Int16",ui16:"Uint16",i32:"Int32",ui32:"Uint32",eid:"Uint32",f32:"Float32",f64:"Float64"};var TYPES={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array};var UNSIGNED_MAX={uint8:Math.pow(2,8),uint16:Math.pow(2,16),uint32:Math.pow(2,32)};var roundToMultiple=function(mul){return function(x){return Math.ceil(x/mul)*mul}};var roundToMultiple4=roundToMultiple(4);var $storeRef=Symbol("storeRef");var $storeSize=Symbol("storeSize");var $storeMaps=Symbol("storeMaps");var $storeFlattened=Symbol("storeFlattened");var $storeBase=Symbol("storeBase");var $storeType=Symbol("storeType");var $storeArrayCounts=Symbol("storeArrayCount");var $storeSubarrays=Symbol("storeSubarrays");var $subarrayCursors=Symbol("subarrayCursors");var $subarray=Symbol("subarray");var $subarrayFrom=Symbol("subarrayFrom");var $subarrayTo=Symbol("subarrayTo");var $parentArray=Symbol("subStore");var $tagStore=Symbol("tagStore");var $queryShadow=Symbol("queryShadow");var $serializeShadow=Symbol("serializeShadow");var $indexType=Symbol("indexType");var $indexBytes=Symbol("indexBytes");var $isEidType=Symbol("isEidType");var stores={};var resize=function(ta,size){var newBuffer=new ArrayBuffer(size*ta.BYTES_PER_ELEMENT);var newTa=new ta.constructor(newBuffer);newTa.set(ta,0);return newTa};var createShadow=function(store,key){if(!ArrayBuffer.isView(store)){var shadowStore=store[$parentArray].slice(0).fill(0);store[key]=store.map(function(_,eid){var from=store[eid][$subarrayFrom];var to=store[eid][$subarrayTo];return shadowStore.subarray(from,to)})}else{store[key]=store.slice(0).fill(0)}};var resizeSubarray=function(metadata,store,size){var cursors=metadata[$subarrayCursors];var type=store[$storeType];var length=store[0].length;var indexType=length<=UNSIGNED_MAX.uint8?"ui8":length<=UNSIGNED_MAX.uint16?"ui16":"ui32";var arrayCount=metadata[$storeArrayCounts][type];var summedLength=Array(arrayCount).fill(0).reduce(function(a,p){return a+length},0);var array=new TYPES[type](roundToMultiple4(summedLength*size));array.set(metadata[$storeSubarrays][type]);metadata[$storeSubarrays][type]=array;array[$indexType]=TYPES_NAMES[indexType];array[$indexBytes]=TYPES[indexType].BYTES_PER_ELEMENT;var start=cursors[type];var end=0;for(var eid=0;eid<size;eid++){var from=cursors[type]+eid*length;var to=from+length;store[eid]=metadata[$storeSubarrays][type].subarray(from,to);store[eid][$subarrayFrom]=from;store[eid][$subarrayTo]=to;store[eid][$subarray]=true;store[eid][$indexType]=TYPES_NAMES[indexType];store[eid][$indexBytes]=TYPES[indexType].BYTES_PER_ELEMENT;end=to}cursors[type]=end;store[$parentArray]=metadata[$storeSubarrays][type].subarray(start,end)};var resizeRecursive=function(metadata,store,size){Object.keys(store).forEach(function(key){var ta=store[key];if(Array.isArray(ta)){resizeSubarray(metadata,ta,size);store[$storeFlattened].push(ta)}else if(ArrayBuffer.isView(ta)){store[key]=resize(ta,size);store[$storeFlattened].push(store[key])}else if(typeof ta==="object"){resizeRecursive(metadata,store[key],size)}})};var resizeStore=function(store,size){if(store[$tagStore])return;store[$storeSize]=size;store[$storeFlattened].length=0;Object.keys(store[$subarrayCursors]).forEach(function(k){store[$subarrayCursors][k]=0});resizeRecursive(store,store,size)};var resetStoreFor=function(store,eid){if(store[$storeFlattened]){store[$storeFlattened].forEach(function(ta){if(ArrayBuffer.isView(ta))ta[eid]=0;else ta[eid].fill(0)})}};var createTypeStore=function(type,length){var totalBytes=length*TYPES[type].BYTES_PER_ELEMENT;var buffer=new ArrayBuffer(totalBytes);var store=new TYPES[type](buffer);store[$isEidType]=type===TYPES_ENUM.eid;return store};var createArrayStore=function(metadata,type,length){var size=metadata[$storeSize];var store=Array(size).fill(0);store[$storeType]=type;store[$isEidType]=type===TYPES_ENUM.eid;var cursors=metadata[$subarrayCursors];var indexType=length<UNSIGNED_MAX.uint8?"ui8":length<UNSIGNED_MAX.uint16?"ui16":"ui32";if(!length)throw new Error("bitECS - Must define component array length");if(!TYPES[type])throw new Error("bitECS - Invalid component array property type ".concat(type));if(!metadata[$storeSubarrays][type]){var arrayCount=metadata[$storeArrayCounts][type];var summedLength=Array(arrayCount).fill(0).reduce(function(a,p){return a+length},0);var array=new TYPES[type](roundToMultiple4(summedLength*size));metadata[$storeSubarrays][type]=array;array[$indexType]=TYPES_NAMES[indexType];array[$indexBytes]=TYPES[indexType].BYTES_PER_ELEMENT}var start=cursors[type];var end=0;for(var eid=0;eid<size;eid++){var from=cursors[type]+eid*length;var to=from+length;store[eid]=metadata[$storeSubarrays][type].subarray(from,to);store[eid][$subarrayFrom]=from;store[eid][$subarrayTo]=to;store[eid][$subarray]=true;store[eid][$indexType]=TYPES_NAMES[indexType];store[eid][$indexBytes]=TYPES[indexType].BYTES_PER_ELEMENT;end=to}cursors[type]=end;store[$parentArray]=metadata[$storeSubarrays][type].subarray(start,end);return store};var isArrayType=function(x){return Array.isArray(x)&& typeof x[0]==="string"&& typeof x[1]==="number"};var _obj,_obj1;var createStore=function(schema,size){var $store=Symbol("store");if(!schema||!Object.keys(schema).length){stores[$store]=(_obj={},swcHelpers.defineProperty(_obj,$storeSize,size),swcHelpers.defineProperty(_obj,$tagStore,true),swcHelpers.defineProperty(_obj,$storeBase,function(){return stores[$store]}),_obj);return stores[$store]}schema=JSON.parse(JSON.stringify(schema));var arrayCounts={};var collectArrayCounts=function(s){var keys=Object.keys(s);for(var _i=0;_i<keys.length;_i++){var k=keys[_i];if(isArrayType(s[k])){if(!arrayCounts[s[k][0]])arrayCounts[s[k][0]]=0;arrayCounts[s[k][0]]++}else if(swcHelpers._instanceof(s[k],Object)){collectArrayCounts(s[k])}}};collectArrayCounts(schema);var metadata=(_obj1={},swcHelpers.defineProperty(_obj1,$storeSize,size),swcHelpers.defineProperty(_obj1,$storeMaps,{}),swcHelpers.defineProperty(_obj1,$storeSubarrays,{}),swcHelpers.defineProperty(_obj1,$storeRef,$store),swcHelpers.defineProperty(_obj1,$subarrayCursors,Object.keys(TYPES).reduce(function(a,type){return swcHelpers.objectSpread({},a,swcHelpers.defineProperty({},type,0))},{})),swcHelpers.defineProperty(_obj1,$storeFlattened,[]),swcHelpers.defineProperty(_obj1,$storeArrayCounts,arrayCounts),_obj1);if(swcHelpers._instanceof(schema,Object)&&Object.keys(schema).length){var recursiveTransform=function(a,k){if(typeof a[k]==="string"){a[k]=createTypeStore(a[k],size);a[k][$storeBase]=function(){return stores[$store]};metadata[$storeFlattened].push(a[k])}else if(isArrayType(a[k])){var _k=a[k],type=_k[0],length=_k[1];a[k]=createArrayStore(metadata,type,length);a[k][$storeBase]=function(){return stores[$store]};metadata[$storeFlattened].push(a[k])}else if(swcHelpers._instanceof(a[k],Object)){a[k]=Object.keys(a[k]).reduce(recursiveTransform,a[k])}return a};stores[$store]=Object.assign(Object.keys(schema).reduce(recursiveTransform,schema),metadata);stores[$store][$storeBase]=function(){return stores[$store]};return stores[$store]}};var SparseSet=function(){var dense=[];var sparse=[];dense.sort=function SparseSet(comparator){var result=Array.prototype.sort.call(this,comparator);for(var i=0;i<dense.length;i++){sparse[dense[i]]=i}return result};var has=function(val){return dense[sparse[val]]===val};var add=function(val){if(has(val))return;sparse[val]=dense.push(val)-1};var remove=function(val){if(!has(val))return;var index=sparse[val];var swapped=dense.pop();if(swapped!==val){dense[index]=swapped;sparse[swapped]=index}};return{add:add,remove:remove,has:has,sparse:sparse,dense:dense}};var newEntities=new Map();var $entityMasks=Symbol("entityMasks");var $entityComponents=Symbol("entityComponents");var $entitySparseSet=Symbol("entitySparseSet");var $entityArray=Symbol("entityArray");var $entityIndices=Symbol("entityIndices");var $removedEntities=Symbol("removedEntities");var defaultSize=1e5;var globalEntityCursor=0;var globalSize=defaultSize;var getGlobalSize=function(){return globalSize};var removed=[];var getEntityCursor=function(){return globalEntityCursor};var eidToWorld=new Map();var addEntity=function(world2){if(globalEntityCursor+1>=defaultSize){console.error("bitECS - max entities of ".concat(defaultSize," reached, increase with setDefaultSize function."));return}var eid=removed.length>0?removed.shift():globalEntityCursor++;world2[$entitySparseSet].add(eid);eidToWorld.set(eid,world2);world2[$notQueries].forEach(function(q){var match=queryCheckEntity(world2,q,eid);if(match)queryAddEntity(q,eid)});world2[$entityComponents].set(eid,new Set());return eid};var removeEntity=function(world2,eid){if(!world2[$entitySparseSet].has(eid))return;world2[$queries].forEach(function(q){queryRemoveEntity(world2,q,eid)});removed.push(eid);world2[$entitySparseSet].remove(eid);world2[$entityComponents].delete(eid);world2[$localEntities].delete(world2[$localEntityLookup].get(eid));world2[$localEntityLookup].delete(eid);for(var i=0;i<world2[$entityMasks].length;i++)world2[$entityMasks][i][eid]=0};function Any(){for(var _len=arguments.length,comps=new Array(_len),_key=0;_key<_len;_key++){comps[_key]=arguments[_key]}return function QueryAny(){return comps}}function All(){for(var _len=arguments.length,comps=new Array(_len),_key=0;_key<_len;_key++){comps[_key]=arguments[_key]}return function QueryAll(){return comps}}function None(){for(var _len=arguments.length,comps=new Array(_len),_key=0;_key<_len;_key++){comps[_key]=arguments[_key]}return function QueryNone(){return comps}}var $queries=Symbol("queries");var $notQueries=Symbol("notQueries");var $queryAny=Symbol("queryAny");var $queryAll=Symbol("queryAll");var $queryNone=Symbol("queryNone");var $queryMap=Symbol("queryMap");var $dirtyQueries=Symbol("$dirtyQueries");var $queryComponents=Symbol("queryComponents");var $enterQuery=Symbol("enterQuery");var $exitQuery=Symbol("exitQuery");var registerQuery=function(world2,query){var components2=[];var notComponents=[];var changedComponents=[];query[$queryComponents].forEach(function(c){if(typeof c==="function"){var ref=c(),comp=ref[0],mod=ref[1];if(!world2[$componentMap].has(comp))registerComponent(world2,comp);if(mod==="not"){notComponents.push(comp)}if(mod==="changed"){changedComponents.push(comp);components2.push(comp)}}else{if(!world2[$componentMap].has(c))registerComponent(world2,c);components2.push(c)}});var mapComponents=function(c){return world2[$componentMap].get(c)};var allComponents=components2.concat(notComponents).map(mapComponents);var sparseSet=SparseSet();var archetypes=[];var changed=[];var toRemove=SparseSet();var entered=[];var exited=[];var generations=allComponents.map(function(c){return c.generationId}).reduce(function(a,v){if(a.includes(v))return a;a.push(v);return a},[]);var reduceBitflags=function(a,c){if(!a[c.generationId])a[c.generationId]=0;a[c.generationId]|=c.bitflag;return a};var masks=components2.map(mapComponents).reduce(reduceBitflags,{});var notMasks=notComponents.map(mapComponents).reduce(reduceBitflags,{});var hasMasks=allComponents.reduce(reduceBitflags,{});var flatProps=components2.filter(function(c){return!c[$tagStore]}).map(function(c){return Object.getOwnPropertySymbols(c).includes($storeFlattened)?c[$storeFlattened]:[c]}).reduce(function(a,v){return a.concat(v)},[]);var shadows=flatProps.map(function(prop){var $=Symbol();createShadow(prop,$);return prop[$]},[]);var q=Object.assign(sparseSet,{archetypes:archetypes,changed:changed,components:components2,notComponents:notComponents,changedComponents:changedComponents,allComponents:allComponents,masks:masks,notMasks:notMasks,hasMasks:hasMasks,generations:generations,flatProps:flatProps,toRemove:toRemove,entered:entered,exited:exited,shadows:shadows});world2[$queryMap].set(query,q);world2[$queries].add(q);allComponents.forEach(function(c){c.queries.add(q)});if(notComponents.length)world2[$notQueries].add(q);for(var eid=0;eid<getEntityCursor();eid++){if(!world2[$entitySparseSet].has(eid))continue;var match=queryCheckEntity(world2,q,eid);if(match)queryAddEntity(q,eid)}};var diff=function(q,clearDiff){if(clearDiff)q.changed=[];var flatProps=q.flatProps,shadows=q.shadows;for(var i=0;i<q.dense.length;i++){var eid=q.dense[i];var dirty=false;for(var pid=0;pid<flatProps.length;pid++){var prop=flatProps[pid];var shadow=shadows[pid];if(ArrayBuffer.isView(prop[eid])){for(var i2=0;i2<prop[eid].length;i2++){if(prop[eid][i2]!==shadow[eid][i2]){dirty=true;shadow[eid][i2]=prop[eid][i2];break}}}else{if(prop[eid]!==shadow[eid]){dirty=true;shadow[eid]=prop[eid]}}}if(dirty)q.changed.push(eid)}return q.changed};var flatten=function(a,v){return a.concat(v)};var aggregateComponentsFor=function(mod){return function(x){return x.filter(function(f){return f.name===mod().constructor.name}).reduce(flatten)}};var getAnyComponents=aggregateComponentsFor(Any);var getAllComponents=aggregateComponentsFor(All);var getNoneComponents=aggregateComponentsFor(None);var defineQuery=function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}var components2=void 0;var any=void 0,all=void 0,none=void 0;if(Array.isArray(args[0])){components2=args[0]}else{any=getAnyComponents(args);all=getAllComponents(args);none=getNoneComponents(args)}if(components2===void 0||components2[$componentMap]!==void 0){return function(world2){return world2?world2[$entityArray]:components2[$entityArray]}}var query=function defineQuery(world2,param){var clearDiff=param===void 0?true:param;if(!world2[$queryMap].has(query))registerQuery(world2,query);var q=world2[$queryMap].get(query);commitRemovals(world2);if(q.changedComponents.length)return diff(q,clearDiff);return q.dense};query[$queryComponents]=components2;query[$queryAny]=any;query[$queryAll]=all;query[$queryNone]=none;return query};var queryCheckEntity=function(world2,q,eid){var masks=q.masks,notMasks=q.notMasks,generations=q.generations;var or=0;for(var i=0;i<generations.length;i++){var generationId=generations[i];var qMask=masks[generationId];var qNotMask=notMasks[generationId];var eMask=world2[$entityMasks][generationId][eid];if(qNotMask&&(eMask&qNotMask)!==0){return false}if(qMask&&(eMask&qMask)!==qMask){return false}}return true};var queryAddEntity=function(q,eid){if(q.has(eid))return;q.add(eid);q.entered.push(eid)};var queryCommitRemovals=function(q){for(var i=q.toRemove.dense.length-1;i>=0;i--){var eid=q.toRemove.dense[i];q.toRemove.remove(eid);q.remove(eid)}};var commitRemovals=function(world2){if(!world2[$dirtyQueries].size)return;world2[$dirtyQueries].forEach(queryCommitRemovals);world2[$dirtyQueries].clear()};var queryRemoveEntity=function(world2,q,eid){if(!q.has(eid)||q.toRemove.has(eid))return;q.toRemove.add(eid);world2[$dirtyQueries].add(q);q.exited.push(eid)};var $componentMap=Symbol("componentMap");var components=[];var defineComponent=function(schema){var component=createStore(schema,getGlobalSize());if(schema&&Object.keys(schema).length)components.push(component);return component};var incrementBitflag=function(world2){world2[$bitflag]*=2;if(world2[$bitflag]>=2**31){world2[$bitflag]=1;world2[$entityMasks].push(new Uint32Array(world2[$size]))}};var registerComponent=function(world2,component){if(!component)throw new Error("bitECS - Cannot register null or undefined component");var queries=new Set();var notQueries=new Set();var changedQueries=new Set();world2[$queries].forEach(function(q){if(q.allComponents.includes(component)){queries.add(q)}});world2[$componentMap].set(component,{generationId:world2[$entityMasks].length-1,bitflag:world2[$bitflag],store:component,queries:queries,notQueries:notQueries,changedQueries:changedQueries});if(component[$storeSize]<getGlobalSize()){resizeStore(component,getGlobalSize())}incrementBitflag(world2)};var hasComponent=function(world2,component,eid){var registeredComponent=world2[$componentMap].get(component);if(!registeredComponent)return;var generationId=registeredComponent.generationId,bitflag=registeredComponent.bitflag;var mask=world2[$entityMasks][generationId][eid];return(mask&bitflag)===bitflag};var addComponent=function(world2,component,eid,param){var reset=param===void 0?true:param;if(eid===void 0)throw new Error("bitECS - entity is undefined.");if(!world2[$entitySparseSet].has(eid))throw new Error("bitECS - entity does not exist in the world.");if(!world2[$componentMap].has(component))registerComponent(world2,component);if(hasComponent(world2,component,eid))return;var c=world2[$componentMap].get(component);var generationId=c.generationId,bitflag=c.bitflag,queries=c.queries,notQueries=c.notQueries;world2[$entityMasks][generationId][eid]|=bitflag;queries.forEach(function(q){if(q.toRemove.has(eid))q.toRemove.remove(eid);var match=queryCheckEntity(world2,q,eid);if(match)queryAddEntity(q,eid);if(!match)queryRemoveEntity(world2,q,eid)});world2[$entityComponents].get(eid).add(component);if(reset)resetStoreFor(component,eid)};var removeComponent=function(world2,component,eid,param){var reset=param===void 0?false:param;var c=world2[$componentMap].get(component);var generationId=c.generationId,bitflag=c.bitflag,queries=c.queries,notQueries=c.notQueries;if(!(world2[$entityMasks][generationId][eid]&bitflag))return;world2[$entityMasks][generationId][eid]&=~bitflag;queries.forEach(function(q){if(q.toRemove.has(eid))q.toRemove.remove(eid);var match=queryCheckEntity(world2,q,eid);if(match)queryAddEntity(q,eid);if(!match)queryRemoveEntity(world2,q,eid)});world2[$entityComponents].get(eid).delete(component);if(reset)resetStoreFor(component,eid)};var $size=Symbol("size");var $resizeThreshold=Symbol("resizeThreshold");var $bitflag=Symbol("bitflag");var $archetypes=Symbol("archetypes");var $localEntities=Symbol("localEntities");var $localEntityLookup=Symbol("localEntityLookp");var worlds=[];var createWorld=function(param){var obj=param===void 0?{}:param;var world2=obj;resetWorld(world2);worlds.push(world2);return world2};var resetWorld=function(world2){var size=getGlobalSize();world2[$size]=size;if(world2[$entityArray])world2[$entityArray].forEach(function(eid){return removeEntity(world2,eid)});world2[$entityMasks]=[new Uint32Array(size)];world2[$entityComponents]=new Map();world2[$archetypes]=[];world2[$entitySparseSet]=SparseSet();world2[$entityArray]=world2[$entitySparseSet].dense;world2[$bitflag]=1;world2[$componentMap]=new Map();world2[$queryMap]=new Map();world2[$queries]=new Set();world2[$notQueries]=new Set();world2[$dirtyQueries]=new Set();world2[$localEntities]=new Map();world2[$localEntityLookup]=new Map();return world2};var Types=TYPES_ENUM;var TRANSFORM={IS_ROOT:0,X:1,Y:2,ROTATION:3,SCALE_X:4,SCALE_Y:5,SKEW_X:6,SKEW_Y:7,AXIS_ALIGNED:8,FRAME_X1:9,FRAME_Y1:10,FRAME_X2:11,FRAME_Y2:12,LOCAL_A:13,LOCAL_B:14,LOCAL_C:15,LOCAL_D:16,LOCAL_TX:17,LOCAL_TY:18,BOUNDS_X1:19,BOUNDS_Y1:20,BOUNDS_X2:21,BOUNDS_Y2:22,ORIGIN_X:23,ORIGIN_Y:24,WORLD_A:25,WORLD_B:26,WORLD_C:27,WORLD_D:28,WORLD_TX:29,WORLD_TY:30,FRAME_WIDTH:31,FRAME_HEIGHT:32,IN_VIEW:33,UPDATED:34};var Transform2DComponent=defineComponent({data:[Types.f32,35]});var world=createWorld();var GameObjectWorld=world;function AddTransform2DComponent(id){addComponent(GameObjectWorld,Transform2DComponent,id);var data=Transform2DComponent.data[id];data[TRANSFORM.SCALE_X]=1;data[TRANSFORM.SCALE_Y]=1;data[TRANSFORM.AXIS_ALIGNED]=1}function NOOP(){}var Matrix4=function(){"use strict";function _class(src){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"data",void 0);swcHelpers.defineProperty(this,"onChange",void 0);var data=new Float32Array(16);this.data=data;this.onChange=NOOP;if(src){if(Array.isArray(src)){this.fromArray(src)}else{this.fromArray(src.data)}}else{data[0]=1;data[5]=1;data[10]=1;data[15]=1}}swcHelpers.createClass(_class,[{key:"set",value:function set(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){this.data.set([m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33]);this.onChange(this);return this}},{key:"toArray",value:function toArray(param,param1){var dst=param===void 0?[]:param,index=param1===void 0?0:param1;var data=this.data;for(var i=0;i<16;i++){dst[index+i]=data[i]}return dst}},{key:"fromArray",value:function fromArray(src,param){var index=param===void 0?0:param;var data=this.data;for(var i=0;i<16;i++){data[i]=src[index+i]}this.onChange(this);return this}},{key:"toString",value:function toString(){return"[ mat4="+this.data.join(", ")+" ]"}},{key:"destroy",value:function destroy(){this.onChange=NOOP;this.data=null}}]);return _class}();function SetBounds(id,x,y,right,bottom){var data=Transform2DComponent.data[id];data[TRANSFORM.BOUNDS_X1]=x;data[TRANSFORM.BOUNDS_Y1]=y;data[TRANSFORM.BOUNDS_X2]=right;data[TRANSFORM.BOUNDS_Y2]=bottom}var DIRTY={TRANSFORM:0,CHILD_TRANSFORM:1,COLOR:2,CHILD_COLOR:3,CHILD_CACHE:4,WORLD_TRANSFORM:5,DISPLAY_LIST:6,SELF:7};var DirtyComponent=defineComponent({data:[Types.ui8,8]});var instance2;var frame=0;var elapsed=0;var GameInstance={get:function(){return instance2},set:function(game){instance2=game},getFrame:function(){return frame},setFrame:function(current){frame=current},getElapsed:function(){return elapsed},setElapsed:function(current){elapsed=current}};var HIERARCHY={WORLD:0,PARENT:1,NEXT:2,PREV:3,FIRST:4,LAST:5,NUM_CHILDREN:6,DEPTH:7};var HierarchyComponent=defineComponent({data:[Types.ui32,8]});function GetParentID(id){return HierarchyComponent.data[id][HIERARCHY.PARENT]}function SetDirtyChildCache(id){DirtyComponent.data[id][DIRTY.CHILD_CACHE]=1}function SetDirtyChildTransform(id){DirtyComponent.data[id][DIRTY.CHILD_TRANSFORM]=1}var PERMISSION={VISIBLE:0,VISIBLE_CHILDREN:1,WILL_UPDATE:2,WILL_UPDATE_CHILDREN:3,WILL_RENDER:4,WILL_RENDER_CHILDREN:5,WILL_CACHE_CHILDREN:6,WILL_TRANSFORM_CHILDREN:7,WILL_COLOR_CHILDREN:8,CUSTOM_DISPLAY_LIST:9};var PermissionsComponent=defineComponent({data:[Types.ui8,10]});function WillCacheChildren(id){return!!PermissionsComponent.data[id][PERMISSION.WILL_CACHE_CHILDREN]}var prevParentID;var prevFrame;function SetDirtyParents(childID){var id=GetParentID(childID);var frame2=GameInstance.getFrame();if(id===prevParentID&&frame2===prevFrame){return}prevParentID=id;prevFrame=frame2;while(id){SetDirtyChildTransform(id);if(WillCacheChildren(id)){SetDirtyChildCache(id)}id=GetParentID(id)}}function SetDirtyTransform(id){DirtyComponent.data[id][DIRTY.TRANSFORM]=1;SetDirtyParents(id)}function UpdateExtent(id,width,height){var data=Transform2DComponent.data[id];var x=-data[TRANSFORM.ORIGIN_X]*width;var y=-data[TRANSFORM.ORIGIN_Y]*height;data[TRANSFORM.FRAME_X1]=x;data[TRANSFORM.FRAME_Y1]=y;data[TRANSFORM.FRAME_X2]=x+width;data[TRANSFORM.FRAME_Y2]=y+height;data[TRANSFORM.FRAME_WIDTH]=width;data[TRANSFORM.FRAME_HEIGHT]=height;SetDirtyTransform(id)}var Size=function(){"use strict";function _class(id,param,param1){var width=param===void 0?0:param,height=param1===void 0?0:param1;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"id",void 0);swcHelpers.defineProperty(this,"_data",void 0);this.id=id;this._data=Transform2DComponent.data[id];this.set(width,height)}swcHelpers.createClass(_class,[{key:"set",value:function set(width,param){var height=param===void 0?width:param;this.width=width;this.height=height;return this}},{key:"width",get:function get(){return this._data[TRANSFORM.FRAME_WIDTH]},set:function set(value){UpdateExtent(this.id,value,this.height)}},{key:"height",get:function get(){return this._data[TRANSFORM.FRAME_HEIGHT]},set:function set(value){UpdateExtent(this.id,this.width,value)}},{key:"x",get:function get(){return this.width},set:function set(value){this.width=value}},{key:"y",get:function get(){return this.height},set:function set(value){this.height=value}},{key:"destroy",value:function destroy(){this._data=null}}]);return _class}();var BaseCamera=function(){"use strict";function _class(width,height){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"id",addEntity(GameObjectWorld));swcHelpers.defineProperty(this,"type","BaseCamera");swcHelpers.defineProperty(this,"name","");swcHelpers.defineProperty(this,"size",void 0);swcHelpers.defineProperty(this,"matrix",void 0);swcHelpers.defineProperty(this,"isDirty",void 0);swcHelpers.defineProperty(this,"_data",void 0);var id=this.id;AddTransform2DComponent(id);this.matrix=new Matrix4();this.size=new Size(id,width,height);this._data=Transform2DComponent.data[id];this.reset(width,height)}swcHelpers.createClass(_class,[{key:"preRender",value:function preRender(){return this.isDirty}},{key:"postRender",value:function postRender(){this.isDirty=false}},{key:"getBoundsX",value:function getBoundsX(){return this._data[TRANSFORM.BOUNDS_X1]}},{key:"getBoundsY",value:function getBoundsY(){return this._data[TRANSFORM.BOUNDS_Y1]}},{key:"getBoundsRight",value:function getBoundsRight(){return this._data[TRANSFORM.BOUNDS_X2]}},{key:"getBoundsBottom",value:function getBoundsBottom(){return this._data[TRANSFORM.BOUNDS_Y2]}},{key:"getMatrix",value:function getMatrix(){return this.matrix.data}},{key:"reset",value:function reset(width,height){this.size.set(width,height);this.isDirty=true;SetBounds(this.id,0,0,width,height)}},{key:"destroy",value:function destroy(){var id=this.id;removeComponent(GameObjectWorld,Transform2DComponent,id);removeEntity(GameObjectWorld,id)}}]);return _class}();function ClearDirtyTransform(id){DirtyComponent.data[id][DIRTY.TRANSFORM]=0}function HasDirtyTransform(id){return!!DirtyComponent.data[id][DIRTY.TRANSFORM]}var StaticCamera=function(BaseCamera){"use strict";swcHelpers.inherits(_class,BaseCamera);function _class(width,height){swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,width,height));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"type","StaticCamera");return _this}swcHelpers.createClass(_class,[{key:"preRender",value:function preRender(){var id=this.id;if(HasDirtyTransform(id)){this.isDirty=true;ClearDirtyTransform(id);return true}return false}}]);return _class}(BaseCamera);var Position=function(){"use strict";function _class(id,param,param1){var x=param===void 0?0:param,y=param1===void 0?0:param1;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"id",void 0);swcHelpers.defineProperty(this,"_x",void 0);swcHelpers.defineProperty(this,"_y",void 0);swcHelpers.defineProperty(this,"_data",void 0);this.id=id;this._data=Transform2DComponent.data[id];this.set(x,y)}swcHelpers.createClass(_class,[{key:"set",value:function set(x,param){var y=param===void 0?x:param;this.x=x;this.y=y;return this}},{key:"x",get:function get(){return this._x},set:function set(value){this._x=value;this._data[TRANSFORM.X]=value;SetDirtyTransform(this.id)}},{key:"y",get:function get(){return this._y},set:function set(value){this._y=value;this._data[TRANSFORM.Y]=value;SetDirtyTransform(this.id)}},{key:"destroy",value:function destroy(){this._data=null}}]);return _class}();var WorldCamera=function(BaseCamera){"use strict";swcHelpers.inherits(_class,BaseCamera);function _class(width,height){swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,width,height));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"type","WorldCamera");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"position",void 0);_this.position=new Position(_this.id,0,0);return _this}swcHelpers.createClass(_class,[{key:"x",get:function get(){return this.position.x},set:function set(value){this.position.x=value}},{key:"y",get:function get(){return this.position.y},set:function set(value){this.position.y=value}},{key:"setPosition",value:function setPosition(x,y){this.position.set(x,y);return this}},{key:"preRender",value:function preRender(){var id=this.id;if(HasDirtyTransform(id)){var x=this.x;var y=this.y;var w=this.size.width;var h=this.size.height;var ox=-x+w/2;var oy=-y+h/2;var bx=ox-w/2;var by=oy-h/2;SetBounds(id,bx,by,bx+w,by+h);var data=this.matrix.data;data[12]=this.x;data[13]=this.y;ClearDirtyTransform(id);this.isDirty=true;return true}return false}}]);return _class}(BaseCamera);var color_exports={};__export(color_exports,{CloneColor:function(){return CloneColor},Color:function(){return Color},FromHSV:function(){return FromHSV},GetColorFromRGB:function(){return GetColorFromRGB},GetColorSpectrum:function(){return GetColorSpectrum},RGBAToFloat:function(){return RGBAToFloat},RGBToFloat:function(){return RGBToFloat},SetGray:function(){return SetGray},SetHSV:function(){return SetHSV}});var Color=function(){"use strict";function _class(param,param1,param2,param3){var red=param===void 0?0:param,green=param1===void 0?0:param1,blue=param2===void 0?0:param2,alpha=param3===void 0?255:param3;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"rgba",void 0);this.rgba=new Uint8ClampedArray([red,green,blue,alpha])}swcHelpers.createClass(_class,[{key:"set",value:function set(red,green,blue,param){var alpha=param===void 0?this.alpha:param;this.rgba.set([red,green,blue,alpha]);return this}},{key:"setColor",value:function setColor(color){var rgba=this.rgba;var alpha=color>16777215?color>>>24:255;rgba.set([color>>16&255,color>>8&255,color&255,alpha]);return this}},{key:"getColor",value:function getColor(param){var includeAlpha=param===void 0?false:param;var _rgba=this.rgba,r=_rgba[0],g=_rgba[1],b=_rgba[2],a=_rgba[3];if(includeAlpha){return a<<24|r<<16|g<<8|b}else{return r<<16|g<<8|b}}},{key:"red",get:function get(){return this.rgba[0]},set:function set(value){this.rgba[0]=value}},{key:"green",get:function get(){return this.rgba[1]},set:function set(value){this.rgba[1]=value}},{key:"blue",get:function get(){return this.rgba[2]},set:function set(value){this.rgba[2]=value}},{key:"alpha",get:function get(){return this.rgba[3]},set:function set(value){this.rgba[3]=value}},{key:"r",get:function get(){return this.rgba[0]/255}},{key:"g",get:function get(){return this.rgba[1]/255}},{key:"b",get:function get(){return this.rgba[2]/255}},{key:"a",get:function get(){return this.rgba[3]/255}}]);return _class}();function CloneColor(color){return new Color(color.red,color.green,color.blue,color.alpha)}function ConvertValue(n,h,s,v){var k=(n+h*6)%6;var min=Math.min(k,4-k,1);return Math.round(255*(v-v*s*Math.max(0,min)))}function SetHSV(color,h,param,param1){var s=param===void 0?1:param,v=param1===void 0?1:param1;var r=ConvertValue(5,h,s,v);var g=ConvertValue(3,h,s,v);var b=ConvertValue(1,h,s,v);return color.set(r,g,b)}function FromHSV(h,param,param1){var s=param===void 0?1:param,v=param1===void 0?1:param1;return SetHSV(new Color(),h,s,v)}function GetColorFromRGB(red,green,blue){return red<<16|green<<8|blue}function GetColorSpectrum(param){var limit=param===void 0?1024:param;var colors=[];var range=255;var i;var r=255;var g=0;var b=0;for(i=0;i<=range;i++){colors.push(new Color(r,i,b))}g=255;for(i=range;i>=0;i--){colors.push(new Color(i,g,b))}r=0;for(i=0;i<=range;i++,g--){colors.push(new Color(r,g,i))}g=0;b=255;for(i=0;i<=range;i++,b--,r++){colors.push(new Color(r,g,b))}if(limit===1024){return colors}else{var out=[];var t=0;var inc=1024/limit;for(i=0;i<limit;i++){out.push(colors[Math.floor(t)]);t+=inc}return out}}function RGBAToFloat(red,green,blue,alpha){return alpha<<24|red<<16|green<<8|blue}function RGBToFloat(red,green,blue){return red<<16|green<<8|blue}function SetGray(color,amount){return color.set(amount,amount,amount)}var config_exports={};__export(config_exports,{BackgroundColor:function(){return BackgroundColor},Banner:function(){return Banner},BatchSize:function(){return BatchSize},Canvas:function(){return Canvas},CanvasContext:function(){return CanvasContext},DefaultOrigin:function(){return DefaultOrigin},GlobalVar:function(){return GlobalVar},MaxTextures:function(){return MaxTextures},Parent:function(){return Parent},Scenes:function(){return Scenes},Size:function(){return Size2},WebGL:function(){return WebGL},WebGLContext:function(){return WebGLContext}});var CONFIG_DEFAULTS={AUTO:"Auto",BACKGROUND_COLOR:"BackgroundColor",BANNER:"Banner",BATCH_SIZE:"BatchSize",CANVAS_CONTEXT:"CanvasContext",CANVAS:"Canvas",DEFAULT_ORIGIN:"DefaultOrigin",GLOBAL_VAR:"GlobalVar",MAX_TEXTURES:"MaxTextures",PARENT:"Parent",RENDERER:"Renderer",SCENES:"Scenes",SIZE:"Size",WEBGL_CONTEXT:"WebGLContext",WEBGL:"WebGL",WORLD_SIZE:"WorldSize",WORLD_WIDTH:"WorldWidth",WORLD_HEIGHT:"WorldHeight"};var ConfigStore=new Map();function SetBackgroundColor(color){ConfigStore.set(CONFIG_DEFAULTS.BACKGROUND_COLOR,color)}function BackgroundColor(color){return function(){SetBackgroundColor(color)}}function SetBanner(param,param1,param2,param3,param4){var title=param===void 0?"":param,version=param1===void 0?"":param1,url=param2===void 0?"":param2,color=param3===void 0?"#fff":param3,background=param4===void 0?"linear-gradient(#3e0081 40%, #00bcc3)":param4;ConfigStore.set(CONFIG_DEFAULTS.BANNER,{title:title,version:version,url:url,color:color,background:background})}function Banner(title,version,url,color,background){return function(){SetBanner(title,version,url,color,background)}}function SetBatchSize(size){ConfigStore.set(CONFIG_DEFAULTS.BATCH_SIZE,size)}function BatchSize(size){return function(){SetBatchSize(size)}}function GetBackgroundColor(){return ConfigStore.get(CONFIG_DEFAULTS.BACKGROUND_COLOR)}function GetCanvasContext(){return ConfigStore.get(CONFIG_DEFAULTS.CANVAS_CONTEXT)}function GetHeight(){return ConfigStore.get(CONFIG_DEFAULTS.SIZE).height}function GetResolution(){return ConfigStore.get(CONFIG_DEFAULTS.SIZE).resolution}function GetWidth(){return ConfigStore.get(CONFIG_DEFAULTS.SIZE).width}var CanvasRenderer=function(){"use strict";function _class(){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"canvas",void 0);swcHelpers.defineProperty(this,"ctx",void 0);swcHelpers.defineProperty(this,"clearColor",void 0);swcHelpers.defineProperty(this,"width",void 0);swcHelpers.defineProperty(this,"height",void 0);swcHelpers.defineProperty(this,"resolution",void 0);swcHelpers.defineProperty(this,"textureIndex",void 0);swcHelpers.defineProperty(this,"flushTotal",void 0);swcHelpers.defineProperty(this,"clearBeforeRender",true);swcHelpers.defineProperty(this,"optimizeRedraw",true);swcHelpers.defineProperty(this,"autoResize",true);this.width=GetWidth();this.height=GetHeight();this.resolution=GetResolution();this.setBackgroundColor(GetBackgroundColor());var canvas=document.createElement("canvas");this.canvas=canvas;this.initContext()}swcHelpers.createClass(_class,[{key:"initContext",value:function initContext(){var ctx=this.canvas.getContext("2d",GetCanvasContext());this.ctx=ctx;this.resize(this.width,this.height,this.resolution)}},{key:"resize",value:function resize(width,height,param){var resolution=param===void 0?1:param;this.width=width*resolution;this.height=height*resolution;this.resolution=resolution;var canvas=this.canvas;canvas.width=this.width;canvas.height=this.height;if(this.autoResize){canvas.style.width=(this.width/resolution).toString()+"px";canvas.style.height=(this.height/resolution).toString()+"px"}}},{key:"setBackgroundColor",value:function setBackgroundColor(color){var r=color>>16&255;var g=color>>8&255;var b=color&255;var a=color>16777215?color>>>24:255;this.clearColor="rgba(".concat(r,", ").concat(g,", ").concat(b,", ").concat(a,")");return this}},{key:"reset",value:function reset(){var ctx=this.ctx;ctx.globalAlpha=1;ctx.globalCompositeOperation="source-over";ctx.setTransform(1,0,0,1,0,0)}},{key:"begin",value:function begin(willRedraw){}},{key:"end",value:function end(){}},{key:"render",value:function render(){}},{key:"destroy",value:function destroy(){}}]);return _class}();function SetRenderer(renderer){ConfigStore.set(CONFIG_DEFAULTS.RENDERER,renderer)}function Canvas(){return function(){SetRenderer(CanvasRenderer)}}function SetCanvasContext(contextAttributes){ConfigStore.set(CONFIG_DEFAULTS.CANVAS_CONTEXT,contextAttributes)}function CanvasContext(contextAttributes){return function(){SetCanvasContext(contextAttributes)}}function SetDefaultOrigin(param,param1){var x=param===void 0?0.5:param,y=param1===void 0?x:param1;ConfigStore.set(CONFIG_DEFAULTS.DEFAULT_ORIGIN,{x:x,y:y})}function DefaultOrigin(param,param1){var x=param===void 0?0.5:param,y=param1===void 0?x:param1;return function(){SetDefaultOrigin(x,y)}}function SetGlobalVar(name){ConfigStore.set(CONFIG_DEFAULTS.GLOBAL_VAR,name)}function GlobalVar(name){return function(){SetGlobalVar(name)}}function SetMaxTextures(max){ConfigStore.set(CONFIG_DEFAULTS.MAX_TEXTURES,max)}function MaxTextures(param){var max=param===void 0?0:param;return function(){SetMaxTextures(max)}}function GetElement(target){var element;if(target){if(typeof target==="string"){element=document.getElementById(target)}else if(typeof target==="object"&&target.nodeType===1){element=target}}if(!element){element=document.body}return element}function SetParent(parentElement){if(parentElement){ConfigStore.set(CONFIG_DEFAULTS.PARENT,GetElement(parentElement))}}function Parent(parentElement){return function(){SetParent(parentElement)}}function SetScenes(scenes){ConfigStore.set(CONFIG_DEFAULTS.SCENES,[].concat(scenes))}function Scenes(scenes){return function(){SetScenes(scenes)}}function SetSize(param,param1,param2){var width=param===void 0?800:param,height=param1===void 0?600:param1,resolution=param2===void 0?1:param2;if(resolution===0){resolution=window.devicePixelRatio}ConfigStore.set(CONFIG_DEFAULTS.SIZE,{width:width,height:height,resolution:resolution})}function Size2(param,param1,param2){var width=param===void 0?800:param,height=param1===void 0?600:param1,resolution=param2===void 0?1:param2;return function(){SetSize(width,height,resolution)}}var ShaderStack={renderPass:null,stack:[],active:null,default:null,index:0,init:function(renderPass){ShaderStack.renderPass=renderPass}};function CurrentShader(){return ShaderStack.stack[ShaderStack.index]}var VertexBufferStack={renderPass:null,stack:[],active:null,default:null,index:0,init:function(renderPass){VertexBufferStack.renderPass=renderPass}};function CurrentVertexBuffer(){return VertexBufferStack.stack[VertexBufferStack.index]}var FramebufferStack={renderPass:null,stack:[],active:null,default:null,index:0,init:function(renderPass){FramebufferStack.renderPass=renderPass}};function CurrentFramebuffer(){return FramebufferStack.stack[FramebufferStack.index]}function RectangleContains(rect,x,y){if(rect.width<=0||rect.height<=0){return false}return rect.x<=x&&rect.x+rect.width>=x&&rect.y<=y&&rect.y+rect.height>=y}var Rectangle=function(){"use strict";function _class(param,param1,param2,param3){var x=param===void 0?0:param,y=param1===void 0?0:param1,width=param2===void 0?0:param2,height=param3===void 0?0:param3;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"x",void 0);swcHelpers.defineProperty(this,"y",void 0);swcHelpers.defineProperty(this,"width",void 0);swcHelpers.defineProperty(this,"height",void 0);this.set(x,y,width,height)}swcHelpers.createClass(_class,[{key:"set",value:function set(param,param1,param2,param3){var x=param===void 0?0:param,y=param1===void 0?0:param1,width=param2===void 0?0:param2,height=param3===void 0?0:param3;this.x=x;this.y=y;this.width=width;this.height=height;return this}},{key:"contains",value:function contains(x,y){return RectangleContains(this,x,y)}},{key:"right",get:function get(){return this.x+this.width},set:function set(value){if(value<=this.x){this.width=0}else{this.width=value-this.x}}},{key:"bottom",get:function get(){return this.y+this.height},set:function set(value){if(value<=this.y){this.height=0}else{this.height=value-this.y}}}]);return _class}();var ViewportStack={renderPass:null,stack:[],active:null,default:null,index:0,init:function(renderPass){ViewportStack.renderPass=renderPass}};function AddViewport(param,param1,param2,param3){var x=param===void 0?0:param,y=param1===void 0?0:param1,width=param2===void 0?0:param2,height=param3===void 0?0:param3;var entry=new Rectangle(x,y,width,height);ViewportStack.index++;if(ViewportStack.index===ViewportStack.stack.length){ViewportStack.stack.push(entry)}else{ViewportStack.stack[ViewportStack.index]=entry}return entry}function CurrentViewport(){return ViewportStack.stack[ViewportStack.index]}function RectangleEquals(rect,toCompare){return rect.x===toCompare.x&&rect.y===toCompare.y&&rect.width===toCompare.width&&rect.height===toCompare.height}var gl;var GL={get:function(){return gl},set:function(context){gl=context}};function BindViewport(viewport){if(!viewport){viewport=CurrentViewport()}if(!ViewportStack.active||!RectangleEquals(ViewportStack.active,viewport)){gl.viewport(viewport.x,viewport.y,viewport.width,viewport.height);ViewportStack.active=viewport}}function SetViewport(param,param1,param2,param3){var x=param===void 0?0:param,y=param1===void 0?0:param1,width=param2===void 0?0:param2,height=param3===void 0?0:param3;var entry=AddViewport(x,y,width,height);BindViewport(entry)}function BindFramebuffer(param,entry){var clear=param===void 0?true:param;if(!entry){entry=CurrentFramebuffer()}var framebuffer=entry.framebuffer,viewport=entry.viewport;if(FramebufferStack.active!==framebuffer){gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer)}if(clear){gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT)}if(viewport){SetViewport(viewport.x,viewport.y,viewport.width,viewport.height)}FramebufferStack.active=framebuffer}function PopViewport(){ViewportStack.index--;BindViewport()}function PopFramebuffer(){if(CurrentFramebuffer().viewport){PopViewport()}FramebufferStack.index--;BindFramebuffer(false)}var BlendModeStack={renderPass:null,stack:[],default:null,index:0,init:function(renderPass){BlendModeStack.renderPass=renderPass}};var ColorMatrixStack={renderPass:null,stack:[],default:null,index:0,init:function(renderPass){ColorMatrixStack.renderPass=renderPass}};function AddColorMatrix(colorMatrix,colorOffset){var entry={colorMatrix:colorMatrix,colorOffset:colorOffset};ColorMatrixStack.index++;if(ColorMatrixStack.index===ColorMatrixStack.stack.length){ColorMatrixStack.stack.push(entry)}else{ColorMatrixStack.stack[ColorMatrixStack.index]=entry}return entry}function AddFramebuffer(framebuffer,viewport){var entry={framebuffer:framebuffer,viewport:viewport};FramebufferStack.index++;if(FramebufferStack.index===FramebufferStack.stack.length){FramebufferStack.stack.push(entry)}else{FramebufferStack.stack[FramebufferStack.index]=entry}return entry}function AddShader(shader,textureID){var entry={shader:shader,textureID:textureID};ShaderStack.index++;if(ShaderStack.index===ShaderStack.stack.length){ShaderStack.stack.push(entry)}else{ShaderStack.stack[ShaderStack.index]=entry}return entry}function SetAttributes(shader,renderPass){if(shader.program){var stride=CurrentVertexBuffer().vertexByteSize;shader.attributes.forEach(function(attrib){gl.vertexAttribPointer(attrib.index,attrib.size,attrib.type,attrib.normalized,stride,attrib.offset)})}}function BindShaderEntry(entry){if(!entry){entry=CurrentShader()}if(!entry.shader.isActive){var success=entry.shader.bind(ShaderStack.renderPass,entry.textureID);if(success){SetAttributes(entry.shader,ShaderStack.renderPass);if(ShaderStack.active&&ShaderStack.active!==entry.shader){ShaderStack.active.isActive=false}ShaderStack.active=entry.shader}}}function BindDefaultShader(){ShaderStack.index=0;BindShaderEntry(ShaderStack.default)}function SetCamera(renderPass,camera){if(renderPass.current2DCamera!==camera){Flush(renderPass);renderPass.current2DCamera=camera;renderPass.cameraMatrix=camera.getMatrix()}if(camera.isDirty){CurrentShader().shader.bind(renderPass)}}function Begin(renderPass,camera){BindDefaultShader();SetCamera(renderPass,camera)}function CurrentBlendMode(){return BlendModeStack.stack[BlendModeStack.index]}function BindBlendMode(entry){if(!entry){entry=CurrentBlendMode()}if(entry.enable){if(!gl.isEnabled(gl.BLEND)){gl.enable(gl.BLEND);gl.blendFuncSeparate(entry.srcRGB,entry.dstRGB,entry.srcAlpha,entry.dstAlpha)}}else{gl.disable(gl.BLEND)}}function CurrentColorMatrix(){return ColorMatrixStack.stack[ColorMatrixStack.index]}function SetUniform(shader,key,value){var uniforms=shader.uniforms;if(uniforms.has(key)){uniforms.set(key,value);if(shader.isActive){var setter=shader.uniformSetters.get(key);setter(value)}}}function BindColorMatrix(entry){if(!entry){entry=CurrentColorMatrix()}var shader=CurrentShader().shader;Flush(ColorMatrixStack.renderPass);SetUniform(shader,"uColorMatrix",entry.colorMatrix);SetUniform(shader,"uColorOffset",entry.colorOffset)}function BindDefaultBlendMode(){BlendModeStack.index=0;BindBlendMode(BlendModeStack.default)}function BindDefaultColorMatrix(){ColorMatrixStack.index=0;BindColorMatrix(ColorMatrixStack.default)}function BindDefaultFramebuffer(){FramebufferStack.index=0;BindFramebuffer(false,FramebufferStack.default)}function BindVertexBuffer(buffer){if(!buffer){buffer=CurrentVertexBuffer()}if(!buffer.isBound){var indexBuffer=buffer.indexed?buffer.indexBuffer:null;gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,indexBuffer);gl.bindBuffer(gl.ARRAY_BUFFER,buffer.vertexBuffer);buffer.isBound=true;if(VertexBufferStack.active&&VertexBufferStack.active!==buffer){VertexBufferStack.active.isBound=false}VertexBufferStack.active=buffer}}function BindDefaultVertexBuffer(){VertexBufferStack.index=0;BindVertexBuffer(VertexBufferStack.default)}function BindDefaultViewport(){ViewportStack.index=0;BindViewport(ViewportStack.default)}function BindTexture(texture,param){var index=param===void 0?1:param;var binding=texture.binding;binding.bind(index);gl.activeTexture(gl.TEXTURE0+index);gl.bindTexture(gl.TEXTURE_2D,binding.texture)}var TextureStack={renderPass:null,textures:null,tempTextures:null,textureIndex:[],maxTextures:0,init:function(renderPass){TextureStack.renderPass=renderPass}};function ClearTextures(){TextureStack.textures.forEach(function(texture){if(texture){texture.binding.unbind()}});TextureStack.textures.clear()}function GetMaxTextures(){return ConfigStore.get(CONFIG_DEFAULTS.MAX_TEXTURES)}function CreateTempTextures(){var maxGPUTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);var maxCombinedGPUTextures=gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS);console.log("MAX GPU",maxGPUTextures,"MAX COMBINED",maxCombinedGPUTextures);var maxConfigTextures=GetMaxTextures();if(maxConfigTextures===0||maxConfigTextures>maxGPUTextures){SetMaxTextures(maxGPUTextures)}else{maxGPUTextures=maxConfigTextures}var textures=[];for(var i=0;i<maxGPUTextures;i++){var tempTexture=gl.createTexture();gl.activeTexture(gl.TEXTURE0+i);gl.bindTexture(gl.TEXTURE_2D,tempTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]));textures.push([i,tempTexture])}return textures}var bufferEntry={buffer:null,F32:null,offset:0};function GetVertexBufferEntry(renderPass,param){var addToCount=param===void 0?0:param;var buffer=CurrentVertexBuffer();if(renderPass.count+addToCount>=buffer.batchSize){Flush(renderPass)}bufferEntry.buffer=buffer;bufferEntry.F32=buffer.vertexViewF32;bufferEntry.offset=renderPass.count*buffer.entryElementSize;renderPass.count+=addToCount;return bufferEntry}function PopColorMatrix(){ColorMatrixStack.index--;BindColorMatrix()}function PopColor(renderPass,color){if(color.colorMatrixEnabled&&color.willColorChildren){PopColorMatrix()}}function PopShader(){ShaderStack.index--;BindShaderEntry()}function CreateFramebuffer(texture,attachment){if(!attachment){attachment=gl.COLOR_ATTACHMENT0}var framebuffer=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,attachment,gl.TEXTURE_2D,texture,0);gl.bindFramebuffer(gl.FRAMEBUFFER,null);return framebuffer}function CreateGLTexture(binding,mipmaps){var generateMipmap=binding.generateMipmap,minFilter=binding.minFilter,parent=binding.parent,compressed=binding.compressed,internalFormat=binding.internalFormat,flipY=binding.flipY,unpackPremultiplyAlpha=binding.unpackPremultiplyAlpha,magFilter=binding.magFilter,wrapS=binding.wrapS,wrapT=binding.wrapT,isPOT=binding.isPOT;var source=parent.image;var width=parent.width;var height=parent.height;var glTexture=gl.createTexture();gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,glTexture);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,flipY);gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,unpackPremultiplyAlpha);if(source){gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,source);width=source.width;height=source.height}else if(compressed&&mipmaps){for(var i=0;i<mipmaps.length;i++){gl.compressedTexImage2D(gl.TEXTURE_2D,i,internalFormat,mipmaps[i].width,mipmaps[i].height,0,mipmaps[i].data)}}else{gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,null)}gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,minFilter);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,magFilter);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,wrapS);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,wrapT);if(generateMipmap&&isPOT){gl.generateMipmap(gl.TEXTURE_2D)}binding.texture=glTexture;return glTexture}function DeleteFramebuffer(framebuffer){if(gl&&gl.isFramebuffer(framebuffer)){gl.deleteFramebuffer(framebuffer)}}function DeleteGLTexture(texture){if(gl.isTexture(texture)){gl.deleteTexture(texture)}}function IsSizePowerOfTwo(width,height){if(width<1||height<1){return false}return(width&width-1)===0&&(height&height-1)===0}function SetGLTextureFilterMode(texture,param){var linear=param===void 0?true:param;gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,texture);var mode=linear?gl.LINEAR:gl.NEAREST;gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,mode);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,mode)}function UpdateGLTexture(binding){var source=binding.parent.image;var width=source.width;var height=source.height;if(width>0&&height>0){gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,binding.texture);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,binding.flipY);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,source)}return binding.texture}var GLTextureBinding=function(){"use strict";function _class(parent,param){var config=param===void 0?{}:param;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"parent",void 0);swcHelpers.defineProperty(this,"texture",void 0);swcHelpers.defineProperty(this,"framebuffer",void 0);swcHelpers.defineProperty(this,"depthbuffer",void 0);swcHelpers.defineProperty(this,"format",void 0);swcHelpers.defineProperty(this,"internalFormat",void 0);swcHelpers.defineProperty(this,"compressed",void 0);swcHelpers.defineProperty(this,"mipmaps",void 0);swcHelpers.defineProperty(this,"isBound",false);swcHelpers.defineProperty(this,"textureUnit",0);swcHelpers.defineProperty(this,"unpackPremultiplyAlpha",true);swcHelpers.defineProperty(this,"minFilter",void 0);swcHelpers.defineProperty(this,"magFilter",void 0);swcHelpers.defineProperty(this,"wrapS",void 0);swcHelpers.defineProperty(this,"wrapT",void 0);swcHelpers.defineProperty(this,"flipY",false);swcHelpers.defineProperty(this,"isPOT",false);swcHelpers.defineProperty(this,"generateMipmap",false);this.parent=parent;this.isPOT=IsSizePowerOfTwo(parent.width,parent.height);var _mipmaps=config.mipmaps,mipmaps=_mipmaps===void 0?null:_mipmaps,_compressed=config.compressed,compressed=_compressed===void 0?false:_compressed,_format=config.format,format=_format===void 0?"IMG":_format,_internalFormat=config.internalFormat,internalFormat=_internalFormat===void 0?0:_internalFormat,_texture=config.texture,texture=_texture===void 0?null:_texture,_framebuffer=config.framebuffer,framebuffer=_framebuffer===void 0?null:_framebuffer,_createFramebuffer=config.createFramebuffer,createFramebuffer=_createFramebuffer===void 0?false:_createFramebuffer,_depthbuffer=config.depthbuffer,depthbuffer=_depthbuffer===void 0?null:_depthbuffer,_unpackPremultiplyAlpha=config.unpackPremultiplyAlpha,unpackPremultiplyAlpha=_unpackPremultiplyAlpha===void 0?true:_unpackPremultiplyAlpha,_minFilter=config.minFilter,minFilter=_minFilter===void 0?this.isPOT?gl.LINEAR_MIPMAP_LINEAR:gl.LINEAR:_minFilter,_magFilter=config.magFilter,magFilter=_magFilter===void 0?gl.LINEAR:_magFilter,_wrapS=config.wrapS,wrapS=_wrapS===void 0?gl.CLAMP_TO_EDGE:_wrapS,_wrapT=config.wrapT,wrapT=_wrapT===void 0?gl.CLAMP_TO_EDGE:_wrapT,_generateMipmap=config.generateMipmap,generateMipmap=_generateMipmap===void 0?this.isPOT:_generateMipmap,_flipY=config.flipY,flipY=_flipY===void 0?false:_flipY;this.compressed=compressed;this.format=format;this.internalFormat=internalFormat;this.mipmaps=mipmaps;if(compressed){this.minFilter=gl.LINEAR}else{this.minFilter=minFilter}this.magFilter=magFilter;this.wrapS=wrapS;this.wrapT=wrapT;this.generateMipmap=generateMipmap;this.flipY=flipY;this.unpackPremultiplyAlpha=unpackPremultiplyAlpha;if(texture){this.texture=texture}else{CreateGLTexture(this,mipmaps)}if(framebuffer){this.framebuffer=framebuffer}else if(createFramebuffer){this.framebuffer=CreateFramebuffer(this.texture)}if(depthbuffer){this.depthbuffer=depthbuffer}parent.binding=this}swcHelpers.createClass(_class,[{key:"setFilter",value:function setFilter(linear){if(this.texture){SetGLTextureFilterMode(this.texture,linear)}}},{key:"create",value:function create(){var texture=this.texture;if(texture){DeleteGLTexture(texture)}return CreateGLTexture(this)}},{key:"update",value:function update(){var texture=this.texture;if(!texture){return CreateGLTexture(this)}else{return UpdateGLTexture(this)}}},{key:"bind",value:function bind(index){this.isBound=true;this.textureUnit=index}},{key:"unbind",value:function unbind(){this.isBound=false;this.textureUnit=0}},{key:"destroy",value:function destroy(){this.unbind();DeleteGLTexture(this.texture);DeleteFramebuffer(this.framebuffer);this.parent=null;this.texture=null;this.framebuffer=null}}]);return _class}();function ProcessBindingQueue(){var queue2=BindingQueue.get();queue2.forEach(function(entry){var texture=entry.texture,glConfig=entry.glConfig;if(!texture.binding){texture.binding=new GLTextureBinding(texture,glConfig)}});BindingQueue.clear()}var DEFAULT_COLOR_MATRIX=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);var DEFAULT_COLOR_OFFSET=new Float32Array(4);function GetBatchSize(){return ConfigStore.get(CONFIG_DEFAULTS.BATCH_SIZE)}function Mat4Ortho(matrix2,left,right,bottom,top,near,far){var lr=1/(left-right);var bt=1/(bottom-top);var nf=1/(near-far);matrix2.set([-2*lr,0,0,0,0,-2*bt,0,0,0,0,2*nf,0,(left+right)*lr,(top+bottom)*bt,(far+near)*nf,1])}function SetUniforms(shader,renderPass){if(!shader.program){return false}gl.useProgram(shader.program);shader.isActive=true;var uniforms=shader.uniforms;for(var _i=0,_iter=shader.uniformSetters.entries();_i<_iter.length;_i++){var __i=_iter[_i],name=__i[0],setter=__i[1];setter(uniforms.get(name))}return true}function BindShader(shader,renderPass){var uniforms=shader.uniforms;uniforms.set("uProjectionMatrix",renderPass.projectionMatrix);uniforms.set("uCameraMatrix",renderPass.cameraMatrix);shader.updateUniforms(renderPass);return SetUniforms(shader,renderPass)}var MULTI_QUAD_FRAG="#define SHADER_NAME MULTI_QUAD_FRAG\n#define numTextures %count%\n\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture[%count%];\nuniform mat4 uColorMatrix;\nuniform vec4 uColorOffset;\n\nvec4 getSampler (int index, vec2 uv)\n{\n    for (int i = 0; i < numTextures; ++i)\n    {\n        vec4 color = texture2D(uTexture[i], uv);\n\n        if (i == index)\n        {\n            return color * vec4(vTintColor.rgb * vTintColor.a, vTintColor.a);\n        }\n    }\n\n    //  Return black\n    return vec4(0);\n}\n\nvoid main (void)\n{\n    vec4 color = getSampler(int(vTextureId), vTextureCoord);\n\n    //  Un pre-mult alpha\n    if (color.a > 0.0)\n    {\n        color.rgb /= color.a;\n    }\n\n    vec4 result = color * uColorMatrix + (uColorOffset / 255.0);\n\n    //  Pre-mult alpha\n    result.rgb *= result.a;\n\n    gl_FragColor = vec4(result.rgb, result.a);\n}";function CreateDepthBuffer(framebuffer,textureWidth,textureHeight){gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer);var depthBuffer=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,depthBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,textureWidth,textureHeight);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,depthBuffer);gl.bindFramebuffer(gl.FRAMEBUFFER,null);return depthBuffer}var webgl1_exports={};__export(webgl1_exports,{CreateFramebuffer:function(){return CreateFramebuffer},CreateGLTexture:function(){return CreateGLTexture},DeleteFramebuffer:function(){return DeleteFramebuffer},DeleteGLBuffer:function(){return DeleteGLBuffer},DeleteGLTexture:function(){return DeleteGLTexture},GL:function(){return GL},PackColor:function(){return PackColor},PackColors:function(){return PackColors},SetGLTextureFilterMode:function(){return SetGLTextureFilterMode},UpdateGLTexture:function(){return UpdateGLTexture},WebGLRenderer:function(){return WebGLRenderer}});function DeleteGLBuffer(buffer){if(gl.isBuffer(buffer)){gl.deleteBuffer(buffer)}}function PackColor(rgb,alpha){var ua=(alpha*255|0)&255;return(ua<<24|rgb)>>>0}function PackColors(vertices){vertices.forEach(function(vertex){vertex.packColor()})}function CompileShader(source,type){var shader=gl.createShader(type);gl.shaderSource(shader,source);gl.compileShader(shader);var status=gl.getShaderParameter(shader,gl.COMPILE_STATUS);if(!status){var info=gl.getShaderInfoLog(shader);var sourceLines=source.split("\n").map(function(line,index){return"".concat(index,": ").concat(line)});console.error("Error compiling shader: ".concat(info),sourceLines.join("\n"));gl.deleteShader(shader);return null}return shader}var BYTE=5120;var UNSIGNED_BYTE=5121;var SHORT=5122;var UNSIGNED_SHORT=5123;var FLOAT=5126;function CreateAttributes(program,attribs){var attributes=new Map();var defaultSettings={size:1,type:FLOAT,normalized:false,stride:0};var offset=0;for(var _i=0,_iter=Object.entries(attribs);_i<_iter.length;_i++){var __i=_iter[_i],name=__i[0],entry=__i[1];var index=gl.getAttribLocation(program,name);if(index!== -1){gl.enableVertexAttribArray(index);var _size=entry.size,size=_size===void 0?defaultSettings.size:_size,_type=entry.type,type=_type===void 0?defaultSettings.type:_type,_normalized=entry.normalized,normalized=_normalized===void 0?defaultSettings.normalized:_normalized,_stride=entry.stride,stride=_stride===void 0?defaultSettings.stride:_stride;attributes.set(name,{index:index,size:size,type:type,normalized:normalized,stride:stride,offset:offset});var typeSize=4;if(type===UNSIGNED_SHORT||type===SHORT){typeSize=2}else if(type===UNSIGNED_BYTE||type===BYTE){typeSize=1}offset+=size*typeSize}}return attributes}function DeleteShaders(){for(var _len=arguments.length,shaders=new Array(_len),_key=0;_key<_len;_key++){shaders[_key]=arguments[_key]}shaders.forEach(function(shader){gl.deleteShader(shader)})}function CreateProgram(){for(var _len=arguments.length,shaders=new Array(_len),_key=0;_key<_len;_key++){shaders[_key]=arguments[_key]}var program=gl.createProgram();shaders.forEach(function(shader){gl.attachShader(program,shader)});gl.linkProgram(program);var status=gl.getProgramParameter(program,gl.LINK_STATUS);if(!status){var info=gl.getProgramInfoLog(program);console.error("Error linking program: ".concat(info));gl.deleteProgram(program);DeleteShaders.apply(void 0,shaders);return null}return program}function CreateUniformSetter(uniform,location,param){var isArray=param===void 0?false:param;switch(uniform.type){case gl.INT:case gl.BOOL:{if(isArray){return function(v){gl.uniform1iv(location,v)}}else{return function(v){gl.uniform1i(location,v)}}}case gl.INT_VEC2:case gl.BOOL_VEC2:{return function(v){gl.uniform2iv(location,v)}}case gl.INT_VEC3:case gl.BOOL_VEC3:{return function(v){gl.uniform3iv(location,v)}}case gl.INT_VEC4:case gl.BOOL_VEC4:{return function(v){gl.uniform4iv(location,v)}}case gl.FLOAT:{if(isArray){return function(v){gl.uniform1fv(location,v)}}else{return function(v){gl.uniform1f(location,v)}}}case gl.FLOAT_VEC2:{return function(v){gl.uniform2fv(location,v)}}case gl.FLOAT_VEC3:{return function(v){gl.uniform3fv(location,v)}}case gl.FLOAT_VEC4:{return function(v){gl.uniform4fv(location,v)}}case gl.FLOAT_MAT2:{return function(v){gl.uniformMatrix2fv(location,false,v)}}case gl.FLOAT_MAT3:{return function(v){gl.uniformMatrix3fv(location,false,v)}}case gl.FLOAT_MAT4:{return function(v){gl.uniformMatrix4fv(location,false,v)}}case gl.SAMPLER_2D:case gl.SAMPLER_CUBE:{if(uniform.size>1){return function(v){gl.uniform1iv(location,v)}}else{return function(v){gl.uniform1i(location,v)}}}}}function CreateUniforms(program){var uniforms=new Map();var total=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS);for(var i=0;i<total;i++){var uniform=gl.getActiveUniform(program,i);var name=uniform.name;if(name.startsWith("gl_")||name.startsWith("webgl_")){continue}var location=gl.getUniformLocation(program,name);if(location){var isArray=false;if(name.endsWith("[0]")){name=name.slice(0,-3);isArray=uniform.size>1}uniforms.set(name,CreateUniformSetter(uniform,location,isArray))}}return uniforms}function CreateShader(shader,fragmentShaderSource,vertexShaderSource,uniforms,attribs){var maxTextures=GetMaxTextures();fragmentShaderSource=fragmentShaderSource.replace(/%count%/gi,"".concat(maxTextures));var fragmentShader=CompileShader(fragmentShaderSource,gl.FRAGMENT_SHADER);var vertexShader=CompileShader(vertexShaderSource,gl.VERTEX_SHADER);if(!fragmentShader||!vertexShader){return}var program=CreateProgram(fragmentShader,vertexShader);if(!program){return}var currentProgram=gl.getParameter(gl.CURRENT_PROGRAM);gl.useProgram(program);shader.program=program;shader.uniformSetters=CreateUniforms(program);shader.uniforms=new Map();for(var _i=0,_iter=Object.entries(uniforms);_i<_iter.length;_i++){var __i=_iter[_i],key=__i[0],value=__i[1];if(shader.uniformSetters.has(key)){shader.uniforms.set(key,value)}}shader.attributes=CreateAttributes(program,attribs);gl.useProgram(currentProgram);shader.isActive=false;return shader}var DefaultQuadAttributes={aVertexPosition:{size:2},aTextureCoord:{size:2},aTextureId:{size:1},aTintColor:{size:4}};var DefaultQuadUniforms={uProjectionMatrix:new Float32Array(16),uCameraMatrix:new Float32Array(16),uTexture:0,uColorMatrix:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),uColorOffset:new Float32Array(4)};var SINGLE_QUAD_FRAG="#define SHADER_NAME SINGLE_QUAD_FRAG\n\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture;\nuniform mat4 uColorMatrix;\nuniform vec4 uColorOffset;\n\nvoid main (void)\n{\n    vec4 color = texture2D(uTexture, vTextureCoord);\n\n    //  Un pre-mult alpha\n    if (color.a > 0.0)\n    {\n        color.rgb /= color.a;\n    }\n\n    vec4 result = color * uColorMatrix + (uColorOffset / 255.0);\n\n    //  Pre-mult alpha\n    result.rgb *= result.a;\n\n    gl_FragColor = vec4(result.rgb, result.a);\n}";var SINGLE_QUAD_VERT="#define SHADER_NAME SINGLE_QUAD_VERT\n\nprecision highp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aTextureId;\nattribute vec4 aTintColor;\n\nuniform mat4 uProjectionMatrix;\nuniform mat4 uCameraMatrix;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nvoid main (void)\n{\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vTintColor = aTintColor;\n\n    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\n}";function SetShaderFromConfig(shader,config){var _attributes=config.attributes,attributes=_attributes===void 0?DefaultQuadAttributes:_attributes,_fragmentShader=config.fragmentShader,fragmentShader=_fragmentShader===void 0?SINGLE_QUAD_FRAG:_fragmentShader,_height=config.height,height=_height===void 0?GetHeight():_height,_renderToFramebuffer=config.renderToFramebuffer,renderToFramebuffer=_renderToFramebuffer===void 0?false:_renderToFramebuffer,_renderToDepthbuffer=config.renderToDepthbuffer,renderToDepthbuffer=_renderToDepthbuffer===void 0?false:_renderToDepthbuffer,_resolution=config.resolution,resolution=_resolution===void 0?GetResolution():_resolution,_vertexShader=config.vertexShader,vertexShader=_vertexShader===void 0?SINGLE_QUAD_VERT:_vertexShader,_width=config.width,width=_width===void 0?GetWidth():_width,_uniforms=config.uniforms,uniforms=_uniforms===void 0?DefaultQuadUniforms:_uniforms;CreateShader(shader,fragmentShader,vertexShader,uniforms,attributes);if(renderToFramebuffer){shader.renderToFramebuffer=true;var texture=new Texture(null,width*resolution,height*resolution);var binding=new GLTextureBinding(texture);binding.framebuffer=CreateFramebuffer(binding.texture);if(renderToDepthbuffer){shader.renderToDepthbuffer=true;binding.depthbuffer=CreateDepthBuffer(binding.framebuffer,texture.width,texture.height)}shader.texture=texture;shader.framebuffer=binding.framebuffer;shader.viewport=new Rectangle(0,0,width,height)}return shader}var Shader=function(){"use strict";function _class(config){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"program",void 0);swcHelpers.defineProperty(this,"attributes",void 0);swcHelpers.defineProperty(this,"uniforms",void 0);swcHelpers.defineProperty(this,"uniformSetters",void 0);swcHelpers.defineProperty(this,"texture",void 0);swcHelpers.defineProperty(this,"framebuffer",void 0);swcHelpers.defineProperty(this,"renderToFramebuffer",false);swcHelpers.defineProperty(this,"renderToDepthbuffer",false);swcHelpers.defineProperty(this,"isActive",false);swcHelpers.defineProperty(this,"viewport",void 0);if(config){SetShaderFromConfig(this,config)}}swcHelpers.createClass(_class,[{key:"updateUniforms",value:function updateUniforms(renderPass){}},{key:"bind",value:function bind(renderPass){return BindShader(this,renderPass)}}]);return _class}();var MultiTextureQuadShader=function(Shader){"use strict";swcHelpers.inherits(_class,Shader);function _class(param){var config=param===void 0?{}:param;swcHelpers.classCallCheck(this,_class);config.fragmentShader=(config===null||config===void 0?void 0:config.fragmentShader)||MULTI_QUAD_FRAG;return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,config))}swcHelpers.createClass(_class,[{key:"bind",value:function bind(renderPass){this.uniforms.set("uTexture",TextureStack.textureIndex);return BindShader(this,renderPass)}}]);return _class}(Shader);function SetDefaultBlendMode(enable,srcRGB,dstRGB,param,param1){var srcAlpha=param===void 0?gl.SRC_ALPHA:param,dstAlpha=param1===void 0?gl.ONE_MINUS_SRC_ALPHA:param1;var entry={enable:enable,srcRGB:srcRGB,dstRGB:dstRGB,srcAlpha:srcAlpha,dstAlpha:dstAlpha};BlendModeStack.stack[0]=entry;BlendModeStack.index=0;BlendModeStack.default=entry}function SetDefaultColorMatrix(colorMatrix,colorOffset){var entry={colorMatrix:colorMatrix,colorOffset:colorOffset};ColorMatrixStack.stack[0]=entry;ColorMatrixStack.index=0;ColorMatrixStack.default=entry}function SetDefaultShader(shader,textureID){var entry={shader:shader,textureID:textureID};ShaderStack.stack[0]=entry;ShaderStack.index=0;ShaderStack.default=entry}function ResetTextures(){TextureStack.tempTextures.forEach(function(texture,index){gl.activeTexture(gl.TEXTURE0+index);gl.bindTexture(gl.TEXTURE_2D,texture)});ClearTextures()}function SetDefaultTextures(){if(TextureStack.textures){ResetTextures()}var tempTextures=CreateTempTextures();TextureStack.maxTextures=tempTextures.length;TextureStack.tempTextures=new Map(tempTextures);TextureStack.textures=new Map();TextureStack.textureIndex=[];TextureStack.tempTextures.forEach(function(texture,index){TextureStack.textureIndex.push(index)})}function SetDefaultVertexBuffer(buffer){VertexBufferStack.stack[0]=buffer;VertexBufferStack.index=0;VertexBufferStack.default=buffer}function SetDefaultViewport(param,param1,param2,param3){var x=param===void 0?0:param,y=param1===void 0?0:param1,width=param2===void 0?0:param2,height=param3===void 0?0:param3;var entry=new Rectangle(x,y,width,height);ViewportStack.stack[0]=entry;ViewportStack.index=0;ViewportStack.default=entry}var SingleTextureQuadShader=function(Shader){"use strict";swcHelpers.inherits(_class,Shader);function _class(param){var config=param===void 0?{}:param;swcHelpers.classCallCheck(this,_class);config.fragmentShader=(config===null||config===void 0?void 0:config.fragmentShader)||SINGLE_QUAD_FRAG;return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,config))}return _class}(Shader);var VertexBuffer=function(){"use strict";function _class(param){var config=param===void 0?{}:param;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"name",void 0);swcHelpers.defineProperty(this,"batchSize",void 0);swcHelpers.defineProperty(this,"dataSize",void 0);swcHelpers.defineProperty(this,"vertexElementSize",void 0);swcHelpers.defineProperty(this,"vertexByteSize",void 0);swcHelpers.defineProperty(this,"entryByteSize",void 0);swcHelpers.defineProperty(this,"bufferByteSize",void 0);swcHelpers.defineProperty(this,"data",void 0);swcHelpers.defineProperty(this,"vertexViewF32",void 0);swcHelpers.defineProperty(this,"vertexBuffer",void 0);swcHelpers.defineProperty(this,"entryElementSize",void 0);swcHelpers.defineProperty(this,"indexed",false);swcHelpers.defineProperty(this,"isDynamic",false);swcHelpers.defineProperty(this,"count",0);swcHelpers.defineProperty(this,"offset",0);swcHelpers.defineProperty(this,"elementsPerEntry",void 0);swcHelpers.defineProperty(this,"isBound",false);var _name=config.name,name=_name===void 0?"VBO":_name,_batchSize=config.batchSize,batchSize=_batchSize===void 0?1:_batchSize,_dataSize=config.dataSize,dataSize=_dataSize===void 0?4:_dataSize,_isDynamic=config.isDynamic,isDynamic=_isDynamic===void 0?true:_isDynamic,_elementsPerEntry=config.elementsPerEntry,elementsPerEntry=_elementsPerEntry===void 0?3:_elementsPerEntry,_vertexElementSize=config.vertexElementSize,vertexElementSize=_vertexElementSize===void 0?9:_vertexElementSize;this.name=name;this.batchSize=batchSize;this.dataSize=dataSize;this.vertexElementSize=vertexElementSize;this.isDynamic=isDynamic;this.elementsPerEntry=elementsPerEntry;this.vertexByteSize=vertexElementSize*dataSize;this.entryByteSize=this.vertexByteSize*elementsPerEntry;this.bufferByteSize=batchSize*this.entryByteSize;this.entryElementSize=this.vertexElementSize*this.elementsPerEntry;this.create()}swcHelpers.createClass(_class,[{key:"resize",value:function resize(batchSize){this.batchSize=batchSize;this.bufferByteSize=batchSize*this.entryByteSize;if(this.vertexBuffer){DeleteGLBuffer(this.vertexBuffer)}this.create()}},{key:"create",value:function create(){var data=new ArrayBuffer(this.bufferByteSize);this.data=data;this.vertexViewF32=new Float32Array(data);this.vertexBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);var type=this.isDynamic?gl.DYNAMIC_DRAW:gl.STATIC_DRAW;gl.bufferData(gl.ARRAY_BUFFER,data,type);gl.bindBuffer(gl.ARRAY_BUFFER,null);this.isBound=false}},{key:"add",value:function add(count){this.count+=count;this.offset+=this.vertexElementSize*count}},{key:"reset",value:function reset(){this.count=0;this.offset=0}},{key:"canContain",value:function canContain(count){return this.count+count<=this.batchSize}},{key:"free",value:function free(){return Math.max(0,1-this.count/this.batchSize)}},{key:"bind",value:function bind(){gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null);gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer)}},{key:"destroy",value:function destroy(){DeleteGLBuffer(this.vertexBuffer);this.data=null;this.vertexViewF32=null;this.vertexBuffer=null}}]);return _class}();var RenderPass=function(){"use strict";function _class(renderer){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"renderer",void 0);swcHelpers.defineProperty(this,"projectionMatrix",void 0);swcHelpers.defineProperty(this,"cameraMatrix",void 0);swcHelpers.defineProperty(this,"count",0);swcHelpers.defineProperty(this,"prevCount",0);swcHelpers.defineProperty(this,"flushTotal",0);swcHelpers.defineProperty(this,"quadShader",void 0);swcHelpers.defineProperty(this,"quadCamera",void 0);swcHelpers.defineProperty(this,"current2DCamera",void 0);this.renderer=renderer;this.projectionMatrix=new Float32Array(16);FramebufferStack.init(this);BlendModeStack.init(this);VertexBufferStack.init(this);ViewportStack.init(this);ShaderStack.init(this);ColorMatrixStack.init(this);TextureStack.init(this);this.reset()}swcHelpers.createClass(_class,[{key:"flush",value:function flush(){this.prevCount=this.count;this.count=0;this.flushTotal++}},{key:"reset",value:function reset(){var gl2=this.renderer.gl;this.quadShader=new SingleTextureQuadShader();this.quadCamera=new StaticCamera(this.renderer.width,this.renderer.height);SetDefaultTextures();SetDefaultFramebuffer();SetDefaultBlendMode(true,gl2.ONE,gl2.ONE_MINUS_SRC_ALPHA);SetDefaultVertexBuffer(new VertexBuffer({batchSize:GetBatchSize()}));SetDefaultShader(GetMaxTextures()===1?new SingleTextureQuadShader():new MultiTextureQuadShader());SetDefaultColorMatrix(DEFAULT_COLOR_MATRIX,DEFAULT_COLOR_OFFSET)}},{key:"resize",value:function resize(width,height){Mat4Ortho(this.projectionMatrix,0,width,height,0,-1e3,1e3);this.quadCamera.reset(width,height);SetDefaultViewport(0,0,width,height)}},{key:"isCameraDirty",value:function isCameraDirty(){return this.current2DCamera.isDirty}}]);return _class}();function CompareColorMatrix(srcMatrix,srcOffset,targetMatrix,targetOffset){for(var i=0;i<srcOffset.length;i++){if(srcOffset[i]!==targetOffset[i]){return false}}for(var i1=0;i1<srcMatrix.length;i1++){if(srcMatrix[i1]!==targetMatrix[i1]){return false}}return true}function SetColorMatrix(color){var current=CurrentColorMatrix();var entry=AddColorMatrix(color.colorMatrix,color.colorOffset);if(!CompareColorMatrix(entry.colorMatrix,entry.colorOffset,current.colorMatrix,current.colorOffset)){BindColorMatrix(entry)}}function SetColor(renderPass,color){if(color.colorMatrixEnabled&&color.willColorChildren){SetColorMatrix(color)}}function SetDefaultFramebuffer(param,viewport){var framebuffer=param===void 0?null:param;var entry={framebuffer:framebuffer,viewport:viewport};FramebufferStack.stack[0]=entry;FramebufferStack.index=0;FramebufferStack.default=entry}function SetFramebuffer(framebuffer,param,viewport){var clear=param===void 0?true:param;var entry=AddFramebuffer(framebuffer,viewport);BindFramebuffer(clear,entry)}function SetShader(shader,textureID){var entry=AddShader(shader,textureID);BindShaderEntry(entry)}function SetTexture(texture){if(!texture.binding){return-1}var binding=texture.binding;var textures=TextureStack.textures;if(!binding.isBound){if(textures.size===TextureStack.maxTextures){Flush(TextureStack.renderPass);ClearTextures()}var textureUnit=textures.size;gl.activeTexture(gl.TEXTURE0+textureUnit);gl.bindTexture(gl.TEXTURE_2D,binding.texture);textures.set(textureUnit,texture);binding.bind(textureUnit)}return binding.textureUnit}var instance3;var WhiteTexture={get:function(){return instance3},set:function(texture){instance3=texture}};function SetWhiteTexture(){return SetTexture(WhiteTexture.get())}function Start(renderPass){if(!renderPass.current2DCamera){renderPass.current2DCamera=renderPass.quadCamera;renderPass.cameraMatrix=renderPass.quadCamera.getMatrix()}renderPass.count=0;renderPass.flushTotal=0;BindDefaultFramebuffer();BindDefaultBlendMode();BindDefaultVertexBuffer();BindDefaultViewport();BindDefaultShader();BindDefaultColorMatrix();return renderPass}function UnbindTexture(texture){var index=texture.binding.textureUnit;var binding=texture.binding;binding.unbind();gl.activeTexture(gl.TEXTURE0+index);gl.bindTexture(gl.TEXTURE_2D,TextureStack.tempTextures.get(index))}function Draw(renderPass){var count=renderPass.count;if(count===0){return}var currentBuffer=CurrentVertexBuffer();var currentShader=CurrentShader();var renderToFramebuffer=currentShader.shader.renderToFramebuffer;if(renderToFramebuffer){SetFramebuffer(currentShader.shader.framebuffer,true,currentShader.shader.viewport)}if(count===currentBuffer.batchSize){var type=currentBuffer.isDynamic?gl.DYNAMIC_DRAW:gl.STATIC_DRAW;gl.bufferData(gl.ARRAY_BUFFER,currentBuffer.data,type)}else{var subsize=count*currentBuffer.entryElementSize;var view=currentBuffer.vertexViewF32.subarray(0,subsize);gl.bufferSubData(gl.ARRAY_BUFFER,0,view)}if(currentBuffer.indexed){gl.drawElements(gl.TRIANGLES,count*currentBuffer.entryIndexSize,gl.UNSIGNED_SHORT,0)}else{gl.drawArrays(gl.TRIANGLES,0,count*currentBuffer.elementsPerEntry)}if(renderToFramebuffer){PopFramebuffer()}}function Flush(renderPass,forceCount){if(forceCount){renderPass.count=forceCount}var count=renderPass.count;if(count===0){return false}Draw(renderPass);renderPass.flush();return true}function End(renderPass){Flush(renderPass)}function GetCompressedTextures(gl2){var extString="WEBGL_compressed_texture_";var wkExtString="WEBKIT_"+extString;var hasExt=function(format){var results=gl2.getExtension(extString+format)||gl2.getExtension(wkExtString+format);if(results){var glEnums={};for(var key in results){glEnums[results[key]]=key}return glEnums}};return{ETC:hasExt("etc"),ETC1:hasExt("etc1"),ATC:hasExt("atc"),ASTC:hasExt("astc"),BPTC:hasExt("bptc"),RGTC:hasExt("rgtc"),PVRTC:hasExt("pvrtc"),S3TC:hasExt("s3tc"),S3TCSRGB:hasExt("s3tc_srgb"),IMG:true}}function GetRGBArray(color,param){var output=param===void 0?[]:param;var r=color>>16&255;var g=color>>8&255;var b=color&255;var a=color>16777215?color>>>24:255;output[0]=r/255;output[1]=g/255;output[2]=b/255;output[3]=a/255;return output}function GetWebGLContext(){return ConfigStore.get(CONFIG_DEFAULTS.WEBGL_CONTEXT)}var instance4;var RendererInstance={get:function(){return instance4},set:function(renderer){instance4=renderer}};var instance5;var WebGLRendererInstance={get:function(){return instance5},set:function(renderer){instance5=renderer;RendererInstance.set(renderer)}};var WebGLRenderer=function(){"use strict";function _class(){var _this=this,_this1=this;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"canvas",void 0);swcHelpers.defineProperty(this,"gl",void 0);swcHelpers.defineProperty(this,"renderPass",void 0);swcHelpers.defineProperty(this,"clearColor",[0,0,0,1]);swcHelpers.defineProperty(this,"width",void 0);swcHelpers.defineProperty(this,"height",void 0);swcHelpers.defineProperty(this,"resolution",void 0);swcHelpers.defineProperty(this,"clearBeforeRender",true);swcHelpers.defineProperty(this,"optimizeRedraw",true);swcHelpers.defineProperty(this,"autoResize",true);swcHelpers.defineProperty(this,"contextLost",false);swcHelpers.defineProperty(this,"compression",void 0);this.width=GetWidth();this.height=GetHeight();this.resolution=GetResolution();this.setBackgroundColor(GetBackgroundColor());var canvas=document.createElement("canvas");canvas.addEventListener("webglcontextlost",function(event){return _this.onContextLost(event)},false);canvas.addEventListener("webglcontextrestored",function(){return _this1.onContextRestored()},false);this.canvas=canvas;this.initContext();WebGLRendererInstance.set(this);this.renderPass=new RenderPass(this);this.resize(this.width,this.height,this.resolution);ProcessBindingQueue()}swcHelpers.createClass(_class,[{key:"initContext",value:function initContext(){var gl2=this.canvas.getContext("webgl",GetWebGLContext());GL.set(gl2);this.gl=gl2;this.compression=GetCompressedTextures(gl2);gl2.disable(gl2.DEPTH_TEST);gl2.disable(gl2.CULL_FACE)}},{key:"resize",value:function resize(width,height,param){var resolution=param===void 0?1:param;var calcWidth=width*resolution;var calcHeight=height*resolution;this.width=calcWidth;this.height=calcHeight;this.resolution=resolution;var canvas=this.canvas;canvas.width=calcWidth;canvas.height=calcHeight;if(this.autoResize){canvas.style.width=width.toString()+"px";canvas.style.height=height.toString()+"px"}this.renderPass.resize(calcWidth,calcHeight)}},{key:"onContextLost",value:function onContextLost(event){event.preventDefault();this.contextLost=true}},{key:"onContextRestored",value:function onContextRestored(){this.contextLost=false;this.initContext()}},{key:"setBackgroundColor",value:function setBackgroundColor(color){GetRGBArray(color,this.clearColor);return this}},{key:"reset",value:function reset(){}},{key:"begin",value:function begin(willRedraw){if(this.contextLost){return}var gl2=this.gl;gl2.getContextAttributes();ProcessBindingQueue();if(this.optimizeRedraw&&!willRedraw){}if(this.clearBeforeRender){var cls=this.clearColor;gl2.clearColor(cls[0],cls[1],cls[2],cls[3]);gl2.clear(gl2.COLOR_BUFFER_BIT)}return Start(this.renderPass)}},{key:"end",value:function end(){End(this.renderPass)}},{key:"destroy",value:function destroy(){WebGLRendererInstance.set(void 0)}}]);return _class}();function WebGL(){return function(){SetRenderer(WebGLRenderer)}}function SetWebGLContext(contextAttributes){ConfigStore.set(CONFIG_DEFAULTS.WEBGL_CONTEXT,contextAttributes)}function WebGLContext(contextAttributes){return function(){SetWebGLContext(contextAttributes)}}var dom_exports={};__export(dom_exports,{AddToDOM:function(){return AddToDOM},DOMContentLoaded:function(){return DOMContentLoaded},GetElement:function(){return GetElement},ParseXML:function(){return ParseXML},RemoveFromDOM:function(){return RemoveFromDOM}});function AddToDOM(element,parent){var target=GetElement(parent);target.appendChild(element);return element}function DOMContentLoaded(callback){var readyState=document.readyState;if(readyState==="complete"||readyState==="interactive"){callback();return}var check=function(){document.removeEventListener("deviceready",check,true);document.removeEventListener("DOMContentLoaded",check,true);window.removeEventListener("load",check,true);callback()};if(!document.body){window.setTimeout(check,20)}else if(window.hasOwnProperty("cordova")){document.addEventListener("deviceready",check,true)}else{document.addEventListener("DOMContentLoaded",check,true);window.addEventListener("load",check,true)}}function ParseXML(data){var xml;try{var parser=new DOMParser();xml=parser.parseFromString(data,"text/xml");if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){return null}else{return xml}}catch(error){return null}}function RemoveFromDOM(element){if(element.parentNode){element.parentNode.removeChild(element)}}var device_exports={};__export(device_exports,{Audio:function(){return audio_exports},Browser:function(){return browser_exports},CanPlayAudioType:function(){return CanPlayAudioType},CanPlayH264Video:function(){return CanPlayH264Video},CanPlayHLSVideo:function(){return CanPlayHLSVideo},CanPlayM4A:function(){return CanPlayM4A},CanPlayMP3:function(){return CanPlayMP3},CanPlayOGG:function(){return CanPlayOGG},CanPlayOGGVideo:function(){return CanPlayOGGVideo},CanPlayOpus:function(){return CanPlayOpus},CanPlayVP9Video:function(){return CanPlayVP9Video},CanPlayVideoType:function(){return CanPlayVideoType},CanPlayWAV:function(){return CanPlayWAV},CanPlayWebM:function(){return CanPlayWebM},CanPlayWebMVideo:function(){return CanPlayWebMVideo},GetAudio:function(){return GetAudio},GetBrowser:function(){return GetBrowser},GetOS:function(){return GetOS},GetVideo:function(){return GetVideo},HasAudio:function(){return HasAudio},HasWebAudio:function(){return HasWebAudio},IsAndroid:function(){return IsAndroid},IsChrome:function(){return IsChrome},IsChromeOS:function(){return IsChromeOS},IsCordova:function(){return IsCordova},IsCrosswalk:function(){return IsCrosswalk},IsEdge:function(){return IsEdge},IsEjecta:function(){return IsEjecta},IsFirefox:function(){return IsFirefox},IsKindle:function(){return IsKindle},IsLinux:function(){return IsLinux},IsMSIE:function(){return IsMSIE},IsMacOS:function(){return IsMacOS},IsMobileSafari:function(){return IsMobileSafari},IsNode:function(){return IsNode},IsNodeWebkit:function(){return IsNodeWebkit},IsOpera:function(){return IsOpera},IsSafari:function(){return IsSafari},IsSilk:function(){return IsSilk},IsTrident:function(){return IsTrident},IsWebApp:function(){return IsWebApp},IsWindows:function(){return IsWindows},IsWindowsPhone:function(){return IsWindowsPhone},IsiOS:function(){return IsiOS},OS:function(){return os_exports},Video:function(){return video_exports}});var audio_exports={};__export(audio_exports,{CanPlayAudioType:function(){return CanPlayAudioType},CanPlayM4A:function(){return CanPlayM4A},CanPlayMP3:function(){return CanPlayMP3},CanPlayOGG:function(){return CanPlayOGG},CanPlayOpus:function(){return CanPlayOpus},CanPlayWAV:function(){return CanPlayWAV},CanPlayWebM:function(){return CanPlayWebM},GetAudio:function(){return GetAudio},HasAudio:function(){return HasAudio},HasWebAudio:function(){return HasWebAudio}});var _audioElement;function CanPlayAudioType(type,audioElement){if(!audioElement){if(!_audioElement){_audioElement=document.createElement("audio")}audioElement=_audioElement}return audioElement&&audioElement.canPlayType(type)!==""}function CanPlayM4A(audioElement){return CanPlayAudioType("audio/x-m4a",audioElement)||CanPlayAudioType("audio/aac",audioElement)}function CanPlayMP3(audioElement){return CanPlayAudioType('audio/mpeg; codecs="mp3"',audioElement)}function CanPlayOGG(audioElement){return CanPlayAudioType('audio/ogg; codecs="vorbis"',audioElement)}function CanPlayOpus(audioElement){return CanPlayAudioType('audio/ogg; codecs="opus"',audioElement)||CanPlayAudioType('audio/webm; codecs="opus"',audioElement)}function CanPlayWAV(audioElement){return CanPlayAudioType('audio/wav; codecs="1"',audioElement)}function CanPlayWebM(audioElement){return CanPlayAudioType('audio/webm; codecs="vorbis"',audioElement)}function HasAudio(){return window&&window.hasOwnProperty("Audio")}function HasWebAudio(){return window&&(window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"))}function GetAudio(){var result={audioData:HasAudio(),m4a:false,mp3:false,ogg:false,opus:false,wav:false,webAudio:HasWebAudio(),webm:false};if(result.audioData){result.m4a=CanPlayM4A();result.mp3=CanPlayMP3();result.ogg=CanPlayOGG();result.opus=CanPlayOpus();result.wav=CanPlayWAV();result.webm=CanPlayWebM()}return result}var browser_exports={};__export(browser_exports,{GetBrowser:function(){return GetBrowser},IsChrome:function(){return IsChrome},IsEdge:function(){return IsEdge},IsFirefox:function(){return IsFirefox},IsMSIE:function(){return IsMSIE},IsMobileSafari:function(){return IsMobileSafari},IsOpera:function(){return IsOpera},IsSafari:function(){return IsSafari},IsSilk:function(){return IsSilk},IsTrident:function(){return IsTrident}});function IsChrome(){var chrome=/Chrome\/(\d+)/.test(navigator.userAgent);var chromeVersion=chrome?parseInt(RegExp.$1,10):0;return{chrome:chrome,chromeVersion:chromeVersion}}function IsEdge(){var edge=/Edge\/\d+/.test(navigator.userAgent);return{edge:edge}}function IsFirefox(){var firefox=/Firefox\D+(\d+)/.test(navigator.userAgent);var firefoxVersion=firefox?parseInt(RegExp.$1,10):0;return{firefox:firefox,firefoxVersion:firefoxVersion}}function IsMSIE(){var ie=/MSIE (\d+\.\d+);/.test(navigator.userAgent);var ieVersion=ie?parseInt(RegExp.$1,10):0;return{ie:ie,ieVersion:ieVersion}}function IsiOS(){var ua=navigator.userAgent;var result={iOS:false,iOSVersion:0,iPhone:false,iPad:false};if(/iP[ao]d|iPhone/i.test(ua)){var match=/OS (\d+)/.exec(navigator.appVersion);result.iOS=true;result.iOSVersion=parseInt(match[0],10);result.iPhone=ua.toLowerCase().includes("iphone");result.iPad=ua.toLowerCase().includes("ipad")}return result}function IsMobileSafari(){var ref=IsiOS(),iOS=ref.iOS;var mobileSafari=navigator.userAgent.includes("AppleWebKit")&&iOS;return{mobileSafari:mobileSafari}}function IsOpera(){var opera=navigator.userAgent.includes("Opera");return{opera:opera}}function IsWindowsPhone(){var ua=navigator.userAgent;return/Windows Phone/i.test(ua)||/IEMobile/i.test(ua)}function IsSafari(){var ua=navigator.userAgent;var safari=ua.includes("Safari")&&!IsWindowsPhone();var safariVersion=/Version\/(\d+)\./.test(ua)?parseInt(RegExp.$1,10):0;return{safari:safari,safariVersion:safariVersion}}function IsSilk(){var silk=navigator.userAgent.includes("Silk");return{silk:silk}}function IsTrident(){var trident=/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(navigator.userAgent);var tridentVersion=trident?parseInt(RegExp.$1,10):0;var tridentIEVersion=trident?parseInt(RegExp.$3,10):0;return{trident:trident,tridentVersion:tridentVersion,tridentIEVersion:tridentIEVersion}}function GetBrowser(){var ref=IsChrome(),chrome=ref.chrome,chromeVersion=ref.chromeVersion;var ref1=IsEdge(),edge=ref1.edge;var ref2=IsFirefox(),firefox=ref2.firefox,firefoxVersion=ref2.firefoxVersion;var ref3=IsMSIE(),ie=ref3.ie,ieVersion=ref3.ieVersion;var ref4=IsMobileSafari(),mobileSafari=ref4.mobileSafari;var ref5=IsOpera(),opera=ref5.opera;var ref6=IsSafari(),safari=ref6.safari,safariVersion=ref6.safariVersion;var ref7=IsSilk(),silk=ref7.silk;var ref8=IsTrident(),trident=ref8.trident,tridentVersion=ref8.tridentVersion,tridentIEVersion=ref8.tridentIEVersion;if(trident){ie=true;ieVersion=tridentIEVersion}var result={chrome:chrome,chromeVersion:chromeVersion,edge:edge,firefox:firefox,firefoxVersion:firefoxVersion,ie:ie,ieVersion:ieVersion,mobileSafari:mobileSafari,opera:opera,safari:safari,safariVersion:safariVersion,silk:silk,trident:trident,tridentVersion:tridentVersion};return result}var os_exports={};__export(os_exports,{GetOS:function(){return GetOS},IsAndroid:function(){return IsAndroid},IsChromeOS:function(){return IsChromeOS},IsCordova:function(){return IsCordova},IsCrosswalk:function(){return IsCrosswalk},IsEjecta:function(){return IsEjecta},IsKindle:function(){return IsKindle},IsLinux:function(){return IsLinux},IsMacOS:function(){return IsMacOS},IsNode:function(){return IsNode},IsNodeWebkit:function(){return IsNodeWebkit},IsWebApp:function(){return IsWebApp},IsWindows:function(){return IsWindows},IsWindowsPhone:function(){return IsWindowsPhone},IsiOS:function(){return IsiOS}});function IsAndroid(){return navigator.userAgent.includes("Android")}function IsChromeOS(){return navigator.userAgent.includes("CrOS")}function IsCordova(){return window.hasOwnProperty("cordova")}function IsCrosswalk(){return navigator.userAgent.includes("Crosswalk")}function IsEjecta(){return window.hasOwnProperty("ejecta")}function IsKindle(){var ua=navigator.userAgent;return ua.includes("Kindle")||/\bKF[A-Z][A-Z]+/.test(ua)||/Silk.*Mobile Safari/.test(ua)}function IsLinux(){return navigator.userAgent.includes("Linux")}function IsMacOS(){var ua=navigator.userAgent;return ua.includes("Mac OS")&&!ua.includes("like Mac OS")}function IsNode(){return typeof process!=="undefined"&& typeof process.versions==="object"&&process.versions.hasOwnProperty("node")}function IsNodeWebkit(){return IsNode()&&!!process.versions.hasOwnProperty("node-webkit")}function IsWebApp(){return navigator.hasOwnProperty("standalone")}function IsWindows(){return navigator.userAgent.includes("Windows")}function GetOS(){var ua=navigator.userAgent;var ref=IsiOS(),iOS=ref.iOS,iOSVersion=ref.iOSVersion,iPad=ref.iPad,iPhone=ref.iPhone;var result={android:IsAndroid(),chromeOS:IsChromeOS(),cordova:IsCordova(),crosswalk:IsCrosswalk(),desktop:false,ejecta:IsEjecta(),iOS:iOS,iOSVersion:iOSVersion,iPad:iPad,iPhone:iPhone,kindle:IsKindle(),linux:IsLinux(),macOS:IsMacOS(),node:IsNode(),nodeWebkit:IsNodeWebkit(),pixelRatio:1,webApp:IsWebApp(),windows:IsWindows(),windowsPhone:IsWindowsPhone()};if(result.windowsPhone){result.android=false;result.iOS=false;result.macOS=false;result.windows=true}var silk=ua.includes("Silk");if(result.windows||result.macOS||result.linux&&!silk||result.chromeOS){result.desktop=true}if(result.windowsPhone||/Windows NT/i.test(ua)&&/Touch/i.test(ua)){result.desktop=false}return result}var video_exports={};__export(video_exports,{CanPlayH264Video:function(){return CanPlayH264Video},CanPlayHLSVideo:function(){return CanPlayHLSVideo},CanPlayOGGVideo:function(){return CanPlayOGGVideo},CanPlayVP9Video:function(){return CanPlayVP9Video},CanPlayVideoType:function(){return CanPlayVideoType},CanPlayWebMVideo:function(){return CanPlayWebMVideo},GetVideo:function(){return GetVideo}});var _videoElement;function CanPlayVideoType(type,videoElement){if(!videoElement){if(!_videoElement){_videoElement=document.createElement("video")}videoElement=_videoElement}return videoElement&&videoElement.canPlayType(type)!==""}function CanPlayH264Video(videoElement){return CanPlayVideoType('video/mp4; codecs="avc1.42E01E"',videoElement)}function CanPlayHLSVideo(videoElement){return CanPlayVideoType('application/x-mpegURL; codecs="avc1.42E01E"',videoElement)}function CanPlayOGGVideo(videoElement){return CanPlayVideoType('video/ogg; codecs="theora"',videoElement)}function CanPlayVP9Video(videoElement){return CanPlayVideoType('video/webm; codecs="vp9"',videoElement)}function CanPlayWebMVideo(videoElement){return CanPlayVideoType('video/webm; codecs="vp8, vorbis"',videoElement)}function GetVideo(){return{h264Video:CanPlayH264Video(),hlsVideo:CanPlayHLSVideo(),oggVideo:CanPlayOGGVideo(),vp9Video:CanPlayVP9Video(),webmVideo:CanPlayWebMVideo()}}var display_exports={};__export(display_exports,{AddChild:function(){return AddChild},AddChildAt:function(){return AddChildAt},AddChildren:function(){return AddChildren},AddChildrenAt:function(){return AddChildrenAt},AddPosition:function(){return AddPosition},AddRotation:function(){return AddRotation},AddScale:function(){return AddScale},AddSkew:function(){return AddSkew},BringChildToTop:function(){return BringChildToTop},ConsoleTreeChildren:function(){return ConsoleTreeChildren},CountMatchingChildren:function(){return CountMatchingChildren},DepthFirstSearch:function(){return DepthFirstSearch},DepthFirstSearchRecursive:function(){return DepthFirstSearchRecursive},DestroyChildren:function(){return DestroyChildren},DisplayDebugTools:function(){return DisplayDebugTools},FindChildrenByName:function(){return FindChildrenByName},GetAllChildren:function(){return GetAllChildren},GetBounds:function(){return GetBounds},GetChildAt:function(){return GetChildAt},GetChildIndex:function(){return GetChildIndex},GetChildren:function(){return GetChildren},GetClosestChild:function(){return GetClosestChild},GetFirstChild:function(){return GetFirstChild},GetFirstChildByName:function(){return GetFirstChildByName},GetFurthestChild:function(){return GetFurthestChild},GetLastChild:function(){return GetLastChild},GetParents:function(){return GetParents2},GetRandomChild:function(){return GetRandomChild},MoveChildDown:function(){return MoveChildDown},MoveChildUp:function(){return MoveChildUp},OverlapBounds:function(){return OverlapBounds},RemoveChild:function(){return RemoveChild},RemoveChildAt:function(){return RemoveChildAt},RemoveChildren:function(){return RemoveChildren},RemoveChildrenAt:function(){return RemoveChildrenAt},RemoveChildrenBetween:function(){return RemoveChildrenBetween},ReparentChildren:function(){return ReparentChildren},RotateChildrenLeft:function(){return RotateChildrenLeft},RotateChildrenRight:function(){return RotateChildrenRight},SendChildToBack:function(){return SendChildToBack},SetChildrenValue:function(){return SetChildrenValue},SetName:function(){return SetName},SetOrigin:function(){return SetOrigin},SetPosition:function(){return SetPosition},SetRotation:function(){return SetRotation},SetScale:function(){return SetScale},SetSize:function(){return SetSize2},SetSkew:function(){return SetSkew},SetValue:function(){return SetValue},SetVisible:function(){return SetVisible2},SetWorld:function(){return SetWorld},ShuffleChildren:function(){return ShuffleChildren},SwapChildren:function(){return SwapChildren}});function GetLastChildID(parentID){return HierarchyComponent.data[parentID][HIERARCHY.LAST]}function GetNumChildren(id){return HierarchyComponent.data[id][HIERARCHY.NUM_CHILDREN]}function IsValidParent(parent,child){var childID=child.id;var parentID=parent.id;return!(parentID===0||childID===parentID||parentID===GetParentID(childID))}function SetNextSiblingID(parentID,childID){HierarchyComponent.data[parentID][HIERARCHY.NEXT]=childID}function SetPreviousSiblingID(parentID,childID){HierarchyComponent.data[parentID][HIERARCHY.PREV]=childID}function LinkSiblings(childA,childB){SetNextSiblingID(childA,childB);SetPreviousSiblingID(childB,childA)}function GetFirstChildID(parentID){return HierarchyComponent.data[parentID][HIERARCHY.FIRST]}function GetNextSiblingID(id){return HierarchyComponent.data[id][HIERARCHY.NEXT]}function GetPreviousSiblingID(id){return HierarchyComponent.data[id][HIERARCHY.PREV]}var hierarchy_exports={};__export(hierarchy_exports,{AddChildIDAfter:function(){return AddChildIDAfter},AddChildIDBefore:function(){return AddChildIDBefore},AddHierarchyComponent:function(){return AddHierarchyComponent},AreSiblings:function(){return AreSiblings},BranchSearch:function(){return BranchSearch},ClearHierarchyComponent:function(){return ClearHierarchyComponent},ClearSiblings:function(){return ClearSiblings},ClearWorldAndParentID:function(){return ClearWorldAndParentID},DebugHierarchyComponent:function(){return DebugHierarchyComponent},DecreaseNumChildren:function(){return DecreaseNumChildren},DepthFirstSearchFromParentID:function(){return DepthFirstSearchFromParentID},GetChildIDAtIndex:function(){return GetChildIDAtIndex},GetChildIDsFromParent:function(){return GetChildIDsFromParent},GetChildIDsFromParentID:function(){return GetChildIDsFromParentID},GetChildrenFromParentID:function(){return GetChildrenFromParentID},GetDepth:function(){return GetDepth},GetFirstChildID:function(){return GetFirstChildID},GetLastChildID:function(){return GetLastChildID},GetNextSiblingID:function(){return GetNextSiblingID},GetNumChildren:function(){return GetNumChildren},GetParentGameObject:function(){return GetParentGameObject},GetParentID:function(){return GetParentID},GetParents:function(){return GetParents},GetPreviousSiblingID:function(){return GetPreviousSiblingID},GetSiblingIDs:function(){return GetSiblingIDs},GetWorldFromID:function(){return GetWorldFromID},GetWorldFromParentID:function(){return GetWorldFromParentID},GetWorldID:function(){return GetWorldID},HasChildren:function(){return HasChildren},HasParent:function(){return HasParent},HierarchyComponent:function(){return HierarchyComponent},IncreaseNumChildren:function(){return IncreaseNumChildren},InsertChildIDAfter:function(){return InsertChildIDAfter},InsertChildIDBefore:function(){return InsertChildIDBefore},IsRoot:function(){return IsRoot},LinkSiblings:function(){return LinkSiblings},MoveNext:function(){return MoveNext},MoveNextRenderable:function(){return MoveNextRenderable},MoveNextUpdatable:function(){return MoveNextUpdatable},RelinkChildren:function(){return RelinkChildren},RemoveChildID:function(){return RemoveChildID},RemoveChildIDFromCurrentParent:function(){return RemoveChildIDFromCurrentParent},RemoveWorldTag:function(){return RemoveWorldTag},SetAndUpdateParent:function(){return SetAndUpdateParent},SetDepth:function(){return SetDepth},SetFirstChildID:function(){return SetFirstChildID},SetLastChildID:function(){return SetLastChildID},SetNextSiblingID:function(){return SetNextSiblingID},SetNumChildren:function(){return SetNumChildren},SetParentID:function(){return SetParentID},SetPreviousSiblingID:function(){return SetPreviousSiblingID},SetWorldAndParentID:function(){return SetWorldAndParentID},SetWorldID:function(){return SetWorldID},SetWorldTag:function(){return SetWorldTag}});function SetLastChildID(parentID,childID){HierarchyComponent.data[parentID][HIERARCHY.LAST]=childID}function AddChildIDAfter(afterID,childID){var nextID=GetNextSiblingID(afterID);if(nextID){LinkSiblings(childID,nextID)}else{SetNextSiblingID(childID,0);var parentID=GetParentID(childID);SetLastChildID(parentID,childID)}LinkSiblings(afterID,childID)}function SetFirstChildID(parentID,childID){HierarchyComponent.data[parentID][HIERARCHY.FIRST]=childID}function AddChildIDBefore(beforeID,childID){var prevID=GetPreviousSiblingID(beforeID);if(prevID){LinkSiblings(prevID,childID)}else{SetPreviousSiblingID(childID,0);var parentID=GetParentID(childID);SetFirstChildID(parentID,childID)}LinkSiblings(childID,beforeID)}function AddHierarchyComponent(id){addComponent(GameObjectWorld,HierarchyComponent,id)}function AreSiblings(childA,childB){return GetNextSiblingID(childA)===childB||GetPreviousSiblingID(childA)===childB}function BranchSearch(id,processCallback){var stack=[id];var stackIndex=1;var node=GetFirstChildID(id);var results=[];stackBlock:{while(stackIndex>0){results.push(node);while(processCallback(node)){stack[stackIndex++]=node;node=GetFirstChildID(node);results.push(node)}var next=GetNextSiblingID(node);var climb=true;while(next&&climb){if(processCallback(next)){climb=false;break}else{results.push(next);next=GetNextSiblingID(next)}}if(climb){while(next===0){node=stack[--stackIndex];if(!node){break stackBlock}next=GetNextSiblingID(node)}}node=next}}return results}function ClearHierarchyComponent(id){HierarchyComponent.data[id].fill(0)}function ClearSiblings(id){SetNextSiblingID(id,0);SetPreviousSiblingID(id,0)}function DecreaseNumChildren(parentID,param){var total=param===void 0?1:param;var data=HierarchyComponent.data[parentID];data[HIERARCHY.NUM_CHILDREN]=Math.max(0,data[HIERARCHY.NUM_CHILDREN]-total)}var GameObjectCache={local:[],set:function set(index,object){this.local[index]=object},get:function get(index){return this.local[index]},clear:function clear(){this.local.length=0},remove:function remove(index){this.local[index]=null}};function GetWorldID(id){return HierarchyComponent.data[id][HIERARCHY.WORLD]}function ClearWorldAndParentID(id){var worldID=GetWorldID(id);var parentID=GetParentID(id);var world2=GameObjectCache.get(worldID);HierarchyComponent.data[id][HIERARCHY.WORLD]=0;HierarchyComponent.data[id][HIERARCHY.PARENT]=0;if(world2&&hasComponent(GameObjectWorld,world2.tag,id)){removeComponent(GameObjectWorld,world2.tag,id)}DecreaseNumChildren(parentID);SetDirtyParents(id)}function DebugHierarchyComponent(id){var data=HierarchyComponent.data[id];var parent=data[HIERARCHY.PARENT];var world2=data[HIERARCHY.WORLD];var next=data[HIERARCHY.NEXT];var prev=data[HIERARCHY.PREV];console.group("Entity ID: ".concat(id));console.log("parent: ".concat(parent," - world: ").concat(world2));console.log("> next: ".concat(next,"      < prev: ").concat(prev));var kids=data[HIERARCHY.NUM_CHILDREN];var first=data[HIERARCHY.FIRST];var last=data[HIERARCHY.LAST];if(kids>0){console.log("first: ".concat(first));console.log("last: ".concat(last));console.log("numChildren: ".concat(kids))}console.groupEnd()}function MoveNext(id,rootID){var firstChild=GetFirstChildID(id);if(firstChild>0){return firstChild}else{var sibling=GetNextSiblingID(id);if(sibling===0){var parent=GetParentID(id);if(parent===rootID){return 0}else{return GetNextSiblingID(parent)}}else{return sibling}}}function DepthFirstSearchFromParentID(parentID,param){var removeParent=param===void 0?true:param;var output=[parentID];var next=GetFirstChildID(parentID);while(next>0){output.push(next);next=MoveNext(next,parentID)}if(removeParent){output.shift()}return output}function GetChildIDAtIndex(parentID,index){var next=GetFirstChildID(parentID);var total=0;while(next>0&&total<index){next=GetNextSiblingID(next);total++}return next}function GetChildIDsFromParent(parent){var next=GetFirstChildID(parent.id);var output=[];while(next>0){output.push(next);next=GetNextSiblingID(next)}return output}function GetChildIDsFromParentID(id){var next=GetFirstChildID(id);var output=[];while(next>0){output.push(next);next=GetNextSiblingID(next)}return output}function GetChildrenFromParentID(id){var out=[];var next=GetFirstChildID(id);while(next>0){out.push(GameObjectCache.get(next));next=GetNextSiblingID(next)}return out}function GetDepth(id){return HierarchyComponent.data[id][HIERARCHY.DEPTH]}function GetParentGameObject(id){return GameObjectCache.get(HierarchyComponent.data[id][HIERARCHY.PARENT])}function GetParents(id){var results=[];var currentParent=GetParentID(id);while(currentParent){results.push(currentParent);currentParent=GetParentID(currentParent)}return results}function GetSiblingIDs(childID){var next=GetNextSiblingID(childID);var output=[];while(next>0){output.push(next);next=GetNextSiblingID(next)}return output}function GetWorldFromID(childID){var worldID=GetWorldID(childID);if(worldID){return GameObjectCache.get(worldID)}}function GetWorldFromParentID(parentID){var worldID=GetWorldID(parentID);return GameObjectCache.get(worldID)}function HasChildren(id){return!!(HierarchyComponent.data[id][HIERARCHY.NUM_CHILDREN]>0)}function HasParent(id){return HierarchyComponent.data[id][HIERARCHY.PARENT]>0}function IncreaseNumChildren(parentID,param){var total=param===void 0?1:param;HierarchyComponent.data[parentID][HIERARCHY.NUM_CHILDREN]+=total}function InsertChildIDAfter(afterID,childID){var nextID=GetNextSiblingID(afterID);if(nextID){SetPreviousSiblingID(nextID,childID)}else{var parentID=GetParentID(childID);SetLastChildID(parentID,childID)}SetNextSiblingID(childID,nextID);LinkSiblings(afterID,childID)}function InsertChildIDBefore(beforeID,childID){var prevID=GetPreviousSiblingID(beforeID);if(prevID){SetNextSiblingID(prevID,childID)}else{var parentID=GetParentID(childID);SetFirstChildID(parentID,childID)}LinkSiblings(childID,beforeID);SetPreviousSiblingID(childID,prevID)}function IsRoot(id){return GetWorldID(id)===GetParentID(id)}function GetVisibleChildren(id){return Boolean(PermissionsComponent.data[id][PERMISSION.VISIBLE_CHILDREN])}function WillRenderChildren(id){return GetVisibleChildren(id)&&!!PermissionsComponent.data[id][PERMISSION.WILL_RENDER_CHILDREN]}function MoveNextRenderable(id){var firstChild=GetFirstChildID(id);if(firstChild>0&&WillRenderChildren(id)){return firstChild}else{var sibling=GetNextSiblingID(id);if(sibling===0){var parent=GetParentID(id);if(parent===GetWorldID(id)){return 0}else{return GetNextSiblingID(parent)}}else{return sibling}}}function WillUpdateChildren(id){return!!PermissionsComponent.data[id][PERMISSION.WILL_UPDATE_CHILDREN]}function MoveNextUpdatable(id){var firstChild=GetFirstChildID(id);if(firstChild>0&&WillUpdateChildren(id)){return firstChild}else{var sibling=GetNextSiblingID(id);if(sibling===0){var parent=GetParentID(id);if(parent===GetWorldID(id)){return 0}else{return GetNextSiblingID(parent)}}else{return sibling}}}function SetNumChildren(parentID,total){HierarchyComponent.data[parentID][HIERARCHY.NUM_CHILDREN]=total}function RelinkChildren(parentID,children){var len=children.length;if(len===0){SetNumChildren(parentID,0);SetFirstChildID(parentID,0);SetLastChildID(parentID,0);return}var total=1;var childA=children[0];SetFirstChildID(parentID,childA);if(len===1){SetLastChildID(parentID,childA);SetNumChildren(parentID,total);return}for(var i=1;i<len;i++){var childB=children[i];LinkSiblings(childA,childB);childA=childB;total++}SetLastChildID(parentID,childA);SetNumChildren(parentID,total)}function RemoveChildID(childID){var parentID=GetParentID(childID);var first=GetFirstChildID(parentID);var last=GetLastChildID(parentID);var prevID=GetPreviousSiblingID(childID);var nextID=GetNextSiblingID(childID);LinkSiblings(prevID,nextID);if(first===childID){SetFirstChildID(parentID,nextID)}if(last===childID){SetLastChildID(parentID,prevID)}ClearSiblings(childID)}function SetWorldID(id,worldID){HierarchyComponent.data[id][HIERARCHY.WORLD]=worldID}function RemoveWorldTag(id){var world2=GetWorldFromParentID(id);var children=DepthFirstSearchFromParentID(id,false);children.map(function(childID){removeComponent(GameObjectWorld,world2.tag,childID);SetWorldID(childID,0)})}function SetParentID(childID,parentID){HierarchyComponent.data[childID][HIERARCHY.PARENT]=parentID}function WillTransformChildren(id){return!!PermissionsComponent.data[id][PERMISSION.WILL_TRANSFORM_CHILDREN]}function SetRootTransform(id){var worldID=GetWorldID(id);var currentParent=GetParentID(id);var isRootTransform=true;while(currentParent&&currentParent!==worldID){if(WillTransformChildren(currentParent)){isRootTransform=false;break}currentParent=GetParentID(currentParent)}Transform2DComponent.data[id][TRANSFORM.IS_ROOT]=Number(isRootTransform)}function SetDirtyChildColor(id){DirtyComponent.data[id][DIRTY.CHILD_COLOR]=1}function SetWorldTag(world2,id){var worldID=world2.id;var worldTag=world2.tag;var children=DepthFirstSearchFromParentID(id,false);children.map(function(childID){addComponent(GameObjectWorld,worldTag,childID);SetWorldID(childID,worldID)});world2.updateDisplayList=true;SetDirtyChildColor(worldID)}function SetAndUpdateParent(parentID,childID,param){var addChildren=param===void 0?1:param;SetParentID(childID,parentID);if(!WillCacheChildren(childID)){SetDirtyTransform(childID)}SetDirtyParents(childID);SetRootTransform(childID);SetNumChildren(parentID,GetNumChildren(parentID)+addChildren);if(WillCacheChildren(parentID)){SetDirtyChildCache(parentID)}var world2=GetWorldFromParentID(parentID);if(world2){SetWorldTag(world2,childID)}}function SetDepth(id,depth){HierarchyComponent.data[id][HIERARCHY.DEPTH]=depth}function SetWorldAndParentID(id,worldID,parentID){HierarchyComponent.data[id][HIERARCHY.WORLD]=worldID;HierarchyComponent.data[id][HIERARCHY.PARENT]=parentID}function RemoveChildIDFromCurrentParent(childID,newParentID){var parentID=GetParentID(childID);if(parentID){var firstID=GetFirstChildID(parentID);var lastID=GetLastChildID(parentID);var nextID=GetNextSiblingID(childID);var prevID=GetPreviousSiblingID(childID);if(childID===firstID){SetFirstChildID(parentID,nextID)}if(childID===lastID){SetLastChildID(parentID,prevID)}if(nextID){SetPreviousSiblingID(nextID,prevID)}if(prevID){SetNextSiblingID(prevID,nextID)}SetDirtyParents(childID);SetParentID(childID,0);SetNumChildren(parentID,GetNumChildren(parentID)-1)}var oldWorld=GetWorldFromID(childID);var newWorld=newParentID?GetWorldFromID(newParentID):null;if(oldWorld&&oldWorld!==newWorld){RemoveWorldTag(childID)}}function AddChild(parent,child){if(IsValidParent(parent,child)){var childID=child.id;var parentID=parent.id;var numChildren=GetNumChildren(parentID);RemoveChildIDFromCurrentParent(childID,parentID);if(numChildren===0){SetFirstChildID(parentID,childID)}else{var lastChild=GetLastChildID(parentID);LinkSiblings(lastChild,childID)}SetLastChildID(parentID,childID);SetAndUpdateParent(parentID,childID);parent.onAddChild(childID)}return child}function AddChildAfter(after,child){var afterID=after.id;var childID=child.id;var parent=GetParentGameObject(afterID);var parentID=parent.id;if(IsValidParent(parent,child)){RemoveChildIDFromCurrentParent(childID,parentID);var nextID=GetNextSiblingID(afterID);if(nextID!==0){SetPreviousSiblingID(nextID,childID)}else{SetLastChildID(parentID,childID)}SetNextSiblingID(childID,nextID);LinkSiblings(afterID,childID);SetAndUpdateParent(parentID,childID);parent.onAddChild(childID)}return child}function AddChildBefore(before,child){var beforeID=before.id;var childID=child.id;var parent=GetParentGameObject(beforeID);var parentID=parent.id;if(IsValidParent(parent,child)){RemoveChildIDFromCurrentParent(childID,parentID);var prevID=GetPreviousSiblingID(beforeID);if(prevID!==0){SetNextSiblingID(prevID,childID)}else{SetFirstChildID(parentID,childID)}LinkSiblings(childID,beforeID);SetPreviousSiblingID(childID,prevID);SetAndUpdateParent(parentID,childID);parent.onAddChild(childID)}return child}function AddChildAt(parent,child,index){if(IsValidParent(parent,child)){var parentID=parent.id;var numChildren=GetNumChildren(parentID);if(index<0||index>numChildren){console.error("Index out of range");return child}if(numChildren===0){AddChild(parent,child)}else{var next=GetFirstChildID(parentID);if(index===0){AddChildBefore(GameObjectCache.get(next),child)}else if(index===1){AddChildAfter(GameObjectCache.get(next),child)}else{var count=1;while(next>0&&count<index){next=MoveNext(next,parentID);count++}AddChildAfter(GameObjectCache.get(next),child)}}}return child}function AddChildren(parent){for(var _len=arguments.length,children=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){children[_key-1]=arguments[_key]}children.forEach(function(child){AddChild(parent,child)});return children}function AddChildrenAt(parent,index){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}children.reverse().forEach(function(child){AddChildAt(parent,child,index)});return children}function AddPosition(x,y){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}children.forEach(function(child){child.x+=x;child.y+=y});return children}function AddRotation(rotation){for(var _len=arguments.length,children=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){children[_key-1]=arguments[_key]}children.forEach(function(child){child.rotation+=rotation});return children}function AddScale(scaleX,scaleY){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}children.forEach(function(child){child.scale.x+=scaleX;child.scale.y+=scaleY});return children}function AddSkew(skewX,skewY){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}children.forEach(function(child){child.skew.x+=skewX;child.skew.y+=skewY});return children}function BringChildToTop(child){var childID=child.id;var parentID=GetParentID(childID);var numChildren=GetNumChildren(parentID);var last=GetLastChildID(parentID);if(parentID&&numChildren>0&&childID!==last){InsertChildIDAfter(last,childID);SetDirtyParents(childID)}return child}function GetInfo(entry){var legend=entry.getNumChildren()>0?"Parent":"Child";return"".concat(legend," [ type=").concat(entry.type,", id=").concat(entry.id," name=").concat(entry.name," ]")}function LogChildren(entry){console.group(GetInfo(entry));entry.getChildren().forEach(function(child){if(child.getNumChildren()>0){LogChildren(child)}else{console.log(GetInfo(child))}});console.groupEnd()}function ConsoleTreeChildren(parent){var entries=parent.getChildren();if(parent.hasOwnProperty("tag")){console.group("World")}else{console.group(GetInfo(parent))}entries.forEach(function(entry){if(entry.getNumChildren()>0){LogChildren(entry)}else{console.log(GetInfo(entry))}});console.groupEnd()}function CountMatchingChildren(parent,property,value){var children=GetChildrenFromParentID(parent.id);var total=0;children.forEach(function(child){if(property in child&&(value===void 0||child[property]===value)){total++}});return total}function DepthFirstSearch(parent){var children=DepthFirstSearchFromParentID(parent.id);return children.map(function(id){return GameObjectCache.get(id)})}function DepthFirstSearchRecursive(parent,param){var output=param===void 0?[]:param;for(var _i=0,_iter=parent.getChildren();_i<_iter.length;_i++){var child=_iter[_i];output.push(child);if(child.getNumChildren()>0){DepthFirstSearchRecursive(child,output)}}return output}function RemoveChildrenBetween(parent,param,endIndex){var beginIndex=param===void 0?0:param;var parentID=parent.id;if(endIndex===void 0){endIndex=GetNumChildren(parentID)}var range=endIndex-beginIndex;if(range>0&&range<=endIndex){var children=GetChildIDsFromParent(parent);var removed2=children.splice(beginIndex,range);removed2.forEach(function(childID){ClearWorldAndParentID(childID)});RelinkChildren(parentID,children);removed2.forEach(function(id){return parent.onRemoveChild(id)});return removed2.map(function(id){return GameObjectCache.get(id)})}else{return[]}}function DestroyChildren(parent,param,endIndex){var beginIndex=param===void 0?0:param;var removed2=RemoveChildrenBetween(parent,beginIndex,endIndex);removed2.forEach(function(child){child.destroy()});var world2=GetWorldFromParentID(parent.id);if(world2){world2.updateDisplayList=true}}var ColorComponent=defineComponent({r:Types.ui8c,g:Types.ui8c,b:Types.ui8c,a:Types.f32,colorMatrix:[Types.f32,16],colorOffset:[Types.f32,4]});function AddColorComponent(id){addComponent(GameObjectWorld,ColorComponent,id);ColorComponent.r[id]=255;ColorComponent.g[id]=255;ColorComponent.b[id]=255;ColorComponent.a[id]=1;ColorComponent.colorMatrix[id].set(DEFAULT_COLOR_MATRIX)}var dirty_exports={};__export(dirty_exports,{AddDirtyComponent:function(){return AddDirtyComponent},ClearDirty:function(){return ClearDirty},ClearDirtyChildCache:function(){return ClearDirtyChildCache},ClearDirtyChildColor:function(){return ClearDirtyChildColor},ClearDirtyChildTransform:function(){return ClearDirtyChildTransform},ClearDirtyColor:function(){return ClearDirtyColor},ClearDirtyDisplayList:function(){return ClearDirtyDisplayList},ClearDirtyTransform:function(){return ClearDirtyTransform},ClearDirtyWorldTransform:function(){return ClearDirtyWorldTransform},DirtyComponent:function(){return DirtyComponent},HasDirtyChildCache:function(){return HasDirtyChildCache},HasDirtyChildColor:function(){return HasDirtyChildColor},HasDirtyChildTransform:function(){return HasDirtyChildTransform},HasDirtyColor:function(){return HasDirtyColor},HasDirtyDisplayList:function(){return HasDirtyDisplayList},HasDirtyTransform:function(){return HasDirtyTransform},HasDirtyWorldTransform:function(){return HasDirtyWorldTransform},IsDirty:function(){return IsDirty},SetDirty:function(){return SetDirty},SetDirtyChildCache:function(){return SetDirtyChildCache},SetDirtyChildColor:function(){return SetDirtyChildColor},SetDirtyChildTransform:function(){return SetDirtyChildTransform},SetDirtyColor:function(){return SetDirtyColor},SetDirtyDisplayList:function(){return SetDirtyDisplayList},SetDirtyParents:function(){return SetDirtyParents},SetDirtyTransform:function(){return SetDirtyTransform},SetDirtyWorldTransform:function(){return SetDirtyWorldTransform},WillUpdateTransform:function(){return WillUpdateTransform}});function SetDirtyColor(id){DirtyComponent.data[id][DIRTY.COLOR]=1;var world2=GetWorldID(id);if(world2){DirtyComponent.data[world2][DIRTY.CHILD_COLOR]=1}}function AddDirtyComponent(id){addComponent(GameObjectWorld,DirtyComponent,id);SetDirtyColor(id)}function ClearDirty(id){DirtyComponent.data[id][DIRTY.SELF]=0}function ClearDirtyChildCache(id){DirtyComponent.data[id][DIRTY.CHILD_CACHE]=0}function ClearDirtyChildColor(id){DirtyComponent.data[id][DIRTY.CHILD_COLOR]=0}function ClearDirtyChildTransform(id){DirtyComponent.data[id][DIRTY.CHILD_TRANSFORM]=0}function ClearDirtyColor(id){DirtyComponent.data[id][DIRTY.COLOR]=0}function ClearDirtyDisplayList(id){DirtyComponent.data[id][DIRTY.DISPLAY_LIST]=0}function ClearDirtyWorldTransform(id){DirtyComponent.data[id][DIRTY.WORLD_TRANSFORM]=0}function HasDirtyChildCache(id){return!!DirtyComponent.data[id][DIRTY.CHILD_CACHE]}function HasDirtyChildColor(id){return!!DirtyComponent.data[id][DIRTY.CHILD_COLOR]}function HasDirtyChildTransform(id){return!!DirtyComponent.data[id][DIRTY.CHILD_TRANSFORM]}function HasDirtyColor(id){return!!DirtyComponent.data[id][DIRTY.COLOR]}function HasDirtyDisplayList(id){return!!DirtyComponent.data[id][DIRTY.DISPLAY_LIST]}function HasDirtyWorldTransform(id){return!!DirtyComponent.data[id][DIRTY.WORLD_TRANSFORM]}function IsDirty(id){return!!DirtyComponent.data[id][DIRTY.SELF]}function SetDirty(id){DirtyComponent.data[id][DIRTY.SELF]=1}function SetDirtyDisplayList(id){DirtyComponent.data[id][DIRTY.DISPLAY_LIST]=1}function SetDirtyWorldTransform(id){DirtyComponent.data[id][DIRTY.WORLD_TRANSFORM]=1}function WillUpdateTransform(id){var data=DirtyComponent.data[id];return!!(data[DIRTY.WORLD_TRANSFORM]||data[DIRTY.CHILD_TRANSFORM])}function SetWillColorChildren(id,value){PermissionsComponent.data[id][PERMISSION.WILL_COLOR_CHILDREN]=Number(value)}function WillColorChildren(id){return!!PermissionsComponent.data[id][PERMISSION.WILL_COLOR_CHILDREN]}var Color2=function(){"use strict";function _class(id,param,param1,param2,param3){var red=param===void 0?255:param,green=param1===void 0?255:param1,blue=param2===void 0?255:param2,alpha=param3===void 0?1:param3;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"id",void 0);swcHelpers.defineProperty(this,"colorMatrixEnabled",false);AddColorComponent(id);this.id=id;this.set(red,green,blue,alpha)}swcHelpers.createClass(_class,[{key:"set",value:function set(red,green,blue,alpha){this.red=red;this.green=green;this.blue=blue;this.alpha=alpha}},{key:"tint",get:function get(){return this.red<<16|this.green<<8|this.blue},set:function set(value){this.red=value>>16&255;this.green=value>>8&255;this.blue=value&255}},{key:"willColorChildren",get:function get(){return WillColorChildren(this.id)},set:function set(value){SetWillColorChildren(this.id,value)}},{key:"colorMatrix",get:function get(){return ColorComponent.colorMatrix[this.id]},set:function set(value){ColorComponent.colorMatrix[this.id].set(value);SetDirtyColor(this.id);this.colorMatrixEnabled=true}},{key:"colorOffset",get:function get(){return ColorComponent.colorOffset[this.id]},set:function set(value){ColorComponent.colorOffset[this.id].set(value);SetDirtyColor(this.id)}},{key:"red",get:function get(){return ColorComponent.r[this.id]},set:function set(value){ColorComponent.r[this.id]=value;SetDirtyColor(this.id)}},{key:"green",get:function get(){return ColorComponent.g[this.id]},set:function set(value){ColorComponent.g[this.id]=value;SetDirtyColor(this.id)}},{key:"blue",get:function get(){return ColorComponent.b[this.id]},set:function set(value){ColorComponent.b[this.id]=value;SetDirtyColor(this.id)}},{key:"alpha",get:function get(){return ColorComponent.a[this.id]},set:function set(value){ColorComponent.a[this.id]=value;SetDirtyColor(this.id)}}]);return _class}();function AddPermissionsComponent(id){addComponent(GameObjectWorld,PermissionsComponent,id);PermissionsComponent.data[id].set([1,1,1,1,1,1,0,1,1,0])}function GetVisible(id){return Boolean(PermissionsComponent.data[id][PERMISSION.VISIBLE])}function ReparentChildren(parent,newParent,param,endIndex){var beginIndex=param===void 0?0:param;var moved=RemoveChildrenBetween(parent,beginIndex,endIndex);moved.forEach(function(child){AddChild(newParent,child)});return moved}function SetVisible(id,value){PermissionsComponent.data[id][PERMISSION.VISIBLE]=Number(value);SetDirtyParents(id)}function SetVisibleChildren(id,value){PermissionsComponent.data[id][PERMISSION.VISIBLE_CHILDREN]=Number(value);SetDirtyParents(id)}function WillRender(id){return!!PermissionsComponent.data[id][PERMISSION.VISIBLE]&&!!PermissionsComponent.data[id][PERMISSION.WILL_RENDER]}var GameObject=function(){"use strict";function _class(){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"id",addEntity(GameObjectWorld));swcHelpers.defineProperty(this,"type","GameObject");swcHelpers.defineProperty(this,"name","");swcHelpers.defineProperty(this,"events",void 0);var id=this.id;AddHierarchyComponent(id);AddPermissionsComponent(id);AddDirtyComponent(id);GameObjectCache.set(id,this)}swcHelpers.createClass(_class,[{key:"isRenderable",value:function isRenderable(){return WillRender(this.id)}},{key:"beforeUpdate",value:function beforeUpdate(delta,time){}},{key:"update",value:function update(delta,time){}},{key:"afterUpdate",value:function afterUpdate(delta,time){}},{key:"preRenderGL",value:function preRenderGL(renderPass){}},{key:"renderGL",value:function renderGL(renderPass){}},{key:"renderCanvas",value:function renderCanvas(renderer){}},{key:"postRenderGL",value:function postRenderGL(renderPass){}},{key:"postRenderCanvas",value:function postRenderCanvas(renderer){}},{key:"visible",get:function get(){return GetVisible(this.id)},set:function set(value){SetVisible(this.id,value)}},{key:"visibleChildren",get:function get(){return GetVisibleChildren(this.id)},set:function set(value){SetVisibleChildren(this.id,value)}},{key:"hasParent",value:function hasParent(id){var parentID=GetParentID(this.id);if(id){return parentID===id}else{return parentID>0}}},{key:"getParent",value:function getParent(){return GetParentGameObject(this.id)}},{key:"getChildren",value:function getChildren(renderPass){return GetChildrenFromParentID(this.id)}},{key:"getNumChildren",value:function getNumChildren(){return GetNumChildren(this.id)}},{key:"onAddChild",value:function onAddChild(childID){}},{key:"onUpdateChild",value:function onUpdateChild(childID){}},{key:"onRemoveChild",value:function onRemoveChild(childID){}},{key:"getDisplayData",value:function getDisplayData(){var id=this.id;var data=HierarchyComponent.data[id];return{id:id,parent:data[HIERARCHY.PARENT],world:data[HIERARCHY.WORLD],numChildren:data[HIERARCHY.NUM_CHILDREN]}}},{key:"toString",value:function toString(){return"".concat(this.type," id=\"").concat(this.id,"\" name=\"").concat(this.name,"\"")}},{key:"destroy",value:function destroy(reparentChildren){if(reparentChildren){ReparentChildren(this,reparentChildren)}else{DestroyChildren(this)}}}]);return _class}();function GetDefaultOriginX(){return ConfigStore.get(CONFIG_DEFAULTS.DEFAULT_ORIGIN).x}function GetDefaultOriginY(){return ConfigStore.get(CONFIG_DEFAULTS.DEFAULT_ORIGIN).y}var Origin=function(){"use strict";function _class(id,param,param1){var x=param===void 0?0:param,y=param1===void 0?0:param1;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"id",void 0);swcHelpers.defineProperty(this,"_x",void 0);swcHelpers.defineProperty(this,"_y",void 0);swcHelpers.defineProperty(this,"_data",void 0);this.id=id;this._data=Transform2DComponent.data[id];this.set(x,y)}swcHelpers.createClass(_class,[{key:"set",value:function set(x,param){var y=param===void 0?x:param;var data=this._data;this._x=x;this._y=y;data[TRANSFORM.ORIGIN_X]=x;data[TRANSFORM.ORIGIN_Y]=y;UpdateExtent(this.id,data[TRANSFORM.FRAME_WIDTH],data[TRANSFORM.FRAME_HEIGHT]);return this}},{key:"x",get:function get(){return this._x},set:function set(value){var data=this._data;this._x=value;data[TRANSFORM.ORIGIN_X]=value;UpdateExtent(this.id,data[TRANSFORM.FRAME_WIDTH],data[TRANSFORM.FRAME_HEIGHT])}},{key:"y",get:function get(){return this._y},set:function set(value){var data=this._data;this._y=value;data[TRANSFORM.ORIGIN_Y]=value;UpdateExtent(this.id,data[TRANSFORM.FRAME_WIDTH],data[TRANSFORM.FRAME_HEIGHT])}},{key:"destroy",value:function destroy(){this._data=null}}]);return _class}();var Scale=function(){"use strict";function _class(id,param,param1){var x=param===void 0?1:param,y=param1===void 0?1:param1;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"id",void 0);swcHelpers.defineProperty(this,"_x",void 0);swcHelpers.defineProperty(this,"_y",void 0);swcHelpers.defineProperty(this,"_data",void 0);this.id=id;this._data=Transform2DComponent.data[id];this.set(x,y)}swcHelpers.createClass(_class,[{key:"set",value:function set(x,param){var y=param===void 0?x:param;this.x=x;this.y=y;return this}},{key:"x",get:function get(){return this._x},set:function set(value){this._x=value;this._data[TRANSFORM.SCALE_X]=value;SetDirtyTransform(this.id)}},{key:"y",get:function get(){return this._y},set:function set(value){this._y=value;this._data[TRANSFORM.SCALE_Y]=value;SetDirtyTransform(this.id)}},{key:"destroy",value:function destroy(){this._data=null}}]);return _class}();function UpdateAxisAligned(id){var data=Transform2DComponent.data[id];var rotation=data[TRANSFORM.ROTATION];var skewX=data[TRANSFORM.SKEW_X];var skewY=data[TRANSFORM.SKEW_Y];data[TRANSFORM.AXIS_ALIGNED]=Number(rotation===0&&skewX===0&&skewY===0)}var Skew=function(){"use strict";function _class(id,param,param1){var x=param===void 0?0:param,y=param1===void 0?0:param1;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"id",void 0);swcHelpers.defineProperty(this,"_x",void 0);swcHelpers.defineProperty(this,"_y",void 0);swcHelpers.defineProperty(this,"_data",void 0);this.id=id;this._data=Transform2DComponent.data[id];this.set(x,y)}swcHelpers.createClass(_class,[{key:"set",value:function set(x,param){var y=param===void 0?x:param;this.x=x;this.y=y;return this}},{key:"x",get:function get(){return this._x},set:function set(value){this._x=value;this._data[TRANSFORM.SKEW_X]=value;var id=this.id;UpdateAxisAligned(id);SetDirtyTransform(id)}},{key:"y",get:function get(){return this._y},set:function set(value){this._y=value;this._data[TRANSFORM.SKEW_Y]=value;var id=this.id;UpdateAxisAligned(id);SetDirtyTransform(id)}},{key:"destroy",value:function destroy(){this._data=null}}]);return _class}();var Container=function(GameObject){"use strict";swcHelpers.inherits(_class,GameObject);function _class(param,param1){var x=param===void 0?0:param,y=param1===void 0?0:param1;swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"type","Container");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"position",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"scale",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"skew",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"origin",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"size",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"color",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"shader",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"_rotation",0);var id=_this.id;AddTransform2DComponent(id);_this.position=new Position(id,x,y);_this.scale=new Scale(id);_this.skew=new Skew(id);_this.size=new Size(id);_this.origin=new Origin(id,GetDefaultOriginX(),GetDefaultOriginY());_this.color=new Color2(id);return _this}swcHelpers.createClass(_class,[{key:"renderGL",value:function renderGL(renderPass){if(this.shader){Flush(renderPass);SetShader(this.shader,0)}SetColor(renderPass,this.color);this.preRenderGL(renderPass)}},{key:"postRenderGL",value:function postRenderGL(renderPass){if(this.shader){Flush(renderPass);PopShader()}PopColor(renderPass,this.color)}},{key:"x",get:function get(){return this.position.x},set:function set(value){this.position.x=value}},{key:"y",get:function get(){return this.position.y},set:function set(value){this.position.y=value}},{key:"rotation",get:function get(){return this._rotation},set:function set(value){this._rotation=value;var id=this.id;Transform2DComponent.data[id][TRANSFORM.ROTATION]=value;UpdateAxisAligned(id);SetDirtyTransform(id)}},{key:"alpha",get:function get(){return this.color.alpha},set:function set(value){this.color.alpha=value}},{key:"setAlpha",value:function setAlpha(value){this.alpha=value;return this}},{key:"setPosition",value:function setPosition(x,y){this.position.set(x,y);return this}},{key:"setScale",value:function setScale(x,y){this.scale.set(x,y);return this}},{key:"setRotation",value:function setRotation(value){this.rotation=value;return this}},{key:"setSkew",value:function setSkew(x,y){this.skew.set(x,y);return this}},{key:"setOrigin",value:function setOrigin(x,y){this.origin.set(x,y);return this}},{key:"getBounds",value:function getBounds(){var data=Transform2DComponent.data[this.id];var x=data[TRANSFORM.BOUNDS_X1];var y=data[TRANSFORM.BOUNDS_Y1];var right=data[TRANSFORM.BOUNDS_X2];var bottom=data[TRANSFORM.BOUNDS_Y2];return new Rectangle(x,y,right-x,bottom-y)}},{key:"destroy",value:function destroy(reparentChildren){this.position.destroy();this.scale.destroy();this.skew.destroy();this.origin.destroy();swcHelpers.get(swcHelpers.getPrototypeOf(_class.prototype),"destroy",this).call(this,reparentChildren)}}]);return _class}(GameObject);function FindChildrenByName(parent,searchString){var children=DepthFirstSearch(parent);var regex=RegExp(searchString);return children.filter(function(child){return regex.test(child.name)})}function GetAllChildren(parent,property,value){var children=DepthFirstSearch(parent);if(!property){return children}return children.filter(function(child){return property in child&&(value===void 0||child[property]===value)})}function GetLocalBounds(id){var data=Transform2DComponent.data[id];var left=data[TRANSFORM.BOUNDS_X1];var top=data[TRANSFORM.BOUNDS_Y1];var right=data[TRANSFORM.BOUNDS_X2];var bottom=data[TRANSFORM.BOUNDS_Y2];return{left:left,top:top,right:right,bottom:bottom}}function GetBounds(){for(var _len=arguments.length,children=new Array(_len),_key=0;_key<_len;_key++){children[_key]=arguments[_key]}var minX=Number.MAX_SAFE_INTEGER;var minY=Number.MAX_SAFE_INTEGER;var maxX=Number.MIN_SAFE_INTEGER;var maxY=Number.MIN_SAFE_INTEGER;children.forEach(function(child){var childID=child.id;if(hasComponent(GameObjectWorld,Transform2DComponent,childID)){var ref=GetLocalBounds(childID),left=ref.left,top=ref.top,right=ref.right,bottom=ref.bottom;if(left<minX){minX=left}if(top<minY){minY=top}if(right>maxX){maxX=right}if(bottom>maxY){maxY=bottom}}});return new Rectangle(minX,minY,maxX,maxY)}function GetChildAt(parent,index){var parentID=parent.id;if(index<0||index>GetNumChildren(parentID)){throw new Error("Index out of bounds: ".concat(index))}var childID=GetChildIDAtIndex(parentID,index);return GameObjectCache.get(childID)}function GetChildIndex(child){var childID=child.id;var index=0;var prev=GetPreviousSiblingID(childID);while(prev>0){prev=GetPreviousSiblingID(childID);index++}return index}function GetChildren(parent,property,value){var children=GetChildrenFromParentID(parent.id);if(!property){return[].concat(children)}return children.filter(function(child){return property in child&&(value===void 0||child[property]===value)})}function GetVec2DistanceSquared(a,b){var x=a.x-b.x;var y=a.y-b.y;return x*x+y*y}function GetVec2Distance(a,b){return Math.sqrt(GetVec2DistanceSquared(a,b))}function GetClosestChild(parent,point){var children=GetChildrenFromParentID(parent.id);var closest=null;var distance=0;children.forEach(function(child){if(hasComponent(GameObjectWorld,Transform2DComponent,child.id)){var childDistance=GetVec2Distance(point,child.position);if(!closest||childDistance<distance){closest=child;distance=childDistance}}});return closest}function GetFirstChild(parent,property,value){var children=GetChildrenFromParentID(parent.id);if(!property){return children[0]}for(var i=0;i<children.length;i++){var child=children[i];if(property in child&&(value===void 0||child[property]===value)){return child}}}function GetFirstChildByName(parent,searchString){var children=DepthFirstSearch(parent);var regex=RegExp(searchString);for(var i=0;i<children.length;i++){var child=children[i];if(regex.test(child.name)){return child}}}function GetFurthestChild(parent,point){var children=GetChildrenFromParentID(parent.id);var furthest=null;var distance=0;children.forEach(function(child){if(hasComponent(GameObjectWorld,Transform2DComponent,child.id)){var childDistance=GetVec2Distance(point,child.position);if(!furthest||childDistance>distance){furthest=child;distance=childDistance}}});return furthest}function GetLastChild(parent,property,value){var children=GetChildrenFromParentID(parent.id);if(!property){return children.pop()}for(var i=children.length;i>=0;i--){var child=children[i];if(property in child&&(value===void 0||child[property]===value)){return child}}}function GetParents2(child){var parents=[];var currentParent;while(child.hasParent()){currentParent=child.getParent();parents.push(currentParent);child=currentParent}return parents}function GetRandom(array,param,length){var startIndex=param===void 0?0:param;if(!length){length=array.length}var randomIndex=startIndex+Math.floor(Math.random()*length);return array[randomIndex]}function GetRandomChild(parent,param,length){var startIndex=param===void 0?0:param;var children=GetChildIDsFromParentID(parent.id);if(children.length>0){var random=GetRandom(children,startIndex,length);return GameObjectCache.get(random)}}function MoveChildDown(child){var childID=child.id;var prevID=GetPreviousSiblingID(childID);if(prevID){RemoveChildID(childID);InsertChildIDBefore(prevID,childID)}return child}function MoveChildUp(child){var childID=child.id;var nextID=GetNextSiblingID(childID);if(nextID){RemoveChildID(childID);InsertChildIDAfter(nextID,childID)}return child}function RemoveChild(parent,child){var childID=child.id;var parentID=parent.id;if(child.hasParent(parentID)){RemoveChildID(childID);DecreaseNumChildren(parentID);parent.onRemoveChild(childID)}return child}function RemoveChildAt(parent,index){var child=GetChildAt(parent,index);return RemoveChild(parent,child)}function RemoveChildren(parent){for(var _len=arguments.length,children=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){children[_key-1]=arguments[_key]}children.forEach(function(child){RemoveChild(parent,child)});return children}function RemoveChildrenAt(parent){for(var _len=arguments.length,index=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){index[_key-1]=arguments[_key]}var removed2=[];index.sort(function(a,b){return a-b});index.reverse().forEach(function(i){var child=RemoveChildAt(parent,i);if(child){removed2.push(child)}});return removed2}function ClearWorld(childID){var worldID=HierarchyComponent.data[childID][HIERARCHY.WORLD];if(worldID!==0){var world2=GameObjectCache.get(worldID);removeComponent(GameObjectWorld,world2.tag,childID);HierarchyComponent.data[childID][HIERARCHY.WORLD]=0;world2.updateDisplayList=true}}function RemoveWorld(world2){for(var _len=arguments.length,children=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){children[_key-1]=arguments[_key]}children.forEach(function(child){ClearWorld(child.id)});return children}function ReplaceChild(target,source){var targetID=target.id;var sourceID=source.id;var targetParentID=GetParentID(targetID);var sourceParentID=GetParentID(sourceID);if(targetParentID===sourceParentID){if(GetNumChildren(targetParentID)===2){RemoveChildID(targetID)}else{var targetNextID=GetNextSiblingID(targetID);var targetPrevID=GetPreviousSiblingID(targetID);RemoveChildID(targetID);RemoveChildID(sourceID);if(targetNextID){InsertChildIDBefore(targetNextID,sourceID)}else{InsertChildIDAfter(targetPrevID,sourceID)}}DecreaseNumChildren(targetParentID)}else{var targetNextID=GetNextSiblingID(targetID);var targetPrevID=GetPreviousSiblingID(targetID);RemoveChildID(targetID);RemoveChildID(sourceID);DecreaseNumChildren(sourceParentID);if(targetNextID){InsertChildIDBefore(targetNextID,sourceID)}else{InsertChildIDAfter(targetPrevID,sourceID)}}return target}function RotateChildrenLeft(parent,param){var total=param===void 0?1:param;var parentID=parent.id;for(var i=0;i<total;i++){var first=GetFirstChildID(parentID);var last=GetLastChildID(parentID);RemoveChildID(first);AddChildIDAfter(last,first)}return parent}function RotateChildrenRight(parent,param){var total=param===void 0?1:param;var parentID=parent.id;for(var i=0;i<total;i++){var first=GetFirstChildID(parentID);var last=GetLastChildID(parentID);RemoveChildID(last);AddChildIDBefore(first,last)}return parent}function SendChildToBack(child){var childID=child.id;var parentID=GetParentID(childID);var numChildren=GetNumChildren(parentID);var first=GetFirstChildID(parentID);if(parentID&&numChildren>0&&childID!==first){InsertChildIDBefore(first,childID);SetDirtyParents(childID)}return child}function SetChildrenValue(parent,property,value){var children=DepthFirstSearch(parent);children.forEach(function(child){if(property in child){child[property]=value}});return children}function SetName(name){for(var _len=arguments.length,children=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){children[_key-1]=arguments[_key]}children.forEach(function(child){child.name=name});return children}function SetOrigin(originX,originY){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}children.forEach(function(child){child.origin.set(originX,originY)});return children}function SetPosition(x,y){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}children.forEach(function(child){child.position.set(x,y)});return children}function SetRotation(rotation){for(var _len=arguments.length,children=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){children[_key-1]=arguments[_key]}children.forEach(function(child){child.rotation=rotation});return children}function SetScale(scaleX,scaleY){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}children.forEach(function(child){child.scale.set(scaleX,scaleY)});return children}function SetSize2(width,height){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}children.forEach(function(child){child.size.set(width,height)});return children}function SetSkew(skewX,skewY){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}children.forEach(function(child){child.skew.set(skewX,skewY)});return children}function SetValue(property,value){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}children.forEach(function(child){if(property in child){child[property]=value}});return children}function SetVisible2(visible){for(var _len=arguments.length,children=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){children[_key-1]=arguments[_key]}children.forEach(function(child){child.visible=visible});return children}function SetWorld(world2){for(var _len=arguments.length,entries=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){entries[_key-1]=arguments[_key]}var worldID=world2.id;var worldTag=world2.tag;var setNewWorld=false;entries.forEach(function(entry){var currentWorldID=GetWorldID(entry.id);var children=DepthFirstSearchFromParentID(entry.id,false);children.map(function(id){if(currentWorldID!==worldID){if(currentWorldID>0){ClearWorld(id)}addComponent(GameObjectWorld,worldTag,id);SetWorldID(id,worldID);setNewWorld=true}})});if(setNewWorld){world2.updateDisplayList=true}return entries}function Shuffle(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=array[i];array[i]=array[j];array[j]=temp}return array}function ShuffleChildren(parent){var children=GetChildIDsFromParent(parent);Shuffle(children);RelinkChildren(parent.id,children);return parent.getChildren()}function SortChildren(parent,propertyGetter){var parentID=parent.id;var children=GetChildIDsFromParentID(parentID);children.sort(function(a,b){var childA=GameObjectCache.get(a);var childB=GameObjectCache.get(b);return propertyGetter(childA)-propertyGetter(childB)});RelinkChildren(parentID,children);return parent.getChildren()}var QuadVertexComponent=defineComponent({values:[Types.f32,54]});function SetQuadColor(id,red,green,blue,alpha){var data=QuadVertexComponent.values[id];data[5]=red;data[6]=green;data[7]=blue;data[8]=alpha;data[14]=red;data[15]=green;data[16]=blue;data[17]=alpha;data[23]=red;data[24]=green;data[25]=blue;data[26]=alpha;data[32]=red;data[33]=green;data[34]=blue;data[35]=alpha;data[41]=red;data[42]=green;data[43]=blue;data[44]=alpha;data[50]=red;data[51]=green;data[52]=blue;data[53]=alpha}function SetQuadPosition(id,x0,y0,x1,y1,x2,y2,x3,y3){var data=QuadVertexComponent.values[id];data[0]=x0;data[1]=y0;data[9]=x1;data[10]=y1;data[18]=x2;data[19]=y2;data[27]=x0;data[28]=y0;data[36]=x2;data[37]=y2;data[45]=x3;data[46]=y3}function SetUV(id,u0,v0,u1,v1){var data=QuadVertexComponent.values[id];data[2]=u0;data[3]=v0;data[11]=u0;data[12]=v1;data[20]=u1;data[21]=v1;data[29]=u0;data[30]=v0;data[38]=u1;data[39]=v1;data[47]=u1;data[48]=v0}function AddQuadVertex(id,param,param1){var width=param===void 0?0:param,height=param1===void 0?0:param1;addComponent(GameObjectWorld,QuadVertexComponent,id);if(width||height){SetUV(id,0,0,1,1);SetQuadColor(id,1,1,1,1);SetQuadPosition(id,0,0,0,height,width,height,width,0)}}function SetQuadTextureIndex(id,textureIndex){var data=QuadVertexComponent.values[id];if(data[4]!==textureIndex){data[4]=textureIndex;data[13]=textureIndex;data[22]=textureIndex;data[31]=textureIndex;data[40]=textureIndex;data[49]=textureIndex}}function BatchTexturedQuadBuffer(texture,id,renderPass){var ref=GetVertexBufferEntry(renderPass,2),F32=ref.F32,offset=ref.offset;var textureIndex=SetTexture(texture);SetQuadTextureIndex(id,textureIndex);F32.set(QuadVertexComponent.values[id],offset)}function SetExtent(id,x,y,width,height){var data=Transform2DComponent.data[id];data[TRANSFORM.FRAME_X1]=x;data[TRANSFORM.FRAME_Y1]=y;data[TRANSFORM.FRAME_X2]=x+width;data[TRANSFORM.FRAME_Y2]=y+height;data[TRANSFORM.FRAME_WIDTH]=width;data[TRANSFORM.FRAME_HEIGHT]=height;SetDirtyTransform(id)}function SetExtentFromFrame(child,frame2){var originX=child.origin.x;var originY=child.origin.y;var sourceSizeWidth=frame2.sourceSizeWidth;var sourceSizeHeight=frame2.sourceSizeHeight;var x;var y;var width;var height;if(frame2.trimmed){x=frame2.spriteSourceSizeX-originX*sourceSizeWidth;y=frame2.spriteSourceSizeY-originY*sourceSizeHeight;width=frame2.spriteSourceSizeWidth;height=frame2.spriteSourceSizeHeight}else{x=-originX*sourceSizeWidth;y=-originY*sourceSizeHeight;width=sourceSizeWidth;height=sourceSizeHeight}SetExtent(child.id,x,y,width,height);return child}function SetVertexUVsFromFrame(id,frame2){SetUV(id,frame2.u0,frame2.v0,frame2.u1,frame2.v1);return frame2}function SetFrame(texture,key){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}var frame2=texture.getFrame(key);var pivot=frame2.pivot;children.forEach(function(child){if(!child||frame2===child.frame){return}child.frame=frame2;child.hasTexture=true;if(pivot){child.origin.set(pivot.x,pivot.y)}SetExtentFromFrame(child,frame2);SetVertexUVsFromFrame(child.id,frame2)});return children}function SetTexture2(key,frame2){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}if(!key){children.forEach(function(child){child.texture=null;child.frame=null;child.hasTexture=false})}else{var texture=void 0;if(swcHelpers._instanceof(key,Frame)){frame2=key;texture=key.texture}else if(swcHelpers._instanceof(key,Texture)){texture=key}else{texture=GetTexture(key)}if(!texture){console.warn("Invalid Texture key: ".concat(key))}else{children.forEach(function(child){child.texture=texture});SetFrame.apply(void 0,[texture,frame2].concat(swcHelpers.toConsumableArray(children)))}}return children}var Sprite=function(Container){"use strict";swcHelpers.inherits(_class,Container);function _class(x,y,param,frame2){var texture=param===void 0?"__BLANK":param;swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,x,y));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"type","Sprite");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"texture",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"frame",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"hasTexture",false);AddQuadVertex(_this.id);_this.setTexture(texture,frame2);return _this}swcHelpers.createClass(_class,[{key:"setTexture",value:function setTexture(key,frame2){SetTexture2(key,frame2,this);return this}},{key:"setFrame",value:function setFrame(key){SetFrame(this.texture,key,this);return this}},{key:"isRenderable",value:function isRenderable(){return this.visible&&this.hasTexture&&WillRender(this.id)&&this.alpha>0}},{key:"renderGL",value:function renderGL(renderPass){var color=this.color;if(this.shader){Flush(renderPass);SetShader(this.shader,0)}if(color.colorMatrixEnabled){SetColorMatrix(color)}this.preRenderGL(renderPass);BatchTexturedQuadBuffer(this.texture,this.id,renderPass);if(color.colorMatrixEnabled&&!color.willColorChildren){Flush(renderPass);PopColorMatrix()}}},{key:"renderCanvas",value:function renderCanvas(renderer){}},{key:"destroy",value:function destroy(reparentChildren){swcHelpers.get(swcHelpers.getPrototypeOf(_class.prototype),"destroy",this).call(this,reparentChildren);this.texture=null;this.frame=null;this.hasTexture=false}}]);return _class}(Container);function SwapChildren(child1,child2){var child1ID=child1.id;var child2ID=child2.id;var parentID=GetParentID(child1ID);if(child2.hasParent(parentID)){if(GetNextSiblingID(child1ID)===child2ID){MoveChildUp(child1)}else if(GetPreviousSiblingID(child1ID)===child2ID){MoveChildDown(child1)}else{var child1NextID=GetNextSiblingID(child1ID);var child1PrevID=GetPreviousSiblingID(child1ID);var child2NextID=GetNextSiblingID(child2ID);var child2PrevID=GetPreviousSiblingID(child2ID);RemoveChildID(child1ID);RemoveChildID(child2ID);if(child1NextID){InsertChildIDBefore(child1NextID,child2ID)}else if(child1PrevID){InsertChildIDAfter(child1PrevID,child2ID)}if(child2NextID){InsertChildIDBefore(child2NextID,child1ID)}else if(child2PrevID){InsertChildIDAfter(child2PrevID,child1ID)}}}}function DisplayDebugTools(world2){var logHelp=["%cPhaser 4 Display Debug Tools Help:","%c"];var logCSS=["color: red;","color: white;"];var logCommands=["%cPhaser 4 Display Debug Tools Commands:","%c"];var logCommandsCSS=["color: red;","color: white;"];var addHelp=function(command,param){var description=param===void 0?"":param;logHelp.push("%c".concat(command,"  %c").concat(description));logCSS.push("color: blue");logCSS.push("color: black")};var addCommand=function(command,param){var description=param===void 0?"":param;logCommands.push("%c".concat(command,"  %c").concat(description));logCommandsCSS.push("color: blue");logCommandsCSS.push("color: black")};var top=window.parent.top;top["world"]=world2;addHelp("world","A reference to the World instance");top["List"]=function(param){var parent=param===void 0?world2:param;ConsoleTreeChildren(parent)};addHelp("List(parent?)","Dump the Display List to the console");top["Container"]=function(x,y){return new Container(x,y)};addHelp("Container(x, y)","Create and return a new Container Game Object");top["Sprite"]=function(x,y,key,frame2){return new Sprite(x,y,key,frame2)};addHelp("Sprite(x, y, key, frame?)","Create and return a new Sprite Game Object");top["Textures"]=function(){for(var _i=0,_iter=TextureManagerInstance.get().textures.keys();_i<_iter.length;_i++){var key=_iter[_i];console.log(key)}};addHelp("Textures()","List all of the textures loaded into the Texture Manager");top["Frames"]=function(texture){for(var _i=0,_iter=GetTexture(texture).frames.keys();_i<_iter.length;_i++){var key=_iter[_i];console.log(key)}};addHelp("Frames(textureKey)","List all of the frames in the given Texture");top["GetParentID"]=function(child){return GetParentID(child.id)};addHelp("GetParentID(child)","Return the Parent ID");top["SaveList"]=function(name){var entries=DepthFirstSearch(world2);console.log(entries)};top["LoadList"]=function(name){};addHelp("");top["AddChild"]=function(parent,child){return AddChild(parent,child)};addCommand("AddChild(parent, child)","Add the child to the parent");top["AddChildAfter"]=function(after,child){return AddChildAfter(after,child)};addCommand("AddChildAfter(after, child)","Add the child after the other");top["AddChildAt"]=function(parent,child,param){var index=param===void 0?0:param;return AddChildAt(parent,child,index)};addCommand("AddChildAt(parent, child, index?)","Add the child to the parent at the given index");top["AddChildBefore"]=function(before,child){return AddChildBefore(before,child)};addCommand("AddChildBefore(before, child)","Add the child before the other");top["AddChildren"]=function(param){var parent=param===void 0?world2:param;for(var _len=arguments.length,children=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){children[_key-1]=arguments[_key]}return AddChildren.apply(void 0,[parent].concat(swcHelpers.toConsumableArray(children)))};addCommand("AddChildren(parent, ...children)","Add all children to the parent");top["AddChildrenAt"]=function(param,param1){var parent=param===void 0?world2:param,index=param1===void 0?0:param1;for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}return AddChildrenAt.apply(void 0,[parent,index].concat(swcHelpers.toConsumableArray(children)))};addCommand("AddChildrenAt(parent, index, ...children)","Add all children to the parent at the given index");top["BringChildToTop"]=function(child){return BringChildToTop(child)};addCommand("BringChildToTop(child)","Moves the child to the top of its parents display list");top["CountMatchingChildren"]=function(parent,property,value){return CountMatchingChildren(parent,property,value)};addCommand("CountMatchingChildren(parent, property, value?)","How many children match the property and value");top["DepthFirstSearch"]=function(param){var parent=param===void 0?world2:param;return DepthFirstSearch(parent)};addCommand("DepthFirstSearch(parent?)","Return all children from a DFS of the parent");top["DepthFirstSearchRecursive"]=function(param){var parent=param===void 0?world2:param;return DepthFirstSearchRecursive(parent)};addCommand("DepthFirstSearchRecursive(parent?)","Return all children from a recursive DFS of the parent");top["DestroyChildren"]=function(param,param1,endIndex){var parent=param===void 0?world2:param,beginIndex=param1===void 0?0:param1;return DestroyChildren(parent,beginIndex,endIndex)};addCommand("DestroyChildren(parent?, beginIndex?, endIndex?)","Destroy all children optionally between the indexes");top["FindChildrenByName"]=function(parent,searchString){return FindChildrenByName(parent,searchString)};addCommand("FindChildrenByName(parent, searchString)","Return all children with a name matching the string or regexp");top["GetAllChildren"]=function(parent,property,value){return GetAllChildren(parent,property,value)};addCommand("GetAllChildren(parent, property?, value?)","Return all children of the parent in a deep scan");top["GetBounds"]=function(children){return GetBounds.apply(void 0,children)};addCommand("GetBounds(...children)","Get the bounds of all children added together");top["GetChildAt"]=function(parent,index){return GetChildAt(parent,index)};addCommand("GetChildAt(parent, index)","Return the child at the given index");top["GetChildIndex"]=function(child){return GetChildIndex(child)};addCommand("GetChildIndex(child)","Get the index of the child within the parent display list");top["GetChildren"]=function(parent,property,value){return GetChildren(parent,property,value)};addCommand("GetChildren(parent, property?, value?)","Return all direct children of the parent");top["GetClosestChild"]=function(parent,point){return GetClosestChild(parent,point)};addCommand("GetClosestChild(parent, IVec2Like point)","Return the child closest to the given vector point");top["GetFirstChild"]=function(parent,property,value){return GetFirstChild(parent,property,value)};addCommand("GetFirstChild(parent, property?, value?)","Return the first child, optionally matching the given property and value");top["GetFirstChildByName"]=function(parent,searchString){return GetFirstChildByName(parent,searchString)};addCommand("GetFirstChildByName(parent, searchString)","Return the first child matching the string or regexp");top["GetFurthestChild"]=function(parent,point){return GetFurthestChild(parent,point)};addCommand("GetFurthestChild(parent, IVec2Like point)","Return the child furthest away from the given vector point");top["GetLastChild"]=function(parent,property,value){return GetLastChild(parent,property,value)};addCommand("GetLastChild(parent, property?, value?)","Return the last child, optionally matching the given property and value");top["GetParents"]=function(child){return GetParents2(child)};addCommand("GetParents(child)","Get all parents of the child in an array, recursively searching up");top["GetRandomChild"]=function(parent,param,length){var startIndex=param===void 0?0:param;return GetRandomChild(parent,startIndex,length)};addCommand("GetRandomChild(parent, startIndex?, length?)","Get a random child from the parent, optionally between the indexes");top["IsValidParent"]=function(parent,child){return IsValidParent(parent,child)};addCommand("IsValidParent(parent, child)","Is the parent a valid candidate for the child?");top["MoveChildDown"]=function(child){return MoveChildDown(child)};addCommand("MoveChildDown(child)","Moves the child one index down the display list");top["MoveChildUp"]=function(child){return MoveChildUp(child)};addCommand("MoveChildUp(child)","Moves the child one index up the display list");top["RemoveChild"]=function(parent,child){return RemoveChild(parent,child)};addCommand("RemoveChild(parent, child)","Removes a single child from its parent");top["RemoveChildAt"]=function(parent,index){return RemoveChildAt(parent,index)};addCommand("RemoveChildAt(parent, index)","Removes the child at the given index from the parent");top["RemoveChildren"]=function(parent){for(var _len=arguments.length,children=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){children[_key-1]=arguments[_key]}return RemoveChildren.apply(void 0,[parent].concat(swcHelpers.toConsumableArray(children)))};addCommand("RemoveChildren(parent, ...children)","Removes all given children from the parent");top["RemoveChildrenAt"]=function(parent){for(var _len=arguments.length,index=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){index[_key-1]=arguments[_key]}return RemoveChildrenAt.apply(void 0,[parent].concat(swcHelpers.toConsumableArray(index)))};addCommand("RemoveChildrenAt(parent, ...index)","Removes the children at the given indexes from the parent");top["RemoveChildrenBetween"]=function(parent,param,endIndex){var beginIndex=param===void 0?0:param;return RemoveChildrenBetween(parent,beginIndex,endIndex)};addCommand("RemoveChildrenBetween(parent, beginIndex, endIndex)","Removes the children from the parent between the start and end indexes");top["RemoveWorld"]=function(world3){for(var _len=arguments.length,children=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){children[_key-1]=arguments[_key]}return RemoveWorld.apply(void 0,[world3].concat(swcHelpers.toConsumableArray(children)))};addCommand("RemoveWorld(world, ...children)","Removes the World component from the given children");top["ReparentChildren"]=function(parent,newParent,param,endIndex){var beginIndex=param===void 0?0:param;return ReparentChildren(parent,newParent,beginIndex,endIndex)};addCommand("ReparentChildren(parent, newParent, beginIndex?, endIndex?)","Removes the children from parent and adds them to newParent");top["ReplaceChild"]=function(target,source){return ReplaceChild(target,source)};addCommand("ReplaceChild(target, source)","Replaces the target with the source child within the parent");top["RotateChildrenLeft"]=function(parent,param){var total=param===void 0?1:param;return RotateChildrenLeft(parent,total)};addCommand("RotateChildrenLeft(parent, total?)",'Rotates the parent display list "total" places to the left');top["RotateChildrenRight"]=function(parent,param){var total=param===void 0?1:param;return RotateChildrenRight(parent,total)};addCommand("RotateChildrenRight(parent, total?)",'Rotates the parent display list "total" places to the right');top["SendChildToBack"]=function(child){return SendChildToBack(child)};addCommand("SendChildToBack(child)","Sends the given child to the back of the parent display list");top["SetChildrenValue"]=function(parent,property,value){return SetChildrenValue(parent,property,value)};addCommand("SetChildrenValue(parent, property, value)","Sets the property to value on all children of the parent");top["SetName"]=function(name){for(var _len=arguments.length,children=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){children[_key-1]=arguments[_key]}return SetName.apply(void 0,[name].concat(swcHelpers.toConsumableArray(children)))};addCommand("SetName(name, ...children)","Sets the name property on all given children");top["SetOrigin"]=function(originX,originY){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}return SetOrigin.apply(void 0,[originX,originY].concat(swcHelpers.toConsumableArray(children)))};addCommand("SetOrigin(originX, originY, ...children)","Sets the origin on all given children");top["SetPosition"]=function(x,y){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}return SetPosition.apply(void 0,[x,y].concat(swcHelpers.toConsumableArray(children)))};addCommand("SetPosition(x, y, ...children)","Sets the position on all given children");top["SetRotation"]=function(rotation){for(var _len=arguments.length,children=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){children[_key-1]=arguments[_key]}return SetRotation.apply(void 0,[rotation].concat(swcHelpers.toConsumableArray(children)))};addCommand("SetRotation(rotation, ...children)","Sets the rotation on all given children");top["SetScale"]=function(scaleX,scaleY){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}return SetScale.apply(void 0,[scaleX,scaleY].concat(swcHelpers.toConsumableArray(children)))};addCommand("SetScale(scaleX, scaleY, ...children)","Sets the scale on all given children");top["SetSize"]=function(width,height){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}return SetSize2.apply(void 0,[width,height].concat(swcHelpers.toConsumableArray(children)))};addCommand("SetSize(width, height, ...children)","Sets the size on all given children");top["SetSkew"]=function(skewX,skewY){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}return SetSkew.apply(void 0,[skewX,skewY].concat(swcHelpers.toConsumableArray(children)))};addCommand("SetSkew(skewX, skewY, ...children)","Sets the skew on all given children");top["SetValue"]=function(property,value){for(var _len=arguments.length,children=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){children[_key-2]=arguments[_key]}return SetValue.apply(void 0,[property,value].concat(swcHelpers.toConsumableArray(children)))};addCommand("SetValue(property, value, ...children)","Sets the property to the value on all given children");top["SetVisible"]=function(visible){for(var _len=arguments.length,children=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){children[_key-1]=arguments[_key]}return SetVisible2.apply(void 0,[visible].concat(swcHelpers.toConsumableArray(children)))};addCommand("SetVisible(visible, ...children)","Sets the visible state on all given children");top["SetWorld"]=function(world3){for(var _len=arguments.length,children=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){children[_key-1]=arguments[_key]}return SetWorld.apply(void 0,[world3].concat(swcHelpers.toConsumableArray(children)))};addCommand("SetWorld(world, ...children)","Sets the World on all given children");top["ShuffleChildren"]=function(parent){return ShuffleChildren(parent)};addCommand("ShuffleChildren(parent)","Shuffles all of the children of the given parent");top["SortChildren"]=function(parent,getter){return SortChildren(parent,getter)};addCommand("SortChildren(parent, getter)","Sorts all of the children based on the given getter function");top["SwapChildren"]=function(child1,child2){SwapChildren(child1,child2)};addCommand("SwapChildren(child1, child2)","Swaps the position of the 2 children of the same parent");top["DDHelp"]=function(){(_console=console).log.apply(_console,[logHelp.join("\n")].concat(swcHelpers.toConsumableArray(logCSS)))};top["DDCommands"]=function(){(_console1=console).log.apply(_console1,[logCommands.join("\n")].concat(swcHelpers.toConsumableArray(logCommandsCSS)))};console.log("%cDisplay Debug Tools Installed%c See DDHelp() and DDCommands() for command list","padding: 4px 16px; color: #fff; background: linear-gradient(#81003e 40%, #c3bc00)","")}function RectangleToRectangle(rectA,rectB){if(rectA.width<=0||rectA.height<=0||rectB.width<=0||rectB.height<=0){return false}return!(rectA.right<rectB.x||rectA.bottom<rectB.y||rectA.x>rectB.right||rectA.y>rectB.bottom)}function OverlapBounds(source){for(var _len=arguments.length,targets=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){targets[_key-1]=arguments[_key]}var sourceBounds=GetBounds(source);for(var i=0;i<targets.length;i++){var target=targets[i];if(target===source){continue}if(RectangleToRectangle(sourceBounds,GetBounds(target))){return true}}return false}var events_exports={};__export(events_exports,{ClearEvent:function(){return ClearEvent},Emit:function(){return Emit},EventEmitter:function(){return EventEmitter},EventInstance:function(){return EventInstance},GetEventNames:function(){return GetEventNames},GetListenerCount:function(){return GetListenerCount},GetListeners:function(){return GetListeners},Off:function(){return Off},On:function(){return On},Once:function(){return Once},RemoveAllListeners:function(){return RemoveAllListeners}});function ClearEvent(emitter,event){emitter.events.delete(event);return emitter}function Emit(emitter,event){for(var _len=arguments.length,args=new Array(_len>2?_len-2:0),_key=2;_key<_len;_key++){args[_key-2]=arguments[_key]}if(emitter.events.size===0||!emitter.events.has(event)){return false}var listeners=emitter.events.get(event);var handlers=[].concat(listeners);for(var _i=0;_i<handlers.length;_i++){var ee=handlers[_i];ee.callback.apply(ee.context,args);if(ee.once){listeners.delete(ee)}}if(listeners.size===0){emitter.events.delete(event)}return true}var EventEmitter=function _class(){"use strict";swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"events",void 0);this.events=new Map()};var EventInstance=function _class(callback,context,param){"use strict";var once=param===void 0?false:param;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"callback",void 0);swcHelpers.defineProperty(this,"context",void 0);swcHelpers.defineProperty(this,"once",void 0);this.callback=callback;this.context=context;this.once=once};function GetEventNames(emitter){return[].concat(emitter.events.keys())}function GetListenerCount(emitter,event){var listeners=emitter.events.get(event);return listeners?listeners.size:0}function GetListeners(emitter,event){var out=[];var listeners=emitter.events.get(event);listeners.forEach(function(listener){out.push(listener.callback)});return out}function Off(emitter,event,callback,context,once){var events=emitter.events;var listeners=events.get(event);if(!callback){events.delete(event)}else if(swcHelpers._instanceof(callback,EventInstance)){listeners.delete(callback)}else{var hasContext=!context;var hasOnce=once!==void 0;for(var _i=0;_i<listeners.length;_i++){var listener=listeners[_i];if(listener.callback===callback&&hasContext&&listener.context===context&&hasOnce&&listener.once===once){listeners.delete(listener)}}}if(listeners.size===0){events.delete(event)}return emitter}function On(emitter,event,callback,param,param1){var context=param===void 0?emitter:param,once=param1===void 0?false:param1;if(typeof callback!=="function"){throw new TypeError("Listener not a function")}var listener=new EventInstance(callback,context,once);var listeners=emitter.events.get(event);if(!listeners){emitter.events.set(event,new Set([listener]))}else{listeners.add(listener)}return listener}function Once(emitter,event,callback,param){var context=param===void 0?emitter:param;return On(emitter,event,callback,context,true)}function RemoveAllListeners(emitter,event){if(!event){emitter.events.clear()}else{emitter.events.delete(event)}}var gameobjects_exports={};__export(gameobjects_exports,{AnimatedSprite:function(){return AnimatedSprite},Components:function(){return components_exports},Container:function(){return Container},DirectDraw:function(){return DirectDraw},EffectLayer:function(){return EffectLayer},GameObject:function(){return GameObject},GameObjectCache:function(){return GameObjectCache},Layer:function(){return Layer},Rectangle:function(){return Rectangle2},RenderLayer:function(){return RenderLayer},SpatialGridLayer:function(){return SpatialGridLayer},Sprite:function(){return Sprite},Text:function(){return Text}});var components_exports={};__export(components_exports,{Color:function(){return color_exports2},Dirty:function(){return dirty_exports},Hierarchy:function(){return hierarchy_exports},Input:function(){return input_exports},Permissions:function(){return permissions_exports},Transform:function(){return transform_exports},Vertex:function(){return Vertex},Vertices:function(){return vertices_exports}});var color_exports2={};__export(color_exports2,{AddColorComponent:function(){return AddColorComponent},Color:function(){return Color2},ColorComponent:function(){return ColorComponent},CompareColorMatrix:function(){return CompareColorMatrix},SetAlpha:function(){return SetAlpha}});function SetAlpha(id,value){ColorComponent.a[id]=value;SetDirtyParents(id)}var input_exports={};__export(input_exports,{InputComponent:function(){return InputComponent}});var InputComponent=function(){"use strict";function _class(entity){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"entity",void 0);swcHelpers.defineProperty(this,"enabled",false);swcHelpers.defineProperty(this,"enabledChildren",true);swcHelpers.defineProperty(this,"hitArea",void 0);this.entity=entity}swcHelpers.createClass(_class,[{key:"destroy",value:function destroy(){this.entity=null;this.hitArea=null}}]);return _class}();var permissions_exports={};__export(permissions_exports,{AddPermissionsComponent:function(){return AddPermissionsComponent},GetVisible:function(){return GetVisible},GetVisibleChildren:function(){return GetVisibleChildren},HasCustomDisplayList:function(){return HasCustomDisplayList},HasRenderableChildren:function(){return HasRenderableChildren},PermissionsComponent:function(){return PermissionsComponent},SetCustomDisplayList:function(){return SetCustomDisplayList},SetVisible:function(){return SetVisible},SetVisibleChildren:function(){return SetVisibleChildren},SetWillCacheChildren:function(){return SetWillCacheChildren},SetWillColorChildren:function(){return SetWillColorChildren},SetWillRender:function(){return SetWillRender},SetWillRenderChildren:function(){return SetWillRenderChildren},SetWillTransformChildren:function(){return SetWillTransformChildren},SetWillUpdate:function(){return SetWillUpdate},SetWillUpdateChildren:function(){return SetWillUpdateChildren},WillCacheChildren:function(){return WillCacheChildren},WillColorChildren:function(){return WillColorChildren},WillRender:function(){return WillRender},WillRenderChildren:function(){return WillRenderChildren},WillTransformChildren:function(){return WillTransformChildren},WillUpdate:function(){return WillUpdate},WillUpdateChildren:function(){return WillUpdateChildren}});function HasCustomDisplayList(id){return!!PermissionsComponent.data[id][PERMISSION.CUSTOM_DISPLAY_LIST]}function HasRenderableChildren(id,dirtyCamera){var numChildren=GetNumChildren(id);if(numChildren===0||!WillRenderChildren(id)){return 0}if(dirtyCamera||!WillCacheChildren(id)||WillCacheChildren(id)&&HasDirtyChildCache(id)){return numChildren}return 0}function SetCustomDisplayList(id,value){PermissionsComponent.data[id][PERMISSION.CUSTOM_DISPLAY_LIST]=Number(value)}function SetWillCacheChildren(id,value){PermissionsComponent.data[id][PERMISSION.WILL_CACHE_CHILDREN]=Number(value)}function SetWillRender(id,value){PermissionsComponent.data[id][PERMISSION.WILL_RENDER]=Number(value)}function SetWillRenderChildren(id,value){PermissionsComponent.data[id][PERMISSION.WILL_RENDER_CHILDREN]=Number(value)}function SetWillTransformChildren(id,value){PermissionsComponent.data[id][PERMISSION.WILL_TRANSFORM_CHILDREN]=Number(value)}function SetWillUpdate(id,value){PermissionsComponent.data[id][PERMISSION.WILL_UPDATE]=Number(value)}function SetWillUpdateChildren(id,value){PermissionsComponent.data[id][PERMISSION.WILL_UPDATE_CHILDREN]=Number(value)}function WillUpdate(id){return!!PermissionsComponent.data[id][PERMISSION.WILL_UPDATE]}var transform_exports={};__export(transform_exports,{AddTransform2DComponent:function(){return AddTransform2DComponent},BoundsIntersects:function(){return BoundsIntersects},CopyLocalToWorld:function(){return CopyLocalToWorld},CopyWorldToWorld:function(){return CopyWorldToWorld},GetLocalBounds:function(){return GetLocalBounds},GetLocalTransform:function(){return GetLocalTransform},GetRotation:function(){return GetRotation},GetScaleX:function(){return GetScaleX},GetScaleY:function(){return GetScaleY},GetSkewX:function(){return GetSkewX},GetSkewY:function(){return GetSkewY},GetWorldTransform:function(){return GetWorldTransform},GetX:function(){return GetX},GetY:function(){return GetY},GlobalToLocal:function(){return GlobalToLocal},IsInView:function(){return IsInView},IsRootTransform:function(){return IsRootTransform},LocalToGlobal:function(){return LocalToGlobal},MultiplyLocalWithWorld:function(){return MultiplyLocalWithWorld},Origin:function(){return Origin},Position:function(){return Position},Scale:function(){return Scale},SetBounds:function(){return SetBounds},SetExtent:function(){return SetExtent},SetInView:function(){return SetInView},SetInViewFromBounds:function(){return SetInViewFromBounds},SetRootTransform:function(){return SetRootTransform},Size:function(){return Size},Skew:function(){return Skew},Transform2DComponent:function(){return Transform2DComponent},UpdateAxisAligned:function(){return UpdateAxisAligned},UpdateExtent:function(){return UpdateExtent},UpdateTransforms:function(){return UpdateTransforms},UpdateWorldTransform:function(){return UpdateWorldTransform}});function BoundsIntersects(id,x,y,right,bottom){var data=Transform2DComponent.data[id];var bx=data[TRANSFORM.BOUNDS_X1];var by=data[TRANSFORM.BOUNDS_Y1];var br=data[TRANSFORM.BOUNDS_X2];var bb=data[TRANSFORM.BOUNDS_Y2];return!(right<bx||bottom<by||x>br||y>bb)}function CopyLocalToWorld(source,target){var targetData=Transform2DComponent.data[target];var sourceData=Transform2DComponent.data[source];targetData[TRANSFORM.WORLD_A]=sourceData[TRANSFORM.LOCAL_A];targetData[TRANSFORM.WORLD_B]=sourceData[TRANSFORM.LOCAL_B];targetData[TRANSFORM.WORLD_C]=sourceData[TRANSFORM.LOCAL_C];targetData[TRANSFORM.WORLD_D]=sourceData[TRANSFORM.LOCAL_D];targetData[TRANSFORM.WORLD_TX]=sourceData[TRANSFORM.LOCAL_TX];targetData[TRANSFORM.WORLD_TY]=sourceData[TRANSFORM.LOCAL_TY]}function CopyWorldToWorld(source,target){var targetData=Transform2DComponent.data[target];var sourceData=Transform2DComponent.data[source];targetData[TRANSFORM.WORLD_A]=sourceData[TRANSFORM.WORLD_A];targetData[TRANSFORM.WORLD_B]=sourceData[TRANSFORM.WORLD_B];targetData[TRANSFORM.WORLD_C]=sourceData[TRANSFORM.WORLD_C];targetData[TRANSFORM.WORLD_D]=sourceData[TRANSFORM.WORLD_D];targetData[TRANSFORM.WORLD_TX]=sourceData[TRANSFORM.WORLD_TX];targetData[TRANSFORM.WORLD_TY]=sourceData[TRANSFORM.WORLD_TY]}function GetLocalTransform(id){var data=Transform2DComponent.data[id];return{a:data[TRANSFORM.LOCAL_A],b:data[TRANSFORM.LOCAL_B],c:data[TRANSFORM.LOCAL_C],d:data[TRANSFORM.LOCAL_D],tx:data[TRANSFORM.LOCAL_TX],ty:data[TRANSFORM.LOCAL_TY]}}function GetRotation(id){return Transform2DComponent.data[id][TRANSFORM.ROTATION]}function GetScaleX(id){return Transform2DComponent.data[id][TRANSFORM.SCALE_X]}function GetScaleY(id){return Transform2DComponent.data[id][TRANSFORM.SCALE_Y]}function GetSkewX(id){return Transform2DComponent.data[id][TRANSFORM.SKEW_X]}function GetSkewY(id){return Transform2DComponent.data[id][TRANSFORM.SKEW_Y]}function GetWorldTransform(id){var data=Transform2DComponent.data[id];return{a:data[TRANSFORM.WORLD_A],b:data[TRANSFORM.WORLD_B],c:data[TRANSFORM.WORLD_C],d:data[TRANSFORM.WORLD_D],tx:data[TRANSFORM.WORLD_TX],ty:data[TRANSFORM.WORLD_TY]}}function GetX(id){return Transform2DComponent.data[id][TRANSFORM.X]}function GetY(id){return Transform2DComponent.data[id][TRANSFORM.Y]}function Vec2FromArray(dst,param,param1){var src=param===void 0?[]:param,index=param1===void 0?0:param1;return dst.set(src[index],src[index+1])}function Vec2ToArray(v,param,param1){var dst=param===void 0?[]:param,index=param1===void 0?0:param1;dst[index]=v.x;dst[index+1]=v.y;return dst}var Vec2=function(){"use strict";function _class(param,param1){var x=param===void 0?0:param,y=param1===void 0?0:param1;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"x",void 0);swcHelpers.defineProperty(this,"y",void 0);this.set(x,y)}swcHelpers.createClass(_class,[{key:"set",value:function set(param,param1){var x=param===void 0?0:param,y=param1===void 0?0:param1;this.x=x;this.y=y;return this}},{key:"toArray",value:function toArray(param,param1){var dst=param===void 0?[]:param,index=param1===void 0?0:param1;return Vec2ToArray(this,dst,index)}},{key:"fromArray",value:function fromArray(src,param){var index=param===void 0?0:param;Vec2FromArray(this,src,index);return this}},{key:"toString",value:function toString(){return"{ x=".concat(this.x,", y=").concat(this.y," }")}}]);return _class}();function GlobalToLocal(worldTransform,x,y,param){var out=param===void 0?new Vec2():param;var a=worldTransform.a,b=worldTransform.b,c=worldTransform.c,d=worldTransform.d,tx=worldTransform.tx,ty=worldTransform.ty;var id=1/(a*d+c*-b);out.x=d*id*x+-c*id*y+(ty*c-tx*d)*id;out.y=a*id*y+-b*id*x+(-ty*a+tx*b)*id;return out}function IsInView(id){return!!Transform2DComponent.data[id][TRANSFORM.IN_VIEW]}function IsRootTransform(id){return!!Transform2DComponent.data[id][TRANSFORM.IS_ROOT]}function LocalToGlobal(worldTransform,x,y,param){var out=param===void 0?new Vec2():param;var a=worldTransform.a,b=worldTransform.b,c=worldTransform.c,d=worldTransform.d,tx=worldTransform.tx,ty=worldTransform.ty;out.x=a*x+c*y+tx;out.y=b*x+d*y+ty;return out}function MultiplyLocalWithWorld(parentID,childID){var parentData=Transform2DComponent.data[parentID];var childData=Transform2DComponent.data[childID];var pa=parentData[TRANSFORM.WORLD_A];var pb=parentData[TRANSFORM.WORLD_B];var pc=parentData[TRANSFORM.WORLD_C];var pd=parentData[TRANSFORM.WORLD_D];var ptx=parentData[TRANSFORM.WORLD_TX];var pty=parentData[TRANSFORM.WORLD_TY];var a=childData[TRANSFORM.LOCAL_A];var b=childData[TRANSFORM.LOCAL_B];var c=childData[TRANSFORM.LOCAL_C];var d=childData[TRANSFORM.LOCAL_D];var tx=childData[TRANSFORM.LOCAL_TX];var ty=childData[TRANSFORM.LOCAL_TY];childData[TRANSFORM.WORLD_A]=a*pa+b*pc;childData[TRANSFORM.WORLD_B]=a*pb+b*pd;childData[TRANSFORM.WORLD_C]=c*pa+d*pc;childData[TRANSFORM.WORLD_D]=c*pb+d*pd;childData[TRANSFORM.WORLD_TX]=tx*pa+ty*pc+ptx;childData[TRANSFORM.WORLD_TY]=tx*pb+ty*pd+pty}function SetInView(id,value){Transform2DComponent.data[id][TRANSFORM.IN_VIEW]=Number(value)}function SetInViewFromBounds(id,cx,cy,cright,cbottom){var data=Transform2DComponent.data[id];var bx=data[TRANSFORM.BOUNDS_X1];var by=data[TRANSFORM.BOUNDS_Y1];var br=data[TRANSFORM.BOUNDS_X2];var bb=data[TRANSFORM.BOUNDS_Y2];data[TRANSFORM.IN_VIEW]=Number(!(cright<bx||cbottom<by||cx>br||cy>bb))}function UpdateTransforms(id,cx,cy,cright,cbottom,forceUpdate,parentIsDisplayList){var data=Transform2DComponent.data[id];var tx=data[TRANSFORM.X];var ty=data[TRANSFORM.Y];var rotation=data[TRANSFORM.ROTATION];var scaleX=data[TRANSFORM.SCALE_X];var scaleY=data[TRANSFORM.SCALE_Y];var skewX=data[TRANSFORM.SKEW_X];var skewY=data[TRANSFORM.SKEW_Y];var axisAligned=Boolean(data[TRANSFORM.AXIS_ALIGNED]);var a=scaleX;var b=0;var c=0;var d=scaleY;if(!axisAligned){a=Math.cos(rotation+skewY)*scaleX;b=Math.sin(rotation+skewY)*scaleX;c=-Math.sin(rotation-skewX)*scaleY;d=Math.cos(rotation-skewX)*scaleY}data[TRANSFORM.LOCAL_A]=a;data[TRANSFORM.LOCAL_B]=b;data[TRANSFORM.LOCAL_C]=c;data[TRANSFORM.LOCAL_D]=d;data[TRANSFORM.LOCAL_TX]=tx;data[TRANSFORM.LOCAL_TY]=ty;if(data[TRANSFORM.IS_ROOT]){data[TRANSFORM.WORLD_A]=a;data[TRANSFORM.WORLD_B]=b;data[TRANSFORM.WORLD_C]=c;data[TRANSFORM.WORLD_D]=d;data[TRANSFORM.WORLD_TX]=tx;data[TRANSFORM.WORLD_TY]=ty}else{var parentID=GetParentID(id);var parentData=Transform2DComponent.data[parentID];var pa=parentData[TRANSFORM.WORLD_A];var pb=parentData[TRANSFORM.WORLD_B];var pc=parentData[TRANSFORM.WORLD_C];var pd=parentData[TRANSFORM.WORLD_D];var ptx=parentData[TRANSFORM.WORLD_TX];var pty=parentData[TRANSFORM.WORLD_TY];data[TRANSFORM.WORLD_A]=a*pa+b*pc;data[TRANSFORM.WORLD_B]=a*pb+b*pd;data[TRANSFORM.WORLD_C]=c*pa+d*pc;data[TRANSFORM.WORLD_D]=c*pb+d*pd;data[TRANSFORM.WORLD_TX]=tx*pa+ty*pc+ptx;data[TRANSFORM.WORLD_TY]=tx*pb+ty*pd+pty;a=data[TRANSFORM.WORLD_A];b=data[TRANSFORM.WORLD_B];c=data[TRANSFORM.WORLD_C];d=data[TRANSFORM.WORLD_D];tx=data[TRANSFORM.WORLD_TX];ty=data[TRANSFORM.WORLD_TY];axisAligned=false}var x=data[TRANSFORM.FRAME_X1];var y=data[TRANSFORM.FRAME_Y1];var right=data[TRANSFORM.FRAME_X2];var bottom=data[TRANSFORM.FRAME_Y2];var x0=x*a+tx;var y0=y*d+ty;var x1=x*a+tx;var y1=bottom*d+ty;var x2=right*a+tx;var y2=bottom*d+ty;var x3=right*a+tx;var y3=y*d+ty;var inView=0;if(axisAligned){data[TRANSFORM.BOUNDS_X1]=x0;data[TRANSFORM.BOUNDS_Y1]=y0;data[TRANSFORM.BOUNDS_X2]=x2;data[TRANSFORM.BOUNDS_Y2]=y2;inView=Number(!(cright<x0||cbottom<y0||cx>x2||cy>y2))}else{x0+=y*c;y0+=x*b;x1+=bottom*c;y1+=x*b;x2+=bottom*c;y2+=right*b;x3+=y*c;y3+=right*b;var bx=Math.min(x0,x1,x2,x3);var by=Math.min(y0,y1,y2,y3);var br=Math.max(x0,x1,x2,x3);var bb=Math.max(y0,y1,y2,y3);data[TRANSFORM.BOUNDS_X1]=bx;data[TRANSFORM.BOUNDS_Y1]=by;data[TRANSFORM.BOUNDS_X2]=br;data[TRANSFORM.BOUNDS_Y2]=bb;inView=Number(!(cright<bx||cbottom<by||cx>br||cy>bb))}data[TRANSFORM.IN_VIEW]=inView;if(inView===1||forceUpdate||parentIsDisplayList){SetQuadPosition(id,x0,y0,x1,y1,x2,y2,x3,y3)}ClearDirtyTransform(id);if(WillTransformChildren(id)){SetDirtyWorldTransform(id)}}function UpdateWorldTransform(id,parentID,cx,cy,cright,cbottom,forceUpdate,parentIsDisplayList){var parentData=Transform2DComponent.data[parentID];var data=Transform2DComponent.data[id];var pa=parentData[TRANSFORM.WORLD_A];var pb=parentData[TRANSFORM.WORLD_B];var pc=parentData[TRANSFORM.WORLD_C];var pd=parentData[TRANSFORM.WORLD_D];var ptx=parentData[TRANSFORM.WORLD_TX];var pty=parentData[TRANSFORM.WORLD_TY];var a=data[TRANSFORM.LOCAL_A];var b=data[TRANSFORM.LOCAL_B];var c=data[TRANSFORM.LOCAL_C];var d=data[TRANSFORM.LOCAL_D];var tx=data[TRANSFORM.LOCAL_TX];var ty=data[TRANSFORM.LOCAL_TY];data[TRANSFORM.WORLD_A]=a*pa+b*pc;data[TRANSFORM.WORLD_B]=a*pb+b*pd;data[TRANSFORM.WORLD_C]=c*pa+d*pc;data[TRANSFORM.WORLD_D]=c*pb+d*pd;data[TRANSFORM.WORLD_TX]=tx*pa+ty*pc+ptx;data[TRANSFORM.WORLD_TY]=tx*pb+ty*pd+pty;a=data[TRANSFORM.WORLD_A];b=data[TRANSFORM.WORLD_B];c=data[TRANSFORM.WORLD_C];d=data[TRANSFORM.WORLD_D];tx=data[TRANSFORM.WORLD_TX];ty=data[TRANSFORM.WORLD_TY];var x=data[TRANSFORM.FRAME_X1];var y=data[TRANSFORM.FRAME_Y1];var right=data[TRANSFORM.FRAME_X2];var bottom=data[TRANSFORM.FRAME_Y2];var x0=x*a+tx;var y0=y*d+ty;var x1=x*a+tx;var y1=bottom*d+ty;var x2=right*a+tx;var y2=bottom*d+ty;var x3=right*a+tx;var y3=y*d+ty;x0+=y*c;y0+=x*b;x1+=bottom*c;y1+=x*b;x2+=bottom*c;y2+=right*b;x3+=y*c;y3+=right*b;var bx=Math.min(x0,x1,x2,x3);var by=Math.min(y0,y1,y2,y3);var br=Math.max(x0,x1,x2,x3);var bb=Math.max(y0,y1,y2,y3);data[TRANSFORM.BOUNDS_X1]=bx;data[TRANSFORM.BOUNDS_Y1]=by;data[TRANSFORM.BOUNDS_X2]=br;data[TRANSFORM.BOUNDS_Y2]=bb;var inView=Number(!(cright<bx||cbottom<by||cx>br||cy>bb));data[TRANSFORM.IN_VIEW]=inView;if(inView===1||forceUpdate||parentIsDisplayList){SetQuadPosition(id,x0,y0,x1,y1,x2,y2,x3,y3)}if(WillTransformChildren(id)){SetDirtyWorldTransform(id)}}var vertices_exports={};__export(vertices_exports,{AddQuadVertex:function(){return AddQuadVertex},GetQuadVertices:function(){return GetQuadVertices},QuadVertexComponent:function(){return QuadVertexComponent},SetInversedQuadFromCamera:function(){return SetInversedQuadFromCamera},SetQuadColor:function(){return SetQuadColor},SetQuadPosition:function(){return SetQuadPosition},SetQuadTextureIndex:function(){return SetQuadTextureIndex},SetUV:function(){return SetUV}});function GetQuadVertices(id){var data=QuadVertexComponent.values[id];var x0=data[0];var y0=data[1];var x1=data[9];var y1=data[10];var x2=data[18];var y2=data[19];var x3=data[45];var y3=data[46];return{x0:x0,y0:y0,x1:x1,y1:y1,x2:x2,y2:y2,x3:x3,y3:y3}}function SetInversedQuadFromCamera(id,camera,x,y,width,height){var cx=camera.getBoundsX()+x;var cy=camera.getBoundsY()+y;SetQuadPosition(id,cx,cy+height,cx,cy,cx+width,cy,cx+width,cy+height)}var Vertex=function(){"use strict";function _class(param,param1,param2){var x=param===void 0?0:param,y=param1===void 0?0:param1,z=param2===void 0?0:param2;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"x",0);swcHelpers.defineProperty(this,"y",0);swcHelpers.defineProperty(this,"z",0);swcHelpers.defineProperty(this,"u",0);swcHelpers.defineProperty(this,"v",0);swcHelpers.defineProperty(this,"texture",0);swcHelpers.defineProperty(this,"tint",16777215);swcHelpers.defineProperty(this,"alpha",1);swcHelpers.defineProperty(this,"color",4294967295);this.x=x;this.y=y;this.z=z}swcHelpers.createClass(_class,[{key:"setPosition",value:function setPosition(x,y,param){var z=param===void 0?0:param;this.x=x;this.y=y;this.z=z;return this}},{key:"setUV",value:function setUV(u,v){this.u=u;this.v=v;return this}},{key:"setColor",value:function setColor(color,param){var alpha=param===void 0?1:param;this.tint=color;this.alpha=alpha;this.packColor();return this}},{key:"setAlpha",value:function setAlpha(value){this.alpha=value;return this}},{key:"setTint",value:function setTint(value){this.tint=value;return this}},{key:"packColor",value:function packColor(){this.color=PackColor(this.tint,this.alpha)}}]);return _class}();var AnimatedSprite=function(Sprite){"use strict";swcHelpers.inherits(_class,Sprite);function _class(x,y,texture,frame2){swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,x,y,texture,frame2));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"currentAnimation",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"currentFrame",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"animData",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"hasStarted",false);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"forward",true);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"inReverse",false);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"accumulator",0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"nextTick",0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"delayCounter",0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"repeatCounter",0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"pendingRepeat",false);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"paused",false);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"wasPlaying",false);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"pendingStop",0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"pendingStopValue",0);_this.animData=CreateAnimData();return _this}swcHelpers.createClass(_class,[{key:"handleStart",value:function handleStart(){if(this.animData.showOnStart){this.visible=true}this.setCurrentFrame(this.currentFrame);this.hasStarted=true}},{key:"handleRepeat",value:function handleRepeat(){this.pendingRepeat=false}},{key:"handleStop",value:function handleStop(){this.pendingStop=0;this.animData.isPlaying=false}},{key:"handleComplete",value:function handleComplete(){this.pendingStop=0;this.animData.isPlaying=false;if(this.animData.hideOnComplete){this.visible=false}}},{key:"reverse",value:function reverse(){if(this.isPlaying){this.inReverse=!this.inReverse;this.forward=!this.forward}return this}},{key:"getProgress",value:function getProgress(){var frame2=this.currentFrame;if(!frame2){return 0}var p=frame2.progress;if(this.inReverse){p*=-1}return p}},{key:"stop",value:function stop(){this.pendingStop=0;this.animData.isPlaying=false;if(this.currentAnimation){this.handleStop()}return this}},{key:"update",value:function update(delta,now){swcHelpers.get(swcHelpers.getPrototypeOf(_class.prototype),"update",this).call(this,delta,now);var data=this.animData;var anim=this.currentAnimation;if(!anim||!data.isPlaying||anim.paused){return}this.accumulator+=delta*data.timeScale;if(this.pendingStop===1){this.pendingStopValue-=delta;if(this.pendingStopValue<=0){this.stop();return}}if(!this.hasStarted){if(this.accumulator>=this.delayCounter){this.accumulator-=this.delayCounter;this.handleStart()}}else if(this.accumulator>=this.nextTick){if(this.forward){this.nextFrame()}else{this.prevFrame()}if(data.isPlaying&&this.pendingStop===0&&anim.skipMissedFrames&&this.accumulator>this.nextTick){var safetyNet=0;do{if(this.forward){this.nextFrame()}else{this.prevFrame()}safetyNet++}while(data.isPlaying&&this.accumulator>this.nextTick&&safetyNet<60)}}}},{key:"nextFrame",value:function nextFrame(){var frame2=this.currentFrame;var data=this.animData;if(frame2.isLast){if(data.yoyo){this.handleYoyoFrame(false)}else if(this.repeatCounter>0){if(this.inReverse&&this.forward){this.forward=false}else{this.repeatAnimation()}}else{this.complete()}}else{this.setCurrentFrame(this.currentFrame.nextFrame);this.getNextTick()}return this}},{key:"repeatAnimation",value:function repeatAnimation(){if(this.pendingStop===2){if(this.pendingStopValue===0){return this.stop()}else{this.pendingStopValue--}}var data=this.animData;if(data.repeatDelay>0&&!this.pendingRepeat){this.pendingRepeat=true;this.accumulator-=this.nextTick;this.nextTick+=data.repeatDelay}else{this.repeatCounter--;if(this.forward){this.setCurrentFrame(this.currentFrame.nextFrame)}else{this.setCurrentFrame(this.currentFrame.prevFrame)}if(this.isPlaying){this.getNextTick();this.handleRepeat()}}}},{key:"setCurrentFrame",value:function setCurrentFrame(animFrame){this.currentFrame=animFrame;this.setTexture(animFrame.texture,animFrame.frame)}},{key:"getNextTick",value:function getNextTick(){this.accumulator-=this.nextTick;this.nextTick=this.currentAnimation.msPerFrame+this.currentFrame.duration}},{key:"handleYoyoFrame",value:function handleYoyoFrame(param){var isReverse=param===void 0?false:param;var animData=this.animData;if(this.inReverse=== !isReverse&&this.repeatCounter>0){if(animData.repeatDelay===0||this.pendingRepeat){this.forward=isReverse}this.repeatAnimation();return}if(this.inReverse!==isReverse&&this.repeatCounter===0){this.complete();return}this.forward=isReverse;if(isReverse){this.setCurrentFrame(this.currentFrame.nextFrame)}else{this.setCurrentFrame(this.currentFrame.prevFrame)}this.getNextTick()}},{key:"prevFrame",value:function prevFrame(){var frame2=this.currentFrame;var animData=this.animData;if(frame2.isFirst){if(animData.yoyo){this.handleYoyoFrame(true)}else if(this.repeatCounter>0){if(this.inReverse&&!this.forward){this.repeatAnimation()}else{this.forward=true;this.repeatAnimation()}}else{this.complete()}}else{this.setCurrentFrame(frame2.prevFrame);this.getNextTick()}return this}},{key:"complete",value:function complete(){this.pendingStop=0;this.animData.isPlaying=false;if(this.currentAnimation){this.handleComplete()}}},{key:"play",value:function play(){var data=this.animData;if(data.repeat=== -1){this.repeatCounter=Number.MAX_VALUE}data.isPlaying=true;if(data.delay===0){this.setTexture(this.currentFrame.texture,this.currentFrame.frame);if(data.onStart){data.onStart(this,this.currentAnimation)}}else{data.pendingStart=true}return this}},{key:"pause",value:function pause(atFrame){if(!this.paused){this.paused=true;this.wasPlaying=this.isPlaying;this.animData.isPlaying=false}if(atFrame){this.setCurrentFrame(atFrame)}return this}},{key:"resume",value:function resume(fromFrame){if(this.paused){this.paused=false;this.animData.isPlaying=this.wasPlaying}if(fromFrame){this.setCurrentFrame(fromFrame)}return this}},{key:"isPlaying",get:function get(){return this.animData.isPlaying}},{key:"isPlayingForward",get:function get(){return this.animData.isPlaying&&this.forward}},{key:"destroy",value:function destroy(reparentChildren){swcHelpers.get(swcHelpers.getPrototypeOf(_class.prototype),"destroy",this).call(this,reparentChildren);this.animData=null}}]);return _class}(Sprite);function BatchTexturedQuad(F32,offset,textureIndex,x1,y1,x2,y2,x3,y3,x4,y4,u0,v0,u1,v1,r,g,b,a){F32[offset+0]=x1;F32[offset+1]=y1;F32[offset+2]=u0;F32[offset+3]=v0;F32[offset+4]=textureIndex;F32[offset+5]=r;F32[offset+6]=g;F32[offset+7]=b;F32[offset+8]=a;F32[offset+9]=x2;F32[offset+10]=y2;F32[offset+11]=u0;F32[offset+12]=v1;F32[offset+13]=textureIndex;F32[offset+14]=r;F32[offset+15]=g;F32[offset+16]=b;F32[offset+17]=a;F32[offset+18]=x3;F32[offset+19]=y3;F32[offset+20]=u1;F32[offset+21]=v1;F32[offset+22]=textureIndex;F32[offset+23]=r;F32[offset+24]=g;F32[offset+25]=b;F32[offset+26]=a;F32[offset+27]=x1;F32[offset+28]=y1;F32[offset+29]=u0;F32[offset+30]=v0;F32[offset+31]=textureIndex;F32[offset+32]=r;F32[offset+33]=g;F32[offset+34]=b;F32[offset+35]=a;F32[offset+36]=x3;F32[offset+37]=y3;F32[offset+38]=u1;F32[offset+39]=v1;F32[offset+40]=textureIndex;F32[offset+41]=r;F32[offset+42]=g;F32[offset+43]=b;F32[offset+44]=a;F32[offset+45]=x4;F32[offset+46]=y4;F32[offset+47]=u1;F32[offset+48]=v0;F32[offset+49]=textureIndex;F32[offset+50]=r;F32[offset+51]=g;F32[offset+52]=b;F32[offset+53]=a;return offset+54}function DrawFrame(renderPass,texture,frame2,x,y,param,param1,param2){var alpha=param===void 0?1:param,scaleX=param1===void 0?1:param1,scaleY=param2===void 0?1:param2;var ref=GetVertexBufferEntry(renderPass,2),F32=ref.F32,offset=ref.offset;frame2=texture.getFrame(frame2);var textureIndex=SetTexture(texture);var displayWidth=frame2.width*scaleX;var displayHeight=frame2.height*scaleY;BatchTexturedQuad(F32,offset,textureIndex,x,y,x,y+displayHeight,x+displayWidth,y+displayHeight,x+displayWidth,y,frame2.u0,frame2.v0,frame2.u1,frame2.v1,1,1,1,alpha)}function DrawImage(renderPass,texture,x,y,param,param1,param2){var alpha=param===void 0?1:param,scaleX=param1===void 0?1:param1,scaleY=param2===void 0?1:param2;var ref=GetVertexBufferEntry(renderPass,2),F32=ref.F32,offset=ref.offset;var frame2=texture.firstFrame;var textureIndex=SetTexture(texture);var displayWidth=frame2.width*scaleX;var displayHeight=frame2.height*scaleY;BatchTexturedQuad(F32,offset,textureIndex,x,y,x,y+displayHeight,x+displayWidth,y+displayHeight,x+displayWidth,y,frame2.u0,frame2.v0,frame2.u1,frame2.v1,1,1,1,alpha)}function Clamp(value,min,max){return Math.max(min,Math.min(max,value))}function DrawImagePart(renderPass,texture,x0,y0,x1,y1,dx,dy,dw,dh,param){var alpha=param===void 0?1:param;var ref=GetVertexBufferEntry(renderPass,2),F32=ref.F32,offset=ref.offset;var frame2=texture.firstFrame;var textureIndex=SetTexture(texture);var frameWidth=frame2.width;var frameHeight=frame2.height;x0=Clamp(x0,0,frameWidth);x1=Clamp(x1,x0,frameWidth);y0=Clamp(y0,0,frameHeight);y1=Clamp(y1,y0,frameHeight);var uRange=frame2.u1-frame2.u0;var vRange=frame2.v1-frame2.v0;var u0=frame2.u0+uRange*(x0/frameWidth);var v0=frame2.v0+vRange*(y0/frameHeight);var u1=frame2.u0+uRange*(x1/frameWidth);var v1=frame2.v0+vRange*(y1/frameHeight);if(dw===void 0||dw===null){dw=x1-x0}if(dh===void 0||dh===null){dh=y1-y0}BatchTexturedQuad(F32,offset,textureIndex,dx,dy,dx,dy+dh,dx+dw,dy+dh,dx+dw,dy,u0,v0,u1,v1,1,1,1,alpha)}function DrawQuad(renderPass,texture,frame2,x0,y0,x1,y1,x2,y2,x3,y3,param){var alpha=param===void 0?1:param;var ref=GetVertexBufferEntry(renderPass,2),F32=ref.F32,offset=ref.offset;frame2=texture.getFrame(frame2);var textureIndex=SetTexture(texture);BatchTexturedQuad(F32,offset,textureIndex,x0,y0,x1,y1,x2,y2,x3,y3,frame2.u0,frame2.v0,frame2.u1,frame2.v1,1,1,1,alpha)}function DrawTiles(renderPass,texture,tileWidth,tileHeight,mapData,mapWidth,param,param1,param2){var x=param===void 0?0:param,y=param1===void 0?0:param1,alpha=param2===void 0?1:param2;var tx=0;var ty=0;var i=0;mapData.forEach(function(tile){if(tile!== -1){DrawFrame(renderPass,texture,tile,Math.floor(x+tx),Math.floor(y+ty),alpha)}i++;tx+=tileWidth;if(i===mapWidth){tx=0;ty+=tileHeight;i=0}})}function BatchTriangle(F32,offset,textureIndex,x1,y1,x2,y2,x3,y3,r,g,b,a){F32.set([x1,y1,0,0,textureIndex,r,g,b,a,x2,y2,0,1,textureIndex,r,g,b,a,x3,y3,1,1,textureIndex,r,g,b,a],offset);return offset+27}function CircleContains(circle2,x,y){if(circle2.radius>0&&x>=circle2.left&&x<=circle2.right&&y>=circle2.top&&y<=circle2.bottom){var dx=(circle2.x-x)*(circle2.x-x);var dy=(circle2.y-y)*(circle2.y-y);return dx+dy<=circle2.radius*circle2.radius}else{return false}}var Circle=function(){"use strict";function _class(param,param1,param2){var x=param===void 0?0:param,y=param1===void 0?0:param1,radius=param2===void 0?0:param2;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"x",void 0);swcHelpers.defineProperty(this,"y",void 0);swcHelpers.defineProperty(this,"_radius",void 0);swcHelpers.defineProperty(this,"_diameter",void 0);this.set(x,y,radius)}swcHelpers.createClass(_class,[{key:"set",value:function set(param,param1,param2){var x=param===void 0?0:param,y=param1===void 0?0:param1,radius=param2===void 0?0:param2;this.x=x;this.y=y;this.radius=radius;return this}},{key:"contains",value:function contains(x,y){return CircleContains(this,x,y)}},{key:"radius",get:function get(){return this._radius},set:function set(value){this._radius=value;this._diameter=value*2}},{key:"diameter",get:function get(){return this._diameter},set:function set(value){this._diameter=value;this._radius=value*0.5}},{key:"left",get:function get(){return this.x-this._radius},set:function set(value){this.x=value+this._radius}},{key:"right",get:function get(){return this.x+this._radius},set:function set(value){this.x=value-this._radius}},{key:"top",get:function get(){return this.y-this._radius},set:function set(value){this.y=value+this._radius}},{key:"bottom",get:function get(){return this.y+this._radius},set:function set(value){this.y=value-this._radius}}]);return _class}();function FromPercent(percent,min,max){percent=Clamp(percent,0,1);return(max-min)*percent}function GetCircleCircumference(circle2){return 2*(Math.PI*circle2.radius)}function GetCircleCircumferencePoint(circle2,angle,param){var out=param===void 0?new Vec2():param;return out.set(circle2.x+circle2.radius*Math.cos(angle),circle2.y+circle2.radius*Math.sin(angle))}var MATH_CONST={PI2:Math.PI*2,HALF_PI:Math.PI*0.5,EPSILON:0.000001,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};function GetCirclePointsBetween(circle2,startAngle,endAngle,step,param,param1,param2,param3){var anticlockwise=param===void 0?false:param,includeCenter=param1===void 0?false:param1,quantity=param2===void 0?0:param2,out=param3===void 0?[]:param3;if(!quantity){quantity=GetCircleCircumference(circle2)/step}for(var i=0;i<quantity;i++){var angle=FromPercent(i/quantity,0,MATH_CONST.PI2);if(angle>=startAngle&&angle<=endAngle){out.push(GetCircleCircumferencePoint(circle2,angle))}}if(anticlockwise){out=out.reverse()}if(includeCenter){out.push(new Vec2(circle2.x,circle2.y))}return out}function Area(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function IsConvex(p1,p2,p3){return Area(p1,p2,p3)<0}function Equals(a,b){return a.x===b.x&&a.y===b.y}function IsClockwise(polygon){var sum=0;for(var i=0,len=polygon.length;i<len;++i){var p1=polygon[i];var p2=polygon[(i+1)%len];sum+=(p2.x-p1.x)*(p2.y+p1.y)}return sum>0}function UpdateVertex(vertex,vertices){if(!vertex.shouldUpdate){return}vertex.shouldUpdate=false;var v1=vertex.prev.point;var v2=vertex.point;var v3=vertex.next.point;vertex.isConvex=IsConvex(v1,v2,v3);var v1x=v1.x-v2.x;var v1y=v1.y-v2.y;var v1Len=Math.sqrt(v1x*v1x+v1y*v1y);v1x/=v1Len;v1y/=v1Len;var v3x=v3.x-v2.x;var v3y=v3.y-v2.y;var v3Len=Math.sqrt(v3x*v3x+v3y*v3y);v3x/=v3Len;v3y/=v3Len;vertex.angleCos=v1x*v3x+v1y*v3y;if(vertex.isConvex){vertex.isEar=true;for(var i=0,len=vertices.length;i<len;++i){var curr=vertices[i];if(!curr.isActive||curr===vertex){continue}if(Equals(v1,curr.point)||Equals(v2,curr.point)||Equals(v3,curr.point)){continue}var areaA=Area(v1,curr.point,v2);var areaB=Area(v2,curr.point,v3);var areaC=Area(v3,curr.point,v1);if(areaA>0&&areaB>0&&areaC>0){vertex.isEar=false;break}if(areaA===0&&areaB>=0&&areaC>=0){if(Area(v1,curr.prev.point,v2)>0||Area(v1,curr.next.point,v2)>0){vertex.isEar=false;break}}if(areaB===0&&areaA>=0&&areaC>=0){if(Area(v2,curr.prev.point,v3)>0||Area(v2,curr.next.point,v3)>0){vertex.isEar=false;break}}if(areaC===0&&areaA>=0&&areaB>=0){if(Area(v3,curr.prev.point,v1)>0||Area(v3,curr.next.point,v1)>0){vertex.isEar=false;break}}}}else{vertex.isEar=false}}function RemoveCollinearOrDuplicate(start){for(var curr=start,end=start;;){if(Equals(curr.point,curr.next.point)||Area(curr.prev.point,curr.point,curr.next.point)===0){curr.prev.next=curr.next;curr.next.prev=curr.prev;curr.prev.shouldUpdate=true;curr.next.shouldUpdate=true;if(curr===curr.next){break}end=curr.prev;curr=curr.next;continue}curr=curr.next;if(curr===end){break}}}function Triangulate(polygon,param){var doNotCheckOrdering=param===void 0?false:param;if(!doNotCheckOrdering){if(IsClockwise(polygon)){throw new Error("Polygon should be counterclockwise")}}if(polygon.length<4){return[polygon]}var len=polygon.length;var vertices=[];var triangles=[];for(var i=0;i<len;++i){vertices.push({isActive:true,isConvex:false,isEar:false,point:polygon[i],angleCos:0,shouldUpdate:true,index:i})}for(var i1=0;i1<len;++i1){var vertex=vertices[i1];vertex.prev=vertices[(i1+len-1)%len];vertex.next=vertices[(i1+1)%len]}vertices.forEach(function(vertex){return UpdateVertex(vertex,vertices)});for(var i2=0;i2<len-3;++i2){var ear=null;for(var j=0;j<len;++j){var vertex=vertices[j];if(!vertex.isActive||!vertex.isEar){continue}if(!ear){ear=vertex}else if(vertex.angleCos>ear.angleCos){ear=vertex}}if(!ear){for(var i2=0;i2<len;++i2){var vertex=vertices[i2];if(vertex.isActive){var p1=vertex.prev.point;var p2=vertex.point;var p3=vertex.next.point;if(Math.abs(Area(p1,p2,p3))>0.00001){throw new Error("Failed to find ear. There may be self-intersection in the polygon.")}}}break}triangles.push([ear.prev.point,ear.point,ear.next.point]);ear.isActive=false;ear.prev.next=ear.next;ear.next.prev=ear.prev;ear.prev.shouldUpdate=true;ear.next.shouldUpdate=true;RemoveCollinearOrDuplicate(ear.next);if(i2===len-4){break}for(var i2=0;i2<len;++i2){UpdateVertex(vertices[i2],vertices)}}for(var i3=0;i3<len;++i3){var vertex=vertices[i3];if(vertex.isActive){vertex.prev.isActive=false;vertex.next.isActive=false;var p1=vertex.prev.point;var p2=vertex.point;var p3=vertex.next.point;if(Math.abs(Area(p1,p2,p3))>0.00001){triangles.push([p1,p2,p3])}}}return triangles}var circle;function FillArc(renderPass,x,y,radius,startAngle,endAngle,steps,anticlockwise,includeCenter,red,green,blue,alpha){if(!circle){circle=new Circle()}circle.set(x,y,radius);var points=GetCirclePointsBetween(circle,startAngle,endAngle,steps,anticlockwise,includeCenter);var tris=Triangulate(points);if(!tris.length){return}var ref=GetVertexBufferEntry(renderPass,tris.length),F32=ref.F32,offset=ref.offset;var textureIndex=SetWhiteTexture();var idx=offset;tris.forEach(function(tri){idx=BatchTriangle(F32,idx,textureIndex,tri[0].x,tri[0].y,tri[1].x,tri[1].y,tri[2].x,tri[2].y,red,green,blue,alpha)})}function BatchQuad(F32,offset,textureIndex,x1,y1,x2,y2,x3,y3,x4,y4,r,g,b,a){F32.set([x1,y1,0,0,textureIndex,r,g,b,a,x2,y2,0,1,textureIndex,r,g,b,a,x3,y3,1,1,textureIndex,r,g,b,a,x1,y1,0,0,textureIndex,r,g,b,a,x3,y3,1,1,textureIndex,r,g,b,a,x4,y4,1,0,textureIndex,r,g,b,a],offset);return offset+54}function FillLine(renderPass,x1,y1,x2,y2,width,red,green,blue,alpha){var ref=GetVertexBufferEntry(renderPass,2),F32=ref.F32,offset=ref.offset;var textureIndex=SetWhiteTexture();var dx=x2-x1;var dy=y2-y1;var len=Math.sqrt(dx*dx+dy*dy);width*=0.5;var al0=width*(y2-y1)/len;var al1=width*(x1-x2)/len;var bl0=width*(y2-y1)/len;var bl1=width*(x1-x2)/len;BatchQuad(F32,offset,textureIndex,Math.floor(x1+al0),Math.floor(y1+al1),Math.floor(x1-al0),Math.floor(y1-al1),Math.floor(x2-bl0),Math.floor(y2-bl1),Math.floor(x2+bl0),Math.floor(y2+bl1),red,green,blue,alpha)}function FillRect(renderPass,x,y,width,height,red,green,blue,alpha){var ref=GetVertexBufferEntry(renderPass,2),F32=ref.F32,offset=ref.offset;var textureIndex=SetWhiteTexture();x=Math.round(x);y=Math.round(y);BatchQuad(F32,offset,textureIndex,x,y,x,y+height,x+width,y+height,x+width,y,red,green,blue,alpha)}function FillTriangle(renderPass,x1,y1,x2,y2,x3,y3,red,green,blue,alpha){var ref=GetVertexBufferEntry(renderPass,1),F32=ref.F32,offset=ref.offset;var textureIndex=SetWhiteTexture();BatchTriangle(F32,offset,textureIndex,x1,y1,x2,y2,x3,y3,red,green,blue,alpha)}var DirectDraw=function(GameObject){"use strict";swcHelpers.inherits(_class,GameObject);function _class(){swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"type","DirectDraw");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"red",1);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"green",1);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"blue",1);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"alpha",1);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"smoothness",8);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"renderPass",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"_color",void 0);return _this}swcHelpers.createClass(_class,[{key:"color",set:function set(value){if(value!==void 0&&value!==this._color){this.red=(value>>16&255)/255;this.green=(value>>8&255)/255;this.blue=(value&255)/255;this._color=value}}},{key:"setRGB",value:function setRGB(red,green,blue,param){var alpha=param===void 0?1:param;this.red=red/255;this.green=green/255;this.blue=blue/255;this.alpha=alpha;return this}},{key:"arc",value:function arc(x,y,radius,param,param1,param2,param3,color){var startAngle=param===void 0?0:param,endAngle=param1===void 0?6.283185307179586:param1,anticlockwise=param2===void 0?false:param2,includeCenter=param3===void 0?false:param3;this.color=color;FillArc(this.renderPass,x,y,radius,startAngle,endAngle,this.smoothness,anticlockwise,includeCenter,this.red,this.green,this.blue,this.alpha);return this}},{key:"circle",value:function circle(x,y,radius,color){this.color=color;FillArc(this.renderPass,x,y,radius,0,Math.PI*2,this.smoothness,false,false,this.red,this.green,this.blue,this.alpha);return this}},{key:"plot",value:function plot(x,y,color){this.color=color;FillRect(this.renderPass,x,y,1,1,this.red,this.green,this.blue,this.alpha);return this}},{key:"box",value:function box(x,y,width,height,param,color){var thickness=param===void 0?1:param;this.color=color;var tw=thickness*0.5;this.line(x,y+tw,x+width,y+tw,thickness);this.line(x,y+height-tw,x+width,y+height-tw,thickness);this.line(x+tw,y+thickness,x+tw,y+height-thickness,thickness);this.line(x+width-tw,y+thickness,x+width-tw,y+height-thickness,thickness);return this}},{key:"rect",value:function rect(x,y,width,height,color){this.color=color;FillRect(this.renderPass,x,y,width,height,this.red,this.green,this.blue,this.alpha);return this}},{key:"triangle",value:function triangle(x1,y1,x2,y2,x3,y3,color){this.color=color;FillTriangle(this.renderPass,x1,y1,x2,y2,x3,y3,this.red,this.green,this.blue,this.alpha);return this}},{key:"line",value:function line(x1,y1,x2,y2,width,color){this.color=color;FillLine(this.renderPass,x1,y1,x2,y2,width,this.red,this.green,this.blue,this.alpha);return this}},{key:"image",value:function image(texture,x,y,param,param1,param2){var alpha=param===void 0?1:param,scaleX=param1===void 0?1:param1,scaleY=param2===void 0?1:param2;DrawImage(this.renderPass,texture,x,y,alpha,scaleX,scaleY);return this}},{key:"imagePart",value:function imagePart(texture,x0,y0,x1,y1,dx,dy,dw,dh,param){var alpha=param===void 0?1:param;DrawImagePart(this.renderPass,texture,x0,y0,x1,y1,dx,dy,dw,dh,alpha);return this}},{key:"frame",value:function frame(texture,frame2,x,y,param,param1,param2){var alpha=param===void 0?1:param,scaleX=param1===void 0?1:param1,scaleY=param2===void 0?1:param2;DrawFrame(this.renderPass,texture,frame2,x,y,alpha,scaleX,scaleY);return this}},{key:"quad",value:function quad(texture,frame2,x0,y0,x1,y1,x2,y2,x3,y3,param){var alpha=param===void 0?1:param;DrawQuad(this.renderPass,texture,frame2,x0,y0,x1,y1,x2,y2,x3,y3,alpha);return this}},{key:"tiles",value:function tiles(texture,tileWidth,tileHeight,mapData,mapWidth,param,param1){var x=param===void 0?0:param,y=param1===void 0?0:param1;DrawTiles(this.renderPass,texture,tileWidth,tileHeight,mapData,mapWidth,x,y,this.alpha);return this}},{key:"render",value:function render(){}},{key:"renderGL",value:function renderGL(renderPass){this.renderPass=renderPass;this.render()}}]);return _class}(GameObject);function BatchSingleQuadFlipped(renderPass,x,y,width,height,u0,v0,u1,v1,param){var textureIndex=param===void 0?0:param;var ref=GetVertexBufferEntry(renderPass,2),F32=ref.F32,offset=ref.offset;BatchTexturedQuad(F32,offset,textureIndex,x,y+height,x,y,x+width,y,x+width,y+height,u0,v0,u1,v1,1,1,1,1)}function DrawTexturedQuadFlipped(renderPass,texture,x,y,shader){if(!shader){shader=renderPass.quadShader}var _firstFrame=texture.firstFrame,u0=_firstFrame.u0,v0=_firstFrame.v0,u1=_firstFrame.u1,v1=_firstFrame.v1;Flush(renderPass);ClearTextures();BindTexture(texture,0);SetShader(shader,0);var camera=renderPass.current2DCamera;var cx=camera.getBoundsX()+x;var cy=camera.getBoundsY()+y;BatchSingleQuadFlipped(renderPass,cx,cy,texture.width,texture.height,u0,v0,u1,v1,0);Flush(renderPass);UnbindTexture(texture);PopShader()}var Layer=function(GameObject){"use strict";swcHelpers.inherits(_class,GameObject);function _class(){swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"type","Layer");var id=_this.id;SetWillTransformChildren(id,false);SetWillCacheChildren(id,false);return _this}return _class}(GameObject);var RenderLayer=function(Layer){"use strict";swcHelpers.inherits(_class,Layer);function _class(param,param1,param2,param3,param4){var x=param===void 0?0:param,y=param1===void 0?0:param1,width=param2===void 0?GetWidth():param2,height=param3===void 0?GetHeight():param3,resolution=param4===void 0?GetResolution():param4;swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"type","RenderLayer");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"color",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"texture",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"framebuffer",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"viewport",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"_x",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"_y",void 0);var id=_this.id;SetWillCacheChildren(id,true);SetWillRenderChildren(id,true);var texture=new Texture(null,width*resolution,height*resolution);texture.key="".concat(_this.type).concat(id);var binding=new GLTextureBinding(texture,{createFramebuffer:true});AddQuadVertex(id,width,height);SetQuadPosition(id,0,height,0,0,width,0,width,height);_this.texture=texture;_this.framebuffer=binding.framebuffer;_this.color=new Color2(id);_this.x=x;_this.y=y;_this.viewport=new Rectangle();return _this}swcHelpers.createClass(_class,[{key:"x",get:function get(){return this._x},set:function set(value){this._x=value;SetDirty(this.id)}},{key:"y",get:function get(){return this._y},set:function set(value){this._y=value;SetDirty(this.id)}},{key:"renderGL",value:function renderGL(renderPass){var id=this.id;var view=this.viewport;var texture=this.texture;if(IsDirty(id)){var rendererHeight=renderPass.renderer.height;view.set(-this.x,-(rendererHeight-texture.height-this.y),renderPass.renderer.width,rendererHeight);SetDirtyChildCache(id)}SetColor(renderPass,this.color);if(renderPass.isCameraDirty()||HasDirtyChildCache(id)){SetDirty(id);if(texture.binding.isBound){UnbindTexture(texture)}Flush(renderPass);SetFramebuffer(this.framebuffer,true,view)}}},{key:"postRenderGL",value:function postRenderGL(renderPass){var id=this.id;var texture=this.texture;if(IsDirty(id)){Flush(renderPass);PopFramebuffer();ClearDirty(id);ClearDirtyChildCache(id);SetDirtyParents(id);SetInversedQuadFromCamera(id,renderPass.current2DCamera,this.x,this.y,texture.width,texture.height);DrawTexturedQuadFlipped(renderPass,texture,this.x,this.y)}else{BatchTexturedQuadBuffer(this.texture,id,renderPass)}PopColor(renderPass,this.color)}}]);return _class}(Layer);var EffectLayer=function(RenderLayer){"use strict";swcHelpers.inherits(_class,RenderLayer);function _class(param,param1,param2){var width=param===void 0?GetWidth():param,height=param1===void 0?GetHeight():param1,resolution=param2===void 0?GetResolution():param2;for(var _len=arguments.length,shaders=new Array(_len>3?_len-3:0),_key=3;_key<_len;_key++){shaders[_key-3]=arguments[_key]}swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,0,0,width,height,resolution));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"type","EffectLayer");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"shaders",[]);if(Array.isArray(shaders)){_this.shaders=shaders}return _this}swcHelpers.createClass(_class,[{key:"postRenderGL",value:function postRenderGL(renderPass){var id=this.id;var shaders=this.shaders;var texture=this.texture;if(IsDirty(id)){Flush(renderPass);PopFramebuffer();ClearDirty(id);ClearDirtyChildCache(id);SetDirtyParents(id);SetInversedQuadFromCamera(id,renderPass.current2DCamera,this.x,this.y,texture.width,texture.height)}if(shaders.length===0){BatchTexturedQuadBuffer(texture,id,renderPass)}else{var x=this.x;var y=this.y;var prevTexture=texture;for(var i=0;i<shaders.length;i++){var shader=shaders[i];DrawTexturedQuadFlipped(renderPass,prevTexture,x,y,shader);prevTexture=shader.texture}DrawTexturedQuadFlipped(renderPass,prevTexture,x,y)}}}]);return _class}(RenderLayer);var textures_exports={};__export(textures_exports,{AlphaTexture:function(){return AlphaTexture},CreateCanvas:function(){return CreateCanvas},CreateTextureManager:function(){return CreateTextureManager},Frame:function(){return Frame},GetFrames:function(){return GetFrames},GetFramesInRange:function(){return GetFramesInRange},GetTexture:function(){return GetTexture},Palettes:function(){return palettes_exports},Parsers:function(){return parsers_exports},SetFilter:function(){return SetFilter},Texture:function(){return Texture},TextureManager:function(){return TextureManager},Types:function(){return types_exports},WhiteTexture:function(){return WhiteTexture}});var palettes_exports={};__export(palettes_exports,{Arne16:function(){return Arne16},C64:function(){return C64},CGA:function(){return CGA},JMP:function(){return JMP},MSX:function(){return MSX},PICO8:function(){return PICO8}});var Arne16=["#000","#9D9D9D","#FFF","#BE2633","#E06F8B","#493C2B","#A46422","#EB8931","#F7E26B","#2F484E","#44891A","#A3CE27","#1B2632","#005784","#31A2F2","#B2DCEF"];var C64=["#000","#fff","#8b4131","#7bbdc5","#8b41ac","#6aac41","#3931a4","#d5de73","#945a20","#5a4100","#bd736a","#525252","#838383","#acee8b","#7b73de","#acacac"];var CGA=["#000","#2234d1","#0c7e45","#44aacc","#8a3622","#5c2e78","#aa5c3d","#b5b5b5","#5e606e","#4c81fb","#6cd947","#7be2f9","#eb8a60","#e23d69","#ffd93f","#fff"];var JMP=["#000","#191028","#46af45","#a1d685","#453e78","#7664fe","#833129","#9ec2e8","#dc534b","#e18d79","#d6b97b","#e9d8a1","#216c4b","#d365c8","#afaab9","#f5f4eb"];var MSX=["#000","#191028","#46af45","#a1d685","#453e78","#7664fe","#833129","#9ec2e8","#dc534b","#e18d79","#d6b97b","#e9d8a1","#216c4b","#d365c8","#afaab9","#fff"];var PICO8=["#000","#1D2B53","#7E2553","#008751","#AB5236","#5F574F","#C2C3C7","#FFF1E8","#FF004D","#FFA300","#FFEC27","#00E436","#29ADFF","#83769C","#FF77A8","#FFCCAA"];var parsers_exports={};__export(parsers_exports,{AtlasParser:function(){return AtlasParser},BitmapTextParser:function(){return BitmapTextParser},KTXParser:function(){return KTXParser},PVRParser:function(){return PVRParser},SpriteSheetParser:function(){return SpriteSheetParser}});function SetFramePivot(frame2,x,y){frame2.pivot={x:x,y:y};return frame2}function SetFrameSourceSize(frame2,width,height){frame2.sourceSizeWidth=width;frame2.sourceSizeHeight=height;return frame2}function SetFrameTrim(frame2,width,height,x,y,w,h){frame2.trimmed=true;frame2.sourceSizeWidth=width;frame2.sourceSizeHeight=height;frame2.spriteSourceSizeX=x;frame2.spriteSourceSizeY=y;frame2.spriteSourceSizeWidth=w;frame2.spriteSourceSizeHeight=h;return frame2}function AtlasParser(texture,data){var frames;if(Array.isArray(data.textures)){frames=data.textures[0].frames}else if(Array.isArray(data.frames)){frames=data.frames}else if(data.hasOwnProperty("frames")){frames=[];for(var _i=0,_iter=Object.entries(data.frames);_i<_iter.length;_i++){var __i=_iter[_i],filename=__i[0],frame2=__i[1];frame2["filename"]=filename;frames.push(frame2)}}else{console.warn("Invalid Texture Atlas JSON")}if(frames){var newFrame=void 0;for(var i=0;i<frames.length;i++){var src=frames[i];newFrame=texture.addFrame(src.filename,src.frame.x,src.frame.y,src.frame.w,src.frame.h);if(src.trimmed){SetFrameTrim(newFrame,src.sourceSize.w,src.sourceSize.h,src.spriteSourceSize.x,src.spriteSourceSize.y,src.spriteSourceSize.w,src.spriteSourceSize.h)}else{SetFrameSourceSize(newFrame,src.sourceSize.w,src.sourceSize.h)}if(src.rotated){}if(src.anchor){SetFramePivot(newFrame,src.anchor.x,src.anchor.y)}}}}function GetValue(node,attribute){return parseInt(node.getAttribute(attribute),10)}function BitmapTextParser(texture,xml,frame2){var xSpacing=0;var ySpacing=0;var info=xml.getElementsByTagName("info")[0];var common=xml.getElementsByTagName("common")[0];var data={font:info.getAttribute("face"),size:GetValue(info,"size"),lineHeight:GetValue(common,"lineHeight")+ySpacing,chars:{}};var letters=xml.getElementsByTagName("char");for(var i=0;i<letters.length;i++){var node=letters[i];var charCode=GetValue(node,"id");var x=GetValue(node,"x");var y=GetValue(node,"y");var width=GetValue(node,"width");var height=GetValue(node,"height");data.chars[charCode]={x:x,y:y,width:width,height:height,xOffset:GetValue(node,"xoffset"),yOffset:GetValue(node,"yoffset"),xAdvance:GetValue(node,"xadvance")+xSpacing,kerning:{}};texture.addFrame(charCode,x,y,width,height)}var kernings=xml.getElementsByTagName("kerning");for(var i1=0;i1<kernings.length;i1++){var kern=kernings[i1];var first=GetValue(kern,"first");var second=GetValue(kern,"second");var amount=GetValue(kern,"amount");data.chars[second].kerning[first]=amount}return data}function KTXParser(data){var idCheck=[171,75,84,88,32,49,49,187,13,10,26,10];var id=new Uint8Array(data,0,12);for(var i=0;i<id.length;i++){if(id[i]!==idCheck[i]){console.error("KTXParser - Invalid file format");return}}var size=Uint32Array.BYTES_PER_ELEMENT;var head=new DataView(data,12,13*size);var littleEndian=head.getUint32(0,true)===67305985;var glType=head.getUint32(1*size,littleEndian);if(glType!==0){console.warn("KTXParser - Only compressed formats supported");return}var internalFormat=head.getUint32(4*size,littleEndian);var width=head.getUint32(6*size,littleEndian);var height=head.getUint32(7*size,littleEndian);var mipmapLevels=Math.max(1,head.getUint32(11*size,littleEndian));var bytesOfKeyValueData=head.getUint32(12*size,littleEndian);var mipmaps=new Array(mipmapLevels);var offset=12+13*4+bytesOfKeyValueData;var levelWidth=width;var levelHeight=height;for(var i1=0;i1<mipmapLevels;i1++){var levelSize=new Int32Array(data,offset,1)[0];offset+=4;mipmaps[i1]={data:new Uint8Array(data,offset,levelSize),width:levelWidth,height:levelHeight};console.log("KTX",i1,"size",levelWidth,levelHeight);levelWidth=Math.max(1,levelWidth>>1);levelHeight=Math.max(1,levelHeight>>1);offset+=levelSize}return{mipmaps:mipmaps,width:width,height:height,internalFormat:internalFormat,compressed:true,generateMipmap:false}}function GetSize(width,height,x,y,dx,dy,param){var mult=param===void 0?16:param;return Math.floor((width+x)/dx)*Math.floor((height+y)/dy)*mult}function PVRTC2bppSize(width,height){width=Math.max(width,16);height=Math.max(height,8);return width*height/4}function PVRTC4bppSize(width,height){width=Math.max(width,8);height=Math.max(height,8);return width*height/2}function DXTEtcSmallSize(width,height){return GetSize(width,height,3,3,4,4,8)}function DXTEtcAstcBigSize(width,height){return GetSize(width,height,3,3,4,4)}function ATC5x4Size(width,height){return GetSize(width,height,4,3,5,4)}function ATC5x5Size(width,height){return GetSize(width,height,4,4,5,5)}function ATC6x5Size(width,height){return GetSize(width,height,5,4,6,5)}function ATC6x6Size(width,height){return GetSize(width,height,5,5,6,6)}function ATC8x5Size(width,height){return GetSize(width,height,7,4,8,5)}function ATC8x6Size(width,height){return GetSize(width,height,7,5,8,6)}function ATC8x8Size(width,height){return GetSize(width,height,7,7,8,8)}function ATC10x5Size(width,height){return GetSize(width,height,9,4,10,5)}function ATC10x6Size(width,height){return GetSize(width,height,9,5,10,6)}function ATC10x8Size(width,height){return GetSize(width,height,9,7,10,8)}function ATC10x10Size(width,height){return GetSize(width,height,9,9,10,10)}function ATC12x10Size(width,height){return GetSize(width,height,11,9,12,10)}function ATC12x12Size(width,height){return GetSize(width,height,11,11,12,12)}var FORMATS={0:{sizeFunc:PVRTC2bppSize,glFormat:35841},1:{sizeFunc:PVRTC2bppSize,glFormat:35843},2:{sizeFunc:PVRTC4bppSize,glFormat:35840},3:{sizeFunc:PVRTC4bppSize,glFormat:35842},6:{sizeFunc:DXTEtcSmallSize,glFormat:36196},7:{sizeFunc:DXTEtcSmallSize,glFormat:33776},8:{sizeFunc:DXTEtcAstcBigSize,glFormat:33777},9:{sizeFunc:DXTEtcAstcBigSize,glFormat:33778},11:{sizeFunc:DXTEtcAstcBigSize,glFormat:33779},22:{sizeFunc:DXTEtcSmallSize,glFormat:37492},23:{sizeFunc:DXTEtcAstcBigSize,glFormat:37496},24:{sizeFunc:DXTEtcSmallSize,glFormat:37494},25:{sizeFunc:DXTEtcSmallSize,glFormat:37488},26:{sizeFunc:DXTEtcAstcBigSize,glFormat:37490},27:{sizeFunc:DXTEtcAstcBigSize,glFormat:37808},28:{sizeFunc:ATC5x4Size,glFormat:37809},29:{sizeFunc:ATC5x5Size,glFormat:37810},30:{sizeFunc:ATC6x5Size,glFormat:37811},31:{sizeFunc:ATC6x6Size,glFormat:37812},32:{sizeFunc:ATC8x5Size,glFormat:37813},33:{sizeFunc:ATC8x6Size,glFormat:37814},34:{sizeFunc:ATC8x8Size,glFormat:37815},35:{sizeFunc:ATC10x5Size,glFormat:37816},36:{sizeFunc:ATC10x6Size,glFormat:37817},37:{sizeFunc:ATC10x8Size,glFormat:37818},38:{sizeFunc:ATC10x10Size,glFormat:37819},39:{sizeFunc:ATC12x10Size,glFormat:37820},40:{sizeFunc:ATC12x12Size,glFormat:37821}};function PVRParser(data){var header=new Uint32Array(data,0,13);var pvrFormat=header[2];var internalFormat=FORMATS[pvrFormat].glFormat;var sizeFunction=FORMATS[pvrFormat].sizeFunc;var mipmapLevels=header[11];var width=header[7];var height=header[6];var dataOffset=52+header[12];var image=new Uint8Array(data,dataOffset);var mipmaps=new Array(mipmapLevels);var offset=0;var levelWidth=width;var levelHeight=height;for(var i=0;i<mipmapLevels;i++){var levelSize=sizeFunction(levelWidth,levelHeight);mipmaps[i]={data:new Uint8Array(image.buffer,image.byteOffset+offset,levelSize),width:levelWidth,height:levelHeight};levelWidth=Math.max(1,levelWidth>>1);levelHeight=Math.max(1,levelHeight>>1);offset+=levelSize}return{mipmaps:mipmaps,width:width,height:height,internalFormat:internalFormat,compressed:true,generateMipmap:false}}function SpriteSheetParser(texture,x,y,width,height,frameConfig){var _frameWidth=frameConfig.frameWidth,frameWidth=_frameWidth===void 0?null:_frameWidth,_endFrame=frameConfig.endFrame,endFrame=_endFrame===void 0?-1:_endFrame,_margin=frameConfig.margin,margin=_margin===void 0?0:_margin,_spacingX=frameConfig.spacingX,spacingX=_spacingX===void 0?0:_spacingX,_spacingY=frameConfig.spacingY,spacingY=_spacingY===void 0?0:_spacingY;var _frameHeight=frameConfig.frameHeight,frameHeight=_frameHeight===void 0?null:_frameHeight,_startFrame=frameConfig.startFrame,startFrame=_startFrame===void 0?0:_startFrame;if(!frameHeight){frameHeight=frameWidth}if(frameWidth===null){throw new Error("SpriteSheetParser: Invalid frameWidth")}var row=Math.floor((width-margin+spacingX)/(frameWidth+spacingX));var column=Math.floor((height-margin+spacingY)/(frameHeight+spacingY));var total=row*column;if(total===0){console.warn("SpriteSheetParser: Frame config will result in zero frames")}if(startFrame>total||startFrame< -total){startFrame=0}if(startFrame<0){startFrame=total+startFrame}if(endFrame!== -1){total=startFrame+(endFrame+1)}var fx=margin;var fy=margin;var ax=0;var ay=0;for(var i=0;i<total;i++){ax=0;ay=0;var w=fx+frameWidth;var h=fy+frameHeight;if(w>width){ax=w-width}if(h>height){ay=h-height}texture.addFrame(i,x+fx,y+fy,frameWidth-ax,frameHeight-ay);fx+=frameWidth+spacingX;if(fx+frameWidth>width){fx=margin;fy+=frameHeight+spacingY}}}var types_exports={};__export(types_exports,{CanvasTexture:function(){return CanvasTexture},DebugSpriteIDTexture:function(){return DebugSpriteIDTexture},GridTexture:function(){return GridTexture},LinearGradientTexture:function(){return LinearGradientTexture},PixelTexture:function(){return PixelTexture},RenderTexture:function(){return RenderTexture},SolidColorTexture:function(){return SolidColorTexture}});function CreateCanvas(width,height){var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;return canvas.getContext("2d")}function CanvasTexture(param,param1){var width=param===void 0?32:param,height=param1===void 0?32:param1;var ctx=CreateCanvas(width,height);return new Texture(ctx.canvas)}function DebugSpriteIDTexture(param,param1,param2,param3){var cellWidth=param===void 0?32:param,cellHeight=param1===void 0?32:param1,cols=param2===void 0?32:param2,rows=param3===void 0?32:param3;var ctx=CreateCanvas(cellWidth*cols,cellHeight*rows);var colors=["#e27458","#e89361","#f0b26b","#fff57e","#b4d27e","#8dc37e","#62b57e","#58b8b3","#44bced","#568ac5","#5c73b4","#605ca3","#8061a4","#9e67a5","#e076a8","#e1757f"];var colorIndex=0;var cell=0;for(var y=0;y<rows;y++){for(var x=0;x<cols;x++){ctx.fillStyle=colors[colorIndex];ctx.fillRect(x*cellWidth,y*cellHeight,cellWidth,cellHeight);ctx.fillStyle="rgba(0, 0, 0, 0.5)";ctx.lineWidth=1;ctx.strokeRect(x*cellWidth+0.5,y*cellHeight+0.5,cellWidth-1,cellHeight-1);ctx.fillStyle="rgba(0, 0, 0, 1)";ctx.textAlign="center";ctx.font="12px monospace";ctx.fillText("".concat(cell),x*cellWidth+cellWidth/2,y*cellHeight+20);cell++;colorIndex++;if(colorIndex>=colors.length){colorIndex=0}}}var texture=new Texture(ctx.canvas);SpriteSheetParser(texture,0,0,cellWidth*cols,cellHeight*rows,{frameWidth:cellWidth,frameHeight:cellHeight});return texture}function GridTexture(color1,color2,param,param1,param2,param3){var width=param===void 0?32:param,height=param1===void 0?32:param1,cols=param2===void 0?2:param2,rows=param3===void 0?2:param3;var ctx=CreateCanvas(width,height);var colWidth=width/cols;var rowHeight=height/rows;ctx.fillStyle=color1;ctx.fillRect(0,0,width,height);ctx.fillStyle=color2;for(var y=0;y<rows;y++){for(var x=y%2;x<cols;x+=2){ctx.fillRect(x*colWidth,y*rowHeight,colWidth,rowHeight)}}return new Texture(ctx.canvas)}function LinearGradientTexture(config){var _width=config.width,width=_width===void 0?256:_width,_height=config.height,height=_height===void 0?256:_height,_horizontal=config.horizontal,horizontal=_horizontal===void 0?false:_horizontal,_x0=config.x0,x0=_x0===void 0?0:_x0,_y0=config.y0,y0=_y0===void 0?0:_y0,_x1=config.x1,x1=_x1===void 0?horizontal?width:0:_x1,_y1=config.y1,y1=_y1===void 0?horizontal?0:height:_y1,_colorStops=config.colorStops,colorStops=_colorStops===void 0?[{offset:0,color:"red"}]:_colorStops;var ctx=CreateCanvas(width,height);var gradient=ctx.createLinearGradient(x0,y0,x1,y1);for(var _i=0,_iter=colorStops.values();_i<_iter.length;_i++){var colorStop=_iter[_i];gradient.addColorStop(colorStop.offset,colorStop.color)}ctx.fillStyle=gradient;ctx.fillRect(0,0,width,height);return new Texture(ctx.canvas)}function PixelTexture(config){var _data=config.data,data=_data===void 0?[]:_data,_palette=config.palette,palette=_palette===void 0?Arne16:_palette,_pixelWidth=config.pixelWidth,pixelWidth=_pixelWidth===void 0?1:_pixelWidth,_pixelHeight=config.pixelHeight,pixelHeight=_pixelHeight===void 0?pixelWidth:_pixelHeight,_preRender=config.preRender,preRender=_preRender===void 0?null:_preRender,_postRender=config.postRender,postRender=_postRender===void 0?null:_postRender;var _canvas=config.canvas,canvas=_canvas===void 0?null:_canvas,_resizeCanvas=config.resizeCanvas,resizeCanvas=_resizeCanvas===void 0?true:_resizeCanvas,_clearCanvas=config.clearCanvas,clearCanvas=_clearCanvas===void 0?true:_clearCanvas;var width=Math.floor(Math.abs(data[0].length*pixelWidth));var height=Math.floor(Math.abs(data.length*pixelHeight));if(!canvas){canvas=CreateCanvas(width,height).canvas;resizeCanvas=false;clearCanvas=false}if(resizeCanvas){canvas.width=width;canvas.height=height}var ctx=canvas.getContext("2d");if(clearCanvas){ctx.clearRect(0,0,width,height)}if(preRender){preRender(canvas,ctx)}for(var y=0;y<data.length;y++){var row=data[y];for(var x=0;x<row.length;x++){var d=row[x];if(d!=="."&&d!==" "){ctx.fillStyle=palette[parseInt("0x"+d.toUpperCase())];ctx.fillRect(x*pixelWidth,y*pixelHeight,pixelWidth,pixelHeight)}}}if(postRender){postRender(canvas,ctx)}return new Texture(canvas)}var RenderTexture=function(Texture){"use strict";swcHelpers.inherits(_class,Texture);function _class(renderer,param,param1){var width=param===void 0?256:param,height=param1===void 0?width:param1;swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,null,width,height));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"renderer",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"cameraMatrix",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"projectionMatrix",void 0);_this.renderer=renderer;return _this}swcHelpers.createClass(_class,[{key:"cls",value:function cls(){return this}},{key:"batchStart",value:function batchStart(){return this}},{key:"batchDraw",value:function batchDraw(sprites){for(var i=0,len=sprites.length;i<len;i++){}return this}},{key:"batchEnd",value:function batchEnd(){var renderer=this.renderer;renderer.reset();return this}},{key:"draw",value:function draw(){for(var _len=arguments.length,sprites=new Array(_len),_key=0;_key<_len;_key++){sprites[_key]=arguments[_key]}this.batchStart();this.batchDraw(sprites);this.batchEnd();return this}}]);return _class}(Texture);function SolidColorTexture(param,param1,param2){var color=param===void 0?"rgba(0,0,0,0)":param,width=param1===void 0?32:param1,height=param2===void 0?32:param2;var ctx=CreateCanvas(width,height);ctx.fillStyle=color;ctx.fillRect(0,0,width,height);return new Texture(ctx.canvas)}var instance6;var AlphaTexture={get:function(){return instance6},set:function(texture){instance6=texture}};var TextureManager=function(){"use strict";function _class(){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"textures",void 0);TextureManagerInstance.set(this);this.textures=new Map();this.createDefaultTextures()}swcHelpers.createClass(_class,[{key:"createDefaultTextures",value:function createDefaultTextures(){var alphaTexture=this.add("__BLANK",new Texture(CreateCanvas(2,2).canvas));AlphaTexture.set(alphaTexture);var missing=CreateCanvas(32,32);missing.strokeStyle="#0f0";missing.moveTo(0,0);missing.lineTo(32,32);missing.stroke();missing.strokeRect(0.5,0.5,31,31);this.add("__MISSING",new Texture(missing.canvas));var white=CreateCanvas(2,2);white.fillStyle="#fff";white.fillRect(0,0,2,2);var whiteTexture=this.add("__WHITE",new Texture(white.canvas));WhiteTexture.set(whiteTexture)}},{key:"get",value:function get(key){var textures=this.textures;if(textures.has(key)){return textures.get(key)}else{return textures.get("__MISSING")}}},{key:"has",value:function has(key){return this.textures.has(key)}},{key:"add",value:function add(key,source,glConfig){var texture;if(!this.textures.has(key)){if(swcHelpers._instanceof(source,Texture)){texture=source}else{texture=new Texture(source,0,0,glConfig)}texture.key=key;this.textures.set(key,texture)}return texture}},{key:"update",value:function update(key,source,glConfig){var texture=this.textures.get(key);if(texture){texture.update(source,glConfig)}return texture}}]);return _class}();function CreateTextureManager(){new TextureManager()}function GetFrames(texture,frames){if(typeof texture==="string"){texture=GetTexture(texture)}var output=[];for(var _i=0,_iter=texture.frames.values();_i<_iter.length;_i++){var frame2=_iter[_i];if(frame2.key==="__BASE"&&texture.frames.size>1){continue}if(!frames||frames.indexOf(frame2.key)!== -1){output.push(frame2)}}return output}function SetFilter(linear){for(var _len=arguments.length,textures=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){textures[_key-1]=arguments[_key]}textures.forEach(function(texture){if(texture.binding){texture.binding.setFilter(linear)}});return textures}var Rectangle2=function(Container){"use strict";swcHelpers.inherits(_class,Container);function _class(x,y,param,param1,param2){var width=param===void 0?64:param,height=param1===void 0?64:param1,color=param2===void 0?16777215:param2;swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,x,y));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"type","Rectangle");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"texture",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"frame",void 0);var id=_this.id;AddQuadVertex(id);_this.texture=WhiteTexture.get();_this.frame=_this.texture.getFrame();SetExtentFromFrame(swcHelpers.assertThisInitialized(_this),_this.frame);SetVertexUVsFromFrame(id,_this.frame);_this.size.set(width,height);_this.color.tint=color;return _this}swcHelpers.createClass(_class,[{key:"isRenderable",value:function isRenderable(){return this.visible&&WillRender(this.id)&&this.alpha>0}},{key:"renderGL",value:function renderGL(renderPass){var color=this.color;if(this.shader){Flush(renderPass);SetShader(this.shader,0)}if(color.colorMatrixEnabled){SetColorMatrix(color)}this.preRenderGL(renderPass);BatchTexturedQuadBuffer(this.texture,this.id,renderPass);if(color.colorMatrixEnabled&&!color.willColorChildren){Flush(renderPass);PopColorMatrix()}}},{key:"renderCanvas",value:function renderCanvas(renderer){}},{key:"destroy",value:function destroy(reparentChildren){swcHelpers.get(swcHelpers.getPrototypeOf(_class.prototype),"destroy",this).call(this,reparentChildren);this.texture=null;this.frame=null}}]);return _class}(Container);var SpatialHashGrid=function(){"use strict";function _class(cellWidth,cellHeight,param){var getBounds=param===void 0?GetLocalBounds:param;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"cellWidth",void 0);swcHelpers.defineProperty(this,"cellHeight",void 0);swcHelpers.defineProperty(this,"cells",void 0);swcHelpers.defineProperty(this,"ids",void 0);swcHelpers.defineProperty(this,"index",void 0);swcHelpers.defineProperty(this,"getBounds",void 0);this.cellWidth=Math.abs(cellWidth);this.cellHeight=Math.abs(cellHeight);this.cells=new Map();this.ids=[];this.index=0;this.getBounds=getBounds}swcHelpers.createClass(_class,[{key:"clear",value:function clear(){this.cells.forEach(function(cell){return cell.clear()});this.cells.clear();this.ids=[];this.index=0}},{key:"getX",value:function getX(x){return Math.floor(x/this.cellWidth)}},{key:"getY",value:function getY(y){return Math.floor(y/this.cellHeight)}},{key:"getXCeil",value:function getXCeil(x){return Math.ceil(x/this.cellWidth)}},{key:"getYCeil",value:function getYCeil(y){return Math.ceil(y/this.cellHeight)}},{key:"getKey",value:function getKey(x,y){return"".concat(this.getX(x)," ").concat(this.getY(y))}},{key:"getGridKey",value:function getGridKey(x,y){return"".concat(x," ").concat(y)}},{key:"addToCell",value:function addToCell(id,gridX,gridY){var cells=this.cells;var key=this.getGridKey(gridX,gridY);if(cells.has(key)){cells.get(key).add(id)}else{cells.set(key,new Set([id]))}return key}},{key:"inView",value:function inView(x,y,width,height){return this.intersects(x,y,x+width,y+height)}},{key:"intersects",value:function intersects(left,top,right,bottom){var topLeftX=this.getX(left);var topLeftY=this.getY(top);var bottomRightX=this.getX(right);var bottomRightY=this.getY(bottom);var cells=this.cells;var results=[];if(topLeftX===bottomRightX&&topLeftY===bottomRightY){var key=this.getGridKey(topLeftX,topLeftY);if(cells.has(key)){results=[].concat(cells.get(key))}}else{var width=bottomRightX-topLeftX+1;var height=bottomRightY-topLeftY+1;var gridX=topLeftX;var gridY=topLeftY;var placed=0;for(var i=0;i<width*height;i++){var key=this.getGridKey(gridX,gridY);if(cells.has(key)){results=(_results=results).concat.apply(_results,cells.get(key))}gridX++;placed++;if(placed===width){gridX=topLeftX;gridY++;placed=0}}}var ids=this.ids;results.sort(function(a,b){return ids[a]-ids[b]});return new Set(results)}},{key:"add",value:function add(id){var ref=this.getBounds(id),left=ref.left,top=ref.top,right=ref.right,bottom=ref.bottom;var topLeftX=this.getX(left);var topLeftY=this.getY(top);var bottomRightX=this.getXCeil(right);var bottomRightY=this.getYCeil(bottom);var width=bottomRightX-topLeftX;var height=bottomRightY-topLeftY;this.ids[id]=this.index++;if(width===1&&height===1){this.addToCell(id,topLeftX,topLeftY);return}var gridX=topLeftX;var gridY=topLeftY;var placed=0;for(var i=0;i<width*height;i++){this.addToCell(id,gridX,gridY);gridX++;placed++;if(placed===width){gridX=topLeftX;gridY++;placed=0}}}},{key:"update",value:function update(id){this.remove(id);this.add(id)}},{key:"has",value:function has(id){return!!this.ids[id]}},{key:"getAll",value:function getAll(){return this.ids.filter(function(index,id){return id!==void 0})}},{key:"remove",value:function remove(id){if(this.has(id)){this.cells.forEach(function(cell){return cell.delete(id)});this.ids[id]=void 0}}}]);return _class}();var SpatialGridLayer=function(GameObject){"use strict";swcHelpers.inherits(_class,GameObject);function _class(param,param1,param2){var cellWidth=param===void 0?512:param,cellHeight=param1===void 0?512:param1,updateChildren=param2===void 0?false:param2;swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"type","SpatialGridLayer");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"hash",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"onSortChildren",void 0);_this.hash=new SpatialHashGrid(cellWidth,cellHeight);var id=_this.id;SetCustomDisplayList(id,true);SetWillTransformChildren(id,false);SetWillUpdateChildren(id,updateChildren);return _this}swcHelpers.createClass(_class,[{key:"getChildren",value:function getChildren(renderPass){ClearDirtyDisplayList(this.id);var camera=renderPass.current2DCamera;var cx=camera.getBoundsX();var cy=camera.getBoundsY();var cright=camera.getBoundsRight();var cbottom=camera.getBoundsBottom();var childIDs=this.hash.intersects(cx,cy,cright,cbottom);var result=[];childIDs.forEach(function(id){result.push(GameObjectCache.get(id))});if(this.onSortChildren){result.sort(this.onSortChildren)}return result}},{key:"onAddChild",value:function onAddChild(childID){if(!HasDirtyTransform(childID)){this.hash.add(childID)}var worldID=GetWorldID(this.id);SetDirtyDisplayList(this.id);SetDirtyChildTransform(worldID);SetDirtyChildColor(worldID)}},{key:"onUpdateChild",value:function onUpdateChild(childID){this.hash.update(childID)}},{key:"onRemoveChild",value:function onRemoveChild(childID){this.hash.remove(childID);SetDirtyDisplayList(this.id)}},{key:"destroy",value:function destroy(reparentChildren){this.hash.clear();swcHelpers.get(swcHelpers.getPrototypeOf(_class.prototype),"destroy",this).call(this,reparentChildren)}}]);return _class}(GameObject);var Text=function(Sprite){"use strict";swcHelpers.inherits(_class,Sprite);function _class(x,y,param,font,fillStyle){var text=param===void 0?"":param;swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,x,y,CanvasTexture()));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"type","Text");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"_text",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"preRenderCallback",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"wordWrapCallback",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"canvas",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"context",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"splitRegExp",/(?:\r\n|\r|\n)/);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"padding",{left:0,right:0,top:0,bottom:0});swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"verticalAlign","ascent");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"lineSpacing",0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"resolution",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"font","16px monospace");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"fillStyle","#fff");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"strokeStyle","");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"backgroundStyle","");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"cornerRadius",0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"textAlign","left");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"textBaseline","alphabetic");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"lineWidth",0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"lineDash",[]);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"fixedWidth",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"fixedHeight",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"antialias",false);_this.texture.key="Text".concat(_this.id);var renderer=RendererInstance.get();_this.resolution=renderer.resolution;_this.canvas=_this.texture.image;_this.context=_this.canvas.getContext("2d");if(font){_this.font=font}if(fillStyle){_this.fillStyle=fillStyle}_this.setText(text);return _this}swcHelpers.createClass(_class,[{key:"syncContext",value:function syncContext(canvas,ctx){if(this.preRenderCallback){this.preRenderCallback(canvas,ctx)}ctx.font=this.font;ctx.textBaseline=this.textBaseline;ctx.textAlign=this.textAlign;ctx.fillStyle=this.fillStyle;ctx.strokeStyle=this.strokeStyle;ctx.lineWidth=this.lineWidth;ctx.lineCap="round";ctx.lineJoin="round";ctx.setLineDash(this.lineDash);ctx.imageSmoothingEnabled=this.antialias}},{key:"updateText",value:function updateText(){var canvas=this.canvas;var ctx=this.context;var resolution=this.resolution;var lines=this._text.split(this.splitRegExp);var padding=this.padding;var fillStyle=this.fillStyle;var strokeStyle=this.strokeStyle;var strokeWidth=this.lineWidth;var lineSpacing=this.lineSpacing;var strokeWidthHalf=strokeWidth>0?strokeWidth/2:0;ctx.clearRect(0,0,canvas.width,canvas.height);this.syncContext(canvas,ctx);ctx.textAlign="start";var maxWidth=0;var maxHeight=0;var y=0;var lineMetrics=[];var vAlignAscent=this.verticalAlign==="ascent";var metrics=ctx.measureText("|M\xc9q");var averageLineHeight=Math.ceil(Math.abs(metrics.actualBoundingBoxAscent)+Math.abs(metrics.actualBoundingBoxDescent))+strokeWidth;for(var i=0;i<lines.length;i++){var metrics2=ctx.measureText(lines[i]);var left=metrics2.actualBoundingBoxLeft;var right=metrics2.actualBoundingBoxRight;var ascent=metrics2.actualBoundingBoxAscent;var descent=metrics2.actualBoundingBoxDescent;if(!ascent&&!descent||lines[i]===""){ascent=averageLineHeight;descent=0}var lineWidth=Math.ceil(Math.abs(left)+Math.abs(right))+strokeWidth;var lineHeight=Math.ceil(Math.abs(ascent)+Math.abs(descent))+strokeWidth;if(vAlignAscent){y+=ascent+strokeWidthHalf;if(i>0){y+=lineSpacing+strokeWidthHalf}maxHeight=y+descent+strokeWidthHalf}else{y=maxHeight+(lineHeight-descent-strokeWidthHalf);maxHeight+=lineHeight;if(i<lines.length-1){maxHeight+=lineSpacing}}maxWidth=Math.max(maxWidth,lineWidth);lineMetrics.push({lineWidth:lineWidth,lineHeight:lineHeight,ascent:ascent,descent:descent,left:left,right:right,y:y})}maxWidth+=padding.left+padding.right;maxHeight+=padding.top+padding.bottom;var displayWidth=this.fixedWidth?this.fixedWidth:maxWidth;var displayHeight=this.fixedHeight?this.fixedHeight:maxHeight;var canvasWidth=Math.ceil(displayWidth*resolution);var canvasHeight=Math.ceil(displayHeight*resolution);if(canvas.width!==canvasWidth||canvas.height!==canvasHeight){canvas.width=canvasWidth;canvas.height=canvasHeight;this.texture.setSize(displayWidth,displayHeight);this.size.set(displayWidth,displayHeight)}ctx.save();ctx.scale(resolution,resolution);this.syncContext(canvas,ctx);var backgroundStyle=this.backgroundStyle;if(backgroundStyle){ctx.save();ctx.fillStyle=backgroundStyle;ctx.strokeStyle=backgroundStyle;var cornerRadius=this.cornerRadius;var halfRadius=cornerRadius>0?cornerRadius/2:0;if(cornerRadius){ctx.lineWidth=cornerRadius;ctx.strokeRect(halfRadius,halfRadius,displayWidth-cornerRadius,displayHeight-cornerRadius)}ctx.fillRect(halfRadius,halfRadius,displayWidth-cornerRadius,displayHeight-cornerRadius);ctx.restore()}var textAlign=this.textAlign;var isCenter=textAlign==="center";var isRight=textAlign==="right"||textAlign==="end";var yOffset=(displayHeight-maxHeight)/2+padding.top;for(var i1=0;i1<lines.length;i1++){var line=lines[i1];var metrics2=lineMetrics[i1];var tx=padding.left+metrics2.left+strokeWidthHalf;var ty=yOffset+metrics2.y;if(isCenter){tx=displayWidth/2}else if(isRight){tx=displayWidth-strokeWidthHalf}if(strokeStyle){ctx.strokeText(line,tx,ty)}if(fillStyle){ctx.fillText(line,tx,ty)}}ctx.restore();if(this.texture.binding){this.texture.binding.update()}return this}},{key:"text",get:function get(){return this._text},set:function set(value){this.setText(value)}},{key:"setText",value:function setText(param){var value=param===void 0?"":param;if(Array.isArray(value)){value=value.join("\n")}if(value!==this._text){this._text=value.toString();this.updateText()}return this}},{key:"destroy",value:function destroy(reparentChildren){this.texture.destroy();this.fillStyle=null;this.strokeStyle=null;this.backgroundStyle=null;this.canvas=null;this.context=null;swcHelpers.get(swcHelpers.getPrototypeOf(_class.prototype),"destroy",this).call(this,reparentChildren)}}]);return _class}(Sprite);var geom_exports={};__export(geom_exports,{Circle:function(){return circle_exports},Ellipse:function(){return ellipse_exports},Intersects:function(){return intersects_exports},Line:function(){return line_exports},Rectangle:function(){return rectangle_exports},Triangle:function(){return triangle_exports}});var circle_exports={};__export(circle_exports,{Circle:function(){return Circle},CircleContains:function(){return CircleContains},CircleContainsPoint:function(){return CircleContainsPoint},CircleContainsRect:function(){return CircleContainsRect},CircleEquals:function(){return CircleEquals},CloneCircle:function(){return CloneCircle},CopyCircleFrom:function(){return CopyCircleFrom},GetCircleArea:function(){return GetCircleArea},GetCircleBounds:function(){return GetCircleBounds},GetCircleCircumference:function(){return GetCircleCircumference},GetCircleCircumferencePoint:function(){return GetCircleCircumferencePoint},GetCirclePoint:function(){return GetCirclePoint},GetCirclePoints:function(){return GetCirclePoints},GetCirclePointsBetween:function(){return GetCirclePointsBetween},GetCircleRandomPoint:function(){return GetCircleRandomPoint},TranslateCircle:function(){return TranslateCircle},TranslateCirclePoint:function(){return TranslateCirclePoint}});function CircleContainsPoint(circle2,point){return CircleContains(circle2,point.x,point.y)}function CircleContainsRect(circle2,rect){return CircleContains(circle2,rect.x,rect.y)&&CircleContains(circle2,rect.right,rect.y)&&CircleContains(circle2,rect.x,rect.bottom)&&CircleContains(circle2,rect.right,rect.bottom)}function CircleEquals(circle2,toCompare){return circle2.x===toCompare.x&&circle2.y===toCompare.y&&circle2.radius===toCompare.radius}function CloneCircle(source){return new Circle(source.x,source.y,source.radius)}function CopyCircleFrom(source,dest){return dest.set(source.x,source.y,source.radius)}function GetCircleArea(circle2){return circle2.radius>0?Math.PI*circle2.radius*circle2.radius:0}function GetCircleBounds(circle2,param){var out=param===void 0?new Rectangle():param;return out.set(circle2.left,circle2.top,circle2.diameter,circle2.diameter)}function GetCirclePoint(circle2,position,param){var out=param===void 0?new Vec2():param;var angle=FromPercent(position,0,MATH_CONST.PI2);return GetCircleCircumferencePoint(circle2,angle,out)}function GetCirclePoints(circle2,step,param,param1){var quantity=param===void 0?0:param,out=param1===void 0?[]:param1;if(!quantity){quantity=GetCircleCircumference(circle2)/step}for(var i=0;i<quantity;i++){var angle=FromPercent(i/quantity,0,MATH_CONST.PI2);out.push(GetCircleCircumferencePoint(circle2,angle))}return out}function GetCircleRandomPoint(circle2,param){var out=param===void 0?new Vec2():param;var t=2*Math.PI*Math.random();var u=Math.random()+Math.random();var r=u>1?2-u:u;var x=r*Math.cos(t);var y=r*Math.sin(t);return out.set(circle2.x+x*circle2.radius,circle2.y+y*circle2.radius)}function TranslateCircle(circle2,x,y){circle2.x+=x;circle2.y+=y;return circle2}function TranslateCirclePoint(circle2,point){circle2.x+=point.x;circle2.y+=point.y;return circle2}var ellipse_exports={};__export(ellipse_exports,{CloneEllipse:function(){return CloneEllipse},CopyEllipseFrom:function(){return CopyEllipseFrom},Ellipse:function(){return Ellipse},EllipseContains:function(){return EllipseContains},EllipseContainsPoint:function(){return EllipseContainsPoint},EllipseContainsRect:function(){return EllipseContainsRect},EllipseEquals:function(){return EllipseEquals},GetEllipseArea:function(){return GetEllipseArea},GetEllipseBounds:function(){return GetEllipseBounds},GetEllipseCircumference:function(){return GetEllipseCircumference},GetEllipseCircumferencePoint:function(){return GetEllipseCircumferencePoint},GetEllipsePoint:function(){return GetEllipsePoint},GetEllipsePoints:function(){return GetEllipsePoints},GetEllipseRandomPoint:function(){return GetEllipseRandomPoint},TranslateEllipse:function(){return TranslateEllipse},TranslateEllipsePoint:function(){return TranslateEllipsePoint}});function EllipseContains(ellipse,x,y){if(ellipse.width<=0||ellipse.height<=0){return false}var normx=(x-ellipse.x)/ellipse.width;var normy=(y-ellipse.y)/ellipse.height;normx*=normx;normy*=normy;return normx+normy<0.25}var Ellipse=function(){"use strict";function _class(param,param1,param2,param3){var x=param===void 0?0:param,y=param1===void 0?0:param1,width=param2===void 0?0:param2,height=param3===void 0?0:param3;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"x",void 0);swcHelpers.defineProperty(this,"y",void 0);swcHelpers.defineProperty(this,"width",void 0);swcHelpers.defineProperty(this,"height",void 0);this.set(x,y,width,height)}swcHelpers.createClass(_class,[{key:"set",value:function set(param,param1,param2,param3){var x=param===void 0?0:param,y=param1===void 0?0:param1,width=param2===void 0?0:param2,height=param3===void 0?0:param3;this.x=x;this.y=y;this.width=width;this.height=height;return this}},{key:"contains",value:function contains(x,y){return EllipseContains(this,x,y)}},{key:"getMinorRadius",value:function getMinorRadius(){return Math.min(this.width,this.height)/2}},{key:"getMajorRadius",value:function getMajorRadius(){return Math.max(this.width,this.height)/2}},{key:"left",get:function get(){return this.x-this.width/2},set:function set(value){this.x=value+this.width/2}},{key:"right",get:function get(){return this.x+this.width/2},set:function set(value){this.x=value-this.width/2}},{key:"top",get:function get(){return this.y-this.height/2},set:function set(value){this.y=value+this.height/2}},{key:"bottom",get:function get(){return this.y+this.height/2},set:function set(value){this.y=value-this.height/2}}]);return _class}();function CloneEllipse(source){return new Ellipse(source.x,source.y,source.width,source.height)}function CopyEllipseFrom(source,dest){return dest.set(source.x,source.y,source.width,source.height)}function EllipseContainsPoint(ellipse,point){return EllipseContains(ellipse,point.x,point.y)}function EllipseContainsRect(ellipse,rect){return EllipseContains(ellipse,rect.x,rect.y)&&EllipseContains(ellipse,rect.right,rect.y)&&EllipseContains(ellipse,rect.x,rect.bottom)&&EllipseContains(ellipse,rect.right,rect.bottom)}function EllipseEquals(ellipse,toCompare){return ellipse.x===toCompare.x&&ellipse.y===toCompare.y&&ellipse.width===toCompare.width&&ellipse.height===toCompare.height}function GetEllipseArea(ellipse){if(ellipse.width<=0||ellipse.height<=0){return 0}return ellipse.getMajorRadius()*ellipse.getMinorRadius()*Math.PI}function GetEllipseBounds(ellipse,param){var out=param===void 0?new Rectangle():param;return out.set(ellipse.left,ellipse.top,ellipse.width,ellipse.height)}function GetEllipseCircumference(ellipse){var rx=ellipse.width/2;var ry=ellipse.height/2;var h=Math.pow(rx-ry,2)/Math.pow(rx+ry,2);return Math.PI*(rx+ry)*(1+3*h/(10+Math.sqrt(4-3*h)))}function GetEllipseCircumferencePoint(ellipse,angle,param){var out=param===void 0?new Vec2():param;var halfWidth=ellipse.width/2;var halfHeight=ellipse.height/2;return out.set(ellipse.x+halfWidth*Math.cos(angle),ellipse.y+halfHeight*Math.sin(angle))}function GetEllipsePoint(ellipse,position,param){var out=param===void 0?new Vec2():param;var angle=FromPercent(position,0,MATH_CONST.PI2);return GetEllipseCircumferencePoint(ellipse,angle,out)}function GetEllipsePoints(ellipse,step,param,param1){var quantity=param===void 0?0:param,out=param1===void 0?[]:param1;if(!quantity){quantity=GetEllipseCircumference(ellipse)/step}for(var i=0;i<quantity;i++){var angle=FromPercent(i/quantity,0,MATH_CONST.PI2);out.push(GetEllipseCircumferencePoint(ellipse,angle))}return out}function GetEllipseRandomPoint(ellipse,param){var out=param===void 0?new Vec2():param;var p=Math.random()*Math.PI*2;var s=Math.sqrt(Math.random());out.x=ellipse.x+s*Math.cos(p)*ellipse.width/2;out.y=ellipse.y+s*Math.sin(p)*ellipse.height/2;return out}function TranslateEllipse(ellipse,x,y){ellipse.x+=x;ellipse.y+=y;return ellipse}function TranslateEllipsePoint(ellipse,point){ellipse.x+=point.x;ellipse.y+=point.y;return ellipse}var intersects_exports={};__export(intersects_exports,{CircleToCircle:function(){return CircleToCircle},CircleToRectangle:function(){return CircleToRectangle},GetCircleToCircle:function(){return GetCircleToCircle},GetCircleToRectangle:function(){return GetCircleToRectangle},GetLineToCircle:function(){return GetLineToCircle},GetLineToRectangle:function(){return GetLineToRectangle},GetRectangleIntersection:function(){return GetRectangleIntersection},GetRectangleToRectangle:function(){return GetRectangleToRectangle},GetRectangleToTriangle:function(){return GetRectangleToTriangle},GetTriangleToCircle:function(){return GetTriangleToCircle},GetTriangleToLine:function(){return GetTriangleToLine},GetTriangleToTriangle:function(){return GetTriangleToTriangle},LineToCircle:function(){return LineToCircle},LineToLine:function(){return LineToLine},LineToRectangle:function(){return LineToRectangle},PointToLine:function(){return PointToLine},PointToLineSegment:function(){return PointToLineSegment},RectangleToRectangle:function(){return RectangleToRectangle},RectangleToTriangle:function(){return RectangleToTriangle},TriangleToCircle:function(){return TriangleToCircle},TriangleToLine:function(){return TriangleToLine},TriangleToTriangle:function(){return TriangleToTriangle}});function CircleToCircle(circleA,circleB){return GetVec2Distance(circleA,circleB)<=circleA.radius+circleB.radius}function CircleToRectangle(circle2,rect){var halfWidth=rect.width/2;var halfHeight=rect.height/2;var cx=Math.abs(circle2.x-rect.x-halfWidth);var cy=Math.abs(circle2.y-rect.y-halfHeight);var xDist=halfWidth+circle2.radius;var yDist=halfHeight+circle2.radius;if(cx>xDist||cy>yDist){return false}else if(cx<=halfWidth||cy<=halfHeight){return true}else{var xCornerDist=cx-halfWidth;var yCornerDist=cy-halfHeight;var xCornerDistSq=xCornerDist*xCornerDist;var yCornerDistSq=yCornerDist*yCornerDist;var maxCornerDistSq=circle2.radius*circle2.radius;return xCornerDistSq+yCornerDistSq<=maxCornerDistSq}}function GetCircleToCircle(circleA,circleB,param){var out=param===void 0?[]:param;if(CircleToCircle(circleA,circleB)){var x0=circleA.x;var y0=circleA.y;var r0=circleA.radius;var x1=circleB.x;var y1=circleB.y;var r1=circleB.radius;var coefficientA;var coefficientB;var coefficientC;var lambda;var x;if(y0===y1){x=(r1*r1-r0*r0-x1*x1+x0*x0)/(2*(x0-x1));coefficientA=1;coefficientB=-2*y1;coefficientC=x1*x1+x*x-2*x1*x+y1*y1-r1*r1;lambda=coefficientB*coefficientB-4*coefficientA*coefficientC;if(lambda===0){out.push(new Vec2(x,-coefficientB/(2*coefficientA)))}else if(lambda>0){out.push(new Vec2(x,(-coefficientB+Math.sqrt(lambda))/(2*coefficientA)));out.push(new Vec2(x,(-coefficientB-Math.sqrt(lambda))/(2*coefficientA)))}}else{var v1=(x0-x1)/(y0-y1);var n=(r1*r1-r0*r0-x1*x1+x0*x0-y1*y1+y0*y0)/(2*(y0-y1));coefficientA=v1*v1+1;coefficientB=2*y0*v1-2*n*v1-2*x0;coefficientC=x0*x0+y0*y0+n*n-r0*r0-2*y0*n;lambda=coefficientB*coefficientB-4*coefficientA*coefficientC;if(lambda===0){x=-coefficientB/(2*coefficientA);out.push(new Vec2(x,n-x*v1))}else if(lambda>0){x=(-coefficientB+Math.sqrt(lambda))/(2*coefficientA);out.push(new Vec2(x,n-x*v1));x=(-coefficientB-Math.sqrt(lambda))/(2*coefficientA);out.push(new Vec2(x,n-x*v1))}}}return out}var tmp=new Vec2();function LineToCircle(line,circle2,nearest){if(!nearest){nearest=tmp}var x1=line.x1,y1=line.y1,x2=line.x2,y2=line.y2;if(CircleContains(circle2,x1,y1)){nearest.set(x1,y1);return true}if(CircleContains(circle2,x2,y2)){nearest.set(x2,y2);return true}var dx=x2-x1;var dy=y2-y1;var lcx=circle2.x-x1;var lcy=circle2.y-y1;var dLen2=dx*dx+dy*dy;var px=dx;var py=dy;if(dLen2>0){var dp=(lcx*dx+lcy*dy)/dLen2;px*=dp;py*=dp}nearest.set(x1+px,y1+py);var pLen2=px*px+py*py;return pLen2<=dLen2&&px*dx+py*dy>=0&&CircleContains(circle2,nearest.x,nearest.y)}function GetLineToCircle(line,circle2,param){var out=param===void 0?[]:param;if(LineToCircle(line,circle2)){var x1=line.x1,y1=line.y1,x2=line.x2,y2=line.y2;var cr=circle2.radius;var lDirX=x2-x1;var lDirY=y2-y1;var oDirX=x1-circle2.x;var oDirY=y1-circle2.y;var coefficientA=lDirX*lDirX+lDirY*lDirY;var coefficientB=2*(lDirX*oDirX+lDirY*oDirY);var coefficientC=oDirX*oDirX+oDirY*oDirY-cr*cr;var lambda=coefficientB*coefficientB-4*coefficientA*coefficientC;var x;var y;if(lambda===0){var root=-coefficientB/(2*coefficientA);x=x1+root*lDirX;y=y1+root*lDirY;if(root>=0&&root<=1){out.push(new Vec2(x,y))}}else if(lambda>0){var root1=(-coefficientB-Math.sqrt(lambda))/(2*coefficientA);x=x1+root1*lDirX;y=y1+root1*lDirY;if(root1>=0&&root1<=1){out.push(new Vec2(x,y))}var root2=(-coefficientB+Math.sqrt(lambda))/(2*coefficientA);x=x1+root2*lDirX;y=y1+root2*lDirY;if(root2>=0&&root2<=1){out.push(new Vec2(x,y))}}}return out}var Line=function(){"use strict";function _class(param,param1,param2,param3){var x1=param===void 0?0:param,y1=param1===void 0?0:param1,x2=param2===void 0?0:param2,y2=param3===void 0?0:param3;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"x1",void 0);swcHelpers.defineProperty(this,"y1",void 0);swcHelpers.defineProperty(this,"x2",void 0);swcHelpers.defineProperty(this,"y2",void 0);this.set(x1,y1,x2,y2)}swcHelpers.createClass(_class,[{key:"set",value:function set(param,param1,param2,param3){var x1=param===void 0?0:param,y1=param1===void 0?0:param1,x2=param2===void 0?0:param2,y2=param3===void 0?0:param3;this.x1=x1;this.y1=y1;this.x2=x2;this.y2=y2;return this}},{key:"left",get:function get(){return Math.min(this.x1,this.x2)},set:function set(value){if(this.x1<=this.x2){this.x1=value}else{this.x2=value}}},{key:"right",get:function get(){return Math.max(this.x1,this.x2)},set:function set(value){if(this.x1>this.x2){this.x1=value}else{this.x2=value}}},{key:"top",get:function get(){return Math.min(this.y1,this.y2)},set:function set(value){if(this.y1<=this.y2){this.y1=value}else{this.y2=value}}},{key:"bottom",get:function get(){return Math.max(this.y1,this.y2)},set:function set(value){if(this.y1>this.y2){this.y1=value}else{this.y2=value}}}]);return _class}();function GetRectangleEdges(rectangle){var x=rectangle.x,y=rectangle.y,right=rectangle.right,bottom=rectangle.bottom;var line1=new Line(x,y,right,y);var line2=new Line(right,y,right,bottom);var line3=new Line(right,bottom,x,bottom);var line4=new Line(x,bottom,x,y);return[line1,line2,line3,line4]}function GetCircleToRectangle(circle2,rect,param){var out=param===void 0?[]:param;if(CircleToRectangle(circle2,rect)){var ref=GetRectangleEdges(rect),line1=ref[0],line2=ref[1],line3=ref[2],line4=ref[3];GetLineToCircle(line1,circle2,out);GetLineToCircle(line2,circle2,out);GetLineToCircle(line3,circle2,out);GetLineToCircle(line4,circle2,out)}return out}function LineToLine(line1,line2,out){var x1=line1.x1,y1=line1.y1,x2=line1.x2,y2=line1.y2;var x3=line2.x1,y3=line2.y1,x4=line2.x2,y4=line2.y2;var numA=(x4-x3)*(y1-y3)-(y4-y3)*(x1-x3);var numB=(x2-x1)*(y1-y3)-(y2-y1)*(x1-x3);var deNom=(y4-y3)*(x2-x1)-(x4-x3)*(y2-y1);if(deNom===0){return false}var uA=numA/deNom;var uB=numB/deNom;if(uA>=0&&uA<=1&&uB>=0&&uB<=1){if(out){out.set(x1+uA*(x2-x1),y1+uA*(y2-y1))}return true}return false}function LineToRectangle(line,rect){var x1=line.x1,y1=line.y1,x2=line.x2,y2=line.y2;var x=rect.x,y=rect.y,right=rect.right,bottom=rect.bottom;var t=0;if(x1>=x&&x1<=right&&y1>=y&&y1<=bottom||x2>=x&&x2<=right&&y2>=y&&y2<=bottom){return true}if(x1<x&&x2>=x){t=y1+(y2-y1)*(x-x1)/(x2-x1);if(t>y&&t<=bottom){return true}}else if(x1>right&&x2<=right){t=y1+(y2-y1)*(right-x1)/(x2-x1);if(t>=y&&t<=bottom){return true}}if(y1<y&&y2>=y){t=x1+(x2-x1)*(y-y1)/(y2-y1);if(t>=x&&t<=right){return true}}else if(y1>bottom&&y2<=bottom){t=x1+(x2-x1)*(bottom-y1)/(y2-y1);if(t>=x&&t<=right){return true}}return false}function GetLineToRectangle(line,rect,param){var out=param===void 0?[]:param;if(LineToRectangle(line,rect)){var ref=GetRectangleEdges(rect),lineA=ref[0],lineB=ref[1],lineC=ref[2],lineD=ref[3];var points=[new Vec2(),new Vec2(),new Vec2(),new Vec2()];var results=[LineToLine(lineA,line,points[0]),LineToLine(lineB,line,points[1]),LineToLine(lineC,line,points[2]),LineToLine(lineD,line,points[3])];for(var i=0;i<results.length;i++){if(results[i]){out.push(points[i])}}}return out}function GetRectangleIntersection(rectA,rectB,param){var out=param===void 0?new Rectangle():param;if(RectangleToRectangle(rectA,rectB)){var x=Math.max(rectA.x,rectB.x);var y=Math.max(rectA.y,rectB.y);return out.set(x,y,Math.min(rectA.right,rectB.right)-x,Math.min(rectA.bottom,rectB.bottom)-y)}}function GetRectangleToRectangle(rectA,rectB,param){var out=param===void 0?[]:param;if(RectangleToRectangle(rectA,rectB)){var ref=GetRectangleEdges(rectA),lineA=ref[0],lineB=ref[1],lineC=ref[2],lineD=ref[3];GetLineToRectangle(lineA,rectB,out);GetLineToRectangle(lineB,rectB,out);GetLineToRectangle(lineC,rectB,out);GetLineToRectangle(lineD,rectB,out)}return out}function GetTriangleEdges(triangle){var x1=triangle.x1,y1=triangle.y1,x2=triangle.x2,y2=triangle.y2,x3=triangle.x3,y3=triangle.y3;var edge1=new Line(x1,y1,x2,y2);var edge2=new Line(x2,y2,x3,y3);var edge3=new Line(x3,y3,x1,y1);return[edge1,edge2,edge3]}function DecomposeRectangle(rect,param){var out=param===void 0?[]:param;out.push(new Vec2(rect.x,rect.y),new Vec2(rect.right,rect.y),new Vec2(rect.right,rect.bottom),new Vec2(rect.x,rect.bottom));return out}function TriangleContains(triangle,x,y){var x1=triangle.x1,y1=triangle.y1,x2=triangle.x2,y2=triangle.y2,x3=triangle.x3,y3=triangle.y3;var v0x=x3-x1;var v0y=y3-y1;var v1x=x2-x1;var v1y=y2-y1;var v2x=x-x1;var v2y=y-y1;var dot00=v0x*v0x+v0y*v0y;var dot01=v0x*v1x+v0y*v1y;var dot02=v0x*v2x+v0y*v2y;var dot11=v1x*v1x+v1y*v1y;var dot12=v1x*v2x+v1y*v2y;var b=dot00*dot11-dot01*dot01;var inv=b===0?0:1/b;var u=(dot11*dot02-dot01*dot12)*inv;var v=(dot00*dot12-dot01*dot02)*inv;return u>=0&&v>=0&&u+v<1}function TriangleContainsPoints(triangle,points,param,param1){var returnFirst=param===void 0?false:param,out=param1===void 0?[]:param1;var skip=false;points.forEach(function(point){if(skip){return}var x=point.x,y=point.y;if(TriangleContains(triangle,x,y)){out.push(new Vec2(x,y));if(returnFirst){skip=true}}});return out}function RectangleToTriangle(rect,triangle){if(triangle.left>rect.right||triangle.right<rect.x||triangle.top>rect.bottom||triangle.bottom<rect.y){return false}var ref=GetTriangleEdges(triangle),triA=ref[0],triB=ref[1],triC=ref[2];if(RectangleContains(rect,triA.x1,triA.y1)||RectangleContains(rect,triA.x2,triA.y2)){return true}if(RectangleContains(rect,triB.x1,triB.y1)||RectangleContains(rect,triB.x2,triB.y2)){return true}if(RectangleContains(rect,triC.x1,triC.y1)||RectangleContains(rect,triC.x2,triC.y2)){return true}var ref1=GetRectangleEdges(rect),rectA=ref1[0],rectB=ref1[1],rectC=ref1[2],rectD=ref1[3];if(LineToLine(triA,rectA)||LineToLine(triA,rectB)||LineToLine(triA,rectC)||LineToLine(triA,rectD)){return true}if(LineToLine(triB,rectA)||LineToLine(triB,rectB)||LineToLine(triB,rectC)||LineToLine(triB,rectD)){return true}if(LineToLine(triC,rectA)||LineToLine(triC,rectB)||LineToLine(triC,rectC)||LineToLine(triC,rectD)){return true}var within=TriangleContainsPoints(triangle,DecomposeRectangle(rect),true);return within.length>0}function GetRectangleToTriangle(rect,triangle,param){var out=param===void 0?[]:param;if(RectangleToTriangle(rect,triangle)){var ref=GetTriangleEdges(triangle),lineA=ref[0],lineB=ref[1],lineC=ref[2];GetLineToRectangle(lineA,rect,out);GetLineToRectangle(lineB,rect,out);GetLineToRectangle(lineC,rect,out)}return out}function TriangleToCircle(triangle,circle2){if(triangle.left>circle2.right||triangle.right<circle2.left||triangle.top>circle2.bottom||triangle.bottom<circle2.top){return false}if(TriangleContains(triangle,circle2.x,circle2.y)){return true}var ref=GetTriangleEdges(triangle),line1=ref[0],line2=ref[1],line3=ref[2];return LineToCircle(line1,circle2)||LineToCircle(line2,circle2)||LineToCircle(line3,circle2)}function GetTriangleToCircle(triangle,circle2,param){var out=param===void 0?[]:param;if(TriangleToCircle(triangle,circle2)){var ref=GetTriangleEdges(triangle),lineA=ref[0],lineB=ref[1],lineC=ref[2];GetLineToCircle(lineA,circle2,out);GetLineToCircle(lineB,circle2,out);GetLineToCircle(lineC,circle2,out)}return out}function TriangleToLine(triangle,line){var x1=line.x1,y1=line.y1,x2=line.x2,y2=line.y2;if(TriangleContains(triangle,x1,y1)||TriangleContains(triangle,x2,y2)){return true}var ref=GetTriangleEdges(triangle),line1=ref[0],line2=ref[1],line3=ref[2];return LineToLine(line1,line)||LineToLine(line2,line)||LineToLine(line3,line)}function GetTriangleToLine(triangle,line,param){var out=param===void 0?[]:param;if(TriangleToLine(triangle,line)){var ref=GetTriangleEdges(triangle),lineA=ref[0],lineB=ref[1],lineC=ref[2];var points=[new Vec2(),new Vec2(),new Vec2()];var results=[LineToLine(lineA,line,points[0]),LineToLine(lineB,line,points[1]),LineToLine(lineC,line,points[2])];for(var i=0;i<results.length;i++){if(results[i]){out.push(points[i])}}}return out}function DecomposeTriangle(triangle,param){var out=param===void 0?[]:param;var x1=triangle.x1,y1=triangle.y1,x2=triangle.x2,y2=triangle.y2,x3=triangle.x3,y3=triangle.y3;out.push(new Vec2(x1,y1),new Vec2(x2,y2),new Vec2(x3,y3));return out}function TriangleToTriangle(triangleA,triangleB){if(triangleA.left>triangleB.right||triangleA.right<triangleB.left||triangleA.top>triangleB.bottom||triangleA.bottom<triangleB.top){return false}var ref=GetTriangleEdges(triangleA),lineAA=ref[0],lineAB=ref[1],lineAC=ref[2];var ref1=GetTriangleEdges(triangleB),lineBA=ref1[0],lineBB=ref1[1],lineBC=ref1[2];if(LineToLine(lineAA,lineBA)||LineToLine(lineAA,lineBB)||LineToLine(lineAA,lineBC)||LineToLine(lineAB,lineBA)||LineToLine(lineAB,lineBB)||LineToLine(lineAB,lineBC)||LineToLine(lineAC,lineBA)||LineToLine(lineAC,lineBB)||LineToLine(lineAC,lineBC)){return true}var withinA=TriangleContainsPoints(triangleB,DecomposeTriangle(triangleA),true);if(withinA.length>0){return true}var withinB=TriangleContainsPoints(triangleA,DecomposeTriangle(triangleB),true);return withinB.length>0}function GetTriangleToTriangle(triangleA,triangleB,param){var out=param===void 0?[]:param;if(TriangleToTriangle(triangleA,triangleB)){var ref=GetTriangleEdges(triangleB),lineA=ref[0],lineB=ref[1],lineC=ref[2];GetTriangleToLine(triangleA,lineA,out);GetTriangleToLine(triangleA,lineB,out);GetTriangleToLine(triangleA,lineC,out)}return out}function PointToLine(point,line,param){var lineThickness=param===void 0?1:param;var x1=line.x1,y1=line.y1,x2=line.x2,y2=line.y2;var px=point.x,py=point.y;var L2=(x2-x1)*(x2-x1)+(y2-y1)*(y2-y1);if(L2===0){return false}var r=((px-x1)*(x2-x1)+(py-y1)*(y2-y1))/L2;if(r<0){return Math.sqrt((x1-px)*(x1-px)+(y1-py)*(y1-py))<=lineThickness}else if(r>=0&&r<=1){var s=((y1-py)*(x2-x1)-(x1-px)*(y2-y1))/L2;return Math.abs(s)*Math.sqrt(L2)<=lineThickness}else{return Math.sqrt((x2-px)*(x2-px)+(y2-py)*(y2-py))<=lineThickness}}function PointToLineSegment(point,line){if(!PointToLine(point,line)){return false}var x1=line.x1,y1=line.y1,x2=line.x2,y2=line.y2;var x=point.x,y=point.y;var xMin=Math.min(x1,x2);var xMax=Math.max(x1,x2);var yMin=Math.min(y1,y2);var yMax=Math.max(y1,y2);return x>=xMin&&x<=xMax&&y>=yMin&&y<=yMax}var line_exports={};__export(line_exports,{CenterLineOn:function(){return CenterLineOn},CloneLine:function(){return CloneLine},CopyLineFrom:function(){return CopyLineFrom},ExtendLine:function(){return ExtendLine},GetLineAngle:function(){return GetLineAngle},GetLineBresenhamPoints:function(){return GetLineBresenhamPoints},GetLineHeight:function(){return GetLineHeight},GetLineLength:function(){return GetLineLength},GetLineMidPoint:function(){return GetLineMidPoint},GetLineNearestPoint:function(){return GetLineNearestPoint},GetLineNormal:function(){return GetLineNormal},GetLineNormalAngle:function(){return GetLineNormalAngle},GetLineNormalX:function(){return GetLineNormalX},GetLineNormalY:function(){return GetLineNormalY},GetLinePerpSlope:function(){return GetLinePerpSlope},GetLinePoint:function(){return GetLinePoint},GetLinePoints:function(){return GetLinePoints},GetLineRandomPoint:function(){return GetLineRandomPoint},GetLineReflectAngle:function(){return GetLineReflectAngle},GetLineSlope:function(){return GetLineSlope},GetLineWidth:function(){return GetLineWidth},GetShortestLineDistance:function(){return GetShortestLineDistance},Line:function(){return Line},LineEquals:function(){return LineEquals},RotateLine:function(){return RotateLine},RotateLineAround:function(){return RotateLineAround},RotateLineAroundPoint:function(){return RotateLineAroundPoint},SetLineToAngle:function(){return SetLineToAngle},TranslateLine:function(){return TranslateLine},TranslateLinePoint:function(){return TranslateLinePoint}});function CenterLineOn(line,x,y){var tx=x-(line.x1+line.x2)/2;var ty=y-(line.y1+line.y2)/2;line.x1+=tx;line.y1+=ty;line.x2+=tx;line.y2+=ty;return line}function CloneLine(source){return new Line(source.x1,source.y1,source.x2,source.y2)}function CopyLineFrom(source,dest){return dest.set(source.x1,source.y1,source.x2,source.y2)}function GetLineLength(line){var x1=line.x1,y1=line.y1,x2=line.x2,y2=line.y2;return Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1))}function ExtendLine(line,left,param){var right=param===void 0?left:param;var length=GetLineLength(line);var slopX=line.x2-line.x1;var slopY=line.y2-line.y1;if(left){line.x1=line.x1-slopX/length*left;line.y1=line.y1-slopY/length*left}if(right){line.x2=line.x2+slopX/length*right;line.y2=line.y2+slopY/length*right}return line}function GetLineAngle(line){return Math.atan2(line.y2-line.y1,line.x2-line.x1)}function GetLineBresenhamPoints(line,param,param1){var stepRate=param===void 0?1:param,results=param1===void 0?[]:param1;var x1=Math.round(line.x1);var y1=Math.round(line.y1);var x2=Math.round(line.x2);var y2=Math.round(line.y2);var dx=Math.abs(x2-x1);var dy=Math.abs(y2-y1);var sx=x1<x2?1:-1;var sy=y1<y2?1:-1;var err=dx-dy;results.push(new Vec2(x1,y1));var i=1;while(!(x1===x2&&y1===y2)){var e2=err<<1;if(e2> -dy){err-=dy;x1+=sx}if(e2<dx){err+=dx;y1+=sy}if(i%stepRate===0){results.push(new Vec2(x1,y1))}i++}return results}function GetLineHeight(line){return Math.abs(line.y1-line.y2)}function GetLineMidPoint(line,param){var out=param===void 0?new Vec2():param;out.x=(line.x1+line.x2)/2;out.y=(line.y1+line.y2)/2;return out}function GetLineNearestPoint(line,point,param){var out=param===void 0?new Vec2():param;var x1=line.x1,y1=line.y1,x2=line.x2,y2=line.y2;var L2=(x2-x1)*(x2-x1)+(y2-y1)*(y2-y1);if(L2===0){return out}var r=((point.x-x1)*(x2-x1)+(point.y-y1)*(y2-y1))/L2;out.x=x1+r*(x2-x1);out.y=y1+r*(y2-y1);return out}function GetLineNormal(line,param){var out=param===void 0?new Vec2():param;var a=GetLineAngle(line)-MATH_CONST.HALF_PI;out.x=Math.cos(a);out.y=Math.sin(a);return out}function Wrap(value,min,max){var range=max-min;return min+((value-min)%range+range)%range}function GetLineNormalAngle(line){var angle=GetLineAngle(line)-MATH_CONST.HALF_PI;return Wrap(angle,-Math.PI,Math.PI)}function GetLineNormalX(line){return Math.cos(GetLineAngle(line)-MATH_CONST.HALF_PI)}function GetLineNormalY(line){return Math.sin(GetLineAngle(line)-MATH_CONST.HALF_PI)}function GetLinePerpSlope(line){var x1=line.x1,y1=line.y1,x2=line.x2,y2=line.y2;return-((x2-x1)/(y2-y1))}function GetLinePoint(line,position,param){var out=param===void 0?new Vec2():param;out.x=line.x1+(line.x2-line.x1)*position;out.y=line.y1+(line.y2-line.y1)*position;return out}function GetLinePoints(line,quantity,param,param1){var stepRate=param===void 0?0:param,out=param1===void 0?[]:param1;if(!quantity){quantity=GetLineLength(line)/stepRate}var x1=line.x1,y1=line.y1,x2=line.x2,y2=line.y2;for(var i=0;i<quantity;i++){var position=i/quantity;var x=x1+(x2-x1)*position;var y=y1+(y2-y1)*position;out.push(new Vec2(x,y))}return out}function GetLineRandomPoint(line,param){var out=param===void 0?new Vec2():param;var t=Math.random();out.x=line.x1+t*(line.x2-line.x1);out.y=line.y1+t*(line.y2-line.y1);return out}function GetLineReflectAngle(lineA,lineB){return 2*GetLineNormalAngle(lineB)-Math.PI-GetLineAngle(lineA)}function GetLineSlope(line){var x1=line.x1,y1=line.y1,x2=line.x2,y2=line.y2;return(y2-y1)/(x2-x1)}function GetLineWidth(line){return Math.abs(line.x1-line.x2)}function GetShortestLineDistance(line,point){var x1=line.x1,y1=line.y1,x2=line.x2,y2=line.y2;var L2=(x2-x1)*(x2-x1)+(y2-y1)*(y2-y1);if(L2===0){return 0}var s=((y1-point.y)*(x2-x1)-(x1-point.x)*(y2-y1))/L2;return Math.abs(s)*Math.sqrt(L2)}function LineEquals(line,toCompare){return line.x1===toCompare.x1&&line.y1===toCompare.y1&&line.x2===toCompare.x2&&line.y2===toCompare.y2}function RotateLineAround(line,x,y,angle){var c=Math.cos(angle);var s=Math.sin(angle);var tx=line.x1-x;var ty=line.y1-y;line.x1=tx*c-ty*s+x;line.y1=tx*s+ty*c+y;tx=line.x2-x;ty=line.y2-y;line.x2=tx*c-ty*s+x;line.y2=tx*s+ty*c+y;return line}function RotateLine(line,angle){var x=(line.x1+line.x2)/2;var y=(line.y1+line.y2)/2;return RotateLineAround(line,x,y,angle)}function RotateLineAroundPoint(line,point,angle){return RotateLineAround(line,point.x,point.y,angle)}function SetLineToAngle(line,x,y,angle,length){line.x1=x;line.y1=y;line.x2=x+Math.cos(angle)*length;line.y2=y+Math.sin(angle)*length;return line}function TranslateLine(line,x,y){line.x1+=x;line.y1+=y;line.x2+=x;line.y2+=y;return line}function TranslateLinePoint(line,v){return TranslateLine(line,v.x,v.y)}var rectangle_exports={};__export(rectangle_exports,{CeilRectangle:function(){return CeilRectangle},CeilRectanglePosition:function(){return CeilRectanglePosition},CenterRectangleOn:function(){return CenterRectangleOn},CloneRectangle:function(){return CloneRectangle},CopyRectangleFrom:function(){return CopyRectangleFrom},DecomposeRectangle:function(){return DecomposeRectangle},FitRectangleInside:function(){return FitRectangleInside},FitRectangleOutside:function(){return FitRectangleOutside},FitRectangleToPoint:function(){return FitRectangleToPoint},FitRectangleToPoints:function(){return FitRectangleToPoints},FloorRectangle:function(){return FloorRectangle},FloorRectanglePosition:function(){return FloorRectanglePosition},GetRectangleArea:function(){return GetRectangleArea},GetRectangleAspectRatio:function(){return GetRectangleAspectRatio},GetRectangleCenter:function(){return GetRectangleCenter},GetRectangleCenterX:function(){return GetRectangleCenterX},GetRectangleCenterY:function(){return GetRectangleCenterY},GetRectangleEdges:function(){return GetRectangleEdges},GetRectangleIntersection:function(){return GetRectangleIntersection2},GetRectangleMarchingAnts:function(){return GetRectangleMarchingAnts},GetRectangleOverlap:function(){return GetRectangleOverlap},GetRectanglePerimeter:function(){return GetRectanglePerimeter},GetRectanglePerimeterPoint:function(){return GetRectanglePerimeterPoint},GetRectanglePoint:function(){return GetRectanglePoint},GetRectanglePoints:function(){return GetRectanglePoints},GetRectangleRandomPoint:function(){return GetRectangleRandomPoint},GetRectangleRandomPointOutside:function(){return GetRectangleRandomPointOutside},GetRectangleSize:function(){return GetRectangleSize},GetRectangleUnion:function(){return GetRectangleUnion},InflateRectangle:function(){return InflateRectangle},MergeRectangle:function(){return MergeRectangle},Rectangle:function(){return Rectangle},RectangleContains:function(){return RectangleContains},RectangleContainsPoint:function(){return RectangleContainsPoint},RectangleContainsRectangle:function(){return RectangleContainsRectangle},RectangleEquals:function(){return RectangleEquals},RectangleFromPoints:function(){return RectangleFromPoints},RectangleSizeEquals:function(){return RectangleSizeEquals},ScaleRectangle:function(){return ScaleRectangle},TranslateRectangle:function(){return TranslateRectangle},TranslateRectanglePoint:function(){return TranslateRectanglePoint}});function CeilRectangle(rect){rect.x=Math.ceil(rect.x);rect.y=Math.ceil(rect.y);rect.width=Math.ceil(rect.width);rect.height=Math.ceil(rect.height);return rect}function CeilRectanglePosition(rect){rect.x=Math.ceil(rect.x);rect.y=Math.ceil(rect.y);return rect}function CenterRectangleOn(rect,x,y){rect.x=x-rect.width/2;rect.y=y-rect.height/2;return rect}function CloneRectangle(source){return new Rectangle(source.x,source.y,source.width,source.height)}function CopyRectangleFrom(source,dest){return dest.set(source.x,source.y,source.width,source.height)}function GetRectangleAspectRatio(rect){return rect.height===0?NaN:rect.width/rect.height}function GetRectangleCenterX(rect){return rect.x+rect.width/2}function GetRectangleCenterY(rect){return rect.y+rect.height/2}function FitRectangleInside(target,source){var ratio=GetRectangleAspectRatio(target);var width=source.width;var height=source.height;if(ratio<GetRectangleAspectRatio(source)){width=source.height*ratio}else{height=source.width/ratio}return target.set(GetRectangleCenterX(source)-target.width/2,GetRectangleCenterY(source)-target.height/2,width,height)}function FitRectangleOutside(target,source){var ratio=GetRectangleAspectRatio(target);var width=source.width;var height=source.height;if(ratio>GetRectangleAspectRatio(source)){width=source.height*ratio}else{height=source.width/ratio}return target.set(GetRectangleCenterX(source)-target.width/2,GetRectangleCenterY(source)-target.height/2,width,height)}function FitRectangleToPoint(target,x,y){var minX=Math.min(target.x,x);var maxX=Math.max(target.right,x);var minY=Math.min(target.y,y);var maxY=Math.max(target.bottom,y);return target.set(minX,minY,maxX-minX,maxY-minY)}function FitRectangleToPoints(target,points){var minX=target.x;var maxX=target.right;var minY=target.y;var maxY=target.bottom;for(var i=0;i<points.length;i++){minX=Math.min(minX,points[i].x);maxX=Math.max(maxX,points[i].x);minY=Math.min(minY,points[i].y);maxY=Math.max(maxY,points[i].y)}return target.set(minX,minY,maxX-minX,maxY-minY)}function FloorRectangle(rect){rect.x=Math.floor(rect.x);rect.y=Math.floor(rect.y);rect.width=Math.floor(rect.width);rect.height=Math.floor(rect.height);return rect}function FloorRectanglePosition(rect){rect.x=Math.floor(rect.x);rect.y=Math.floor(rect.y);return rect}function GetRectangleArea(rect){return rect.width*rect.height}function GetRectangleCenter(rect,param){var out=param===void 0?new Vec2():param;return out.set(GetRectangleCenterX(rect),GetRectangleCenterY(rect))}function GetRectangleIntersection2(rectA,rectB,param){var out=param===void 0?new Rectangle():param;if(RectangleToRectangle(rectA,rectB)){out.set(Math.max(rectA.x,rectB.x),Math.max(rectA.y,rectB.y),Math.min(rectA.right,rectB.right)-out.x,Math.min(rectA.bottom,rectB.bottom)-out.y)}else{out.set()}return out}function GetRectanglePerimeter(rect){return 2*(rect.width+rect.height)}function GetRectangleMarchingAnts(rect,step,quantity,param){var out=param===void 0?[]:param;if(!step&&!quantity){return out}if(!step){step=GetRectanglePerimeter(rect)/quantity}else{quantity=Math.round(GetRectanglePerimeter(rect)/step)}var x=rect.x;var y=rect.y;var face=0;for(var i=0;i<quantity;i++){out.push(new Vec2(x,y));switch(face){case 0:x+=step;if(x>=rect.right){face=1;y+=x-rect.right;x=rect.right}break;case 1:y+=step;if(y>=rect.bottom){face=2;x-=y-rect.bottom;y=rect.bottom}break;case 2:x-=step;if(x<=rect.x){face=3;y-=rect.x-x;x=rect.x}break;case 3:y-=step;if(y<=rect.y){face=0;y=rect.y}break}}return out}function GetRectangleOverlap(rectA,rectB){return rectA.x<rectB.right&&rectA.right>rectB.x&&rectA.y<rectB.bottom&&rectA.bottom>rectB.y}function DegToRad(degrees){return degrees*MATH_CONST.DEG_TO_RAD}function GetRectanglePerimeterPoint(rectangle,angle,param){var out=param===void 0?new Vec2():param;angle=DegToRad(angle);var s=Math.sin(angle);var c=Math.cos(angle);var dx=c>0?rectangle.width/2:rectangle.width/-2;var dy=s>0?rectangle.height/2:rectangle.height/-2;if(Math.abs(dx*s)<Math.abs(dy*c)){dy=dx*s/c}else{dx=dy*c/s}return out.set(dx+GetRectangleCenterX(rectangle),dy+GetRectangleCenterY(rectangle))}function GetRectanglePoint(rectangle,position,param){var out=param===void 0?new Vec2():param;if(position<=0||position>=1){return out.set(rectangle.x,rectangle.y)}var p=GetRectanglePerimeter(rectangle)*position;if(position>0.5){p-=rectangle.width+rectangle.height;if(p<=rectangle.width){return out.set(rectangle.right-p,rectangle.bottom)}else{return out.set(rectangle.x,rectangle.bottom-(p-rectangle.width))}}else if(p<=rectangle.width){return out.set(rectangle.x+p,rectangle.y)}else{return out.set(rectangle.right,rectangle.y+(p-rectangle.width))}}function GetRectanglePoints(rectangle,step,param,param1){var quantity=param===void 0?0:param,out=param1===void 0?[]:param1;if(!quantity){quantity=GetRectanglePerimeter(rectangle)/step}for(var i=0;i<quantity;i++){out.push(GetRectanglePoint(rectangle,i/quantity))}return out}function GetRectangleRandomPoint(rect,param){var out=param===void 0?new Vec2():param;return out.set(rect.x+Math.random()*rect.width,rect.y+Math.random()*rect.height)}function Between(min,max){return Math.floor(Math.random()*(max-min+1)+min)}function RectangleContainsRectangle(rectA,rectB){if(rectB.width*rectB.height>rectA.width*rectA.height){return false}return rectB.x>rectA.x&&rectB.x<rectA.right&&rectB.right>rectA.x&&rectB.right<rectA.right&&rectB.y>rectA.y&&rectB.y<rectA.bottom&&rectB.bottom>rectA.y&&rectB.bottom<rectA.bottom}function GetRectangleRandomPointOutside(outer,inner,param){var out=param===void 0?new Vec2():param;if(RectangleContainsRectangle(outer,inner)){switch(Between(0,3)){case 0:out.x=outer.x+Math.random()*(inner.right-outer.x);out.y=outer.y+Math.random()*(inner.y-outer.y);break;case 1:out.x=inner.x+Math.random()*(outer.right-inner.x);out.y=inner.bottom+Math.random()*(outer.bottom-inner.bottom);break;case 2:out.x=outer.x+Math.random()*(inner.x-outer.x);out.y=inner.y+Math.random()*(outer.bottom-inner.y);break;case 3:out.x=inner.right+Math.random()*(outer.right-inner.right);out.y=outer.y+Math.random()*(inner.bottom-outer.y);break}}return out}function GetRectangleSize(rect,param){var out=param===void 0?new Vec2():param;return out.set(rect.width,rect.height)}function GetRectangleUnion(rectA,rectB,param){var out=param===void 0?new Rectangle():param;var x=Math.min(rectA.x,rectB.x);var y=Math.min(rectA.y,rectB.y);var w=Math.max(rectA.right,rectB.right)-x;var h=Math.max(rectA.bottom,rectB.bottom)-y;return out.set(x,y,w,h)}function InflateRectangle(rect,x,y){var cx=GetRectangleCenterX(rect);var cy=GetRectangleCenterY(rect);rect.width=rect.width+x*2;rect.height=rect.height+y*2;return CenterRectangleOn(rect,cx,cy)}function MergeRectangle(target,source){var minX=Math.min(target.x,source.x);var maxX=Math.max(target.right,source.right);var minY=Math.min(target.y,source.y);var maxY=Math.max(target.bottom,source.bottom);return target.set(minX,minY,maxX-minX,maxY-minY)}function RectangleContainsPoint(rect,point){return RectangleContains(rect,point.x,point.y)}function RectangleFromPoints(points,param){var out=param===void 0?new Rectangle():param;if(points.length===0){return out}var minX=Number.MAX_VALUE;var minY=Number.MAX_VALUE;var maxX=MATH_CONST.MIN_SAFE_INTEGER;var maxY=MATH_CONST.MIN_SAFE_INTEGER;for(var i=0;i<points.length;i++){var px=points[i].x;var py=points[i].y;minX=Math.min(minX,px);minY=Math.min(minY,py);maxX=Math.max(maxX,px);maxY=Math.max(maxY,py)}return out.set(minX,minY,maxX-minX,maxY-minY)}function RectangleSizeEquals(rect,toCompare){return rect.width===toCompare.width&&rect.height===toCompare.height}function ScaleRectangle(rect,x,param){var y=param===void 0?x:param;rect.width*=x;rect.height*=y;return rect}function TranslateRectangle(rect,x,y){rect.x+=x;rect.y+=y;return rect}function TranslateRectanglePoint(rect,point){rect.x+=point.x;rect.y+=point.y;return rect}var triangle_exports={};__export(triangle_exports,{BuildEquilateralTriangle:function(){return BuildEquilateralTriangle},BuildRightTriangle:function(){return BuildRightTriangle},CenterTriangleOn:function(){return CenterTriangleOn},CloneTriangle:function(){return CloneTriangle},CopyTriangleFrom:function(){return CopyTriangleFrom},DecomposeTriangle:function(){return DecomposeTriangle},GetTriangleArea:function(){return GetTriangleArea},GetTriangleCentroid:function(){return GetTriangleCentroid},GetTriangleCircumCenter:function(){return GetTriangleCircumCenter},GetTriangleCircumCircle:function(){return GetTriangleCircumCircle},GetTriangleEdges:function(){return GetTriangleEdges},GetTriangleInCenter:function(){return GetTriangleInCenter},GetTrianglePerimeter:function(){return GetTrianglePerimeter},GetTrianglePoint:function(){return GetTrianglePoint},GetTrianglePoints:function(){return GetTrianglePoints},GetTriangleRandomPoint:function(){return GetTriangleRandomPoint},RotateTriangle:function(){return RotateTriangle},RotateTriangleAround:function(){return RotateTriangleAround},RotateTriangleAroundPoint:function(){return RotateTriangleAroundPoint},TranslateTriangle:function(){return TranslateTriangle},Triangle:function(){return Triangle},TriangleContains:function(){return TriangleContains},TriangleContainsPoint:function(){return TriangleContainsPoint},TriangleContainsPoints:function(){return TriangleContainsPoints},TriangleEquals:function(){return TriangleEquals}});var Triangle=function(){"use strict";function _class(param,param1,param2,param3,param4,param5){var x1=param===void 0?0:param,y1=param1===void 0?0:param1,x2=param2===void 0?0:param2,y2=param3===void 0?0:param3,x3=param4===void 0?0:param4,y3=param5===void 0?0:param5;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"x1",void 0);swcHelpers.defineProperty(this,"y1",void 0);swcHelpers.defineProperty(this,"x2",void 0);swcHelpers.defineProperty(this,"y2",void 0);swcHelpers.defineProperty(this,"x3",void 0);swcHelpers.defineProperty(this,"y3",void 0);this.set(x1,y1,x2,y2,x3,y3)}swcHelpers.createClass(_class,[{key:"set",value:function set(param,param1,param2,param3,param4,param5){var x1=param===void 0?0:param,y1=param1===void 0?0:param1,x2=param2===void 0?0:param2,y2=param3===void 0?0:param3,x3=param4===void 0?0:param4,y3=param5===void 0?0:param5;this.x1=x1;this.y1=y1;this.x2=x2;this.y2=y2;this.x3=x3;this.y3=y3;return this}},{key:"contains",value:function contains(x,y){return TriangleContains(this,x,y)}},{key:"left",get:function get(){return Math.min(this.x1,this.x2,this.x3)},set:function set(value){var diff2=0;if(this.x1<=this.x2&&this.x1<=this.x3){diff2=this.x1-value}else if(this.x2<=this.x1&&this.x2<=this.x3){diff2=this.x2-value}else{diff2=this.x3-value}this.x1-=diff2;this.x2-=diff2;this.x3-=diff2}},{key:"right",get:function get(){return Math.max(this.x1,this.x2,this.x3)},set:function set(value){var diff2=0;if(this.x1>=this.x2&&this.x1>=this.x3){diff2=this.x1-value}else if(this.x2>=this.x1&&this.x2>=this.x3){diff2=this.x2-value}else{diff2=this.x3-value}this.x1-=diff2;this.x2-=diff2;this.x3-=diff2}},{key:"top",get:function get(){return Math.min(this.y1,this.y2,this.y3)},set:function set(value){var diff2=0;if(this.y1<=this.y2&&this.y1<=this.y3){diff2=this.y1-value}else if(this.y2<=this.y1&&this.y2<=this.y3){diff2=this.y2-value}else{diff2=this.y3-value}this.y1-=diff2;this.y2-=diff2;this.y3-=diff2}},{key:"bottom",get:function get(){return Math.max(this.y1,this.y2,this.y3)},set:function set(value){var diff2=0;if(this.y1>=this.y2&&this.y1>=this.y3){diff2=this.y1-value}else if(this.y2>=this.y1&&this.y2>=this.y3){diff2=this.y2-value}else{diff2=this.y3-value}this.y1-=diff2;this.y2-=diff2;this.y3-=diff2}}]);return _class}();function BuildEquilateralTriangle(x,y,length){var height=length*(Math.sqrt(3)/2);var x1=x;var y1=y;var x2=x+length/2;var y2=y+height;var x3=x-length/2;var y3=y+height;return new Triangle(x1,y1,x2,y2,x3,y3)}function BuildRightTriangle(x,y,width,param){var height=param===void 0?width:param;var x1=x;var y1=y;var x2=x;var y2=y-height;var x3=x+width;var y3=y;return new Triangle(x1,y1,x2,y2,x3,y3)}function GetTriangleCentroid(triangle,param){var out=param===void 0?new Vec2():param;return out.set((triangle.x1+triangle.x2+triangle.x3)/3,(triangle.y1+triangle.y2+triangle.y3)/3)}function TranslateTriangle(triangle,x,y){triangle.x1+=x;triangle.y1+=y;triangle.x2+=x;triangle.y2+=y;triangle.x3+=x;triangle.y3+=y;return triangle}function CenterTriangleOn(triangle,x,y,param){var centerFunc=param===void 0?GetTriangleCentroid:param;var center=centerFunc(triangle);var diffX=x-center.x;var diffY=y-center.y;return TranslateTriangle(triangle,diffX,diffY)}function CloneTriangle(source){var x1=source.x1,y1=source.y1,x2=source.x2,y2=source.y2,x3=source.x3,y3=source.y3;return new Triangle(x1,y1,x2,y2,x3,y3)}function CopyTriangleFrom(source,dest){var x1=source.x1,y1=source.y1,x2=source.x2,y2=source.y2,x3=source.x3,y3=source.y3;return dest.set(x1,y1,x2,y2,x3,y3)}function GetTriangleArea(triangle){var x1=triangle.x1,y1=triangle.y1,x2=triangle.x2,y2=triangle.y2,x3=triangle.x3,y3=triangle.y3;return Math.abs(((x3-x1)*(y2-y1)-(x2-x1)*(y3-y1))/2)}function Det(m00,m01,m10,m11){return m00*m11-m01*m10}function GetTriangleCircumCenter(triangle,param){var out=param===void 0?new Vec2():param;var cx=triangle.x3;var cy=triangle.y3;var ax=triangle.x1-cx;var ay=triangle.y1-cy;var bx=triangle.x2-cx;var by=triangle.y2-cy;var denom=2*Det(ax,ay,bx,by);var numx=Det(ay,ax*ax+ay*ay,by,bx*bx+by*by);var numy=Det(ax,ax*ax+ay*ay,bx,bx*bx+by*by);return out.set(cx-numx/denom,cy+numy/denom)}function GetTriangleCircumCircle(triangle,param){var out=param===void 0?new Circle():param;var x1=triangle.x1,y1=triangle.y1,x2=triangle.x2,y2=triangle.y2,x3=triangle.x3,y3=triangle.y3;var A=x2-x1;var B=y2-y1;var C=x3-x1;var D=y3-y1;var E=A*(x1+x2)+B*(y1+y2);var F=C*(x1+x3)+D*(y1+y3);var G=2*(A*(y3-y2)-B*(x3-x2));if(Math.abs(G)<0.000001){var minX=Math.min(x1,x2,x3);var minY=Math.min(y1,y2,y3);var dx=(Math.max(x1,x2,x3)-minX)*0.5;var dy=(Math.max(y1,y2,y3)-minY)*0.5;return out.set(minX+dx,minY+dy,Math.sqrt(dx*dx+dy*dy))}else{var cx=(D*E-B*F)/G;var cy=(A*F-C*E)/G;var dx=cx-x1;var dy=cy-y1;return out.set(cx,cy,Math.sqrt(dx*dx+dy*dy))}}function GetLength(x1,y1,x2,y2){var x=x1-x2;var y=y1-y2;return Math.sqrt(x*x+y*y)}function GetTriangleInCenter(triangle,param){var out=param===void 0?new Vec2():param;var x1=triangle.x1,y1=triangle.y1,x2=triangle.x2,y2=triangle.y2,x3=triangle.x3,y3=triangle.y3;var d1=GetLength(x3,y3,x2,y2);var d2=GetLength(x1,y1,x3,y3);var d3=GetLength(x2,y2,x1,y1);var p=d1+d2+d3;return out.set((x1*d1+x2*d2+x3*d3)/p,(y1*d1+y2*d2+y3*d3)/p)}function GetTrianglePerimeter(triangle){var ref=GetTriangleEdges(triangle),line1=ref[0],line2=ref[1],line3=ref[2];return GetLineLength(line1)+GetLineLength(line2)+GetLineLength(line3)}function GetTrianglePoint(triangle,position,param){var out=param===void 0?new Vec2():param;var ref=GetTriangleEdges(triangle),line1=ref[0],line2=ref[1],line3=ref[2];if(position<=0||position>=1){return out.set(line1.x1,line1.y1)}var length1=GetLineLength(line1);var length2=GetLineLength(line2);var length3=GetLineLength(line3);var perimeter=length1+length2+length3;var p=perimeter*position;var localPosition=0;if(p<length1){localPosition=p/length1;var x1=line1.x1,y1=line1.y1,x2=line1.x2,y2=line1.y2;return out.set(x1+(x2-x1)*localPosition,y1+(y2-y1)*localPosition)}else if(p>length1+length2){p-=length1+length2;localPosition=p/length3;var x1=line3.x1,y1=line3.y1,x2=line3.x2,y2=line3.y2;return out.set(x1+(x2-x1)*localPosition,y1+(y2-y1)*localPosition)}else{p-=length1;localPosition=p/length2;var x1=line2.x1,y1=line2.y1,x2=line2.x2,y2=line2.y2;return out.set(x1+(x2-x1)*localPosition,y1+(y2-y1)*localPosition)}}function GetTrianglePoints(triangle,quantity,stepRate,param){var out=param===void 0?[]:param;var ref=GetTriangleEdges(triangle),line1=ref[0],line2=ref[1],line3=ref[2];var length1=GetLineLength(line1);var length2=GetLineLength(line2);var length3=GetLineLength(line3);var perimeter=length1+length2+length3;if(!quantity){quantity=perimeter/stepRate}for(var i=0;i<quantity;i++){var p=perimeter*(i/quantity);var localPosition=0;var point=void 0;if(p<length1){localPosition=p/length1;var x1=line1.x1,y1=line1.y1,x2=line1.x2,y2=line1.y2;point=new Vec2(x1+(x2-x1)*localPosition,y1+(y2-y1)*localPosition)}else if(p>length1+length2){p-=length1+length2;localPosition=p/length3;var x1=line3.x1,y1=line3.y1,x2=line3.x2,y2=line3.y2;point=new Vec2(x1+(x2-x1)*localPosition,y1+(y2-y1)*localPosition)}else{p-=length1;localPosition=p/length2;var x1=line2.x1,y1=line2.y1,x2=line2.x2,y2=line2.y2;point=new Vec2(x1+(x2-x1)*localPosition,y1+(y2-y1)*localPosition)}out.push(point)}return out}function GetTriangleRandomPoint(triangle,param){var out=param===void 0?new Vec2():param;var x1=triangle.x1,y1=triangle.y1,x2=triangle.x2,y2=triangle.y2,x3=triangle.x3,y3=triangle.y3;var ux=x2-x1;var uy=y2-y1;var vx=x3-x1;var vy=y3-y1;var r=Math.random();var s=Math.random();if(r+s>=1){r=1-r;s=1-s}return out.set(x1+(ux*r+vx*s),y1+(uy*r+vy*s))}function RotateTriangleAround(triangle,x,y,angle){var x1=triangle.x1,y1=triangle.y1,x2=triangle.x2,y2=triangle.y2,x3=triangle.x3,y3=triangle.y3;var c=Math.cos(angle);var s=Math.sin(angle);return triangle.set((x1-x)*c-(y1-y)*s+x,(x1-x)*s+(y1-y)*c+y,(x2-x)*c-(y2-y)*s+x,(x2-x)*s+(y2-y)*c+y,(x3-x)*c-(y3-y)*s+x,(x3-x)*s+(y3-y)*c+y)}function RotateTriangle(triangle,angle){var point=GetTriangleInCenter(triangle);return RotateTriangleAround(triangle,point.x,point.y,angle)}function RotateTriangleAroundPoint(triangle,point,angle){return RotateTriangleAround(triangle,point.x,point.y,angle)}function TriangleContainsPoint(triangle,point){return TriangleContains(triangle,point.x,point.y)}function TriangleEquals(src,dest){return src.x1===dest.x1&&src.y1===dest.y1&&src.x2===dest.x2&&src.y2===dest.y2&&src.x3===dest.x3&&src.y3===dest.y3}var input_exports2={};__export(input_exports2,{Keyboard:function(){return keyboard_exports},Mouse:function(){return mouse_exports},SetInteractive:function(){return SetInteractive}});var keyboard_exports={};__export(keyboard_exports,{GetKeyDownDuration:function(){return GetKeyDownDuration},Key:function(){return Key},Keyboard:function(){return Keyboard},Keys:function(){return keys_exports},SetKeyRepeatRate:function(){return SetKeyRepeatRate}});var keys_exports={};__export(keys_exports,{AKey:function(){return AKey},ArrowKeys:function(){return ArrowKeys},BKey:function(){return BKey},CKey:function(){return CKey},DKey:function(){return DKey},DownKey:function(){return DownKey},EKey:function(){return EKey},FKey:function(){return FKey},GKey:function(){return GKey},HKey:function(){return HKey},IKey:function(){return IKey},JKey:function(){return JKey},KKey:function(){return KKey},LKey:function(){return LKey},LeftKey:function(){return LeftKey},MKey:function(){return MKey},NKey:function(){return NKey},OKey:function(){return OKey},PKey:function(){return PKey},QKey:function(){return QKey},RKey:function(){return RKey},RightKey:function(){return RightKey},SKey:function(){return SKey},SpaceKey:function(){return SpaceKey},TKey:function(){return TKey},UKey:function(){return UKey},UpKey:function(){return UpKey},VKey:function(){return VKey},WASDKeys:function(){return WASDKeys},WKey:function(){return WKey},XKey:function(){return XKey},YKey:function(){return YKey},ZKey:function(){return ZKey}});var Key=function(){"use strict";function _class(value){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"value",void 0);swcHelpers.defineProperty(this,"events",void 0);swcHelpers.defineProperty(this,"capture",true);swcHelpers.defineProperty(this,"isDown",false);swcHelpers.defineProperty(this,"enabled",true);swcHelpers.defineProperty(this,"repeatRate",0);swcHelpers.defineProperty(this,"canRepeat",true);swcHelpers.defineProperty(this,"timeDown",0);swcHelpers.defineProperty(this,"timeUpdated",0);swcHelpers.defineProperty(this,"timeUp",0);swcHelpers.defineProperty(this,"shiftKey",void 0);swcHelpers.defineProperty(this,"ctrlKey",void 0);swcHelpers.defineProperty(this,"altKey",void 0);swcHelpers.defineProperty(this,"downCallback",void 0);swcHelpers.defineProperty(this,"upCallback",void 0);this.value=value;this.events=new Map()}swcHelpers.createClass(_class,[{key:"getValue",value:function getValue(){return this.value}},{key:"down",value:function down(event){if(!this.enabled){return}if(this.capture){event.preventDefault()}this.shiftKey=event.shiftKey;this.ctrlKey=event.ctrlKey;this.altKey=event.altKey;if(this.isDown&&this.canRepeat){this.timeUpdated=event.timeStamp;var delay=this.timeUpdated-this.timeDown;if(delay>=this.repeatRate){Emit(this,"keydown",this);if(this.downCallback){this.downCallback(this)}}}else{this.isDown=true;this.timeDown=event.timeStamp;this.timeUpdated=event.timeStamp;Emit(this,"keydown",this);if(this.downCallback){this.downCallback(this)}}}},{key:"up",value:function up(event){if(!this.enabled){return}if(this.capture){event.preventDefault()}this.shiftKey=event.shiftKey;this.ctrlKey=event.ctrlKey;this.altKey=event.altKey;if(this.isDown){this.isDown=false;this.timeUp=event.timeStamp;this.timeUpdated=event.timeStamp;Emit(this,"keyup",this);if(this.upCallback){this.upCallback(this)}}}},{key:"reset",value:function reset(){this.isDown=false;this.timeUpdated=this.timeDown;this.timeUp=this.timeDown}},{key:"destroy",value:function destroy(){this.downCallback=null;this.upCallback=null;this.events.clear()}}]);return _class}();var AKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"a"))}return _class}(Key);var ArrowKeys=function _class(keyboardManager,config){"use strict";swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"left",void 0);swcHelpers.defineProperty(this,"right",void 0);swcHelpers.defineProperty(this,"up",void 0);swcHelpers.defineProperty(this,"down",void 0);swcHelpers.defineProperty(this,"space",void 0);var _left=config.left,left=_left===void 0?true:_left,_right=config.right,right=_right===void 0?true:_right,_up=config.up,up=_up===void 0?true:_up,_down=config.down,down=_down===void 0?true:_down,_space=config.space,space=_space===void 0?true:_space;var keys=keyboardManager.keys;if(left){this.left=new Key("ArrowLeft");keys.set(this.left.value,this.left)}if(right){this.right=new Key("ArrowRight");keys.set(this.right.value,this.right)}if(up){this.up=new Key("ArrowUp");keys.set(this.up.value,this.up)}if(down){this.down=new Key("ArrowDown");keys.set(this.down.value,this.down)}if(space){this.space=new Key(" ");keys.set(this.space.value,this.space)}};var BKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"b"))}return _class}(Key);var CKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"c"))}return _class}(Key);var DKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"d"))}return _class}(Key);var DownKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"ArrowDown"))}return _class}(Key);var EKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"e"))}return _class}(Key);var FKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"f"))}return _class}(Key);var GKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"g"))}return _class}(Key);var HKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"h"))}return _class}(Key);var IKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"i"))}return _class}(Key);var JKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"j"))}return _class}(Key);var KKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"k"))}return _class}(Key);var LKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"l"))}return _class}(Key);var LeftKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"ArrowLeft"))}return _class}(Key);var MKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"m"))}return _class}(Key);var NKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"n"))}return _class}(Key);var OKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"o"))}return _class}(Key);var PKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"p"))}return _class}(Key);var QKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"q"))}return _class}(Key);var RKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"r"))}return _class}(Key);var RightKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"ArrowRight"))}return _class}(Key);var SKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"s"))}return _class}(Key);var SpaceKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this," "))}return _class}(Key);var TKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"t"))}return _class}(Key);var UKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"u"))}return _class}(Key);var UpKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"ArrowUp"))}return _class}(Key);var VKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"v"))}return _class}(Key);var WASDKeys=function _class(keyboardManager,config){"use strict";swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"W",void 0);swcHelpers.defineProperty(this,"A",void 0);swcHelpers.defineProperty(this,"S",void 0);swcHelpers.defineProperty(this,"D",void 0);swcHelpers.defineProperty(this,"space",void 0);var _W=config.W,W=_W===void 0?true:_W,_A=config.A,A=_A===void 0?true:_A,_S=config.S,S=_S===void 0?true:_S,_D=config.D,D=_D===void 0?true:_D,_space=config.space,space=_space===void 0?true:_space;var keys=keyboardManager.keys;if(W){this.W=new Key("w");keys.set(this.W.value,this.W)}if(A){this.A=new Key("a");keys.set(this.A.value,this.A)}if(S){this.S=new Key("s");keys.set(this.S.value,this.S)}if(D){this.D=new Key("d");keys.set(this.D.value,this.D)}if(space){this.space=new Key(" ");keys.set(this.space.value,this.space)}};var WKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"w"))}return _class}(Key);var XKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"x"))}return _class}(Key);var YKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"y"))}return _class}(Key);var ZKey=function(Key){"use strict";swcHelpers.inherits(_class,Key);function _class(){swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,"z"))}return _class}(Key);function GetKeyDownDuration(key){if(key.isDown){return key.timeUpdated-key.timeDown}else{return key.timeUp-key.timeDown}}var Keyboard=function(EventEmitter){"use strict";swcHelpers.inherits(_class,EventEmitter);function _class(){swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"keys",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"keydownHandler",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"keyupHandler",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"blurHandler",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"keyConversion",{Up:"ArrowUp",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Spacebar:" ",Win:"Meta",Scroll:"ScrollLock",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Add:"+",Subtract:"-",Multiply:"*",Decimal:".",Divide:"/"});_this.keydownHandler=function(event){return _this.onKeyDown(event)};_this.keyupHandler=function(event){return _this.onKeyUp(event)};_this.blurHandler=function(){return _this.onBlur()};window.addEventListener("keydown",_this.keydownHandler);window.addEventListener("keyup",_this.keyupHandler);window.addEventListener("blur",_this.blurHandler);_this.keys=new Map();return _this}swcHelpers.createClass(_class,[{key:"addKeys",value:function addKeys(){for(var _len=arguments.length,keys=new Array(_len),_key=0;_key<_len;_key++){keys[_key]=arguments[_key]}var _this=this;keys.forEach(function(key){_this.keys.set(key.getValue(),key)})}},{key:"clearKeys",value:function clearKeys(){this.keys.clear()}},{key:"onBlur",value:function onBlur(){this.keys.forEach(function(key){key.reset()})}},{key:"getKeyValue",value:function getKeyValue(key){if(this.keyConversion.hasOwnProperty(key)){return this.keyConversion[key]}else{return key}}},{key:"onKeyDown",value:function onKeyDown(event){var value=this.getKeyValue(event.key);if(this.keys.has(value)){var key=this.keys.get(value);key.down(event)}Emit(this,"keydown-"+value,event);Emit(this,"keydown",event)}},{key:"onKeyUp",value:function onKeyUp(event){var value=this.getKeyValue(event.key);if(this.keys.has(value)){var key=this.keys.get(value);key.up(event)}Emit(this,"keyup-"+value,event);Emit(this,"keyup",event)}},{key:"destroy",value:function destroy(){window.removeEventListener("keydown",this.keydownHandler);window.removeEventListener("keyup",this.keyupHandler);window.removeEventListener("blur",this.blurHandler);Emit(this,"destroy")}}]);return _class}(EventEmitter);function SetKeyRepeatRate(rate){for(var _len=arguments.length,keys=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){keys[_key-1]=arguments[_key]}keys.forEach(function(key){key.repeatRate=rate});return keys}var mouse_exports={};__export(mouse_exports,{Mouse:function(){return Mouse}});var Mouse=function(EventEmitter){"use strict";swcHelpers.inherits(_class,EventEmitter);function _class(target){swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"primaryDown",false);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"auxDown",false);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"secondaryDown",false);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"blockContextMenu",true);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"localPoint",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"hitPoint",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"target",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"resolution",1);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"mousedownHandler",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"mouseupHandler",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"mousemoveHandler",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"mousewheelHandler",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"contextmenuHandler",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"blurHandler",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"transPoint",void 0);_this.mousedownHandler=function(event){return _this.onMouseDown(event)};_this.mouseupHandler=function(event){return _this.onMouseUp(event)};_this.mousemoveHandler=function(event){return _this.onMouseMove(event)};_this.mousewheelHandler=function(event){return _this.onMouseWheel(event)};_this.contextmenuHandler=function(event){return _this.onContextMenuEvent(event)};_this.blurHandler=function(){return _this.onBlur()};_this.localPoint=new Vec2();_this.hitPoint=new Vec2();_this.transPoint=new Vec2();if(!target){target=RendererInstance.get().canvas}target.addEventListener("mousedown",_this.mousedownHandler);target.addEventListener("mouseup",_this.mouseupHandler);target.addEventListener("wheel",_this.mousewheelHandler,{passive:false});target.addEventListener("contextmenu",_this.contextmenuHandler);window.addEventListener("mouseup",_this.mouseupHandler);window.addEventListener("mousemove",_this.mousemoveHandler);window.addEventListener("blur",_this.blurHandler);_this.target=target;return _this}swcHelpers.createClass(_class,[{key:"onBlur",value:function onBlur(){}},{key:"onMouseDown",value:function onMouseDown(event){this.positionToPoint(event);this.primaryDown=event.button===0;this.auxDown=event.button===1;this.secondaryDown=event.button===2;Emit(this,"pointerdown",this.localPoint.x,this.localPoint.y,event.button,event)}},{key:"onMouseUp",value:function onMouseUp(event){this.positionToPoint(event);this.primaryDown=!(event.button===0);this.auxDown=!(event.button===1);this.secondaryDown=!(event.button===2);Emit(this,"pointerup",this.localPoint.x,this.localPoint.y,event.button,event)}},{key:"onMouseMove",value:function onMouseMove(event){this.positionToPoint(event);Emit(this,"pointermove",this.localPoint.x,this.localPoint.y,event)}},{key:"onMouseWheel",value:function onMouseWheel(event){Emit(this,"wheel",event.deltaX,event.deltaY,event.deltaZ,event)}},{key:"onContextMenuEvent",value:function onContextMenuEvent(event){if(this.blockContextMenu){event.preventDefault()}Emit(this,"contextmenu",event)}},{key:"positionToPoint",value:function positionToPoint(event){return this.localPoint.set(event.offsetX,event.offsetY)}},{key:"shutdown",value:function shutdown(){var target=this.target;target.removeEventListener("mousedown",this.mousedownHandler);target.removeEventListener("mouseup",this.mouseupHandler);target.removeEventListener("wheel",this.mousewheelHandler);target.removeEventListener("contextmenu",this.contextmenuHandler);window.removeEventListener("mouseup",this.mouseupHandler);window.removeEventListener("mousemove",this.mousemoveHandler);window.removeEventListener("blur",this.blurHandler)}}]);return _class}(EventEmitter);function SetInteractive(){for(var _len=arguments.length,children=new Array(_len),_key=0;_key<_len;_key++){children[_key]=arguments[_key]}children.forEach(function(child){});return children}var loader_exports={};__export(loader_exports,{File:function(){return File},Files:function(){return files_exports},Loader:function(){return Loader}});var files_exports={};__export(files_exports,{AtlasFile:function(){return AtlasFile},BinaryFile:function(){return BinaryFile},BitmapTextFile:function(){return BitmapTextFile},CSVFile:function(){return CSVFile},ImageFile:function(){return ImageFile},JSONFile:function(){return JSONFile},JSONGeometryFile:function(){return JSONGeometryFile},LoadAtlasFile:function(){return LoadAtlasFile},LoadBinaryFile:function(){return LoadBinaryFile},LoadBitmapTextFile:function(){return LoadBitmapTextFile},LoadCSVFile:function(){return LoadCSVFile},LoadImageFile:function(){return LoadImageFile},LoadJSONFile:function(){return LoadJSONFile},LoadOBJFile:function(){return LoadOBJFile},LoadSpriteSheetFile:function(){return LoadSpriteSheetFile},LoadTextureFile:function(){return LoadTextureFile},LoadXMLFile:function(){return LoadXMLFile},OBJFile:function(){return OBJFile},OBJGeometryFile:function(){return OBJGeometryFile},SpriteSheetFile:function(){return SpriteSheetFile},TextureFile:function(){return TextureFile},XMLFile:function(){return XMLFile}});function CreateFile(key,url,param){var skipCache=param===void 0?false:param;return{key:key,url:url,skipCache:skipCache}}function IsAbsoluteURI(url){return/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/.test(url)}function GetURL(key,url,extension,loader){if(!url){url="".concat(key,".").concat(extension)}if(IsAbsoluteURI(url)){return url}else if(loader){return"".concat(loader.baseURL).concat(loader.path).concat(url)}else{return url}}function _RequestFile(){_RequestFile=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(file,preload,onload,fileData){var request;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:if(preload(file)){_ctx.next=2;break}return _ctx.abrupt("return",Promise.reject(file));case 2:_ctx.prev=2;request=new Request(file.url,fileData===null||fileData===void 0?void 0:fileData.requestInit);_ctx.next=6;return fetch(request);case 6:file.response=_ctx.sent;_ctx.t0=file.response.ok;if(!_ctx.t0){_ctx.next=12;break}_ctx.next=11;return onload(file);case 11:_ctx.t0=_ctx.sent;case 12:if(!_ctx.t0){_ctx.next=16;break}return _ctx.abrupt("return",Promise.resolve(file));case 16:return _ctx.abrupt("return",Promise.reject(file));case 17:_ctx.next=23;break;case 19:_ctx.prev=19;_ctx.t1=_ctx["catch"](2);file.error=_ctx.t1;return _ctx.abrupt("return",Promise.reject(file));case 23:case"end":return _ctx.stop()}},_callee,null,[[2,19]])}));return _RequestFile.apply(this,arguments)}function RequestFile(file,preload,onload,fileData){return _RequestFile.apply(this,arguments)}function ImageFile(key,url,param){var fileData=param===void 0?{}:param;return function(loader){var file=CreateFile(key,GetURL(key,url,"png",loader),fileData===null||fileData===void 0?void 0:fileData.skipCache);var textureManager=TextureManagerInstance.get();var preload=function(){return textureManager&&(!textureManager.has(key)||!textureManager.get(key).locked)};var onload=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(file2){var blob,image;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:_ctx.next=2;return file2.response.blob();case 2:blob=_ctx.sent;if(!(window&&"createImageBitmap"in window&&!(fileData===null||fileData===void 0?void 0:fileData.getImage))){_ctx.next=10;break}_ctx.next=7;return createImageBitmap(blob);case 7:image=_ctx.sent;_ctx.next=13;break;case 10:_ctx.next=12;return new Promise(function(resolve,reject){var url2=URL.createObjectURL(blob);var img=new Image();img.onload=function(){URL.revokeObjectURL(url2);resolve(img)};img.onerror=function(){reject()};img.src=url2;if(img.complete&&img.width&&img.height){img.onload=null;img.onerror=null;resolve(img)}});case 12:image=_ctx.sent;case 13:if(image){_ctx.next=15;break}return _ctx.abrupt("return",false);case 15:if(fileData.skipCache){file2.data=image}else if(textureManager.has(key)){file2.data=textureManager.update(key,image,fileData===null||fileData===void 0?void 0:fileData.glConfig)}else{file2.data=textureManager.add(key,image,fileData===null||fileData===void 0?void 0:fileData.glConfig)}return _ctx.abrupt("return",true);case 17:case"end":return _ctx.stop()}},_callee)}));return RequestFile(file,preload,onload,fileData)}}var caches=new Map();var Cache={get:function(type){if(!caches.has(type)){caches.set(type,new Map())}return caches.get(type)},getEntry:function(cache,entry){if(caches.has(cache)){return caches.get(cache).get(entry)}}};function JSONFile(key,url,param){var fileData=param===void 0?{}:param;return function(loader){var file=CreateFile(key,GetURL(key,url,"json",loader),fileData.skipCache);var cache=Cache.get("JSON");var preload=function(file2){return cache&&(!cache.has(key)||!file2.skipCache)};var onload=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(file2){return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:_ctx.next=2;return file2.response.json();case 2:file2.data=_ctx.sent;if(!file2.skipCache){cache.set(key,file2.data)}return _ctx.abrupt("return",true);case 5:case"end":return _ctx.stop()}},_callee)}));return RequestFile(file,preload,onload,fileData)}}function AtlasFile(key,textureURL,atlasURL,param){var fileData=param===void 0?{}:param;return swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(loader){var loadImage,loadJSON,image,json;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:_ctx.prev=0;loadImage=ImageFile(key,textureURL,Object.assign({},fileData,{skipCache:false}));loadJSON=JSONFile(key,atlasURL,Object.assign({},fileData,{skipCache:true}));_ctx.next=5;return loadImage(loader);case 5:image=_ctx.sent;_ctx.next=8;return loadJSON(loader);case 8:json=_ctx.sent;AtlasParser(GetTexture(key),json.data);return _ctx.abrupt("return",Promise.resolve(image));case 13:_ctx.prev=13;_ctx.t0=_ctx["catch"](0);return _ctx.abrupt("return",Promise.reject());case 16:case"end":return _ctx.stop()}},_callee,null,[[0,13]])}))}function BinaryFile(key,url,param){var fileData=param===void 0?{}:param;return function(loader){var file=CreateFile(key,GetURL(key,url,"bin",loader),fileData.skipCache);var cache=Cache.get("Binary");var preload=function(file2){return cache&&(!cache.has(key)||!file2.skipCache)};var onload=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(file2){return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:_ctx.next=2;return file2.response.arrayBuffer();case 2:file2.data=_ctx.sent;if(!file2.skipCache){cache.set(key,file2.data)}return _ctx.abrupt("return",true);case 5:case"end":return _ctx.stop()}},_callee)}));return RequestFile(file,preload,onload,fileData)}}function XMLFile(key,url,param){var fileData=param===void 0?{}:param;return function(loader){var file=CreateFile(key,GetURL(key,url,"xml",loader),fileData.skipCache);var cache=Cache.get("XML");var preload=function(file2){return cache&&(!cache.has(key)||!file2.skipCache)};var onload=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(file2){var data,xml;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:_ctx.next=2;return file2.response.text();case 2:data=_ctx.sent;xml=ParseXML(data);if(!(xml!==null)){_ctx.next=10;break}file2.data=xml;if(!file2.skipCache){cache.set(key,xml)}return _ctx.abrupt("return",true);case 10:return _ctx.abrupt("return",false);case 11:case"end":return _ctx.stop()}},_callee)}));return RequestFile(file,preload,onload,fileData)}}function BitmapTextFile(key,textureURL,fontDataURL,param){var fileData=param===void 0?{}:param;return swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(loader){var loadImage,loadXML,image,xml,texture,fontData;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:_ctx.prev=0;loadImage=ImageFile(key,textureURL,Object.assign({},fileData,{skipCache:false}));loadXML=XMLFile(key,fontDataURL,Object.assign({},fileData,{skipCache:true}));_ctx.next=5;return loadImage(loader);case 5:image=_ctx.sent;_ctx.next=8;return loadXML(loader);case 8:xml=_ctx.sent;texture=GetTexture(key);fontData=BitmapTextParser(texture,xml.data);texture.data=fontData;return _ctx.abrupt("return",Promise.resolve(image));case 15:_ctx.prev=15;_ctx.t0=_ctx["catch"](0);return _ctx.abrupt("return",Promise.reject());case 18:case"end":return _ctx.stop()}},_callee,null,[[0,15]])}))}function CSVFile(key,url,param){var fileData=param===void 0?{}:param;return function(loader){var file=CreateFile(key,GetURL(key,url,"csv",loader),fileData.skipCache);var cache=Cache.get("CSV");var preload=function(file2){return cache&&(!cache.has(key)||!file2.skipCache)};var onload=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(file2){return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:_ctx.next=2;return file2.response.text();case 2:file2.data=_ctx.sent;if(!file2.skipCache){cache.set(key,file2.data)}return _ctx.abrupt("return",true);case 5:case"end":return _ctx.stop()}},_callee)}));return RequestFile(file,preload,onload,fileData)}}var File=function _class(key,url,config){"use strict";swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"key",void 0);swcHelpers.defineProperty(this,"url",void 0);swcHelpers.defineProperty(this,"responseType","text");swcHelpers.defineProperty(this,"crossOrigin",void 0);swcHelpers.defineProperty(this,"data",void 0);swcHelpers.defineProperty(this,"error",void 0);swcHelpers.defineProperty(this,"config",void 0);swcHelpers.defineProperty(this,"skipCache",false);swcHelpers.defineProperty(this,"hasLoaded",false);swcHelpers.defineProperty(this,"loader",void 0);swcHelpers.defineProperty(this,"load",void 0);this.key=key;this.url=url;this.config=config};function GetVec3(data,index){var x=data[index*3+0];var y=data[index*3+1];var z=data[index*3+2];return[x,y,z]}function GetVec2(data,index){var x=data[index*2+0];var y=data[index*2+1];return[x,y]}function CreateNonIndexedVertexBuffer(data){var vertices=data.vertices,normals=data.normals,uvs=data.uvs;var total=vertices.length;var count=total/3;var batchSize=count/3;var buffer=new VertexBuffer({batchSize:batchSize,isDynamic:false,vertexElementSize:8,elementsPerEntry:3});var F32=buffer.vertexViewF32;var offset=0;var uvIndex=0;for(var i=0;i<total;i+=3){F32[offset++]=vertices[i+0];F32[offset++]=vertices[i+1];F32[offset++]=vertices[i+2];F32[offset++]=normals[i+0];F32[offset++]=normals[i+1];F32[offset++]=normals[i+2];F32[offset++]=uvs[uvIndex+0];F32[offset++]=uvs[uvIndex+1];uvIndex+=2}buffer.count=count;return buffer}function CreateVertexBuffer(data){var vertices=data.vertices,normals=data.normals,uvs=data.uvs,indices=data.indices;var buffer=new VertexBuffer({batchSize:indices.length/3,isDynamic:false,vertexElementSize:8,elementsPerEntry:3});var F32=buffer.vertexViewF32;var offset=0;for(var i=0;i<indices.length;i+=3){var i1=indices[i+0];var i2=indices[i+1];var i3=indices[i+2];var v1=GetVec3(vertices,i1);var v2=GetVec3(vertices,i2);var v3=GetVec3(vertices,i3);var n1=GetVec3(normals,i1);var n2=GetVec3(normals,i2);var n3=GetVec3(normals,i3);var uv1=GetVec2(uvs,i1);var uv2=GetVec2(uvs,i2);var uv3=GetVec2(uvs,i3);F32[offset++]=v1[0];F32[offset++]=v1[1];F32[offset++]=v1[2];F32[offset++]=n1[0];F32[offset++]=n1[1];F32[offset++]=n1[2];F32[offset++]=uv1[0];F32[offset++]=uv1[1];F32[offset++]=v2[0];F32[offset++]=v2[1];F32[offset++]=v2[2];F32[offset++]=n2[0];F32[offset++]=n2[1];F32[offset++]=n2[2];F32[offset++]=uv2[0];F32[offset++]=uv2[1];F32[offset++]=v3[0];F32[offset++]=v3[1];F32[offset++]=v3[2];F32[offset++]=n3[0];F32[offset++]=n3[1];F32[offset++]=n3[2];F32[offset++]=uv3[0];F32[offset++]=uv3[1]}buffer.count=indices.length;return buffer}function GetBufferFromVertexSet(data){if(data.indices&&data.indices.length>0){return CreateVertexBuffer(data)}else{return CreateNonIndexedVertexBuffer(data)}}var Geometry=function(){"use strict";function _class(data){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"buffer",void 0);if(data){if(data.hasOwnProperty("vertices")){this.buffer=GetBufferFromVertexSet(data)}else{this.buffer=data}}}swcHelpers.createClass(_class,[{key:"destroy",value:function destroy(){this.buffer.destroy()}}]);return _class}();function XHRLoader(file){var xhr=new XMLHttpRequest();xhr.open("GET",file.url,true);xhr.responseType=file.responseType;return new Promise(function(resolve,reject){xhr.onload=function(){var type=file.responseType;file.data=type==="text"||type===""?xhr.responseText:xhr.response;file.hasLoaded=true;resolve(file)};xhr.onerror=function(){file.hasLoaded=true;reject(file)};xhr.send()})}function JSONGeometryFile(key,url,mappingConfig){var file=new File(key,url);var _vertices=mappingConfig.vertices,vertices=_vertices===void 0?"verts":_vertices,_normals=mappingConfig.normals,normals=_normals===void 0?"normals":_normals,_uvs=mappingConfig.uvs,uvs=_uvs===void 0?"uvs":_uvs,_numberOfVertices=mappingConfig.numberOfVertices,numberOfVertices=_numberOfVertices===void 0?0:_numberOfVertices;file.load=function(){file.url=GetURL(file.key,file.url,".json",file.loader);return new Promise(function(resolve,reject){var cache=Cache.get("Geometry");if(!file.skipCache&&cache.has(file.key)){resolve(file)}else{XHRLoader(file).then(function(file2){var data=JSON.parse(file2.data);var geom=new Geometry({vertices:data[vertices],normals:data[normals],uvs:data[uvs],numberOfVertices:numberOfVertices});file2.data=geom;if(!file2.skipCache){cache.set(file2.key,geom)}resolve(file2)}).catch(function(file2){reject(file2)})}})};return file}function _LoadAtlasFile(){_LoadAtlasFile=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(key,textureURL,atlasURL,param){var fileData=param===void 0?{}:param;var load;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:load=AtlasFile(key,textureURL,atlasURL,fileData);return _ctx.abrupt("return",load());case 2:case"end":return _ctx.stop()}},_callee)}));return _LoadAtlasFile.apply(this,arguments)}function LoadAtlasFile(key,textureURL,atlasURL){return _LoadAtlasFile.apply(this,arguments)}function _LoadBinaryFile(){_LoadBinaryFile=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(key,url,param){var fileData=param===void 0?{}:param;var load;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:load=BinaryFile(key,url,fileData);return _ctx.abrupt("return",load());case 2:case"end":return _ctx.stop()}},_callee)}));return _LoadBinaryFile.apply(this,arguments)}function LoadBinaryFile(key,url){return _LoadBinaryFile.apply(this,arguments)}function _LoadBitmapTextFile(){_LoadBitmapTextFile=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(key,textureURL,fontDataURL,param){var fileData=param===void 0?{}:param;var load;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:load=BitmapTextFile(key,textureURL,fontDataURL,fileData);return _ctx.abrupt("return",load());case 2:case"end":return _ctx.stop()}},_callee)}));return _LoadBitmapTextFile.apply(this,arguments)}function LoadBitmapTextFile(key,textureURL,fontDataURL){return _LoadBitmapTextFile.apply(this,arguments)}function _LoadCSVFile(){_LoadCSVFile=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(key,url,param){var fileData=param===void 0?{}:param;var load;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:load=CSVFile(key,url,fileData);return _ctx.abrupt("return",load());case 2:case"end":return _ctx.stop()}},_callee)}));return _LoadCSVFile.apply(this,arguments)}function LoadCSVFile(key,url){return _LoadCSVFile.apply(this,arguments)}function _LoadImageFile(){_LoadImageFile=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(key,url,param){var fileData=param===void 0?{}:param;var load;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:load=ImageFile(key,url,fileData);return _ctx.abrupt("return",load());case 2:case"end":return _ctx.stop()}},_callee)}));return _LoadImageFile.apply(this,arguments)}function LoadImageFile(key,url){return _LoadImageFile.apply(this,arguments)}function _LoadJSONFile(){_LoadJSONFile=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(key,url,param){var fileData=param===void 0?{}:param;var load;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:load=JSONFile(key,url,fileData);return _ctx.abrupt("return",load());case 2:case"end":return _ctx.stop()}},_callee)}));return _LoadJSONFile.apply(this,arguments)}function LoadJSONFile(key,url){return _LoadJSONFile.apply(this,arguments)}function OBJFile(key,url,param){var fileData=param===void 0?{}:param;return function(loader){var file=CreateFile(key,GetURL(key,url,"obj",loader),fileData.skipCache);var cache=Cache.get("OBJ");var preload=function(file2){return cache&&(!cache.has(key)||!file2.skipCache)};var onload=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(file2){return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:_ctx.next=2;return file2.response.text();case 2:file2.data=_ctx.sent;if(!file2.skipCache){cache.set(key,file2.data)}return _ctx.abrupt("return",true);case 5:case"end":return _ctx.stop()}},_callee)}));return RequestFile(file,preload,onload,fileData)}}function _LoadOBJFile(){_LoadOBJFile=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(key,url,param){var fileData=param===void 0?{}:param;var load;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:load=OBJFile(key,url,fileData);return _ctx.abrupt("return",load());case 2:case"end":return _ctx.stop()}},_callee)}));return _LoadOBJFile.apply(this,arguments)}function LoadOBJFile(key,url){return _LoadOBJFile.apply(this,arguments)}function SpriteSheetFile(key,url,frameConfig,param){var fileData=param===void 0?{}:param;return swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(loader){var load,file,texture;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:_ctx.prev=0;load=ImageFile(key,url,Object.assign({},fileData,{skipCache:false}));_ctx.next=4;return load(loader);case 4:file=_ctx.sent;texture=GetTexture(key);if(texture){SpriteSheetParser(texture,0,0,texture.width,texture.height,frameConfig)}return _ctx.abrupt("return",Promise.resolve(file));case 10:_ctx.prev=10;_ctx.t0=_ctx["catch"](0);return _ctx.abrupt("return",Promise.reject());case 13:case"end":return _ctx.stop()}},_callee,null,[[0,10]])}))}function _LoadSpriteSheetFile(){_LoadSpriteSheetFile=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(key,url,frameConfig,param){var fileData=param===void 0?{}:param;var load;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:load=SpriteSheetFile(key,url,frameConfig,fileData);return _ctx.abrupt("return",load());case 2:case"end":return _ctx.stop()}},_callee)}));return _LoadSpriteSheetFile.apply(this,arguments)}function LoadSpriteSheetFile(key,url,frameConfig){return _LoadSpriteSheetFile.apply(this,arguments)}function GetCompressedTextureName(baseFormat,format){var renderer=WebGLRendererInstance.get();if(renderer){var supportedFormats=renderer.compression[baseFormat.toUpperCase()];if(format in supportedFormats){return supportedFormats[format]}}}function SupportsCompressedTexture(baseFormat,format){var renderer=WebGLRendererInstance.get();if(renderer){var supportedFormats=renderer.compression[baseFormat.toUpperCase()];if(supportedFormats){if(format){return format in supportedFormats}else{return true}}}return false}function TextureFile(key,urls,param){var fileData=param===void 0?{}:param;if(!fileData.glConfig){fileData.glConfig={}}var entry={format:null,type:null,textureURL:null,atlasURL:null};for(var textureBaseFormat in urls){if(SupportsCompressedTexture(textureBaseFormat)){var urlEntry=urls[textureBaseFormat];if(typeof urlEntry==="string"){entry.textureURL=urlEntry}else{Object.assign(entry,urlEntry)}entry.format=textureBaseFormat.toUpperCase();break}}if(!entry){console.warn("TextureFile: ".concat(key," = No supported format or IMG fallback"));return}if(entry.format==="IMG"){if(entry.atlasURL){return AtlasFile(key,entry.textureURL,entry.atlasURL,fileData)}else{return ImageFile(key,entry.textureURL,fileData)}}return swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(loader){var loadImage,image,json,loadJSON,textureData,texture,textureManager;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:_ctx.prev=0;loadImage=BinaryFile(key,entry.textureURL,Object.assign({},fileData,{skipCache:true}));_ctx.next=4;return loadImage(loader);case 4:image=_ctx.sent;if(!entry.atlasURL){_ctx.next=11;break}loadJSON=JSONFile(key,entry.atlasURL,Object.assign({},fileData,{skipCache:true}));_ctx.next=10;return loadJSON(loader);case 10:json=_ctx.sent;case 11:if(!entry.type){entry.type=image.url.endsWith(".ktx")?"KTX":"PVR"};if(entry.type==="PVR"){textureData=PVRParser(image.data)}else if(entry.type==="KTX"){textureData=KTXParser(image.data)}if(!(textureData&&SupportsCompressedTexture(entry.format,textureData.internalFormat))){_ctx.next=24;break}textureData.format=GetCompressedTextureName(entry.format,textureData.internalFormat);texture=new Texture(null,textureData.width,textureData.height,Object.assign(fileData.glConfig,textureData));textureManager=TextureManagerInstance.get();textureManager.add(key,texture);ProcessBindingQueue();if(json&&json.data){AtlasParser(texture,json.data)}return _ctx.abrupt("return",Promise.resolve(image));case 24:return _ctx.abrupt("return",Promise.reject());case 25:_ctx.next=30;break;case 27:_ctx.prev=27;_ctx.t0=_ctx["catch"](0);return _ctx.abrupt("return",Promise.reject());case 30:case"end":return _ctx.stop()}},_callee,null,[[0,27]])}))}function _LoadTextureFile(){_LoadTextureFile=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(key,urls,param){var fileData=param===void 0?{}:param;var load;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:load=TextureFile(key,urls,fileData);return _ctx.abrupt("return",load());case 2:case"end":return _ctx.stop()}},_callee)}));return _LoadTextureFile.apply(this,arguments)}function LoadTextureFile(key,urls){return _LoadTextureFile.apply(this,arguments)}function _LoadXMLFile(){_LoadXMLFile=swcHelpers.asyncToGenerator(_regeneratorRuntime.default.mark(function _callee(key,url,param){var fileData=param===void 0?{}:param;var load;return _regeneratorRuntime.default.wrap(function _callee$(_ctx){while(1)switch(_ctx.prev=_ctx.next){case 0:load=XMLFile(key,url,fileData);return _ctx.abrupt("return",load());case 2:case"end":return _ctx.stop()}},_callee)}));return _LoadXMLFile.apply(this,arguments)}function LoadXMLFile(key,url){return _LoadXMLFile.apply(this,arguments)}var ParseObj=function(){"use strict";function _class(fileContents,param,param1){var flipUVs=param===void 0?true:param,defaultModelName=param1===void 0?"untitled":param1;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"fileContents",void 0);swcHelpers.defineProperty(this,"defaultModelName",void 0);swcHelpers.defineProperty(this,"currentMaterial","");swcHelpers.defineProperty(this,"currentGroup","");swcHelpers.defineProperty(this,"smoothingGroup",0);swcHelpers.defineProperty(this,"result",{materialLibraries:[],models:[]});swcHelpers.defineProperty(this,"flipUVs",void 0);this.fileContents=fileContents;this.defaultModelName=defaultModelName;this.flipUVs=flipUVs}swcHelpers.createClass(_class,[{key:"parseAsync",value:function parseAsync(){var _this=this;return new Promise(function(resolve,reject){try{resolve(_this.parse())}catch(theError){reject(theError)}})}},{key:"parse",value:function parse(){var stripComments=function(line){var commentIndex=line.indexOf("#");if(commentIndex> -1){return line.substring(0,commentIndex)}return line};var lines=this.fileContents.split("\n");for(var _i=0;_i<lines.length;_i++){var line=lines[_i];var strippedline=stripComments(line);var lineItems=strippedline.replace(/\s\s+/g," ").trim().split(" ");switch(lineItems[0].toLowerCase()){case"o":this.parseObject(lineItems);break;case"g":this.parseGroup(lineItems);break;case"v":this.parseVertexCoords(lineItems);break;case"vt":this.parseTextureCoords(lineItems);break;case"vn":this.parseVertexNormal(lineItems);break;case"s":this.parseSmoothShadingStatement(lineItems);break;case"f":this.parsePolygon(lineItems);break;case"mtllib":this.parseMtlLib(lineItems);break;case"usemtl":this.parseUseMtl(lineItems);break}}this.fileContents="";return this.result}},{key:"currentModel",value:function currentModel(){if(this.result.models.length===0){this.result.models.push({faces:[],name:this.defaultModelName,textureCoords:[],vertexNormals:[],vertices:[]});this.currentGroup="";this.smoothingGroup=0}return this.result.models[this.result.models.length-1]}},{key:"parseObject",value:function parseObject(lineItems){var modelName=lineItems.length>=2?lineItems[1]:this.defaultModelName;this.result.models.push({faces:[],name:modelName,textureCoords:[],vertexNormals:[],vertices:[]});this.currentGroup="";this.smoothingGroup=0}},{key:"parseGroup",value:function parseGroup(lineItems){if(lineItems.length!==2){throw"Group statements must have exactly 1 argument (eg. g group_1)"}this.currentGroup=lineItems[1]}},{key:"parseVertexCoords",value:function parseVertexCoords(lineItems){var len=lineItems.length;var x=len>=2?parseFloat(lineItems[1]):0;var y=len>=3?parseFloat(lineItems[2]):0;var z=len>=4?parseFloat(lineItems[3]):0;this.currentModel().vertices.push({x:x,y:y,z:z})}},{key:"parseTextureCoords",value:function parseTextureCoords(lineItems){var len=lineItems.length;var u=len>=2?parseFloat(lineItems[1]):0;var v=len>=3?parseFloat(lineItems[2]):0;var w=len>=4?parseFloat(lineItems[3]):0;if(isNaN(u)){u=0}if(isNaN(v)){v=0}if(isNaN(w)){w=0}if(this.flipUVs){v=1-v}this.currentModel().textureCoords.push({u:u,v:v,w:w})}},{key:"parseVertexNormal",value:function parseVertexNormal(lineItems){var len=lineItems.length;var x=len>=2?parseFloat(lineItems[1]):0;var y=len>=3?parseFloat(lineItems[2]):0;var z=len>=4?parseFloat(lineItems[3]):0;this.currentModel().vertexNormals.push({x:x,y:y,z:z})}},{key:"parsePolygon",value:function parsePolygon(lineItems){var totalVertices=lineItems.length-1;if(totalVertices<3){throw"Face < 3 vertices"}var face={group:this.currentGroup,material:this.currentMaterial,smoothingGroup:this.smoothingGroup,vertices:[]};for(var i=0;i<totalVertices;i++){var vertexString=lineItems[i+1];var vertexValues=vertexString.split("/");var vvLen=vertexValues.length;if(vvLen<1||vvLen>3){throw"Too many / values for single vertex"}var vertexIndex=0;var textureCoordsIndex=0;var vertexNormalIndex=0;vertexIndex=parseInt(vertexValues[0],10);if(vvLen>1&&vertexValues[1]!==""){textureCoordsIndex=parseInt(vertexValues[1],10)}if(vvLen>2){vertexNormalIndex=parseInt(vertexValues[2],10)}if(vertexIndex===0){throw"Faces uses invalid vertex index of 0"}if(vertexIndex<0){vertexIndex=this.currentModel().vertices.length+1+vertexIndex}textureCoordsIndex-=1;vertexIndex-=1;vertexNormalIndex-=1;face.vertices.push({textureCoordsIndex:textureCoordsIndex,vertexIndex:vertexIndex,vertexNormalIndex:vertexNormalIndex})}this.currentModel().faces.push(face)}},{key:"parseMtlLib",value:function parseMtlLib(lineItems){if(lineItems.length>=2){this.result.materialLibraries.push(lineItems[1])}}},{key:"parseUseMtl",value:function parseUseMtl(lineItems){if(lineItems.length>=2){this.currentMaterial=lineItems[1]}}},{key:"parseSmoothShadingStatement",value:function parseSmoothShadingStatement(lineItems){if(lineItems.length!==2){throw"Smoothing group statements must have exactly 1 argument (eg. s <number|off>)"}var groupNumber=lineItems[1].toLowerCase()==="off"?0:parseInt(lineItems[1],10);this.smoothingGroup=groupNumber}}]);return _class}();function GetBufferFromObj(data,param){var flipUVs=param===void 0?true:param;var parser=new ParseObj(data,flipUVs);var result=parser.parse();var output=[];result.models.forEach(function(model){var faces=model.faces,textureCoords=model.textureCoords,vertexNormals=model.vertexNormals,vertices=model.vertices;var totalFaces=0;for(var i=0;i<faces.length;i++){totalFaces+=faces[i].vertices.length===4?6:3}var buffer=new VertexBuffer({batchSize:totalFaces,isDynamic:false,vertexElementSize:8,elementsPerEntry:3});var F32=buffer.vertexViewF32;var offset=0;for(var i1=0;i1<faces.length;i1++){var face=faces[i1];var i1=face.vertices[0];var i2=face.vertices[1];var i3=face.vertices[2];var v1=vertices[i1.vertexIndex];var v2=vertices[i2.vertexIndex];var v3=vertices[i3.vertexIndex];var n1=vertexNormals[i1.vertexNormalIndex];var n2=vertexNormals[i2.vertexNormalIndex];var n3=vertexNormals[i3.vertexNormalIndex];var uv1=textureCoords[i1.textureCoordsIndex];var uv2=textureCoords[i2.textureCoordsIndex];var uv3=textureCoords[i3.textureCoordsIndex];F32[offset++]=v1.x;F32[offset++]=v1.y;F32[offset++]=v1.z;F32[offset++]=n1.x;F32[offset++]=n1.y;F32[offset++]=n1.z;F32[offset++]=uv1.u;F32[offset++]=uv1.v;F32[offset++]=v2.x;F32[offset++]=v2.y;F32[offset++]=v2.z;F32[offset++]=n2.x;F32[offset++]=n2.y;F32[offset++]=n2.z;F32[offset++]=uv2.u;F32[offset++]=uv2.v;F32[offset++]=v3.x;F32[offset++]=v3.y;F32[offset++]=v3.z;F32[offset++]=n3.x;F32[offset++]=n3.y;F32[offset++]=n3.z;F32[offset++]=uv3.u;F32[offset++]=uv3.v;buffer.count+=3;if(face.vertices.length===4){var i4=face.vertices[3];var v4=vertices[i4.vertexIndex];var n4=vertexNormals[i4.vertexNormalIndex];var uv4=textureCoords[i4.textureCoordsIndex];F32[offset++]=v1.x;F32[offset++]=v1.y;F32[offset++]=v1.z;F32[offset++]=n1.x;F32[offset++]=n1.y;F32[offset++]=n1.z;F32[offset++]=uv1.u;F32[offset++]=uv1.v;F32[offset++]=v3.x;F32[offset++]=v3.y;F32[offset++]=v3.z;F32[offset++]=n3.x;F32[offset++]=n3.y;F32[offset++]=n3.z;F32[offset++]=uv3.u;F32[offset++]=uv3.v;F32[offset++]=v4.x;F32[offset++]=v4.y;F32[offset++]=v4.z;F32[offset++]=n4.x;F32[offset++]=n4.y;F32[offset++]=n4.z;F32[offset++]=uv4.u;F32[offset++]=uv4.v;buffer.count+=3}}output.push({name:model.name,buffer:buffer})});return output}function OBJGeometryFile(key,url,param){var flipUVs=param===void 0?true:param;var file=new File(key,url);file.load=function(){file.url=GetURL(file.key,file.url,".obj",file.loader);return new Promise(function(resolve,reject){var cache=Cache.get("Geometry");if(!file.skipCache&&cache.has(file.key)){resolve(file)}else{XHRLoader(file).then(function(file2){var models=GetBufferFromObj(file2.data,flipUVs);file2.data=models;if(!file2.skipCache){var key2=file2.key;models.forEach(function(model,index){if(index>0){key2=file2.key+index.toString()}var geom=new Geometry(model.buffer);cache.set(key2,geom)})}resolve(file2)}).catch(function(file2){reject(file2)})}})};return file}var Loader=function(EventEmitter){"use strict";swcHelpers.inherits(_class,EventEmitter);function _class(){swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"baseURL","");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"path","");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"crossOrigin","anonymous");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"maxParallelDownloads",-1);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"isLoading",false);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"progress",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"queue",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"inflight",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"completed",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"onComplete",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"onError",void 0);_this.reset();return _this}swcHelpers.createClass(_class,[{key:"reset",value:function reset(){this.isLoading=false;this.queue=new Set();this.inflight=new Set();this.completed=new Set();this.progress=0}},{key:"add",value:function add(){for(var _len=arguments.length,file=new Array(_len),_key=0;_key<_len;_key++){file[_key]=arguments[_key]}var _this=this;file.forEach(function(entity){_this.queue.add(entity)});return this}},{key:"start",value:function start(){var _this=this;if(this.isLoading){return null}return new Promise(function(resolve,reject){_this.completed.clear();_this.progress=0;if(_this.queue.size>0){_this.isLoading=true;_this.onComplete=resolve;_this.onError=reject;Emit(_this,"start");_this.nextFile()}else{_this.progress=1;Emit(_this,"complete");resolve(_this)}})}},{key:"nextFile",value:function nextFile(){var limit=this.queue.size;if(this.maxParallelDownloads!== -1){limit=Math.min(limit,this.maxParallelDownloads)-this.inflight.size}if(limit){var iterator=this.queue.values();while(limit>0){var _this=this,_this1=this;var loadFile=iterator.next().value;this.inflight.add(loadFile);this.queue.delete(loadFile);loadFile(this).then(function(file){_this.fileComplete(file);_this.updateProgress(file,loadFile)}).catch(function(file){_this1.fileError(file);_this1.updateProgress(file,loadFile)});limit--}}else if(this.inflight.size===0){this.stop()}}},{key:"stop",value:function stop(){if(!this.isLoading){return}this.isLoading=false;Emit(this,"complete",this.completed);this.onComplete();this.completed.clear()}},{key:"updateProgress",value:function updateProgress(file,queueEntry){this.inflight.delete(queueEntry);this.completed.add(file);var totalCompleted=this.completed.size;var totalQueued=this.queue.size+this.inflight.size;if(totalCompleted>0){this.progress=totalCompleted/(totalCompleted+totalQueued)}Emit(this,"progress",this.progress,totalCompleted,totalQueued);this.nextFile()}},{key:"fileComplete",value:function fileComplete(file){Emit(this,"filecomplete",file)}},{key:"fileError",value:function fileError(file){Emit(this,"fileerror",file)}},{key:"totalFilesToLoad",value:function totalFilesToLoad(){return this.queue.size+this.inflight.size}},{key:"setBaseURL",value:function setBaseURL(param){var url=param===void 0?"":param;if(url!==""&&url.substr(-1)!=="/"){url=url.concat("/")}this.baseURL=url;return this}},{key:"setPath",value:function setPath(param){var path=param===void 0?"":param;if(path!==""&&path.substr(-1)!=="/"){path=path.concat("/")}this.path=path;return this}},{key:"setCORS",value:function setCORS(crossOrigin){this.crossOrigin=crossOrigin;return this}},{key:"setMaxParallelDownloads",value:function setMaxParallelDownloads(max){this.maxParallelDownloads=max;return this}}]);return _class}(EventEmitter);var math_exports={};__export(math_exports,{Angle:function(){return angle_exports},Average:function(){return Average},Bernstein:function(){return Bernstein},Between:function(){return Between},Bezier:function(){return Bezier},CatmullRom:function(){return CatmullRom},CeilTo:function(){return CeilTo},Clamp:function(){return Clamp},DegToRad:function(){return DegToRad},Difference:function(){return Difference},Easing:function(){return easing_exports},Factorial:function(){return Factorial},FloatBetween:function(){return FloatBetween},FloorTo:function(){return FloorTo},FromPercent:function(){return FromPercent},Fuzzy:function(){return fuzzy_exports},GetSpeed:function(){return GetSpeed},Hermite:function(){return Hermite},Interpolation:function(){return interpolation_exports},Linear:function(){return Linear2},MATH_CONST:function(){return MATH_CONST},Matrix2D:function(){return mat2d_exports},Matrix4:function(){return mat4_exports},MaxAdd:function(){return MaxAdd},MinSub:function(){return MinSub},Percent:function(){return Percent},Pow2:function(){return pow2_exports},Quaternion:function(){return quaternion_exports},RadToDeg:function(){return RadToDeg},RoundAwayFromZero:function(){return RoundAwayFromZero},RoundTo:function(){return RoundTo},SinCosTableGenerator:function(){return SinCosTableGenerator},SmoothStep:function(){return SmoothStep},SmootherStep:function(){return SmootherStep},Snap:function(){return snap_exports},Vec2:function(){return vec2_exports},Vec3:function(){return vec3_exports},Vec4:function(){return vec4_exports},Within:function(){return Within},Wrap:function(){return Wrap}});var angle_exports={};__export(angle_exports,{AngleBetween:function(){return AngleBetween},AngleBetweenY:function(){return AngleBetweenY},CounterClockwise:function(){return CounterClockwise},NormalizeAngle:function(){return NormalizeAngle},ReverseAngle:function(){return ReverseAngle},RotateAngleTo:function(){return RotateAngleTo},ShortestAngleBetween:function(){return ShortestAngleBetween},WrapAngle:function(){return WrapAngle},WrapAngleDegrees:function(){return WrapAngleDegrees}});function AngleBetween(x1,y1,x2,y2){return Math.atan2(y2-y1,x2-x1)}function AngleBetweenY(x1,y1,x2,y2){return Math.atan2(x2-x1,y2-y1)}function CounterClockwise(angle){if(angle>Math.PI){angle-=MATH_CONST.PI2}return Math.abs(((angle+MATH_CONST.HALF_PI)%MATH_CONST.PI2-MATH_CONST.PI2)%MATH_CONST.PI2)}function NormalizeAngle(angle){angle=angle%MATH_CONST.PI2;if(angle>=0){return angle}else{return angle+MATH_CONST.PI2}}function ReverseAngle(angle){return NormalizeAngle(angle+Math.PI)}function RotateAngleTo(currentAngle,targetAngle,param){var lerp=param===void 0?0.05:param;if(currentAngle===targetAngle){return currentAngle}if(Math.abs(targetAngle-currentAngle)<=lerp||Math.abs(targetAngle-currentAngle)>=MATH_CONST.PI2-lerp){currentAngle=targetAngle}else{if(Math.abs(targetAngle-currentAngle)>Math.PI){if(targetAngle<currentAngle){targetAngle+=MATH_CONST.PI2}else{targetAngle-=MATH_CONST.PI2}}if(targetAngle>currentAngle){currentAngle+=lerp}else if(targetAngle<currentAngle){currentAngle-=lerp}}return currentAngle}function ShortestAngleBetween(angle1,angle2){var difference=angle2-angle1;if(difference===0){return 0}var times=Math.floor((difference- -180)/360);return difference-times*360}function WrapAngle(angle){return Wrap(angle,-Math.PI,Math.PI)}function WrapAngleDegrees(angle){return Wrap(angle,-180,180)}var easing_exports={};__export(easing_exports,{Back:function(){return back_exports},Bounce:function(){return bounce_exports},Circular:function(){return circular_exports},Cubic:function(){return cubic_exports},Elastic:function(){return elastic_exports},Expo:function(){return expo_exports},GetEase:function(){return GetEase_exports},Linear:function(){return Linear_exports},Quadratic:function(){return quadratic_exports},Quartic:function(){return quartic_exports},Quintic:function(){return quintic_exports},Sine:function(){return sine_exports},Stepped:function(){return Stepped_exports}});var back_exports={};__export(back_exports,{In:function(){return In},InOut:function(){return InOut},Out:function(){return Out}});function In(v,param){var overshoot=param===void 0?1.70158:param;return v*v*((overshoot+1)*v-overshoot)}function InOut(v,param){var overshoot=param===void 0?1.70158:param;var s=overshoot*1.525;if((v*=2)<1){return 0.5*(v*v*((s+1)*v-s))}else{return 0.5*((v-=2)*v*((s+1)*v+s)+2)}}function Out(v,param){var overshoot=param===void 0?1.70158:param;return--v*v*((overshoot+1)*v+overshoot)+1}var bounce_exports={};__export(bounce_exports,{In:function(){return In2},InOut:function(){return InOut2},Out:function(){return Out2}});function In2(v){v=1-v;if(v<1/2.75){return 1-7.5625*v*v}else if(v<2/2.75){return 1-(7.5625*(v-=1.5/2.75)*v+0.75)}else if(v<2.5/2.75){return 1-(7.5625*(v-=2.25/2.75)*v+0.9375)}else{return 1-(7.5625*(v-=2.625/2.75)*v+0.984375)}}function InOut2(v){var reverse=false;if(v<0.5){v=1-v*2;reverse=true}else{v=v*2-1}if(v<1/2.75){v=7.5625*v*v}else if(v<2/2.75){v=7.5625*(v-=1.5/2.75)*v+0.75}else if(v<2.5/2.75){v=7.5625*(v-=2.25/2.75)*v+0.9375}else{v=7.5625*(v-=2.625/2.75)*v+0.984375}if(reverse){return(1-v)*0.5}else{return v*0.5+0.5}}function Out2(v){if(v<1/2.75){return 7.5625*v*v}else if(v<2/2.75){return 7.5625*(v-=1.5/2.75)*v+0.75}else if(v<2.5/2.75){return 7.5625*(v-=2.25/2.75)*v+0.9375}else{return 7.5625*(v-=2.625/2.75)*v+0.984375}}var circular_exports={};__export(circular_exports,{In:function(){return In3},InOut:function(){return InOut3},Out:function(){return Out3}});function In3(v){return 1-Math.sqrt(1-v*v)}function InOut3(v){if((v*=2)<1){return-0.5*(Math.sqrt(1-v*v)-1)}else{return 0.5*(Math.sqrt(1-(v-=2)*v)+1)}}function Out3(v){return Math.sqrt(1- --v*v)}var cubic_exports={};__export(cubic_exports,{In:function(){return In4},InOut:function(){return InOut4},Out:function(){return Out4}});function In4(v){return v*v*v}function InOut4(v){if((v*=2)<1){return 0.5*v*v*v}else{return 0.5*((v-=2)*v*v+2)}}function Out4(v){return--v*v*v+1}var elastic_exports={};__export(elastic_exports,{In:function(){return In5},InOut:function(){return InOut5},Out:function(){return Out5}});function In5(v,param,param1){var amplitude=param===void 0?0.1:param,period=param1===void 0?0.1:param1;if(v===0){return 0}else if(v===1){return 1}else{var s=period/4;if(amplitude<1){amplitude=1}else{s=period*Math.asin(1/amplitude)/(2*Math.PI)}return-(amplitude*Math.pow(2,10*(v-=1))*Math.sin((v-s)*(2*Math.PI)/period))}}function InOut5(v,param,param1){var amplitude=param===void 0?0.1:param,period=param1===void 0?0.1:param1;if(v===0){return 0}else if(v===1){return 1}else{var s=period/4;if(amplitude<1){amplitude=1}else{s=period*Math.asin(1/amplitude)/(2*Math.PI)}if((v*=2)<1){return-0.5*(amplitude*Math.pow(2,10*(v-=1))*Math.sin((v-s)*(2*Math.PI)/period))}else{return amplitude*Math.pow(2,-10*(v-=1))*Math.sin((v-s)*(2*Math.PI)/period)*0.5+1}}}function Out5(v,param,param1){var amplitude=param===void 0?0.1:param,period=param1===void 0?0.1:param1;if(v===0){return 0}else if(v===1){return 1}else{var s=period/4;if(amplitude<1){amplitude=1}else{s=period*Math.asin(1/amplitude)/(2*Math.PI)}return amplitude*Math.pow(2,-10*v)*Math.sin((v-s)*(2*Math.PI)/period)+1}}var expo_exports={};__export(expo_exports,{In:function(){return In6},InOut:function(){return InOut6},Out:function(){return Out6}});function In6(v){return Math.pow(2,10*(v-1))-0.001}function InOut6(v){if(v==0){return 0}if(v==1){return 1}if((v*=2)<1){return 0.5*Math.pow(2,10*(v-1))}else{return 0.5*(2-Math.pow(2,-10*(v-1)))}}function Out6(v){return 1-Math.pow(2,-10*v)}var GetEase_exports={};__export(GetEase_exports,{GetEase:function(){return GetEase}});var quadratic_exports={};__export(quadratic_exports,{In:function(){return In7},InOut:function(){return InOut7},Out:function(){return Out7}});function In7(v){return v*v}function InOut7(v){if((v*=2)<1){return 0.5*v*v}else{return-0.5*(--v*(v-2)-1)}}function Out7(v){return v*(2-v)}var quartic_exports={};__export(quartic_exports,{In:function(){return In8},InOut:function(){return InOut8},Out:function(){return Out8}});function In8(v){return v*v*v*v}function InOut8(v){if((v*=2)<1){return 0.5*v*v*v*v}else{return-0.5*((v-=2)*v*v*v-2)}}function Out8(v){return-(--v*v*v*v-1)}var quintic_exports={};__export(quintic_exports,{In:function(){return In9},InOut:function(){return InOut9},Out:function(){return Out9}});function In9(v){return v*v*v*v*v}function InOut9(v){if((v*=2)<1){return 0.5*v*v*v*v*v}else{return 0.5*((v-=2)*v*v*v*v+2)}}function Out9(v){return(v=v-1)*v*v*v*v+1}var sine_exports={};__export(sine_exports,{In:function(){return In10},InOut:function(){return InOut10},Out:function(){return Out10}});function In10(v){if(v===0){return 0}else if(v===1){return 1}else{return 1-Math.cos(v*Math.PI/2)}}function InOut10(v){if(v===0){return 0}else if(v===1){return 1}else{return 0.5*(1-Math.cos(Math.PI*v))}}function Out10(v){if(v===0){return 0}else if(v===1){return 1}else{return Math.sin(v*Math.PI/2)}}var Linear_exports={};__export(Linear_exports,{Linear:function(){return Linear}});function Linear(v){return v}var Stepped_exports={};__export(Stepped_exports,{Stepped:function(){return Stepped}});function Stepped(v,param){var steps=param===void 0?1:param;if(v<=0){return 0}else if(v>=1){return 1}else{return((steps*v|0)+1)*(1/steps)}}var EaseMap;function GetEase(name){if(!EaseMap){EaseMap=new Map([["power0",Linear],["power1",Out7],["power2",Out4],["power3",Out8],["power4",Out9],["linear",Linear],["quad",Out7],["cubic",Out4],["quart",Out8],["quint",Out9],["sine",Out10],["expo",Out6],["circ",Out3],["elastic",Out5],["back",Out],["bounce",Out2],["stepped",Stepped],["quad.in",In7],["cubic.in",In4],["quart.in",In8],["quint.in",In9],["sine.in",In10],["expo.in",In6],["circ.in",In3],["elastic.in",In5],["back.in",In],["bounce.in",In2],["quad.out",Out7],["cubic.out",Out4],["quart.out",Out8],["quint.out",Out9],["sine.out",Out10],["expo.out",Out6],["circ.out",Out3],["elastic.out",Out5],["back.out",Out],["bounce.out",Out2],["quad.inout",InOut7],["cubic.inout",InOut4],["quart.inout",InOut8],["quint.inout",InOut9],["sine.inout",InOut10],["expo.inout",InOut6],["circ.inout",InOut3],["elastic.inout",InOut5],["back.inout",InOut],["bounce.inout",InOut2]])}name=name.toLowerCase();name=name.replace("ease","");if(EaseMap.has(name)){return EaseMap.get(name)}else{return Linear}}var fuzzy_exports={};__export(fuzzy_exports,{FuzzyCeil:function(){return FuzzyCeil},FuzzyEqual:function(){return FuzzyEqual},FuzzyFloor:function(){return FuzzyFloor},FuzzyGreaterThan:function(){return FuzzyGreaterThan},FuzzyLessThan:function(){return FuzzyLessThan}});function FuzzyCeil(value,param){var epsilon=param===void 0?0.0001:param;return Math.ceil(value-epsilon)}function FuzzyEqual(a,b,param){var epsilon=param===void 0?0.0001:param;return Math.abs(a-b)<epsilon}function FuzzyFloor(value,param){var epsilon=param===void 0?0.0001:param;return Math.floor(value+epsilon)}function FuzzyGreaterThan(a,b,param){var epsilon=param===void 0?0.0001:param;return a>b-epsilon}function FuzzyLessThan(a,b,param){var epsilon=param===void 0?0.0001:param;return a<b+epsilon}var interpolation_exports={};__export(interpolation_exports,{BezierInterpolation:function(){return BezierInterpolation},CatmullRomInterpolation:function(){return CatmullRomInterpolation},CubicBezierInterpolation:function(){return CubicBezierInterpolation},LinearInterpolation:function(){return LinearInterpolation},QuadraticBezierInterpolation:function(){return QuadraticBezierInterpolation},SmoothStepInterpolation:function(){return SmoothStepInterpolation},SmootherStepInterpolation:function(){return SmootherStepInterpolation}});function Factorial(value){if(value===0){return 1}var res=value;while(--value){res*=value}return res}function Bernstein(n,i){return Factorial(n)/Factorial(i)/Factorial(n-i)}function BezierInterpolation(v,k){var b=0;var n=v.length-1;for(var i=0;i<=n;i++){b+=Math.pow(1-k,n-i)*Math.pow(k,i)*v[i]*Bernstein(n,i)}return b}function CatmullRom(t,p0,p1,p2,p3){var v0=(p2-p0)*0.5;var v1=(p3-p1)*0.5;var t2=t*t;var t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}function CatmullRomInterpolation(v,k){var m=v.length-1;var f=m*k;var i=Math.floor(f);if(v[0]===v[m]){if(k<0){i=Math.floor(f=m*(1+k))}return CatmullRom(f-i,v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m])}else{if(k<0){return v[0]-(CatmullRom(-f,v[0],v[0],v[1],v[1])-v[0])}if(k>1){return v[m]-(CatmullRom(f-m,v[m],v[m],v[m-1],v[m-1])-v[m])}return CatmullRom(f-i,v[i?i-1:0],v[i],v[m<i+1?m:i+1],v[m<i+2?m:i+2])}}function P0(t,p){var k=1-t;return k*k*k*p}function P1(t,p){var k=1-t;return 3*k*k*t*p}function P2(t,p){return 3*(1-t)*t*t*p}function P3(t,p){return t*t*t*p}function CubicBezierInterpolation(t,p0,p1,p2,p3){return P0(t,p0)+P1(t,p1)+P2(t,p2)+P3(t,p3)}function Linear2(p0,p1,t){return(p1-p0)*t+p0}function LinearInterpolation(v,k){var m=v.length-1;var f=m*k;var i=Math.floor(f);if(k<0){return Linear2(v[0],v[1],f)}else if(k>1){return Linear2(v[m],v[m-1],m-f)}else{return Linear2(v[i],v[i+1>m?m:i+1],f-i)}}function P02(t,p){var k=1-t;return k*k*p}function P12(t,p){return 2*(1-t)*t*p}function P22(t,p){return t*t*p}function QuadraticBezierInterpolation(t,p0,p1,p2){return P02(t,p0)+P12(t,p1)+P22(t,p2)}function SmoothStep(x,min,max){if(x<=min){return 0}if(x>=max){return 1}x=(x-min)/(max-min);return x*x*(3-2*x)}function SmoothStepInterpolation(t,min,max){return min+(max-min)*SmoothStep(t,0,1)}function SmootherStep(x,min,max){x=Math.max(0,Math.min(1,(x-min)/(max-min)));return x*x*x*(x*(x*6-15)+10)}function SmootherStepInterpolation(t,min,max){return min+(max-min)*SmootherStep(t,0,1)}var mat2d_exports={};__export(mat2d_exports,{GetMat2dDeterminant:function(){return GetMat2dDeterminant},GetMat2dFrobenius:function(){return GetMat2dFrobenius},Mat2dAdd:function(){return Mat2dAdd},Mat2dAppend:function(){return Mat2dAppend},Mat2dClone:function(){return Mat2dClone},Mat2dCopyFrom:function(){return Mat2dCopyFrom},Mat2dCopyToContext:function(){return Mat2dCopyToContext},Mat2dEquals:function(){return Mat2dEquals},Mat2dFromRotation:function(){return Mat2dFromRotation},Mat2dFromScaling:function(){return Mat2dFromScaling},Mat2dFromTranslation:function(){return Mat2dFromTranslation},Mat2dFuzzyEquals:function(){return Mat2dFuzzyEquals},Mat2dGlobalToLocal:function(){return Mat2dGlobalToLocal},Mat2dITRS:function(){return Mat2dITRS},Mat2dITRSS:function(){return Mat2dITRSS},Mat2dIdentity:function(){return Mat2dIdentity},Mat2dInvert:function(){return Mat2dInvert},Mat2dLocalToGlobal:function(){return Mat2dLocalToGlobal},Mat2dMultiply:function(){return Mat2dMultiply},Mat2dMultiplyScalar:function(){return Mat2dMultiplyScalar},Mat2dMultiplyScalarAndAdd:function(){return Mat2dMultiplyScalarAndAdd},Mat2dRotate:function(){return Mat2dRotate},Mat2dScale:function(){return Mat2dScale},Mat2dSetToContext:function(){return Mat2dSetToContext},Mat2dSkew:function(){return Mat2dSkew},Mat2dSubtract:function(){return Mat2dSubtract},Mat2dTranslate:function(){return Mat2dTranslate},Mat2dZero:function(){return Mat2dZero},Matrix2D:function(){return Matrix2D}});function GetMat2dDeterminant(src){var a=src.a,b=src.b,c=src.c,d=src.d;return a*d-b*c}function GetMat2dFrobenius(src){return Math.hypot(src.a,src.b,src.c,src.d,src.tx,src.ty,1)}var Matrix2D=function(){"use strict";function _class(param,param1,param2,param3,param4,param5){var a=param===void 0?1:param,b=param1===void 0?0:param1,c=param2===void 0?0:param2,d=param3===void 0?1:param3,tx=param4===void 0?0:param4,ty=param5===void 0?0:param5;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"a",void 0);swcHelpers.defineProperty(this,"b",void 0);swcHelpers.defineProperty(this,"c",void 0);swcHelpers.defineProperty(this,"d",void 0);swcHelpers.defineProperty(this,"tx",void 0);swcHelpers.defineProperty(this,"ty",void 0);this.set(a,b,c,d,tx,ty)}swcHelpers.createClass(_class,[{key:"set",value:function set(param,param1,param2,param3,param4,param5){var a=param===void 0?1:param,b=param1===void 0?0:param1,c=param2===void 0?0:param2,d=param3===void 0?1:param3,tx=param4===void 0?0:param4,ty=param5===void 0?0:param5;this.a=a;this.b=b;this.c=c;this.d=d;this.tx=tx;this.ty=ty;return this}},{key:"identity",value:function identity(){return this.set()}},{key:"toArray",value:function toArray(){var ref=this,a=ref.a,b=ref.b,c=ref.c,d=ref.d,tx=ref.tx,ty=ref.ty;return[a,b,c,d,tx,ty]}},{key:"fromArray",value:function fromArray(src){return this.set(src[0],src[1],src[2],src[3],src[4],src[5])}}]);return _class}();function Mat2dAdd(a,b,param){var out=param===void 0?new Matrix2D():param;return out.set(a.a+b.a,a.b+b.b,a.c+b.c,a.d+b.d,a.tx+b.tx,a.ty+b.ty)}function Mat2dAppend(mat1,mat2,param){var out=param===void 0?new Matrix2D():param;var a1=mat1.a,b1=mat1.b,c1=mat1.c,d1=mat1.d,tx1=mat1.tx,ty1=mat1.ty;var a2=mat2.a,b2=mat2.b,c2=mat2.c,d2=mat2.d,tx2=mat2.tx,ty2=mat2.ty;return out.set(a2*a1+b2*c1,a2*b1+b2*d1,c2*a1+d2*c1,c2*b1+d2*d1,tx2*a1+ty2*c1+tx1,tx2*b1+ty2*d1+ty1)}function Mat2dClone(src){return new Matrix2D(src.a,src.b,src.c,src.d,src.tx,src.ty)}function Mat2dCopyFrom(src,target){var a=src.a,b=src.b,c=src.c,d=src.d,tx=src.tx,ty=src.ty;return target.set(a,b,c,d,tx,ty)}function Mat2dCopyToContext(src,context){var a=src.a,b=src.b,c=src.c,d=src.d,tx=src.tx,ty=src.ty;context.transform(a,b,c,d,tx,ty);return context}function Mat2dEquals(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty}function Mat2dRotate(target,angle,param){var out=param===void 0?new Matrix2D():param;var a=target.a,b=target.b,c=target.c,d=target.d,tx=target.tx,ty=target.ty;var sin=Math.sin(angle);var cos=Math.cos(angle);return out.set(a*cos+c*sin,b*cos+d*sin,a*-sin+c*cos,b*-sin+d*cos,tx,ty)}function Mat2dFromRotation(angle){var target=new Matrix2D();return Mat2dRotate(target,angle,target)}function Mat2dScale(target,scaleX,scaleY,param){var out=param===void 0?new Matrix2D():param;var a=target.a,b=target.b,c=target.c,d=target.d,tx=target.tx,ty=target.ty;return out.set(a*scaleX,b*scaleX,c*scaleY,d*scaleY,tx,ty)}function Mat2dFromScaling(scaleX,param){var scaleY=param===void 0?scaleX:param;var target=new Matrix2D();return Mat2dScale(target,scaleX,scaleY,target)}function Mat2dTranslate(target,x,y,param){var out=param===void 0?new Matrix2D():param;var a=target.a,b=target.b,c=target.c,d=target.d,tx=target.tx,ty=target.ty;out.tx=a*x+c*y+tx;out.ty=b*x+d*y+ty;return out}function Mat2dFromTranslation(x,y){var target=new Matrix2D();return Mat2dTranslate(target,x,y,target)}function Mat2dFuzzyEquals(a,b,param){var epsilon=param===void 0?0.000001:param;var a0=a.a,b0=a.b,c0=a.c,d0=a.d,tx0=a.tx,ty0=a.ty;var a1=b.a,b1=b.b,c1=b.c,d1=b.d,tx1=b.tx,ty1=b.ty;return Math.abs(a0-a1)<=epsilon*Math.max(1,Math.abs(a0),Math.abs(a1))&&Math.abs(b0-b1)<=epsilon*Math.max(1,Math.abs(b0),Math.abs(b1))&&Math.abs(c0-c1)<=epsilon*Math.max(1,Math.abs(c0),Math.abs(c1))&&Math.abs(d0-d1)<=epsilon*Math.max(1,Math.abs(d0),Math.abs(d1))&&Math.abs(tx0-tx1)<=epsilon*Math.max(1,Math.abs(tx0),Math.abs(tx1))&&Math.abs(ty0-ty1)<=epsilon*Math.max(1,Math.abs(ty0),Math.abs(ty1))}function Mat2dGlobalToLocal(mat,x,y,param){var out=param===void 0?new Vec2():param;var a=mat.a,b=mat.b,c=mat.c,d=mat.d,tx=mat.tx,ty=mat.ty;var id=1/(a*d+c*-b);return out.set(d*id*x+-c*id*y+(ty*c-tx*d)*id,a*id*y+-b*id*x+(-ty*a+tx*b)*id)}function Mat2dITRS(target,x,y,angle,scaleX,scaleY){if(angle===0){return target.set(1,0,0,1,x,y)}else{var sin=Math.sin(angle);var cos=Math.cos(angle);return target.set(cos*scaleX,sin*scaleX,-sin*scaleY,cos*scaleY,x,y)}}function Mat2dITRSS(target,x,y,param,param1,param2,param3,param4){var angle=param===void 0?0:param,scaleX=param1===void 0?1:param1,scaleY=param2===void 0?1:param2,skewX=param3===void 0?0:param3,skewY=param4===void 0?0:param4;if(angle===0){return target.set(1,0,0,1,x,y)}else{return target.set(Math.cos(angle+skewY)*scaleX,Math.sin(angle+skewY)*scaleX,-Math.sin(angle-skewX)*scaleY,Math.cos(angle-skewX)*scaleY,x,y)}}function Mat2dIdentity(){return new Matrix2D()}function Mat2dInvert(target,param){var out=param===void 0?new Matrix2D():param;var a=target.a,b=target.b,c=target.c,d=target.d,tx=target.tx,ty=target.ty;var determinant=a*d-b*c;if(determinant){determinant=1/determinant;out.set(d*determinant,-b*determinant,-c*determinant,a*determinant,(c*ty-d*tx)*determinant,(b*tx-a*ty)*determinant)}return out}function Mat2dLocalToGlobal(mat,x,y,param){var out=param===void 0?new Vec2():param;var a=mat.a,b=mat.b,c=mat.c,d=mat.d,tx=mat.tx,ty=mat.ty;return out.set(a*x+c*y+tx,b*x+d*y+ty)}function Mat2dMultiply(target,src,param){var out=param===void 0?new Matrix2D():param;var a0=target.a,b0=target.b,c0=target.c,d0=target.d,tx0=target.tx,ty0=target.ty;var a1=src.a,b1=src.b,c1=src.c,d1=src.d,tx1=src.tx,ty1=src.ty;return out.set(a0*a1+c0*b1,b0*a1+d0*b1,a0*c1+c0*d1,b0*c1+d0*d1,a0*tx1+c0*ty1+tx0,b0*tx1+d0*ty1+ty0)}function Mat2dMultiplyScalar(target,scalar,param){var out=param===void 0?new Matrix2D():param;var a=target.a,b=target.b,c=target.c,d=target.d,tx=target.tx,ty=target.ty;return out.set(a*scalar,b*scalar,c*scalar,d*scalar,tx*scalar,ty*scalar)}function Mat2dMultiplyScalarAndAdd(target,src,scalar,param){var out=param===void 0?new Matrix2D():param;var a=src.a,b=src.b,c=src.c,d=src.d,tx=src.tx,ty=src.ty;var ta=target.a,tb=target.b,tc=target.c,td=target.d,ttx=target.tx,tty=target.ty;return out.set(ta+a*scalar,tb+b*scalar,tc+c*scalar,td+d*scalar,ttx+tx*scalar,tty+ty*scalar)}function Mat2dSetToContext(src,context){var a=src.a,b=src.b,c=src.c,d=src.d,tx=src.tx,ty=src.ty;context.setTransform(a,b,c,d,tx,ty);return context}function Mat2dSkew(target,angleX,angleY,param){var out=param===void 0?new Matrix2D():param;var a=target.a,b=target.b,c=target.c,d=target.d,tx=target.tx,ty=target.ty;return out.set(a,b+Math.tan(angleX),c+Math.tan(angleY),d,tx,ty)}function Mat2dSubtract(a,b,param){var out=param===void 0?new Matrix2D():param;return out.set(a.a-b.a,a.b-b.b,a.c-b.c,a.d-b.d,a.tx-b.tx,a.ty-b.ty)}function Mat2dZero(target){return target.set(0,0,0,0,0,0)}var mat4_exports={};__export(mat4_exports,{GetMat4Determinant:function(){return GetMat4Determinant},GetMat4Frobenius:function(){return GetMat4Frobenius},Mat4Add:function(){return Mat4Add},Mat4AddTranslationFromFloats:function(){return Mat4AddTranslationFromFloats},Mat4Adjoint:function(){return Mat4Adjoint},Mat4Clone:function(){return Mat4Clone},Mat4CopyFrom:function(){return Mat4CopyFrom},Mat4CopyPosition:function(){return Mat4CopyPosition},Mat4Equals:function(){return Mat4Equals},Mat4FromQuat:function(){return Mat4FromQuat},Mat4FromRotation:function(){return Mat4FromRotation},Mat4FromRotationTranslation:function(){return Mat4FromRotationTranslation},Mat4FromRotationTranslationScale:function(){return Mat4FromRotationTranslationScale},Mat4FromRotationTranslationScaleOrigin:function(){return Mat4FromRotationTranslationScaleOrigin},Mat4FromRotationXYTranslation:function(){return Mat4FromRotationXYTranslation},Mat4FromScaling:function(){return Mat4FromScaling},Mat4FromTranslation:function(){return Mat4FromTranslation},Mat4FromXRotation:function(){return Mat4FromXRotation},Mat4FromYRotation:function(){return Mat4FromYRotation},Mat4FromZRotation:function(){return Mat4FromZRotation},Mat4Frustum:function(){return Mat4Frustum},Mat4GetRotation:function(){return Mat4GetRotation},Mat4GetScaling:function(){return Mat4GetScaling},Mat4GetTranslation:function(){return Mat4GetTranslation},Mat4Identity:function(){return Mat4Identity},Mat4Invert:function(){return Mat4Invert},Mat4LookAt:function(){return Mat4LookAt},Mat4Multiply:function(){return Mat4Multiply},Mat4MultiplyScalar:function(){return Mat4MultiplyScalar},Mat4MultiplyScalarAndAdd:function(){return Mat4MultiplyScalarAndAdd},Mat4Ortho:function(){return Mat4Ortho},Mat4Perspective:function(){return Mat4Perspective},Mat4PerspectiveFromFieldOfView:function(){return Mat4PerspectiveFromFieldOfView},Mat4Rotate:function(){return Mat4Rotate},Mat4RotateX:function(){return Mat4RotateX},Mat4RotateY:function(){return Mat4RotateY},Mat4RotateZ:function(){return Mat4RotateZ},Mat4Scale:function(){return Mat4Scale},Mat4SetTranslation:function(){return Mat4SetTranslation},Mat4SetTranslationFromFloats:function(){return Mat4SetTranslationFromFloats},Mat4Subtract:function(){return Mat4Subtract},Mat4TargetTo:function(){return Mat4TargetTo},Mat4Translate:function(){return Mat4Translate},Mat4TranslateFromFloats:function(){return Mat4TranslateFromFloats},Mat4Transpose:function(){return Mat4Transpose},Mat4Zero:function(){return Mat4Zero},Matrix4:function(){return Matrix4}});function GetMat4Determinant(matrix2){var _data=matrix2.data,m00=_data[0],m01=_data[1],m02=_data[2],m03=_data[3],m10=_data[4],m11=_data[5],m12=_data[6],m13=_data[7],m20=_data[8],m21=_data[9],m22=_data[10],m23=_data[11],m30=_data[12],m31=_data[13],m32=_data[14],m33=_data[15];var det22x33=m22*m33-m32*m23;var det21x33=m21*m33-m31*m23;var det21x32=m21*m32-m31*m22;var det20x33=m20*m33-m30*m23;var det20x32=m20*m32-m22*m30;var det20x31=m20*m31-m30*m21;var cofact00=+(m11*det22x33-m12*det21x33+m13*det21x32);var cofact01=-(m10*det22x33-m12*det20x33+m13*det20x32);var cofact02=+(m10*det21x33-m11*det20x33+m13*det20x31);var cofact03=-(m10*det21x32-m11*det20x32+m12*det20x31);return m00*cofact00+m01*cofact01+m02*cofact02+m03*cofact03}function GetMat4Frobenius(matrix2){var _data=matrix2.data,m00=_data[0],m01=_data[1],m02=_data[2],m03=_data[3],m10=_data[4],m11=_data[5],m12=_data[6],m13=_data[7],m20=_data[8],m21=_data[9],m22=_data[10],m23=_data[11],m30=_data[12],m31=_data[13],m32=_data[14],m33=_data[15];return Math.hypot(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33)}function Mat4Add(a,b,param){var out=param===void 0?new Matrix4():param;var _data=a.data,a00=_data[0],a01=_data[1],a02=_data[2],a03=_data[3],a10=_data[4],a11=_data[5],a12=_data[6],a13=_data[7],a20=_data[8],a21=_data[9],a22=_data[10],a23=_data[11],a30=_data[12],a31=_data[13],a32=_data[14],a33=_data[15];var _data1=b.data,b00=_data1[0],b01=_data1[1],b02=_data1[2],b03=_data1[3],b10=_data1[4],b11=_data1[5],b12=_data1[6],b13=_data1[7],b20=_data1[8],b21=_data1[9],b22=_data1[10],b23=_data1[11],b30=_data1[12],b31=_data1[13],b32=_data1[14],b33=_data1[15];return out.set(a00+b00,a01+b01,a02+b02,a03+b03,a10+b10,a11+b11,a12+b12,a13+b13,a20+b20,a21+b21,a22+b22,a23+b23,a30+b30,a31+b31,a32+b32,a33+b33)}function Mat4AddTranslationFromFloats(matrix2,x,y,z){var data=matrix2.data;data[12]+=x;data[13]+=y;data[14]+=z;matrix2.onChange(matrix2);return matrix2}function Mat4Adjoint(matrix2,param){var out=param===void 0?new Matrix4():param;var _data=matrix2.data,a00=_data[0],a01=_data[1],a02=_data[2],a03=_data[3],a10=_data[4],a11=_data[5],a12=_data[6],a13=_data[7],a20=_data[8],a21=_data[9],a22=_data[10],a23=_data[11],a30=_data[12],a31=_data[13],a32=_data[14],a33=_data[15];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;return out.set(a11*b11-a12*b10+a13*b09,a02*b10-a01*b11-a03*b09,a31*b05-a32*b04+a33*b03,a22*b04-a21*b05-a23*b03,a12*b08-a10*b11-a13*b07,a00*b11-a02*b08+a03*b07,a32*b02-a30*b05-a33*b01,a20*b05-a22*b02+a23*b01,a10*b10-a11*b08+a13*b06,a01*b08-a00*b10-a03*b06,a30*b04-a31*b02+a33*b00,a21*b02-a20*b04-a23*b00,a11*b07-a10*b09-a12*b06,a00*b09-a01*b07+a02*b06,a31*b01-a30*b03-a32*b00,a20*b03-a21*b01+a22*b00)}function Mat4Clone(src){return new Matrix4(src)}function Mat4CopyFrom(src,dest){return dest.fromArray(src.data)}function Mat4CopyPosition(src,dest){var srcData=src.data;var destData=dest.data;destData[12]=srcData[12];destData[13]=srcData[13];destData[14]=srcData[14];dest.onChange(dest);return dest}function Mat4Equals(a,b){var _data=a.data,a00=_data[0],a01=_data[1],a02=_data[2],a03=_data[3],a10=_data[4],a11=_data[5],a12=_data[6],a13=_data[7],a20=_data[8],a21=_data[9],a22=_data[10],a23=_data[11],a30=_data[12],a31=_data[13],a32=_data[14],a33=_data[15];var _data1=b.data,b00=_data1[0],b01=_data1[1],b02=_data1[2],b03=_data1[3],b10=_data1[4],b11=_data1[5],b12=_data1[6],b13=_data1[7],b20=_data1[8],b21=_data1[9],b22=_data1[10],b23=_data1[11],b30=_data1[12],b31=_data1[13],b32=_data1[14],b33=_data1[15];return a00===b00&&a01===b01&&a02===b02&&a03===b03&&a10===b10&&a11===b11&&a12===b12&&a13===b13&&a20===b20&&a21===b21&&a22===b22&&a23===b23&&a30===b30&&a31===b31&&a32===b32&&a33===b33}function Mat4FromQuat(q,param){var out=param===void 0?new Matrix4():param;var x=q.x,y=q.y,z=q.z,w=q.w;var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var yx=y*x2;var yy=y*y2;var zx=z*x2;var zy=z*y2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;return out.set(1-yy-zz,yx+wz,zx-wy,0,yx-wz,1-xx-zz,zy+wx,0,zx+wy,zy-wx,1-xx-yy,0,0,0,0,1)}function Mat4FromRotation(angle,axis,param){var out=param===void 0?new Matrix4():param;var x=axis.x,y=axis.y,z=axis.z;var len=Math.hypot(x,y,z);if(len<0.00001){return null}len=1/len;x*=len;y*=len;z*=len;var s=Math.sin(angle);var c=Math.cos(angle);var t=1-c;return out.set(x*x*t+c,y*x*t+z*s,z*x*t-y*s,0,x*y*t-z*s,y*y*t+c,z*y*t+x*s,0,x*z*t+y*s,y*z*t-x*s,z*z*t+c,0,0,0,0,1)}function Mat4FromRotationTranslation(q,v,param){var out=param===void 0?new Matrix4():param;var x=q.x,y=q.y,z=q.z,w=q.w;var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;var vx=v.x,vy=v.y,vz=v.z;return out.set(1-(yy+zz),xy+wz,xz-wy,0,xy-wz,1-(xx+zz),yz+wx,0,xz+wy,yz-wx,1-(xx+yy),0,vx,vy,vz,1)}function Mat4FromRotationTranslationScale(q,v,s,param){var out=param===void 0?new Matrix4():param;var x=q.x,y=q.y,z=q.z,w=q.w;var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;var sx=s.x,sy=s.y,sz=s.z;var vx=v.x,vy=v.y,vz=v.z;return out.set((1-(yy+zz))*sx,(xy+wz)*sx,(xz-wy)*sx,0,(xy-wz)*sy,(1-(xx+zz))*sy,(yz+wx)*sy,0,(xz+wy)*sz,(yz-wx)*sz,(1-(xx+yy))*sz,0,vx,vy,vz,1)}function Mat4FromRotationTranslationScaleOrigin(q,v,s,o,param){var out=param===void 0?new Matrix4():param;var x=q.x,y=q.y,z=q.z,w=q.w;var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;var sx=s.x,sy=s.y,sz=s.z;var ox=o.x,oy=o.y,oz=o.z;var vx=v.x,vy=v.y,vz=v.z;var out0=(1-(yy+zz))*sx;var out1=(xy+wz)*sx;var out2=(xz-wy)*sx;var out4=(xy-wz)*sy;var out5=(1-(xx+zz))*sy;var out6=(yz+wx)*sy;var out8=(xz+wy)*sz;var out9=(yz-wx)*sz;var out10=(1-(xx+yy))*sz;return out.set(out0,out1,out2,0,out4,out5,out6,0,out8,out9,out10,0,vx+ox-(out0*ox+out4*oy+out8*oz),vy+oy-(out1*ox+out5*oy+out9*oz),vz+oz-(out2*ox+out6*oy+out10*oz),1)}function Mat4FromRotationXYTranslation(rotation,position,param,param1){var translateFirst=param===void 0?true:param,out=param1===void 0?new Matrix4():param1;var x=position.x,y=position.y,z=position.z;var sx=Math.sin(rotation.x);var cx=Math.cos(rotation.x);var sy=Math.sin(rotation.y);var cy=Math.cos(rotation.y);var a30=x;var a31=y;var a32=z;var b21=-sx;var c01=0-b21*sy;var c02=0-cx*sy;var c21=b21*cy;var c22=cx*cy;if(!translateFirst){a30=cy*x+sy*z;a31=c01*x+cx*y+c21*z;a32=c02*x+sx*y+c22*z}return out.set(cy,c01,c02,0,0,cx,sx,0,sy,c21,c22,0,a30,a31,a32,1)}function Mat4FromScaling(vec3,param){var out=param===void 0?new Matrix4():param;var x=vec3.x,y=vec3.y,z=vec3.z;return out.set(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1)}function Mat4FromTranslation(vec3,param){var out=param===void 0?new Matrix4():param;var x=vec3.x,y=vec3.y,z=vec3.z;return out.set(1,0,0,0,0,1,0,0,0,0,1,0,x,y,z,1)}function Mat4FromXRotation(angle,param){var out=param===void 0?new Matrix4():param;var c=Math.cos(angle);var s=Math.sin(angle);return out.set(1,0,0,0,0,c,s,0,0,-s,c,0,0,0,0,1)}function Mat4FromYRotation(angle,param){var out=param===void 0?new Matrix4():param;var c=Math.cos(angle);var s=Math.sin(angle);return out.set(c,0,-s,0,0,1,0,0,s,0,c,0,0,0,0,1)}function Mat4FromZRotation(angle,param){var out=param===void 0?new Matrix4():param;var c=Math.cos(angle);var s=Math.sin(angle);return out.set(c,s,0,0,-s,c,0,0,0,0,1,0,0,0,0,1)}function Mat4Frustum(left,right,bottom,top,near,far,param){var out=param===void 0?new Matrix4():param;var rl=1/(right-left);var tb=1/(top-bottom);var nf=1/(near-far);return out.set(near*2*rl,0,0,0,0,near*2*tb,0,0,(right+left)*rl,(top+bottom)*tb,(far+near)*nf,-1,0,0,far*near*2*nf,0)}var Vec3=function(){"use strict";function _class(param,param1,param2){var x=param===void 0?0:param,y=param1===void 0?0:param1,z=param2===void 0?0:param2;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"x",void 0);swcHelpers.defineProperty(this,"y",void 0);swcHelpers.defineProperty(this,"z",void 0);this.set(x,y,z)}swcHelpers.createClass(_class,[{key:"set",value:function set(param,param1,param2){var x=param===void 0?0:param,y=param1===void 0?0:param1,z=param2===void 0?0:param2;this.x=x;this.y=y;this.z=z;return this}},{key:"toArray",value:function toArray(param,param1){var dst=param===void 0?[]:param,index=param1===void 0?0:param1;var ref=this,x=ref.x,y=ref.y,z=ref.z;dst[index]=x;dst[index+1]=y;dst[index+2]=z;return dst}},{key:"fromArray",value:function fromArray(src,param){var index=param===void 0?0:param;return this.set(src[index],src[index+1],src[index+2])}},{key:"toString",value:function toString(){var ref=this,x=ref.x,y=ref.y,z=ref.z;return"{ x=".concat(x,", y=").concat(y,", z=").concat(z," }")}}]);return _class}();function Mat4GetScaling(matrix2,param){var out=param===void 0?new Vec3():param;var _data=matrix2.data,m00=_data[0],m01=_data[1],m02=_data[2],m03=_data[3],m10=_data[4],m11=_data[5],m12=_data[6],m13=_data[7],m20=_data[8],m21=_data[9],m22=_data[10];return out.set(Math.hypot(m00,m01,m02),Math.hypot(m10,m11,m12),Math.hypot(m20,m21,m22))}var Quaternion=function(){"use strict";function _class(param,param1,param2,param3){var x=param===void 0?0:param,y=param1===void 0?0:param1,z=param2===void 0?0:param2,w=param3===void 0?1:param3;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"_x",void 0);swcHelpers.defineProperty(this,"_y",void 0);swcHelpers.defineProperty(this,"_z",void 0);swcHelpers.defineProperty(this,"_w",void 0);swcHelpers.defineProperty(this,"onChange",void 0);this._x=x;this._y=y;this._z=z;this._w=w;this.onChange=NOOP}swcHelpers.createClass(_class,[{key:"set",value:function set(param,param1,param2,param3){var x=param===void 0?0:param,y=param1===void 0?0:param1,z=param2===void 0?0:param2,w=param3===void 0?1:param3;this._x=x;this._y=y;this._z=z;this._w=w;this.onChange(this);return this}},{key:"x",get:function get(){return this._x},set:function set(value){var prev=this._x;this._x=value;if(value!==prev){this.onChange(this)}}},{key:"y",get:function get(){return this._y},set:function set(value){var prev=this._y;this._y=value;if(value!==prev){this.onChange(this)}}},{key:"z",get:function get(){return this._z},set:function set(value){var prev=this._z;this._z=value;if(value!==prev){this.onChange(this)}}},{key:"w",get:function get(){return this._w},set:function set(value){var prev=this._w;this._w=value;if(value!==prev){this.onChange(this)}}},{key:"toArray",value:function toArray(param,param1){var dst=param===void 0?[]:param,index=param1===void 0?0:param1;var ref=this,x=ref.x,y=ref.y,z=ref.z,w=ref.w;dst[index]=x;dst[index+1]=y;dst[index+2]=z;dst[index+3]=w;return dst}},{key:"fromArray",value:function fromArray(src,param){var index=param===void 0?0:param;return this.set(src[index],src[index+1],src[index+2],src[index+3])}},{key:"destroy",value:function destroy(){this.onChange=NOOP}},{key:"toString",value:function toString(){var ref=this,x=ref.x,y=ref.y,z=ref.z,w=ref.w;return"{ x=".concat(x,", y=").concat(y,", z=").concat(z,", w=").concat(w," }")}}]);return _class}();function Mat4GetRotation(matrix2,param){var out=param===void 0?new Quaternion():param;var scaling=Mat4GetScaling(matrix2);var is1=1/scaling.x;var is2=1/scaling.y;var is3=1/scaling.z;var _data=matrix2.data,m00=_data[0],m01=_data[1],m02=_data[2],m03=_data[3],m10=_data[4],m11=_data[5],m12=_data[6],m13=_data[7],m20=_data[8],m21=_data[9],m22=_data[10];var sm11=m00*is1;var sm12=m01*is2;var sm13=m02*is3;var sm21=m10*is1;var sm22=m11*is2;var sm23=m12*is3;var sm31=m20*is1;var sm32=m21*is2;var sm33=m22*is3;var trace=sm11+sm22+sm33;var S=0;if(trace>0){S=Math.sqrt(trace+1)*2;return out.set((sm23-sm32)/S,(sm31-sm13)/S,(sm12-sm21)/S,0.25*S)}else if(sm11>sm22&&sm11>sm33){S=Math.sqrt(1+sm11-sm22-sm33)*2;return out.set(0.25*S,(sm12+sm21)/S,(sm31+sm13)/S,(sm23-sm32)/S)}else if(sm22>sm33){S=Math.sqrt(1+sm22-sm11-sm33)*2;return out.set((sm12+sm21)/S,0.25*S,(sm23+sm32)/S,(sm31-sm13)/S)}else{S=Math.sqrt(1+sm33-sm11-sm22)*2;return out.set((sm31+sm13)/S,(sm23+sm32)/S,0.25*S,(sm12-sm21)/S)}}function Mat4GetTranslation(matrix2,param){var out=param===void 0?new Vec3():param;var data=matrix2.data;return out.set(data[12],data[13],data[14])}function Mat4Identity(param){var matrix2=param===void 0?new Matrix4():param;return matrix2.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}function Mat4Invert(matrix2,param){var out=param===void 0?new Matrix4():param;var _data=matrix2.data,m00=_data[0],m01=_data[1],m02=_data[2],m03=_data[3],m10=_data[4],m11=_data[5],m12=_data[6],m13=_data[7],m20=_data[8],m21=_data[9],m22=_data[10],m23=_data[11],m30=_data[12],m31=_data[13],m32=_data[14],m33=_data[15];var det22x33=m22*m33-m32*m23;var det21x33=m21*m33-m31*m23;var det21x32=m21*m32-m31*m22;var det20x33=m20*m33-m30*m23;var det20x32=m20*m32-m22*m30;var det20x31=m20*m31-m30*m21;var cofact00=+(m11*det22x33-m12*det21x33+m13*det21x32);var cofact01=-(m10*det22x33-m12*det20x33+m13*det20x32);var cofact02=+(m10*det21x33-m11*det20x33+m13*det20x31);var cofact03=-(m10*det21x32-m11*det20x32+m12*det20x31);var det=m00*cofact00+m01*cofact01+m02*cofact02+m03*cofact03;if(det===0){return out}var detInv=1/det;var det12x33=m12*m33-m32*m13;var det11x33=m11*m33-m31*m13;var det11x32=m11*m32-m31*m12;var det10x33=m10*m33-m30*m13;var det10x32=m10*m32-m30*m12;var det10x31=m10*m31-m30*m11;var det12x23=m12*m23-m22*m13;var det11x23=m11*m23-m21*m13;var det11x22=m11*m22-m21*m12;var det10x23=m10*m23-m20*m13;var det10x22=m10*m22-m20*m12;var det10x21=m10*m21-m20*m11;var cofact10=-(m01*det22x33-m02*det21x33+m03*det21x32);var cofact11=+(m00*det22x33-m02*det20x33+m03*det20x32);var cofact12=-(m00*det21x33-m01*det20x33+m03*det20x31);var cofact13=+(m00*det21x32-m01*det20x32+m02*det20x31);var cofact20=+(m01*det12x33-m02*det11x33+m03*det11x32);var cofact21=-(m00*det12x33-m02*det10x33+m03*det10x32);var cofact22=+(m00*det11x33-m01*det10x33+m03*det10x31);var cofact23=-(m00*det11x32-m01*det10x32+m02*det10x31);var cofact30=-(m01*det12x23-m02*det11x23+m03*det11x22);var cofact31=+(m00*det12x23-m02*det10x23+m03*det10x22);var cofact32=-(m00*det11x23-m01*det10x23+m03*det10x21);var cofact33=+(m00*det11x22-m01*det10x22+m02*det10x21);return out.set(cofact00*detInv,cofact10*detInv,cofact20*detInv,cofact30*detInv,cofact01*detInv,cofact11*detInv,cofact21*detInv,cofact31*detInv,cofact02*detInv,cofact12*detInv,cofact22*detInv,cofact32*detInv,cofact03*detInv,cofact13*detInv,cofact23*detInv,cofact33*detInv)}function Mat4LookAt(eye,center,up,param){var out=param===void 0?new Matrix4():param;var eyex=eye.x,eyey=eye.y,eyez=eye.z;var upx=up.x,upy=up.y,upz=up.z;var centerx=center.x,centery=center.y,centerz=center.z;if(Math.abs(eyex-centerx)<0.00001&&Math.abs(eyey-centery)<0.00001&&Math.abs(eyez-centerz)<0.00001){return Mat4Identity(out)}var z0=eyex-centerx;var z1=eyey-centery;var z2=eyez-centerz;var len=1/Math.hypot(z0,z1,z2);z0*=len;z1*=len;z2*=len;var x0=upy*z2-upz*z1;var x1=upz*z0-upx*z2;var x2=upx*z1-upy*z0;len=Math.hypot(x0,x1,x2);if(!len){x0=0;x1=0;x2=0}else{len=1/len;x0*=len;x1*=len;x2*=len}var y0=z1*x2-z2*x1;var y1=z2*x0-z0*x2;var y2=z0*x1-z1*x0;len=Math.hypot(y0,y1,y2);if(!len){y0=0;y1=0;y2=0}else{len=1/len;y0*=len;y1*=len;y2*=len}return out.set(x0,y0,z0,0,x1,y1,z1,0,x2,y2,z2,0,-(x0*eyex+x1*eyey+x2*eyez),-(y0*eyex+y1*eyey+y2*eyez),-(z0*eyex+z1*eyey+z2*eyez),1)}function Mat4Multiply(a,b,param){var out=param===void 0?new Matrix4():param;var _data=a.data,a00=_data[0],a01=_data[1],a02=_data[2],a03=_data[3],a10=_data[4],a11=_data[5],a12=_data[6],a13=_data[7],a20=_data[8],a21=_data[9],a22=_data[10],a23=_data[11],a30=_data[12],a31=_data[13],a32=_data[14],a33=_data[15];var _data1=b.data,b00=_data1[0],b01=_data1[1],b02=_data1[2],b03=_data1[3],b10=_data1[4],b11=_data1[5],b12=_data1[6],b13=_data1[7],b20=_data1[8],b21=_data1[9],b22=_data1[10],b23=_data1[11],b30=_data1[12],b31=_data1[13],b32=_data1[14],b33=_data1[15];return out.set(b00*a00+b01*a10+b02*a20+b03*a30,b01*a01+b01*a11+b02*a21+b03*a31,b02*a02+b01*a12+b02*a22+b03*a32,b03*a03+b01*a13+b02*a23+b03*a33,b10*a00+b11*a10+b12*a20+b13*a30,b10*a01+b11*a11+b12*a21+b13*a31,b10*a02+b11*a12+b12*a22+b13*a32,b10*a03+b11*a13+b12*a23+b13*a33,b20*a00+b21*a10+b22*a20+b23*a30,b20*a01+b21*a11+b22*a21+b23*a31,b20*a02+b21*a12+b22*a22+b23*a32,b20*a03+b21*a13+b22*a23+b23*a33,b30*a00+b31*a10+b32*a20+b33*a30,b30*a01+b31*a11+b32*a21+b33*a31,b30*a02+b31*a12+b32*a22+b33*a32,b30*a03+b31*a13+b32*a23+b33*a33)}function Mat4MultiplyScalar(matrix2,scalar,param){var out=param===void 0?new Matrix4():param;var _data=matrix2.data,a00=_data[0],a01=_data[1],a02=_data[2],a03=_data[3],a10=_data[4],a11=_data[5],a12=_data[6],a13=_data[7],a20=_data[8],a21=_data[9],a22=_data[10],a23=_data[11],a30=_data[12],a31=_data[13],a32=_data[14],a33=_data[15];return out.set(a00*scalar,a01*scalar,a02*scalar,a03*scalar,a10*scalar,a11*scalar,a12*scalar,a13*scalar,a20*scalar,a21*scalar,a22*scalar,a23*scalar,a30*scalar,a31*scalar,a32*scalar,a33*scalar)}function Mat4MultiplyScalarAndAdd(a,b,scalar,param){var out=param===void 0?new Matrix4():param;var _data=a.data,a00=_data[0],a01=_data[1],a02=_data[2],a03=_data[3],a10=_data[4],a11=_data[5],a12=_data[6],a13=_data[7],a20=_data[8],a21=_data[9],a22=_data[10],a23=_data[11],a30=_data[12],a31=_data[13],a32=_data[14],a33=_data[15];var _data1=b.data,b00=_data1[0],b01=_data1[1],b02=_data1[2],b03=_data1[3],b10=_data1[4],b11=_data1[5],b12=_data1[6],b13=_data1[7],b20=_data1[8],b21=_data1[9],b22=_data1[10],b23=_data1[11],b30=_data1[12],b31=_data1[13],b32=_data1[14],b33=_data1[15];return out.set(a00+b00*scalar,a01+b01*scalar,a02+b02*scalar,a03+b03*scalar,a10+b10*scalar,a11+b11*scalar,a12+b12*scalar,a13+b13*scalar,a20+b20*scalar,a21+b21*scalar,a22+b22*scalar,a23+b23*scalar,a30+b30*scalar,a31+b31*scalar,a32+b32*scalar,a33+b33*scalar)}function Mat4Perspective(fovY,aspect,near,far,param){var out=param===void 0?new Matrix4():param;var f=1/Math.tan(fovY/2);var m22=-1;var m32=-2*near;if(far!==null&&far!==Infinity){var nf=1/(near-far);m22=(far+near)*nf;m32=2*far*near*nf}return out.set(f/aspect,0,0,0,0,f,0,0,0,0,m22,-1,0,0,m32,0)}function Mat4PerspectiveFromFieldOfView(fov,near,far,param){var out=param===void 0?new Matrix4():param;var upTan=Math.tan(fov.upDegrees*Math.PI/180);var downTan=Math.tan(fov.downDegrees*Math.PI/180);var leftTan=Math.tan(fov.leftDegrees*Math.PI/180);var rightTan=Math.tan(fov.rightDegrees*Math.PI/180);var xScale=2/(leftTan+rightTan);var yScale=2/(upTan+downTan);return out.set(xScale,0,0,0,0,yScale,0,0,-((leftTan-rightTan)*xScale*0.5),(upTan-downTan)*yScale*0.5,far/(near-far),-1,0,0,far*near/(near-far),0)}function Mat4Rotate(matrix2,angle,axis,param){var out=param===void 0?new Matrix4():param;var x=axis.x,y=axis.y,z=axis.z;var len=Math.hypot(x,y,z);if(len<0.00001){return null}len=1/len;x*=len;y*=len;z*=len;var s=Math.sin(angle);var c=Math.cos(angle);var t=1-c;var _data=matrix2.data,a00=_data[0],a01=_data[1],a02=_data[2],a03=_data[3],a10=_data[4],a11=_data[5],a12=_data[6],a13=_data[7],a20=_data[8],a21=_data[9],a22=_data[10],a23=_data[11],a30=_data[12],a31=_data[13],a32=_data[14],a33=_data[15];var b00=x*x*t+c;var b01=y*x*t+z*s;var b02=z*x*t-y*s;var b10=x*y*t-z*s;var b11=y*y*t+c;var b12=z*y*t+x*s;var b20=x*z*t+y*s;var b21=y*z*t-x*s;var b22=z*z*t+c;return out.set(a00*b00+a10*b01+a20*b02,a01*b00+a11*b01+a21*b02,a02*b00+a12*b01+a22*b02,a03*b00+a13*b01+a23*b02,a00*b10+a10*b11+a20*b12,a01*b10+a11*b11+a21*b12,a02*b10+a12*b11+a22*b12,a03*b10+a13*b11+a23*b12,a00*b20+a10*b21+a20*b22,a01*b20+a11*b21+a21*b22,a02*b20+a12*b21+a22*b22,a03*b20+a13*b21+a23*b22,a30,a31,a32,a33)}function Mat4RotateX(matrix2,angle,param){var out=param===void 0?new Matrix4():param;var s=Math.sin(angle);var c=Math.cos(angle);var _data=matrix2.data,a00=_data[0],a01=_data[1],a02=_data[2],a03=_data[3],a10=_data[4],a11=_data[5],a12=_data[6],a13=_data[7],a20=_data[8],a21=_data[9],a22=_data[10],a23=_data[11],a30=_data[12],a31=_data[13],a32=_data[14],a33=_data[15];return out.set(a00,a01,a02,a03,a10*c+a20*s,a11*c+a21*s,a12*c+a22*s,a13*c+a23*s,a20*c-a10*s,a21*c-a11*s,a22*c-a12*s,a23*c-a13*s,a30,a31,a32,a33)}function Mat4RotateY(matrix2,angle,param){var out=param===void 0?new Matrix4():param;var s=Math.sin(angle);var c=Math.cos(angle);var _data=matrix2.data,a00=_data[0],a01=_data[1],a02=_data[2],a03=_data[3],a10=_data[4],a11=_data[5],a12=_data[6],a13=_data[7],a20=_data[8],a21=_data[9],a22=_data[10],a23=_data[11],a30=_data[12],a31=_data[13],a32=_data[14],a33=_data[15];return out.set(a00*c-a20*s,a01*c-a21*s,a02*c-a22*s,a03*c-a23*s,a10,a11,a12,a13,a00*s+a20*c,a01*s+a21*c,a02*s+a22*c,a03*s+a23*c,a30,a31,a32,a33)}function Mat4RotateZ(matrix2,angle,param){var out=param===void 0?new Matrix4():param;var s=Math.sin(angle);var c=Math.cos(angle);var _data=matrix2.data,a00=_data[0],a01=_data[1],a02=_data[2],a03=_data[3],a10=_data[4],a11=_data[5],a12=_data[6],a13=_data[7],a20=_data[8],a21=_data[9],a22=_data[10],a23=_data[11],a30=_data[12],a31=_data[13],a32=_data[14],a33=_data[15];return out.set(a00*c+a10*s,a01*c+a11*s,a02*c+a12*s,a03*c+a13*s,a10*c-a00*s,a11*c-a01*s,a12*c-a02*s,a13*c-a03*s,a20,a21,a22,a23,a30,a31,a32,a33)}function Mat4Scale(matrix2,v,param){var out=param===void 0?new Matrix4():param;var _data=matrix2.data,m00=_data[0],m01=_data[1],m02=_data[2],m03=_data[3],m10=_data[4],m11=_data[5],m12=_data[6],m13=_data[7],m20=_data[8],m21=_data[9],m22=_data[10],m23=_data[11],m30=_data[12],m31=_data[13],m32=_data[14],m33=_data[15];var x=v.x,y=v.y,z=v.z;return out.set(m00*x,m01*x,m02*x,m03*x,m10*y,m11*y,m12*y,m13*y,m20*z,m21*z,m22*z,m23*z,m30,m31,m32,m33)}function Mat4SetTranslation(matrix2,vec3){var data=matrix2.data;var x=vec3.x,y=vec3.y,z=vec3.z;data[12]=x;data[13]=y;data[14]=z;matrix2.onChange(matrix2);return matrix2}function Mat4SetTranslationFromFloats(matrix2,x,y,z){var data=matrix2.data;data[12]=x;data[13]=y;data[14]=z;matrix2.onChange(matrix2);return matrix2}function Mat4Subtract(a,b,param){var out=param===void 0?new Matrix4():param;var _data=a.data,a00=_data[0],a01=_data[1],a02=_data[2],a03=_data[3],a10=_data[4],a11=_data[5],a12=_data[6],a13=_data[7],a20=_data[8],a21=_data[9],a22=_data[10],a23=_data[11],a30=_data[12],a31=_data[13],a32=_data[14],a33=_data[15];var _data1=b.data,b00=_data1[0],b01=_data1[1],b02=_data1[2],b03=_data1[3],b10=_data1[4],b11=_data1[5],b12=_data1[6],b13=_data1[7],b20=_data1[8],b21=_data1[9],b22=_data1[10],b23=_data1[11],b30=_data1[12],b31=_data1[13],b32=_data1[14],b33=_data1[15];return out.set(a00-b00,a01-b01,a02-b02,a03-b03,a10-b10,a11-b11,a12-b12,a13-b13,a20-b20,a21-b21,a22-b22,a23-b23,a30-b30,a31-b31,a32-b32,a33-b33)}function Mat4TargetTo(eye,target,up,param){var out=param===void 0?new Matrix4():param;var eyex=eye.x,eyey=eye.y,eyez=eye.z;var upx=up.x,upy=up.y,upz=up.z;var targetx=target.x,targety=target.y,targetz=target.z;var z0=eyex-targetx;var z1=eyey-targety;var z2=eyez-targetz;var len=z0*z0+z1*z1+z2*z2;if(len>0){len=1/Math.sqrt(len);z0*=len;z1*=len;z2*=len}var x0=upy*z2-upz*z1;var x1=upz*z0-upx*z2;var x2=upx*z1-upy*z0;len=x0*x0+x1*x1+x2*x2;if(len>0){len=1/Math.sqrt(len);x0*=len;x1*=len;x2*=len}return out.set(x0,x1,x2,0,z1*x2-z2*x1,z2*x0-z0*x2,z0*x1-z1*x0,0,z0,z1,z2,0,eyex,eyey,eyez,1)}function Mat4Translate(matrix2,vec3,param){var out=param===void 0?new Matrix4():param;var x=vec3.x,y=vec3.y,z=vec3.z;var data=matrix2.data;var a00=data[0],a01=data[1],a02=data[2],a03=data[3],a10=data[4],a11=data[5],a12=data[6],a13=data[7],a20=data[8],a21=data[9],a22=data[10],a23=data[11],a30=data[12],a31=data[13],a32=data[14],a33=data[15];if(matrix2===out){data[12]=a00*x+a10*y+a20*z+a30;data[13]=a01*x+a11*y+a21*z+a31;data[14]=a02*x+a12*y+a22*z+a32;data[15]=a03*x+a13*y+a23*z+a33}else{out.set(a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,a00*x+a10*y+a20*z+a30,a01*x+a11*y+a21*z+a31,a02*x+a12*y+a22*z+a32,a03*x+a13*y+a23*z+a33)}return out}function Mat4TranslateFromFloats(matrix2,x,y,z,param){var out=param===void 0?new Matrix4():param;var data=matrix2.data;var a00=data[0],a01=data[1],a02=data[2],a03=data[3],a10=data[4],a11=data[5],a12=data[6],a13=data[7],a20=data[8],a21=data[9],a22=data[10],a23=data[11],a30=data[12],a31=data[13],a32=data[14],a33=data[15];if(matrix2===out){data[12]=a00*x+a10*y+a20*z+a30;data[13]=a01*x+a11*y+a21*z+a31;data[14]=a02*x+a12*y+a22*z+a32;data[15]=a03*x+a13*y+a23*z+a33}else{out.set(a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,a00*x+a10*y+a20*z+a30,a01*x+a11*y+a21*z+a31,a02*x+a12*y+a22*z+a32,a03*x+a13*y+a23*z+a33)}return out}function Mat4Transpose(matrix2,param){var out=param===void 0?new Matrix4():param;var _data=matrix2.data,m00=_data[0],m01=_data[1],m02=_data[2],m03=_data[3],m10=_data[4],m11=_data[5],m12=_data[6],m13=_data[7],m20=_data[8],m21=_data[9],m22=_data[10],m23=_data[11],m30=_data[12],m31=_data[13],m32=_data[14],m33=_data[15];return out.set(m00,m10,m20,m30,m01,m11,m21,m31,m02,m12,m22,m32,m03,m13,m23,m33)}function Mat4Zero(matrix2){return matrix2.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}var pow2_exports={};__export(pow2_exports,{GetPowerOfTwo:function(){return GetPowerOfTwo},IsSizePowerOfTwo:function(){return IsSizePowerOfTwo},IsValuePowerOfTwo:function(){return IsValuePowerOfTwo}});function GetPowerOfTwo(value){var index=Math.log(value)/0.6931471805599453;return 1<<Math.ceil(index)}function IsValuePowerOfTwo(value){return value>0&&(value&value-1)===0}var quaternion_exports={};__export(quaternion_exports,{GetQuatAngle:function(){return GetQuatAngle},GetQuatAngleTo:function(){return GetQuatAngleTo},GetQuatAreClose:function(){return GetQuatAreClose},GetQuatAxisAngle:function(){return GetQuatAxisAngle},GetQuatLength:function(){return GetQuatLength},GetQuatLengthSquared:function(){return GetQuatLengthSquared},QuatAdd:function(){return QuatAdd},QuatAddScalar:function(){return QuatAddScalar},QuatClone:function(){return QuatClone},QuatConjugate:function(){return QuatConjugate},QuatCopyFrom:function(){return QuatCopyFrom},QuatDot:function(){return QuatDot},QuatEquals:function(){return QuatEquals},QuatFromEulerAngles:function(){return QuatFromEulerAngles},QuatFromEulerVector:function(){return QuatFromEulerVector},QuatFromRotationAxis:function(){return QuatFromRotationAxis},QuatFromRotationMatrix:function(){return QuatFromRotationMatrix},QuatFuzzyEquals:function(){return QuatFuzzyEquals},QuatHermite:function(){return QuatHermite},QuatInvert:function(){return QuatInvert},QuatMultiply:function(){return QuatMultiply},QuatMultiplyByFloats:function(){return QuatMultiplyByFloats},QuatNormalize:function(){return QuatNormalize},QuatRotateTowards:function(){return QuatRotateTowards},QuatRotateX:function(){return QuatRotateX},QuatRotateY:function(){return QuatRotateY},QuatRotateZ:function(){return QuatRotateZ},QuatRotationAlphaBetaGamma:function(){return QuatRotationAlphaBetaGamma},QuatRotationYawPitchRoll:function(){return QuatRotationYawPitchRoll},QuatScale:function(){return QuatScale},QuatScaleAndAdd:function(){return QuatScaleAndAdd},QuatSetAxisAngle:function(){return QuatSetAxisAngle},QuatSetFromUnitVectors:function(){return QuatSetFromUnitVectors},QuatSlerp:function(){return QuatSlerp},QuatSubtract:function(){return QuatSubtract},QuatSubtractScalar:function(){return QuatSubtractScalar},QuatToEulerAngles:function(){return QuatToEulerAngles},QuatZero:function(){return QuatZero},Quaternion:function(){return Quaternion}});function QuatDot(a,b){return a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w}function GetQuatAngle(a,b){var dot=QuatDot(a,b);return Math.acos(2*dot*dot-1)}function GetQuatAngleTo(a,b){return 2*Math.acos(Math.abs(Clamp(QuatDot(a,b),-1,1)))}function GetQuatAreClose(a,b){return QuatDot(a,b)>=0}function GetQuatAxisAngle(a,param){var out=param===void 0?new Quaternion():param;var rad=Math.acos(a.w)*2;var s=Math.sin(rad/2);var epsilon=0.000001;if(s>epsilon){out.set(a.x/s,a.y/s,a.z/s)}else{out.set(1,0,0)}return rad}function GetQuatLength(a){var x=a.x,y=a.y,z=a.z,w=a.w;return Math.sqrt(x*x+y*y+z*z+w*w)}function GetQuatLengthSquared(a){var x=a.x,y=a.y,z=a.z,w=a.w;return x*x+y*y+z*z+w*w}function QuatAdd(a,b,param){var out=param===void 0?new Quaternion():param;return out.set(a.x+b.x,a.y+b.y,a.z+b.z,a.w+b.w)}function QuatAddScalar(a,scalar,param){var out=param===void 0?new Quaternion():param;return out.set(a.x+scalar,a.y+scalar,a.z+scalar,a.w+scalar)}function QuatClone(source){var x=source.x,y=source.y,z=source.z,w=source.w;return new Quaternion(x,y,z,w)}function QuatConjugate(a,param){var out=param===void 0?new Quaternion():param;var x=a.x,y=a.y,z=a.z,w=a.w;return out.set(x*-1,y*-1,z*-1,w)}function QuatCopyFrom(source,dest){var x=source.x,y=source.y,z=source.z,w=source.w;return dest.set(x,y,z,w)}function QuatEquals(a,b){return a.x===b.x&&a.y===b.y&&a.z===b.z&&a.w===b.w}function QuatRotationYawPitchRoll(yaw,pitch,roll,param){var out=param===void 0?new Quaternion():param;var halfRoll=roll*0.5;var halfPitch=pitch*0.5;var halfYaw=yaw*0.5;var sinRoll=Math.sin(halfRoll);var cosRoll=Math.cos(halfRoll);var sinPitch=Math.sin(halfPitch);var cosPitch=Math.cos(halfPitch);var sinYaw=Math.sin(halfYaw);var cosYaw=Math.cos(halfYaw);return out.set(cosYaw*sinPitch*cosRoll+sinYaw*cosPitch*sinRoll,sinYaw*cosPitch*cosRoll-cosYaw*sinPitch*sinRoll,cosYaw*cosPitch*sinRoll-sinYaw*sinPitch*cosRoll,cosYaw*cosPitch*cosRoll+sinYaw*sinPitch*sinRoll)}function QuatFromEulerAngles(x,y,z,param){var out=param===void 0?new Quaternion():param;return QuatRotationYawPitchRoll(y,x,z,out)}function QuatFromEulerVector(v,param){var out=param===void 0?new Quaternion():param;return QuatRotationYawPitchRoll(v.y,v.x,v.z,out)}function Vec3Normalize(a,param){var out=param===void 0?new Vec3():param;var x=a.x,y=a.y,z=a.z;var len=x*x+y*y+z*z;if(len>0){len=1/Math.sqrt(len)}return out.set(x*len,y*len,z*len)}function QuatFromRotationAxis(axis,angle,param){var out=param===void 0?new Quaternion():param;var sin=Math.sin(angle/2);Vec3Normalize(axis,axis);var x=axis.x,y=axis.y,z=axis.z;return out.set(x*sin,y*sin,z*sin,Math.cos(angle/2))}function QuatFromRotationMatrix(matrix2,param){var out=param===void 0?new Quaternion():param;var _data=matrix2.data,m11=_data[0],m21=_data[1],m31=_data[2],m41=_data[3],m12=_data[4],m22=_data[5],m32=_data[6],m42=_data[7],m13=_data[8],m23=_data[9],m33=_data[10];var trace=m11+m22+m33;var s;if(trace>0){s=0.5/Math.sqrt(trace+1);return out.set((m32-m23)*s,(m13-m31)*s,(m21-m12)*s,0.25/s)}else if(m11>m22&&m11>m33){s=2*Math.sqrt(1+m11-m22-m33);return out.set(0.25*s,(m12+m21)/s,(m13+m31)/s,(m32-m23)/s)}else if(m22>m33){s=2*Math.sqrt(1+m22-m11-m33);return out.set((m12+m21)/s,0.25*s,(m23+m32)/s,(m13-m31)/s)}else{s=2*Math.sqrt(1+m33-m11-m22);return out.set((m13+m31)/s,(m23+m32)/s,0.25*s,(m21-m12)/s)}}function QuatFuzzyEquals(a,b,param){var epsilon=param===void 0?0.0001:param;return FuzzyEqual(a.x,b.x,epsilon)&&FuzzyEqual(a.y,b.y,epsilon)&&FuzzyEqual(a.z,b.z,epsilon)&&FuzzyEqual(a.w,b.w,epsilon)}function Hermite(a,b,c,d,t){var squared=t*t;var factor1=squared*(2*t-3)+1;var factor2=squared*(t-2)+t;var factor3=squared*(t-1);var factor4=squared*(3-2*t);return a*factor1+b*factor2+c*factor3+d*factor4}function QuatHermite(a,b,c,d,t,param){var out=param===void 0?new Quaternion():param;return out.set(Hermite(t,a.x,b.x,c.x,d.x),Hermite(t,a.y,b.y,c.y,d.y),Hermite(t,a.z,b.z,c.z,d.z),Hermite(t,a.w,b.w,c.w,d.w))}function QuatInvert(a,param){var out=param===void 0?new Quaternion():param;var x=a.x,y=a.y,z=a.z,w=a.w;var dot=x*x+y*y+z*z+w*w;var invDot=dot?1/dot:0;return out.set(-x*invDot,-y*invDot,-z*invDot,w*invDot)}function QuatMultiply(a,b,param){var out=param===void 0?new Quaternion():param;var ax=a.x,ay=a.y,az=a.z,aw=a.w;var bx=b.x,by=b.y,bz=b.z,bw=b.w;return out.set(ax*bw+aw*bx+ay*bz-az*by,ay*bw+aw*by+az*bx-ax*bz,az*bw+aw*bz+ax*by-ay*bx,aw*bw-ax*bx-ay*by-az*bz)}function QuatMultiplyByFloats(a,x,y,z,w,param){var out=param===void 0?new Quaternion():param;return out.set(a.x*x,a.y*y,a.z*z,a.w*w)}function QuatScale(a,scalar,param){var out=param===void 0?new Quaternion():param;var x=a.x,y=a.y,z=a.z,w=a.w;return out.set(x*scalar,y*scalar,z*scalar,w*scalar)}function QuatNormalize(a,param){var out=param===void 0?new Quaternion():param;var length=GetQuatLength(a);if(length===0){return out.set(0,0,0,1)}else{return QuatScale(a,length,out)}}function QuatSlerp(a,b,t,param){var out=param===void 0?new Quaternion():param;if(t===0){return QuatCopyFrom(a,out)}else if(t===1){return QuatCopyFrom(b,out)}var x=a.x,y=a.y,z=a.z,w=a.w;var bx=b.x,by=b.y,bz=b.z,bw=b.w;var cosHalfTheta=w*bw+x*bx+y*by+z*bz;if(cosHalfTheta<0){out.set(-bx,-by,-bz,-bw);cosHalfTheta=-cosHalfTheta}else{QuatCopyFrom(b,out)}if(cosHalfTheta>=1){return out.set(x,y,z,w)}var sqrSinHalfTheta=1-cosHalfTheta*cosHalfTheta;if(sqrSinHalfTheta<=Number.EPSILON){var s=1-t;out.set(s*x+t*out.x,s*y+t*out.y,s*z+t*out.z,s*w+t*out.w);return QuatNormalize(out,out)}var sinHalfTheta=Math.sqrt(sqrSinHalfTheta);var halfTheta=Math.atan2(sinHalfTheta,cosHalfTheta);var ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta;var ratioB=Math.sin(t*halfTheta)/sinHalfTheta;return out.set(x*ratioA+out.x*ratioB,y*ratioA+out.y*ratioB,z*ratioA+out.z*ratioB,w*ratioA+out.w*ratioB)}function QuatRotateTowards(a,b,step,param){var out=param===void 0?new Quaternion():param;var angle=GetQuatAngle(a,b);if(angle===0){return QuatCopyFrom(a,out)}var t=Math.min(1,step/angle);return QuatSlerp(a,b,t,out)}function QuatRotateX(a,angle,param){var out=param===void 0?new Quaternion():param;angle*=0.5;var x=a.x,y=a.y,z=a.z,w=a.w;var bx=Math.sin(angle);var bw=Math.cos(angle);return out.set(x*bw+w*bx,y*bw+z*bx,z*bw-y*bx,w*bw-x*bx)}function QuatRotateY(a,angle,param){var out=param===void 0?new Quaternion():param;angle*=0.5;var x=a.x,y=a.y,z=a.z,w=a.w;var by=Math.sin(angle);var bw=Math.cos(angle);return out.set(x*bw-z*by,y*bw+w*by,z*bw+x*by,w*bw-y*by)}function QuatRotateZ(a,angle,param){var out=param===void 0?new Quaternion():param;angle*=0.5;var x=a.x,y=a.y,z=a.z,w=a.w;var bz=Math.sin(angle);var bw=Math.cos(angle);return out.set(x*bw+y*bz,y*bw-x*bz,z*bw+w*bz,w*bw-z*bz)}function QuatRotationAlphaBetaGamma(alpha,beta,gamma,param){var out=param===void 0?new Quaternion():param;var halfGammaPlusAlpha=(gamma+alpha)*0.5;var halfGammaMinusAlpha=(gamma-alpha)*0.5;var halfBeta=beta*0.5;return out.set(Math.cos(halfGammaMinusAlpha)*Math.sin(halfBeta),Math.sin(halfGammaMinusAlpha)*Math.sin(halfBeta),Math.sin(halfGammaPlusAlpha)*Math.cos(halfBeta),Math.cos(halfGammaPlusAlpha)*Math.cos(halfBeta))}function QuatScaleAndAdd(a,b,scalar,param){var out=param===void 0?new Quaternion():param;return out.set(a.x+b.x*scalar,a.y+b.y*scalar,a.z+b.z*scalar,a.w+b.w*scalar)}function QuatSetAxisAngle(axis,angle,param){var out=param===void 0?new Quaternion():param;var x=axis.x,y=axis.y,z=axis.z;angle*=0.5;var s=Math.sin(angle);return out.set(x*s,y*s,z*s,Math.cos(angle))}function Vec3Dot(a,b){return a.x*b.x+a.y*b.y+a.z*b.z}function QuatSetFromUnitVectors(a,from,to,param){var out=param===void 0?new Quaternion():param;var fx=from.x,fy=from.y,fz=from.z;var tx=to.x,ty=to.y,tz=to.z;var epsilon=0.000001;var r=Vec3Dot(from,to)+1;if(r<epsilon){r=0;if(Math.abs(fx)>Math.abs(fz)){return out.set(-fy,fx,0,r)}else{return out.set(0,-fz,fy,r)}}else{return out.set(fy*tz-fz*ty,fz*tx-fx*tz,fx*ty-fy*tx,r)}}function QuatSubtract(a,b,param){var out=param===void 0?new Quaternion():param;return out.set(a.x-b.x,a.y-b.y,a.z-b.z,a.w-b.w)}function QuatSubtractScalar(a,scalar,param){var out=param===void 0?new Quaternion():param;var x=a.x,y=a.y,z=a.z,w=a.w;return out.set(x-scalar,y-scalar,z-scalar,w-scalar)}function QuatToEulerAngles(q,param){var out=param===void 0?new Vec3():param;var x=q.x,y=q.y,z=q.z,w=q.w;var sqw=w*w;var sqz=z*z;var sqx=x*x;var sqy=y*y;var zAxisY=y*z-x*w;var limit=0.4999999;if(zAxisY< -limit){return out.set(Math.PI/2,2*Math.atan2(y,w),0)}else if(zAxisY>limit){return out.set(-Math.PI/2,2*Math.atan2(y,w),0)}else{return out.set(Math.asin(-2*(z*y-x*w)),Math.atan2(2*(z*x+y*w),sqz-sqx-sqy+sqw),Math.atan2(2*(x*y+z*w),-sqz-sqx+sqy+sqw))}}function QuatZero(){return new Quaternion(0,0,0,0)}var snap_exports={};__export(snap_exports,{SnapCeil:function(){return SnapCeil},SnapFloor:function(){return SnapFloor},SnapTo:function(){return SnapTo}});function SnapCeil(value,gap,param,param1){var start=param===void 0?0:param,divide=param1===void 0?false:param1;if(gap===0){return value}value-=start;value=gap*Math.ceil(value/gap);return divide?(start+value)/gap:start+value}function SnapFloor(value,gap,param,param1){var start=param===void 0?0:param,divide=param1===void 0?false:param1;if(gap===0){return value}value-=start;value=gap*Math.floor(value/gap);return divide?(start+value)/gap:start+value}function SnapTo(value,gap,param,param1){var start=param===void 0?0:param,divide=param1===void 0?false:param1;if(gap===0){return value}value-=start;value=gap*Math.round(value/gap);return divide?(start+value)/gap:start+value}var vec2_exports={};__export(vec2_exports,{GetChebyshevDistance:function(){return GetChebyshevDistance},GetDistanceFromSegment:function(){return GetDistanceFromSegment},GetVec2Angle:function(){return GetVec2Angle},GetVec2AngleY:function(){return GetVec2AngleY},GetVec2Distance:function(){return GetVec2Distance},GetVec2DistancePower:function(){return GetVec2DistancePower},GetVec2DistanceSquared:function(){return GetVec2DistanceSquared},GetVec2Length:function(){return GetVec2Length},GetVec2LengthSquared:function(){return GetVec2LengthSquared},GetVec2ManhattanDistance:function(){return GetVec2ManhattanDistance},GetVec2ManhattanLength:function(){return GetVec2ManhattanLength},Vec2:function(){return Vec2},Vec2Abs:function(){return Vec2Abs},Vec2Add:function(){return Vec2Add},Vec2AddScalar:function(){return Vec2AddScalar},Vec2Bezier:function(){return Vec2Bezier},Vec2Callback:function(){return Vec2Callback},Vec2CatmullRom:function(){return Vec2CatmullRom},Vec2Ceil:function(){return Vec2Ceil},Vec2Center:function(){return Vec2Center},Vec2Clamp:function(){return Vec2Clamp},Vec2ClampScalar:function(){return Vec2ClampScalar},Vec2Clone:function(){return Vec2Clone},Vec2CopyFrom:function(){return Vec2CopyFrom},Vec2Cross:function(){return Vec2Cross},Vec2Divide:function(){return Vec2Divide},Vec2DivideScalar:function(){return Vec2DivideScalar},Vec2Dot:function(){return Vec2Dot},Vec2Equals:function(){return Vec2Equals},Vec2Floor:function(){return Vec2Floor},Vec2Fract:function(){return Vec2Fract},Vec2FromArray:function(){return Vec2FromArray},Vec2FromGridIndex:function(){return Vec2FromGridIndex},Vec2FromTransform:function(){return Vec2FromTransform},Vec2FuzzyEquals:function(){return Vec2FuzzyEquals},Vec2Hermite:function(){return Vec2Hermite},Vec2Inverse:function(){return Vec2Inverse},Vec2Lerp:function(){return Vec2Lerp},Vec2Limit:function(){return Vec2Limit},Vec2Max:function(){return Vec2Max},Vec2Min:function(){return Vec2Min},Vec2Multiply:function(){return Vec2Multiply},Vec2MultiplyByFloats:function(){return Vec2MultiplyByFloats},Vec2Negate:function(){return Vec2Negate},Vec2Normalize:function(){return Vec2Normalize},Vec2One:function(){return Vec2One},Vec2PerpDot:function(){return Vec2PerpDot},Vec2Random:function(){return Vec2Random},Vec2Rotate:function(){return Vec2Rotate},Vec2Round:function(){return Vec2Round},Vec2RoundToZero:function(){return Vec2RoundToZero},Vec2Scale:function(){return Vec2Scale},Vec2ScaleAndAdd:function(){return Vec2ScaleAndAdd},Vec2SetLength:function(){return Vec2SetLength},Vec2Subtract:function(){return Vec2Subtract},Vec2SubtractScalar:function(){return Vec2SubtractScalar},Vec2ToArray:function(){return Vec2ToArray},Vec2Transform:function(){return Vec2Transform},Vec2TransformMat2d:function(){return Vec2TransformMat2d},Vec2TransformMat4:function(){return Vec2TransformMat4},Vec2Zero:function(){return Vec2Zero}});function GetChebyshevDistance(a,b){return Math.max(Math.abs(a.x-b.x),Math.abs(a.y-b.y))}function Vec2Add(a,b,param){var out=param===void 0?new Vec2():param;return out.set(a.x+b.x,a.y+b.y)}function Vec2Dot(a,b){return a.x*b.x+a.y*b.y}function Vec2MultiplyByFloats(a,x,y,param){var out=param===void 0?new Vec2():param;return out.set(a.x*x,a.y*y)}function Vec2Subtract(a,b,param){var out=param===void 0?new Vec2():param;return out.set(a.x-b.x,a.y-b.y)}function GetDistanceFromSegment(p,a,b){var d=GetVec2DistanceSquared(a,b);if(d===0){return GetVec2Distance(p,a)}var v=Vec2Subtract(b,a);Vec2Subtract(p,a,p);var t=Math.max(0,Math.min(1,Vec2Dot(p,v)/12));var proj=Vec2Add(a,Vec2MultiplyByFloats(v,t,t,v));return GetVec2Distance(p,proj)}function GetVec2Angle(a,b){return Math.atan2(b.y-a.y,b.x-a.x)}function GetVec2AngleY(a,b){return Math.atan2(b.x-a.x,b.y-a.y)}function GetVec2DistancePower(a,b,param){var pow=param===void 0?2:param;return Math.sqrt(Math.pow(b.x-a.x,pow)+Math.pow(b.y-a.y,pow))}function GetVec2Length(a){return Math.sqrt(a.x*a.x+a.y*a.y)}function GetVec2LengthSquared(a){return a.x*a.x+a.y*a.y}function GetVec2ManhattanDistance(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)}function GetVec2ManhattanLength(a){return Math.abs(a.x)+Math.abs(a.y)}function Vec2Abs(a,param){var out=param===void 0?new Vec2():param;return out.set(Math.abs(a.x),Math.abs(a.y))}function Vec2AddScalar(a,scalar,param){var out=param===void 0?new Vec2():param;return out.set(a.x+scalar,a.y+scalar)}function Bezier(a,b,c,d,t){var inverseFactor=1-t;var inverseFactorTimesTwo=inverseFactor*inverseFactor;var factorTimes2=t*t;var factor1=inverseFactorTimesTwo*inverseFactor;var factor2=3*t*inverseFactorTimesTwo;var factor3=3*factorTimes2*inverseFactor;var factor4=factorTimes2*t;return a*factor1+b*factor2+c*factor3+d*factor4}function Vec2Bezier(a,b,c,d,t,param){var out=param===void 0?new Vec2():param;return out.set(Bezier(a.x,b.x,c.x,d.x,t),Bezier(a.y,b.y,c.y,d.y,t))}var Vec2Callback=function(){"use strict";function _class(onChange,param,param1){var x=param===void 0?0:param,y=param1===void 0?0:param1;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"_x",void 0);swcHelpers.defineProperty(this,"_y",void 0);swcHelpers.defineProperty(this,"onChange",void 0);this._x=x;this._y=y;this.onChange=onChange}swcHelpers.createClass(_class,[{key:"destroy",value:function destroy(){this.onChange=NOOP}},{key:"set",value:function set(param,param1){var x=param===void 0?0:param,y=param1===void 0?0:param1;this._x=x;this._y=y;if(this.onChange){this.onChange(this)}return this}},{key:"x",get:function get(){return this._x},set:function set(value){var prev=this._x;this._x=value;if(prev!==value){this.onChange(this)}}},{key:"y",get:function get(){return this._y},set:function set(value){var prev=this._y;this._y=value;if(prev!==value){this.onChange(this)}}},{key:"toArray",value:function toArray(param,param1){var dst=param===void 0?[]:param,index=param1===void 0?0:param1;var ref=this,x=ref.x,y=ref.y;dst[index]=x;dst[index+1]=y;return dst}},{key:"fromArray",value:function fromArray(src,param){var index=param===void 0?0:param;return this.set(src[index],src[index+1])}},{key:"toString",value:function toString(){var ref=this,x=ref.x,y=ref.y;return"{ x=".concat(x,", y=").concat(y," }")}}]);return _class}();function Vec2CatmullRom(p1,p2,p3,p4,t,param){var out=param===void 0?new Vec2():param;return out.set(CatmullRom(t,p1.x,p2.x,p3.x,p4.x),CatmullRom(t,p1.y,p2.y,p3.y,p4.y))}function Vec2Ceil(a,param){var out=param===void 0?new Vec2():param;return out.set(Math.ceil(a.x),Math.ceil(a.y))}function Vec2Scale(a,scalar,param){var out=param===void 0?new Vec2():param;return out.set(a.x*scalar,a.y*scalar)}function Vec2Center(a,b,param){var out=param===void 0?new Vec2():param;Vec2Add(a,b,out);return Vec2Scale(out,0.5,out)}function Vec2Clamp(a,min,max,param){var out=param===void 0?new Vec2():param;return out.set(Clamp(a.x,min.x,max.x),Clamp(a.y,min.y,max.y))}function Vec2ClampScalar(a,min,max,param){var out=param===void 0?new Vec2():param;return out.set(Clamp(a.x,min,max),Clamp(a.y,min,max))}function Vec2Clone(source){return new Vec2(source.x,source.y)}function Vec2CopyFrom(source,dest){return dest.set(source.x,source.y)}function Vec2Cross(a,b){return a.x*b.y-a.y*b.x}function Vec2Divide(a,b,param){var out=param===void 0?new Vec2():param;return out.set(a.x/b.x,a.y/b.y)}function Vec2DivideScalar(a,scalar,param){var out=param===void 0?new Vec2():param;return out.set(a.x/scalar,a.y/scalar)}function Vec2Equals(a,b){return a.x===b.x&&a.y===b.y}function Vec2Floor(a,param){var out=param===void 0?new Vec2():param;return out.set(Math.floor(a.x),Math.floor(a.y))}function Vec2Fract(a,param){var out=param===void 0?new Vec2():param;return out.set(a.x-Math.floor(a.x),a.y-Math.floor(a.y))}function Vec2FromGridIndex(index,width,height,param){var out=param===void 0?new Vec2():param;var x=0;var y=0;var total=width*height;if(index>0&&index<=total){if(index>width-1){y=Math.floor(index/width);x=index-y*width}else{x=index}out.set(x,y)}return out}function Vec2FromTransform(x,y,positionX,positionY,rotation,scaleX,scaleY,param){var out=param===void 0?new Vec2():param;var sin=Math.sin(rotation);var cos=Math.cos(rotation);var a=cos*scaleX;var b=sin*scaleX;var c=-sin*scaleY;var d=cos*scaleY;var id=1/(a*d+c*-b);return out.set(d*id*x+-c*id*y+(positionY*c-positionX*d)*id,a*id*y+-b*id*x+(-positionY*a+positionX*b)*id)}function Vec2FuzzyEquals(a,b,param){var epsilon=param===void 0?0.0001:param;return FuzzyEqual(a.x,b.x,epsilon)&&FuzzyEqual(a.y,b.y,epsilon)}function Vec2Hermite(a,b,c,d,t,param){var out=param===void 0?new Vec2():param;return out.set(Hermite(a.x,b.x,c.x,d.x,t),Hermite(a.y,b.y,c.y,d.y,t))}function Vec2Inverse(a,param){var out=param===void 0?new Vec2():param;return out.set(1/a.x,1/a.y)}function Vec2Lerp(a,b,t,param){var out=param===void 0?new Vec2():param;var x=a.x;var y=a.y;return out.set(x+t*(b.x-x),y+t*(b.y-y))}function Vec2Limit(a,max,param){var out=param===void 0?new Vec2():param;var length=GetVec2Length(a);if(length&&length>max){Vec2Scale(a,max/length,out)}return out}function Vec2Max(a,b,param){var out=param===void 0?new Vec2():param;var ax=a.x,ay=a.y;var bx=b.x,by=b.y;return out.set(Math.max(ax,bx),Math.max(ay,by))}function Vec2Min(a,b,param){var out=param===void 0?new Vec2():param;var ax=a.x,ay=a.y;var bx=b.x,by=b.y;return out.set(Math.min(ax,bx),Math.min(ay,by))}function Vec2Multiply(a,b,param){var out=param===void 0?new Vec2():param;return out.set(a.x*b.x,a.y*b.y)}function Vec2Negate(a,param){var out=param===void 0?new Vec2():param;return out.set(-a.x,-a.y)}function Vec2Normalize(a,param){var out=param===void 0?new Vec2():param;return Vec2DivideScalar(a,GetVec2Length(a)||1,out)}function Vec2One(){return new Vec2(1,1)}function Vec2PerpDot(a,b){return a.x*b.y-a.y*b.x}function Vec2Random(a,param,param1){var scale=param===void 0?1:param,out=param1===void 0?new Vec2():param1;var r=Math.random()*2*Math.PI;return out.set(Math.cos(r)*scale,Math.sin(r)*scale)}function Vec2Rotate(a,origin,angle,param){var out=param===void 0?new Vec2():param;var s=Math.sin(angle);var c=Math.cos(angle);var x=a.x-origin.x;var y=a.y-origin.y;return out.set(x*c-y*s+origin.x,x*s+y*c+origin.y)}function Vec2Round(a,param){var out=param===void 0?new Vec2():param;return out.set(Math.round(a.x),Math.round(a.y))}function Vec2RoundToZero(a,param){var out=param===void 0?new Vec2():param;return out.set(a.x<0?Math.ceil(a.x):Math.floor(a.x),a.y<0?Math.ceil(a.y):Math.floor(a.y))}function Vec2ScaleAndAdd(a,b,scalar,param){var out=param===void 0?new Vec2():param;return out.set(a.x+b.x*scalar,a.y+b.y*scalar)}function Vec2SetLength(a,length,param){var out=param===void 0?new Vec2():param;Vec2Normalize(a,out);return Vec2Scale(out,length,out)}function Vec2SubtractScalar(a,scalar,param){var out=param===void 0?new Vec2():param;return out.set(a.x-scalar,a.y-scalar)}function Vec2Transform(v,positionX,positionY,rotation,scaleX,scaleY,param){var out=param===void 0?new Vec2():param;return Vec2FromTransform(v.x,v.y,positionX,positionY,rotation,scaleX,scaleY,out)}function Vec2TransformMat2d(v,m,param){var out=param===void 0?new Vec2():param;var a=m.a,b=m.b,c=m.c,d=m.d,tx=m.tx,ty=m.ty;return out.set(a*v.x+c*v.y+tx,b*v.x+d*v.y+ty)}function Vec2TransformMat4(v,m,param){var out=param===void 0?new Vec2():param;var data=m.data;return out.set(data[0]*v.x+data[4]*v.y+data[12],data[1]*v.x+data[5]*v.y+data[13])}function Vec2Zero(){return new Vec2(0,0)}var vec3_exports={};__export(vec3_exports,{GetVec3Angle:function(){return GetVec3Angle},GetVec3Distance:function(){return GetVec3Distance},GetVec3DistanceSquared:function(){return GetVec3DistanceSquared},GetVec3Length:function(){return GetVec3Length},GetVec3LengthSquared:function(){return GetVec3LengthSquared},GetVec3ManhattanDistance:function(){return GetVec3ManhattanDistance},GetVec3ManhattanLength:function(){return GetVec3ManhattanLength},RGBCallback:function(){return RGBCallback},Vec3:function(){return Vec3},Vec3Abs:function(){return Vec3Abs},Vec3Add:function(){return Vec3Add},Vec3AddScalar:function(){return Vec3AddScalar},Vec3Backward:function(){return Vec3Backward},Vec3Bezier:function(){return Vec3Bezier},Vec3Callback:function(){return Vec3Callback},Vec3CatmullRom:function(){return Vec3CatmullRom},Vec3Ceil:function(){return Vec3Ceil},Vec3Center:function(){return Vec3Center},Vec3Clamp:function(){return Vec3Clamp},Vec3ClampLength:function(){return Vec3ClampLength},Vec3ClampScalar:function(){return Vec3ClampScalar},Vec3Clone:function(){return Vec3Clone},Vec3CopyFrom:function(){return Vec3CopyFrom},Vec3Cross:function(){return Vec3Cross},Vec3CrossNormalize:function(){return Vec3CrossNormalize},Vec3Divide:function(){return Vec3Divide},Vec3DivideScalar:function(){return Vec3DivideScalar},Vec3Dot:function(){return Vec3Dot},Vec3Down:function(){return Vec3Down},Vec3Equals:function(){return Vec3Equals},Vec3Floor:function(){return Vec3Floor},Vec3Forward:function(){return Vec3Forward},Vec3Fract:function(){return Vec3Fract},Vec3FromCylindricalCoords:function(){return Vec3FromCylindricalCoords},Vec3FromSphericalCoords:function(){return Vec3FromSphericalCoords},Vec3FuzzyEquals:function(){return Vec3FuzzyEquals},Vec3Hermite:function(){return Vec3Hermite},Vec3Inverse:function(){return Vec3Inverse},Vec3IsNonUniform:function(){return Vec3IsNonUniform},Vec3Left:function(){return Vec3Left},Vec3Lerp:function(){return Vec3Lerp},Vec3Max:function(){return Vec3Max},Vec3Min:function(){return Vec3Min},Vec3Multiply:function(){return Vec3Multiply},Vec3MultiplyByFloats:function(){return Vec3MultiplyByFloats},Vec3Negate:function(){return Vec3Negate},Vec3Normalize:function(){return Vec3Normalize},Vec3One:function(){return Vec3One},Vec3Project:function(){return Vec3Project},Vec3Random:function(){return Vec3Random},Vec3Reflect:function(){return Vec3Reflect},Vec3Right:function(){return Vec3Right},Vec3RotateX:function(){return Vec3RotateX},Vec3RotateY:function(){return Vec3RotateY},Vec3RotateZ:function(){return Vec3RotateZ},Vec3Round:function(){return Vec3Round},Vec3RoundToZero:function(){return Vec3RoundToZero},Vec3Scale:function(){return Vec3Scale},Vec3ScaleAndAdd:function(){return Vec3ScaleAndAdd},Vec3SetLength:function(){return Vec3SetLength},Vec3Subtract:function(){return Vec3Subtract},Vec3SubtractScalar:function(){return Vec3SubtractScalar},Vec3TransformMat4:function(){return Vec3TransformMat4},Vec3TransformMat4Zero:function(){return Vec3TransformMat4Zero},Vec3TransformQuat:function(){return Vec3TransformQuat},Vec3Unproject:function(){return Vec3Unproject},Vec3Up:function(){return Vec3Up},Vec3Zero:function(){return Vec3Zero}});function GetVec3Angle(a,b){var ax=a.x,ay=a.y,az=a.z;var bx=b.x,by=b.y,bz=b.z;var mag1=Math.sqrt(ax*ax+ay*ay+az*az);var mag2=Math.sqrt(bx*bx+by*by+bz*bz);var mag=mag1*mag2;var c=mag&&Vec3Dot(a,b)/mag;return Math.acos(Math.min(Math.max(c,-1),1))}function GetVec3DistanceSquared(a,b){var x=a.x-b.x;var y=a.y-b.y;var z=a.z-b.z;return x*x+y*y+z*z}function GetVec3Distance(a,b){return Math.sqrt(GetVec3DistanceSquared(a,b))}function GetVec3Length(a){var x=a.x,y=a.y,z=a.z;return Math.sqrt(x*x+y*y+z*z)}function GetVec3LengthSquared(a){var x=a.x,y=a.y,z=a.z;return x*x+y*y+z*z}function GetVec3ManhattanDistance(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)+Math.abs(a.z-b.z)}function GetVec3ManhattanLength(a){return Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z)}var Vec3Callback=function(){"use strict";function _class(onChange,param,param1,param2){var x=param===void 0?0:param,y=param1===void 0?0:param1,z=param2===void 0?0:param2;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"_x",void 0);swcHelpers.defineProperty(this,"_y",void 0);swcHelpers.defineProperty(this,"_z",void 0);swcHelpers.defineProperty(this,"onChange",void 0);this._x=x;this._y=y;this._z=z;this.onChange=onChange}swcHelpers.createClass(_class,[{key:"destroy",value:function destroy(){this.onChange=NOOP}},{key:"set",value:function set(param,param1,param2){var x=param===void 0?0:param,y=param1===void 0?0:param1,z=param2===void 0?0:param2;this._x=x;this._y=y;this._z=z;if(this.onChange){this.onChange(this)}return this}},{key:"x",get:function get(){return this._x},set:function set(value){var prev=this._x;this._x=value;if(prev!==value){this.onChange(this)}}},{key:"y",get:function get(){return this._y},set:function set(value){var prev=this._y;this._y=value;if(prev!==value){this.onChange(this)}}},{key:"z",get:function get(){return this._z},set:function set(value){var prev=this._z;this._z=value;if(prev!==value){this.onChange(this)}}},{key:"toArray",value:function toArray(param,param1){var dst=param===void 0?[]:param,index=param1===void 0?0:param1;var ref=this,x=ref.x,y=ref.y,z=ref.z;dst[index]=x;dst[index+1]=y;dst[index+2]=z;return dst}},{key:"fromArray",value:function fromArray(src,param){var index=param===void 0?0:param;return this.set(src[index],src[index+1],src[index+2])}},{key:"toString",value:function toString(){var ref=this,x=ref.x,y=ref.y,z=ref.z;return"{ x=".concat(x,", y=").concat(y,", z=").concat(z," }")}}]);return _class}();var RGBCallback=function(Vec3Callback){"use strict";swcHelpers.inherits(_class,Vec3Callback);function _class(onChange,param,param1,param2){var r=param===void 0?0:param,g=param1===void 0?0:param1,b=param2===void 0?0:param2;swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,onChange,r,g,b))}swcHelpers.createClass(_class,[{key:"r",get:function get(){return this.x},set:function set(value){this.x=value}},{key:"g",get:function get(){return this.y},set:function set(value){this.y=value}},{key:"b",get:function get(){return this.z},set:function set(value){this.z=value}},{key:"toString",value:function toString(){var ref=this,x=ref.x,y=ref.y,z=ref.z;return"[ r=".concat(x,", g=").concat(y,", b=").concat(z," ]")}}]);return _class}(Vec3Callback);function Vec3Abs(a,param){var out=param===void 0?new Vec3():param;return out.set(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z))}function Vec3Add(a,b,param){var out=param===void 0?new Vec3():param;return out.set(a.x+b.x,a.y+b.y,a.z+b.z)}function Vec3AddScalar(a,scalar,param){var out=param===void 0?new Vec3():param;return out.set(a.x+scalar,a.y+scalar,a.z+scalar)}function Vec3Backward(){return new Vec3(0,0,-1)}function Vec3Bezier(a,b,c,d,t,param){var out=param===void 0?new Vec3():param;return out.set(Bezier(a.x,b.x,c.x,d.x,t),Bezier(a.y,b.y,c.y,d.y,t),Bezier(a.z,b.z,c.z,d.z,t))}function Vec3CatmullRom(p1,p2,p3,p4,t,param){var out=param===void 0?new Vec3():param;return out.set(CatmullRom(t,p1.x,p2.x,p3.x,p4.x),CatmullRom(t,p1.y,p2.y,p3.y,p4.y),CatmullRom(t,p1.z,p2.z,p3.z,p4.z))}function Vec3Ceil(a,param){var out=param===void 0?new Vec3():param;return out.set(Math.ceil(a.x),Math.ceil(a.y),Math.ceil(a.z))}function Vec3Scale(a,scalar,param){var out=param===void 0?new Vec3():param;return out.set(a.x*scalar,a.y*scalar,a.z*scalar)}function Vec3Center(a,b,param){var out=param===void 0?new Vec3():param;Vec3Add(a,b,out);return Vec3Scale(out,0.5,out)}function Vec3Clamp(a,min,max,param){var out=param===void 0?new Vec3():param;return out.set(Clamp(a.x,min.x,max.x),Clamp(a.y,min.y,max.y),Clamp(a.z,min.z,max.z))}function Vec3DivideScalar(a,scalar,param){var out=param===void 0?new Vec3():param;var x=a.x,y=a.y,z=a.z;return out.set(x/scalar,y/scalar,z/scalar)}function Vec3ClampLength(a,min,max,param){var out=param===void 0?new Vec3():param;var length=GetVec3Length(a);Vec3DivideScalar(a,length||1,out);return Vec3Scale(out,Clamp(length,min,max),out)}function Vec3ClampScalar(a,min,max,param){var out=param===void 0?new Vec3():param;return out.set(Clamp(a.x,min,max),Clamp(a.y,min,max),Clamp(a.z,min,max))}function Vec3Clone(source){var x=source.x,y=source.y,z=source.z;return new Vec3(x,y,z)}function Vec3CopyFrom(source,dest){var x=source.x,y=source.y,z=source.z;return dest.set(x,y,z)}function Vec3Cross(a,b,param){var out=param===void 0?new Vec3():param;var ax=a.x,ay=a.y,az=a.z;var bx=b.x,by=b.y,bz=b.z;return out.set(ay*bz-az*by,az*bx-ax*bz,ax*by-ay*bx)}function Vec3CrossNormalize(a,b,param){var out=param===void 0?new Vec3():param;var ax=a.x,ay=a.y,az=a.z;var bx=b.x,by=b.y,bz=b.z;var x=ay*bz-az*by;var y=az*bx-ax*bz;var z=ax*by-ay*bx;var len=x*x+y*y+z*z;if(len>0){len=1/Math.sqrt(len)}return out.set(x*len,y*len,z*len)}function Vec3Divide(a,b,param){var out=param===void 0?new Vec3():param;return out.set(a.x/b.x,a.y/b.y,a.z/b.z)}function Vec3Down(){return new Vec3(0,-1,0)}function Vec3Equals(a,b){return a.x===b.x&&a.y===b.y&&a.z===b.z}function Vec3Floor(a,param){var out=param===void 0?new Vec3():param;return out.set(Math.floor(a.x),Math.floor(a.y),Math.floor(a.z))}function Vec3Forward(){return new Vec3(0,0,1)}function Vec3Fract(a,param){var out=param===void 0?new Vec3():param;return out.set(a.x-Math.floor(a.x),a.y-Math.floor(a.y),a.z-Math.floor(a.z))}function Vec3FromCylindricalCoords(radius,theta,y,param){var out=param===void 0?new Vec3():param;return out.set(radius*Math.sin(theta),y,radius*Math.cos(theta))}function Vec3FromSphericalCoords(radius,phi,theta,param){var out=param===void 0?new Vec3():param;var sinPhiRadius=Math.sin(phi)*radius;return out.set(sinPhiRadius*Math.sin(theta),Math.cos(phi)*radius,sinPhiRadius*Math.cos(theta))}function Vec3FuzzyEquals(a,b,param){var epsilon=param===void 0?0.0001:param;return FuzzyEqual(a.x,b.x,epsilon)&&FuzzyEqual(a.y,b.y,epsilon)&&FuzzyEqual(a.z,b.z,epsilon)}function Vec3Hermite(a,b,c,d,t,param){var out=param===void 0?new Vec3():param;return out.set(Hermite(a.x,b.x,c.x,d.x,t),Hermite(a.y,b.y,c.y,d.y,t),Hermite(a.z,b.z,c.z,d.z,t))}function Vec3Inverse(a,param){var out=param===void 0?new Vec3():param;return out.set(1/a.x,1/a.y,1/a.z)}function Vec3IsNonUniform(a){var absX=Math.abs(a.x);var absY=Math.abs(a.y);var absZ=Math.abs(a.z);return absX!==absY||absX!==absZ||absY!==absZ}function Vec3Left(){return new Vec3(-1,0,0)}function Vec3Lerp(a,b,t,param){var out=param===void 0?new Vec3():param;var x=a.x,y=a.y,z=a.z;return out.set(x+t*(b.x-x),y+t*(b.y-y),z+t*(b.z-z))}function Vec3Max(a,b,param){var out=param===void 0?new Vec3():param;var ax=a.x,ay=a.y,az=a.z;var bx=b.x,by=b.y,bz=b.z;return out.set(Math.max(ax,bx),Math.max(ay,by),Math.max(az,bz))}function Vec3Min(a,b,param){var out=param===void 0?new Vec3():param;var ax=a.x,ay=a.y,az=a.z;var bx=b.x,by=b.y,bz=b.z;return out.set(Math.min(ax,bx),Math.min(ay,by),Math.min(az,bz))}function Vec3Multiply(a,b,param){var out=param===void 0?new Vec3():param;return out.set(a.x*b.x,a.y*b.y,a.z*b.z)}function Vec3MultiplyByFloats(a,x,y,z,param){var out=param===void 0?new Vec3():param;return out.set(a.x*x,a.y*y,a.z*z)}function Vec3Negate(a,param){var out=param===void 0?new Vec3():param;return out.set(-a.x,-a.y,-a.z)}function Vec3One(){return new Vec3(1,1,1)}function Vec3TransformMat4(a,m,param){var out=param===void 0?new Vec3():param;var _data=m.data,m00=_data[0],m01=_data[1],m02=_data[2],m03=_data[3],m10=_data[4],m11=_data[5],m12=_data[6],m13=_data[7],m20=_data[8],m21=_data[9],m22=_data[10],m23=_data[11],m30=_data[12],m31=_data[13],m32=_data[14],m33=_data[15];var x=a.x,y=a.y,z=a.z;var w=m03*x+m13*y+m23*z+m33;w=w||1;return out.set((m00*x+m10*y+m20*z+m30)/w,(m01*x+m11*y+m21*z+m31)/w,(m02*x+m12*y+m22*z+m32)/w)}var tempMatrix1=new Matrix4();var tempMatrix2=new Matrix4();function Vec3Project(v,world2,transform,viewport,param){var out=param===void 0?new Vec3():param;var x=viewport.x,y=viewport.y,width=viewport.width,height=viewport.height;tempMatrix1.set(width/2,0,0,0,0,-height/2,0,0,0,0,0.5,0,x+width/2,height/2+y,0.5,1);Mat4Multiply(world2,transform,tempMatrix2);Mat4Multiply(tempMatrix2,tempMatrix1,tempMatrix2);return Vec3TransformMat4(v,tempMatrix2,out)}function Vec3Random(a,param,param1){var scale=param===void 0?1:param,out=param1===void 0?new Vec3():param1;var r=Math.random()*2*Math.PI;var z=Math.random()*2-1;var zScale=Math.sqrt(1-z*z)*scale;return out.set(Math.cos(r)*zScale,Math.sin(r)*zScale,z*scale)}function Vec3Subtract(a,b,param){var out=param===void 0?new Vec3():param;return out.set(a.x-b.x,a.y-b.y,a.z-b.z)}function Vec3Reflect(a,normal,param){var out=param===void 0?new Vec3():param;Vec3Scale(normal,2*Vec3Dot(a,normal),out);return Vec3Subtract(a,out,out)}function Vec3Right(){return new Vec3(1,0,0)}function Vec3RotateX(a,origin,angle,param){var out=param===void 0?new Vec3():param;var ax=a.x,ay=a.y,az=a.z;var bx=origin.x,by=origin.y,bz=origin.z;var px=ax-bx;var py=ay-by;var pz=az-bz;var rx=px;var ry=py*Math.cos(angle)-pz*Math.sin(angle);var rz=py*Math.sin(angle)+pz*Math.cos(angle);return out.set(rx+bx,ry+by,rz+bz)}function Vec3RotateY(a,origin,angle,param){var out=param===void 0?new Vec3():param;var ax=a.x,ay=a.y,az=a.z;var bx=origin.x,by=origin.y,bz=origin.z;var px=ax-bx;var py=ay-by;var pz=az-bz;var rx=pz*Math.sin(angle)+px*Math.cos(angle);var ry=py;var rz=pz*Math.cos(angle)-px*Math.sin(angle);return out.set(rx+bx,ry+by,rz+bz)}function Vec3RotateZ(a,origin,angle,param){var out=param===void 0?new Vec3():param;var ax=a.x,ay=a.y,az=a.z;var bx=origin.x,by=origin.y,bz=origin.z;var px=ax-bx;var py=ay-by;var pz=az-bz;var rx=px*Math.cos(angle)-py*Math.sin(angle);var ry=px*Math.sin(angle)+py*Math.cos(angle);var rz=pz;return out.set(rx+bx,ry+by,rz+bz)}function Vec3Round(a,param){var out=param===void 0?new Vec3():param;return out.set(Math.round(a.x),Math.round(a.y),Math.round(a.z))}function Vec3RoundToZero(a,param){var out=param===void 0?new Vec3():param;return out.set(a.x<0?Math.ceil(a.x):Math.floor(a.x),a.y<0?Math.ceil(a.y):Math.floor(a.y),a.z<0?Math.ceil(a.z):Math.floor(a.z))}function Vec3ScaleAndAdd(a,b,scalar,param){var out=param===void 0?new Vec3():param;return out.set(a.x+b.x*scalar,a.y+b.y*scalar,a.z+b.z*scalar)}function Vec3SetLength(a,length,param){var out=param===void 0?new Vec3():param;Vec3Normalize(a,out);return Vec3Scale(out,length,out)}function Vec3SubtractScalar(a,scalar,param){var out=param===void 0?new Vec3():param;return out.set(a.x-scalar,a.y-scalar,a.z-scalar)}function Vec3TransformMat4Zero(a,m,param){var out=param===void 0?new Vec3():param;var _data=m.data,m00=_data[0],m01=_data[1],m02=_data[2],m03=_data[3],m10=_data[4],m11=_data[5],m12=_data[6],m13=_data[7],m20=_data[8],m21=_data[9],m22=_data[10];var x=a.x,y=a.y,z=a.z;return out.set(m00*x+m10*y+m20*z,m01*x+m11*y+m21*z,m02*x+m12*y+m22*z)}function Vec3TransformQuat(a,q,param){var out=param===void 0?new Vec3():param;var qx=q.x,qy=q.y,qz=q.z,qw=q.w;var x=a.x,y=a.y,z=a.z;var uvx=qy*z-qz*y;var uvy=qz*x-qx*z;var uvz=qx*y-qy*x;var uuvx=qy*uvz-qz*uvy;var uuvy=qz*uvx-qx*uvz;var uuvz=qx*uvy-qy*uvx;var w2=qw*2;uvx*=w2;uvy*=w2;uvz*=w2;uuvx*=2;uuvy*=2;uuvz*=2;return out.set(x+uvx+uuvx,y+uvy+uuvy,z+uvz+uuvz)}var matrix=new Matrix4();var screenSource=new Vec3();function Vec3Unproject(v,viewportWidth,viewportHeight,world2,view,projection,param){var out=param===void 0?new Vec3():param;Mat4Multiply(world2,view,matrix);Mat4Multiply(matrix,projection,matrix);Mat4Invert(matrix,matrix);var x=v.x,y=v.y,z=v.z;screenSource.set(x/viewportWidth*2-1,-(y/viewportHeight*2-1),2*z-1);Vec3TransformMat4(screenSource,matrix,out);var data=matrix.data;var num=screenSource.x*data[3]+screenSource.y*data[7]+screenSource.z*data[11]+data[15];return Vec3Scale(out,1/num,out)}function Vec3Up(){return new Vec3(0,1,0)}function Vec3Zero(){return new Vec3(0,0,0)}var vec4_exports={};__export(vec4_exports,{GetVec4Distance:function(){return GetVec4Distance},GetVec4DistanceSquared:function(){return GetVec4DistanceSquared},GetVec4Length:function(){return GetVec4Length},GetVec4LengthSquared:function(){return GetVec4LengthSquared},GetVec4ManhattanDistance:function(){return GetVec4ManhattanDistance},GetVec4ManhattanLength:function(){return GetVec4ManhattanLength},RGBACallback:function(){return RGBACallback},Vec4:function(){return Vec4},Vec4Abs:function(){return Vec4Abs},Vec4Add:function(){return Vec4Add},Vec4AddScalar:function(){return Vec4AddScalar},Vec4Bezier:function(){return Vec4Bezier},Vec4Callback:function(){return Vec4Callback},Vec4CatmullRom:function(){return Vec4CatmullRom},Vec4Ceil:function(){return Vec4Ceil},Vec4Center:function(){return Vec4Center},Vec4Clamp:function(){return Vec4Clamp},Vec4ClampLength:function(){return Vec4ClampLength},Vec4ClampScalar:function(){return Vec4ClampScalar},Vec4Clone:function(){return Vec4Clone},Vec4CopyFrom:function(){return Vec4CopyFrom},Vec4Cross:function(){return Vec4Cross},Vec4Divide:function(){return Vec4Divide},Vec4DivideScalar:function(){return Vec4DivideScalar},Vec4Dot:function(){return Vec4Dot},Vec4Equals:function(){return Vec4Equals},Vec4Floor:function(){return Vec4Floor},Vec4Fract:function(){return Vec4Fract},Vec4FuzzyEquals:function(){return Vec4FuzzyEquals},Vec4Hermite:function(){return Vec4Hermite},Vec4Lerp:function(){return Vec4Lerp},Vec4Max:function(){return Vec4Max},Vec4Min:function(){return Vec4Min},Vec4Multiply:function(){return Vec4Multiply},Vec4MultiplyByFloats:function(){return Vec4MultiplyByFloats},Vec4Negate:function(){return Vec4Negate},Vec4Normalize:function(){return Vec4Normalize},Vec4One:function(){return Vec4One},Vec4Random:function(){return Vec4Random},Vec4Round:function(){return Vec4Round},Vec4RoundToZero:function(){return Vec4RoundToZero},Vec4Scale:function(){return Vec4Scale},Vec4ScaleAndAdd:function(){return Vec4ScaleAndAdd},Vec4SetLength:function(){return Vec4SetLength},Vec4Subtract:function(){return Vec4Subtract},Vec4SubtractScalar:function(){return Vec4SubtractScalar},Vec4TransformMat4:function(){return Vec4TransformMat4},Vec4Zero:function(){return Vec4Zero}});function GetVec4DistanceSquared(a,b){var x=a.x-b.x;var y=a.y-b.y;var z=a.z-b.z;var w=a.w-b.w;return x*x+y*y+z*z+w*w}function GetVec4Distance(a,b){return Math.sqrt(GetVec4DistanceSquared(a,b))}function GetVec4Length(a){var x=a.x,y=a.y,z=a.z,w=a.w;return Math.sqrt(x*x+y*y+z*z+w*w)}function GetVec4LengthSquared(a){var x=a.x,y=a.y,z=a.z,w=a.w;return x*x+y*y+z*z+w*w}function GetVec4ManhattanDistance(a,b){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)+Math.abs(a.z-b.z)+Math.abs(a.w-b.w)}function GetVec4ManhattanLength(a){var x=a.x,y=a.y,z=a.z,w=a.w;return Math.abs(x)+Math.abs(y)+Math.abs(z)+Math.abs(w)}var Vec4Callback=function(){"use strict";function _class(onChange,param,param1,param2,param3){var x=param===void 0?0:param,y=param1===void 0?0:param1,z=param2===void 0?0:param2,w=param3===void 0?0:param3;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"_x",void 0);swcHelpers.defineProperty(this,"_y",void 0);swcHelpers.defineProperty(this,"_z",void 0);swcHelpers.defineProperty(this,"_w",void 0);swcHelpers.defineProperty(this,"onChange",void 0);this._x=x;this._y=y;this._z=z;this._w=w;this.onChange=onChange}swcHelpers.createClass(_class,[{key:"destroy",value:function destroy(){this.onChange=NOOP}},{key:"set",value:function set(param,param1,param2,param3){var x=param===void 0?0:param,y=param1===void 0?0:param1,z=param2===void 0?0:param2,w=param3===void 0?0:param3;this._x=x;this._y=y;this._z=z;this._w=w;if(this.onChange){this.onChange(this)}return this}},{key:"x",get:function get(){return this._x},set:function set(value){var prev=this._x;this._x=value;if(prev!==value){this.onChange(this)}}},{key:"y",get:function get(){return this._y},set:function set(value){var prev=this._y;this._y=value;if(prev!==value){this.onChange(this)}}},{key:"z",get:function get(){return this._z},set:function set(value){var prev=this._z;this._z=value;if(prev!==value){this.onChange(this)}}},{key:"w",get:function get(){return this._w},set:function set(value){var prev=this._w;this._w=value;if(prev!==value){this.onChange(this)}}},{key:"toArray",value:function toArray(param,param1){var dst=param===void 0?[]:param,index=param1===void 0?0:param1;var ref=this,x=ref.x,y=ref.y,z=ref.z,w=ref.w;dst[index]=x;dst[index+1]=y;dst[index+2]=z;dst[index+3]=w;return dst}},{key:"fromArray",value:function fromArray(src,param){var index=param===void 0?0:param;return this.set(src[index],src[index+1],src[index+2],src[index+3])}},{key:"toString",value:function toString(){var ref=this,x=ref.x,y=ref.y,z=ref.z,w=ref.w;return"{ x=".concat(x,", y=").concat(y,", z=").concat(z,", w=").concat(w," }")}}]);return _class}();var RGBACallback=function(Vec4Callback){"use strict";swcHelpers.inherits(_class,Vec4Callback);function _class(onChange,param,param1,param2,param3){var r=param===void 0?0:param,g=param1===void 0?0:param1,b=param2===void 0?0:param2,a=param3===void 0?1:param3;swcHelpers.classCallCheck(this,_class);return swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,onChange,r,g,b,a))}swcHelpers.createClass(_class,[{key:"r",get:function get(){return this.x},set:function set(value){this.x=value}},{key:"g",get:function get(){return this.y},set:function set(value){this.y=value}},{key:"b",get:function get(){return this.z},set:function set(value){this.z=value}},{key:"a",get:function get(){return this.w},set:function set(value){this.w=value}},{key:"toString",value:function toString(){var ref=this,x=ref.x,y=ref.y,z=ref.z,w=ref.w;return"[ r=".concat(x,", g=").concat(y,", b=").concat(z,", a=").concat(w," ]")}}]);return _class}(Vec4Callback);var Vec4=function(){"use strict";function _class(param,param1,param2,param3){var x=param===void 0?0:param,y=param1===void 0?0:param1,z=param2===void 0?0:param2,w=param3===void 0?1:param3;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"x",void 0);swcHelpers.defineProperty(this,"y",void 0);swcHelpers.defineProperty(this,"z",void 0);swcHelpers.defineProperty(this,"w",void 0);this.set(x,y,z,w)}swcHelpers.createClass(_class,[{key:"set",value:function set(param,param1,param2,param3){var x=param===void 0?0:param,y=param1===void 0?0:param1,z=param2===void 0?0:param2,w=param3===void 0?1:param3;this.x=x;this.y=y;this.z=z;this.w=w;return this}},{key:"toArray",value:function toArray(param,param1){var dst=param===void 0?[]:param,index=param1===void 0?0:param1;var ref=this,x=ref.x,y=ref.y,z=ref.z,w=ref.w;dst[index]=x;dst[index+1]=y;dst[index+2]=z;dst[index+3]=w;return dst}},{key:"fromArray",value:function fromArray(src,param){var index=param===void 0?0:param;return this.set(src[index],src[index+1],src[index+2],src[index+3])}},{key:"toString",value:function toString(){var ref=this,x=ref.x,y=ref.y,z=ref.z,w=ref.w;return"{ x=".concat(x,", y=").concat(y,", z=").concat(z,", w=").concat(w," }")}}]);return _class}();function Vec4Abs(a,param){var out=param===void 0?new Vec4():param;return out.set(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z),Math.abs(a.w))}function Vec4Add(a,b,param){var out=param===void 0?new Vec4():param;return out.set(a.x+b.x,a.y+b.y,a.z+b.z,a.w+b.w)}function Vec4AddScalar(a,scalar,param){var out=param===void 0?new Vec4():param;return out.set(a.x+scalar,a.y+scalar,a.z+scalar,a.w+scalar)}function Vec4Bezier(a,b,c,d,t,param){var out=param===void 0?new Vec4():param;return out.set(Bezier(t,a.x,b.x,c.x,d.x),Bezier(t,a.y,b.y,c.y,d.y),Bezier(t,a.z,b.z,c.z,d.z),Bezier(t,a.w,b.w,c.w,d.w))}function Vec4CatmullRom(p1,p2,p3,p4,t,param){var out=param===void 0?new Vec4():param;return out.set(CatmullRom(t,p1.x,p2.x,p3.x,p4.x),CatmullRom(t,p1.y,p2.y,p3.y,p4.y),CatmullRom(t,p1.z,p2.z,p3.z,p4.z),CatmullRom(t,p1.w,p2.w,p3.w,p4.w))}function Vec4Ceil(a,param){var out=param===void 0?new Vec4():param;var x=a.x,y=a.y,z=a.z,w=a.w;return out.set(Math.ceil(x),Math.ceil(y),Math.ceil(z),Math.ceil(w))}function Vec4Scale(a,scalar,param){var out=param===void 0?new Vec4():param;var x=a.x,y=a.y,z=a.z,w=a.w;return out.set(x*scalar,y*scalar,z*scalar,w*scalar)}function Vec4Center(a,b,param){var out=param===void 0?new Vec4():param;Vec4Add(a,b,out);return Vec4Scale(out,0.5,out)}function Vec4Clamp(a,min,max,param){var out=param===void 0?new Vec4():param;return out.set(Clamp(a.x,min.x,max.x),Clamp(a.y,min.y,max.y),Clamp(a.z,min.z,max.z),Clamp(a.w,min.w,max.w))}function Vec4DivideScalar(a,scalar,param){var out=param===void 0?new Vec4():param;var x=a.x,y=a.y,z=a.z,w=a.w;return out.set(x/scalar,y/scalar,z/scalar,w/scalar)}function Vec4ClampLength(a,min,max,param){var out=param===void 0?new Vec4():param;var length=GetVec4Length(a);Vec4DivideScalar(a,length||1,out);return Vec4Scale(out,Clamp(min,max,length),out)}function Vec4ClampScalar(a,min,max,param){var out=param===void 0?new Vec4():param;return out.set(Clamp(a.x,min,max),Clamp(a.y,min,max),Clamp(a.z,min,max),Clamp(a.w,min,max))}function Vec4Clone(source){var x=source.x,y=source.y,z=source.z,w=source.w;return new Vec4(x,y,z,w)}function Vec4CopyFrom(source,dest){var x=source.x,y=source.y,z=source.z,w=source.w;return dest.set(x,y,z,w)}function Vec4Cross(u,v,w,param){var out=param===void 0?new Vec4():param;var ux=u.x,uy=u.y,uz=u.z,uw=u.w;var vx=v.x,vy=v.y,vz=v.z,vw=v.w;var wx=w.x,wy=w.y,wz=w.z,ww=w.w;var A=vx*wy-vy*wx;var B=vx*wz-vz*wx;var C=vx*ww-vw*wx;var D=vy*wz-vz*wy;var E=vy*ww-vw*wy;var F=vz*ww-vw*wz;var G=ux;var H=uy;var I=uz;var J=uw;return out.set(H*F-I*E+J*D,-(G*F)+I*C-J*B,G*E-H*C+J*A,-(G*D)+H*B-I*A)}function Vec4Divide(a,b,param){var out=param===void 0?new Vec4():param;return out.set(a.x/b.x,a.y/b.y,a.z/b.z,a.w/b.w)}function Vec4Dot(a,b){return a.x*b.x+a.y*b.y+a.z*b.z+a.w*b.w}function Vec4Equals(a,b){return a.x===b.x&&a.y===b.y&&a.z===b.z&&a.w===b.w}function Vec4Floor(a,param){var out=param===void 0?new Vec4():param;var x=a.x,y=a.y,z=a.z,w=a.w;return out.set(Math.floor(x),Math.floor(y),Math.floor(z),Math.floor(w))}function Vec4Fract(a,param){var out=param===void 0?new Vec4():param;return out.set(a.x-Math.floor(a.x),a.y-Math.floor(a.y),a.z-Math.floor(a.z),a.w-Math.floor(a.w))}function Vec4FuzzyEquals(a,b,param){var epsilon=param===void 0?0.0001:param;return FuzzyEqual(a.x,b.x,epsilon)&&FuzzyEqual(a.y,b.y,epsilon)&&FuzzyEqual(a.z,b.z,epsilon)&&FuzzyEqual(a.w,b.w,epsilon)}function Vec4Hermite(a,b,c,d,t,param){var out=param===void 0?new Vec4():param;return out.set(Hermite(t,a.x,b.x,c.x,d.x),Hermite(t,a.y,b.y,c.y,d.y),Hermite(t,a.z,b.z,c.z,d.z),Hermite(t,a.w,b.w,c.w,d.w))}function Vec4Lerp(a,b,t,param){var out=param===void 0?new Vec4():param;var x=a.x,y=a.y,z=a.z,w=a.w;return out.set(x+t*(b.x-x),y+t*(b.y-y),z+t*(b.z-z),w+t*(b.w-w))}function Vec4Max(a,b,param){var out=param===void 0?new Vec4():param;var ax=a.x,ay=a.y,az=a.z,aw=a.w;var bx=b.x,by=b.y,bz=b.z,bw=b.w;return out.set(Math.max(ax,bx),Math.max(ay,by),Math.max(az,bz),Math.max(aw,bw))}function Vec4Min(a,b,param){var out=param===void 0?new Vec4():param;var ax=a.x,ay=a.y,az=a.z,aw=a.w;var bx=b.x,by=b.y,bz=b.z,bw=b.w;return out.set(Math.min(ax,bx),Math.min(ay,by),Math.min(az,bz),Math.min(aw,bw))}function Vec4Multiply(a,b,param){var out=param===void 0?new Vec4():param;return out.set(a.x*b.x,a.y*b.y,a.z*b.z,a.w*b.w)}function Vec4MultiplyByFloats(a,x,y,z,w,param){var out=param===void 0?new Vec4():param;return out.set(a.x*x,a.y*y,a.z*z,a.w*w)}function Vec4Negate(a,param){var out=param===void 0?new Vec4():param;return out.set(-a.x,-a.y,-a.z,-a.w)}function Vec4Normalize(a,param){var out=param===void 0?new Vec4():param;return Vec4DivideScalar(a,GetVec4Length(a)||1,out)}function Vec4One(){return new Vec4(1,1,1,1)}function Vec4Random(a,param,param1){var scale=param===void 0?1:param,out=param1===void 0?new Vec4():param1;var v1;var v2;var v3;var v4;var s1;var s2;do{v1=Math.random()*2-1;v2=Math.random()*2-1;s1=v1*v1+v2*v2}while(s1>=1)do{v3=Math.random()*2-1;v4=Math.random()*2-1;s2=v3*v3+v4*v4}while(s2>=1)var d=Math.sqrt((1-s1)/s2);return out.set(scale*v1,scale*v2,scale*v3*d,scale*v4*d)}function Vec4Round(a,param){var out=param===void 0?new Vec4():param;var x=a.x,y=a.y,z=a.z,w=a.w;return out.set(Math.round(x),Math.round(y),Math.round(z),Math.round(w))}function Vec4RoundToZero(a,param){var out=param===void 0?new Vec4():param;var x=a.x,y=a.y,z=a.z,w=a.w;return out.set(x<0?Math.ceil(x):Math.floor(x),y<0?Math.ceil(y):Math.floor(y),z<0?Math.ceil(z):Math.floor(z),w<0?Math.ceil(w):Math.floor(w))}function Vec4ScaleAndAdd(a,b,scalar,param){var out=param===void 0?new Vec4():param;return out.set(a.x+b.x*scalar,a.y+b.y*scalar,a.z+b.z*scalar,a.w+b.w*scalar)}function Vec4SetLength(a,length,param){var out=param===void 0?new Vec4():param;Vec4Normalize(a,out);return Vec4Scale(out,length,out)}function Vec4Subtract(a,b,param){var out=param===void 0?new Vec4():param;return out.set(a.x-b.x,a.y-b.y,a.z-b.z,a.w-b.w)}function Vec4SubtractScalar(a,scalar,param){var out=param===void 0?new Vec4():param;var x=a.x,y=a.y,z=a.z,w=a.w;return out.set(x-scalar,y-scalar,z-scalar,w-scalar)}function Vec4TransformMat4(a,m,param){var out=param===void 0?new Vec4():param;var _data=m.data,m00=_data[0],m01=_data[1],m02=_data[2],m03=_data[3],m10=_data[4],m11=_data[5],m12=_data[6],m13=_data[7],m20=_data[8],m21=_data[9],m22=_data[10],m23=_data[11],m30=_data[12],m31=_data[13],m32=_data[14],m33=_data[15];var x=a.x,y=a.y,z=a.z,w=a.w;return out.set(m00*x+m10*y+m20*z+m30*w,m01*x+m11*y+m21*z+m31*w,m02*x+m12*y+m22*z+m32*w,m03*x+m13*y+m23*z+m33*w)}function Vec4Zero(){return new Vec4(0,0,0,0)}function Average(values){var sum=0;for(var i=0;i<values.length;i++){sum+=+values[i]}return sum/values.length}function CeilTo(value,param,param1){var place=param===void 0?0:param,base=param1===void 0?10:param1;var p=Math.pow(base,-place);return Math.ceil(value*p)/p}function Difference(a,b){return Math.abs(a-b)}function FloatBetween(min,max){return Math.random()*(max-min)+min}function FloorTo(value,param,param1){var place=param===void 0?0:param,base=param1===void 0?10:param1;var p=Math.pow(base,-place);return Math.floor(value*p)/p}function GetSpeed(distance,time){return distance/time/1e3}function MaxAdd(value,amount,max){return Math.min(value+amount,max)}function MinSub(value,amount,min){return Math.max(value-amount,min)}function Percent(value,min,max,upperMax){if(max===void 0){max=min+1}var percentage=(value-min)/(max-min);if(percentage>1){if(upperMax!==void 0){percentage=(upperMax-value)/(upperMax-max);if(percentage<0){percentage=0}}else{percentage=1}}else if(percentage<0){percentage=0}return percentage}function RadToDeg(radians){return radians*MATH_CONST.RAD_TO_DEG}function RoundAwayFromZero(value){return value>0?Math.ceil(value):Math.floor(value)}function RoundTo(value,param,param1){var place=param===void 0?0:param,base=param1===void 0?10:param1;var p=Math.pow(base,-place);return Math.round(value*p)/p}function SinCosTableGenerator(length,param,param1,param2){var sinAmp=param===void 0?1:param,cosAmp=param1===void 0?1:param1,frequency=param2===void 0?1:param2;frequency*=Math.PI/length;var cos=[];var sin=[];for(var c=0;c<length;c++){cosAmp-=sinAmp*frequency;sinAmp+=cosAmp*frequency;cos[c]=cosAmp;sin[c]=sinAmp}return{sin:sin,cos:cos,length:length}}function Within(a,b,tolerance){return Math.abs(a-b)<=tolerance}var scenes_exports={};__export(scenes_exports,{CreateSceneManager:function(){return CreateSceneManager},GetConfigValue:function(){return GetConfigValue},Install:function(){return Install},RenderStats:function(){return RenderStats},Scene:function(){return Scene},SceneManager:function(){return SceneManager},SceneManagerInstance:function(){return SceneManagerInstance}});function GetScenes(){return ConfigStore.get(CONFIG_DEFAULTS.SCENES)}var instance7;var SceneManagerInstance={get:function(){return instance7},set:function(manager){if(instance7){throw new Error("Cannot instantiate SceneManager more than once")}instance7=manager}};var WorldList=new Map();var SceneManager=function(){"use strict";function _class(){var _this=this;swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"id",addEntity(GameObjectWorld));swcHelpers.defineProperty(this,"game",void 0);swcHelpers.defineProperty(this,"scenes",new Map());swcHelpers.defineProperty(this,"sceneIndex",0);swcHelpers.defineProperty(this,"flush",void 0);SceneManagerInstance.set(this);this.game=GameInstance.get();Once(this.game,"boot",function(){return _this.boot()})}swcHelpers.createClass(_class,[{key:"boot",value:function boot(){var scenes=GetScenes();if(scenes){scenes.forEach(function(scene){return new scene()})}}},{key:"update",value:function update(){var time=this.game.time;var delta=time.delta;var now=time.lastTick;for(var _i=0,_iter=this.scenes.values();_i<_iter.length;_i++){var scene=_iter[_i];var worlds2=WorldList.get(scene);for(var _i1=0;_i1<worlds2.length;_i1++){var world2=worlds2[_i1];world2.beforeUpdate(delta,now)}if(scene.update){scene.update(delta,now)}for(var _i2=0;_i2<worlds2.length;_i2++){var world2=worlds2[_i2];world2.update(delta,now)}for(var _i3=0;_i3<worlds2.length;_i3++){var world2=worlds2[_i3];world2.afterUpdate(delta,now)}}}},{key:"preRender",value:function preRender(){var gameFrame=this.game.time.frame;for(var _i=0,_iter=this.scenes.values();_i<_iter.length;_i++){var scene=_iter[_i];var worlds2=WorldList.get(scene);for(var _i4=0;_i4<worlds2.length;_i4++){var world2=worlds2[_i4];if(world2.preRender(gameFrame)){this.flush=true}}}}},{key:"render",value:function render(renderPass){for(var _i=0,_iter=this.scenes.values();_i<_iter.length;_i++){var scene=_iter[_i];var worlds2=WorldList.get(scene);for(var _i5=0;_i5<worlds2.length;_i5++){var world2=worlds2[_i5];world2.renderGL(renderPass)}}this.flush=false}}]);return _class}();function CreateSceneManager(){new SceneManager()}function GetConfigValue(config,property,defaultValue){if(Object.prototype.hasOwnProperty.call(config,property)){return config[property]}else{return defaultValue}}function Install(scene,param){var config=param===void 0?{}:param;var sceneManager=SceneManagerInstance.get();var size=sceneManager.scenes.size;var sceneIndex=sceneManager.sceneIndex;var firstScene=size===0;if(typeof config==="string"){scene.key=config}else if(config|| !config&&firstScene){scene.key=GetConfigValue(config,"key","scene"+sceneIndex.toString())}if(sceneManager.scenes.has(scene.key)){console.warn("Scene key already in use: "+scene.key)}else{sceneManager.scenes.set(scene.key,scene);sceneManager.flush=true;sceneManager.sceneIndex++}WorldList.set(scene,[])}var RenderStats={fps:0,delta:0,gameFrame:0,numScenes:0,numWorlds:0,numGameObjects:0,numGameObjectsRendered:0,numDirtyLocalTransforms:0,numDirtyWorldTransforms:0,numDirtyVertices:0,numDirtyWorldLists:0,numDirtyCameras:0};var Scene=function _class(config){"use strict";swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"key",void 0);swcHelpers.defineProperty(this,"game",void 0);swcHelpers.defineProperty(this,"events",void 0);this.game=GameInstance.get();this.events=new Map();Install(this,config)};var time_exports={};__export(time_exports,{AddDelayedCall:function(){return AddDelayedCall},AddTimer:function(){return AddTimer},Clock:function(){return Clock},NOOP:function(){return NOOP2}});function NOOP2(){}function AddTimer(clock,config){var _duration=config.duration,duration=_duration===void 0?0:_duration,_repeat=config.repeat,repeat=_repeat===void 0?0:_repeat,_delay=config.delay,delay=_delay===void 0?-1:_delay,_onStart=config.onStart,onStart=_onStart===void 0?NOOP2:_onStart,_onUpdate=config.onUpdate,onUpdate=_onUpdate===void 0?NOOP2:_onUpdate,_onRepeat=config.onRepeat,onRepeat=_onRepeat===void 0?NOOP2:_onRepeat,_onComplete=config.onComplete,onComplete=_onComplete===void 0?NOOP2:_onComplete;var timer={elapsed:duration,duration:duration,repeat:repeat,delay:delay,update:null,onStart:onStart,onUpdate:onUpdate,onRepeat:onRepeat,onComplete:onComplete};timer.update=function(delta){if(timer.delay>0){timer.delay-=delta;if(timer.delay<0){timer.delay=0}else{return false}}if(timer.delay===0){timer.onStart();timer.delay=-1}if(timer.delay=== -1){timer.elapsed-=delta;timer.onUpdate(delta,timer.elapsed/timer.duration);if(timer.elapsed<=0){if(timer.repeat>0){timer.repeat--;timer.elapsed=timer.duration;timer.onRepeat(timer.repeat)}else{timer.elapsed=0;timer.onComplete()}}}return timer.elapsed===0};clock.events.add(timer)}function AddDelayedCall(clock,delay,callback){AddTimer(clock,{duration:0,delay:delay,onComplete:callback})}var Clock=function(){"use strict";function _class(world2){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"world",void 0);swcHelpers.defineProperty(this,"now",void 0);swcHelpers.defineProperty(this,"timeScale",void 0);swcHelpers.defineProperty(this,"events",void 0);this.world=world2;this.timeScale=1;this.events=new Set()}swcHelpers.createClass(_class,[{key:"update",value:function update(delta,time){var _this=this;this.now=time;delta*=this.timeScale;this.events.forEach(function(timer){if(timer.update(delta)){_this.events.delete(timer)}})}}]);return _class}();var world_exports={};__export(world_exports,{BaseWorld:function(){return BaseWorld},CreateWorldRenderData:function(){return CreateWorldRenderData},Events:function(){return events_exports2},PreRenderWorld:function(){return PreRenderWorld},ProcessNode:function(){return ProcessNode},RenderGLNode:function(){return RenderGLNode},RenderGLWorld:function(){return RenderGLWorld},ResetWorldRenderData:function(){return ResetWorldRenderData},StaticWorld:function(){return StaticWorld},UpdateNode:function(){return UpdateNode},UpdateWorld:function(){return UpdateWorld},World:function(){return World},WorldList:function(){return WorldList}});var events_exports2={};__export(events_exports2,{WorldAfterUpdateEvent:function(){return WorldAfterUpdateEvent},WorldBeforeUpdateEvent:function(){return WorldBeforeUpdateEvent},WorldPostRenderEvent:function(){return WorldPostRenderEvent},WorldPreRenderEvent:function(){return WorldPreRenderEvent},WorldRenderEvent:function(){return WorldRenderEvent},WorldShutdownEvent:function(){return WorldShutdownEvent},WorldUpdateEvent:function(){return WorldUpdateEvent}});var WorldAfterUpdateEvent="afterupdate";var WorldBeforeUpdateEvent="beforeupdate";var WorldPostRenderEvent="postrender";var WorldPreRenderEvent="prerender";var WorldRenderEvent="render";var WorldShutdownEvent="shutdown";var WorldUpdateEvent="update";function CreateWorldRenderData(){return{gameFrame:0,dirtyLocal:0,dirtyWorld:0,dirtyQuad:0,dirtyColor:0,dirtyView:0,numChildren:0,rendered:0,renderMs:0,preRenderMs:0,updated:0,updateMs:0,fps:0,delta:0,processed:0}}function ResetWorldRenderData(renderData){renderData.rendered=0;renderData.dirtyColor=0;renderData.dirtyLocal=0;renderData.dirtyView=0;renderData.dirtyWorld=0;renderData.dirtyQuad=0;renderData.processed=0;renderData.renderMs=0;renderData.preRenderMs=0;renderData.updated=0;renderData.updateMs=0}var SceneDestroyEvent="destroy";function UpdateWorld(world2,delta,time){if(!WillUpdate(world2.id)){return}var start=performance.now();var next=GetFirstChildID(world2.id);var total=0;while(next>0){if(WillUpdate(next)){GameObjectCache.get(next).update(delta,time);total++}next=MoveNextUpdatable(next)}world2.renderData.updated=total;world2.renderData.updateMs=performance.now()-start;Emit(world2,WorldUpdateEvent,delta,time)}var BaseWorld=function(GameObject){"use strict";swcHelpers.inherits(_class,GameObject);function _class(scene){swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"type","BaseWorld");swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"tag",defineComponent());swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"scene",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"camera",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"is3D",false);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"updateDisplayList",true);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"color",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"renderData",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"stack",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"totalChildren",0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"totalChildrenQuery",void 0);var id=_this.id;var tag=_this.tag;_this.scene=scene;_this.totalChildrenQuery=defineQuery([tag]);SetWorldID(id,id);WorldList.get(scene).push(swcHelpers.assertThisInitialized(_this));_this.color=new Color2(id);_this.events=new Map();_this.renderData=CreateWorldRenderData();_this.stack=new Uint32Array(256);SetWillTransformChildren(id,false);SetWillCacheChildren(id,false);Once(scene,SceneDestroyEvent,function(){return _this.destroy()});return _this}swcHelpers.createClass(_class,[{key:"getNumChildren",value:function getNumChildren(){if(this.updateDisplayList){this.totalChildren=this.totalChildrenQuery(GameObjectWorld).length;this.updateDisplayList=false}return this.totalChildren}},{key:"beforeUpdate",value:function beforeUpdate(delta,time){ResetWorldRenderData(this.renderData);Emit(this,WorldBeforeUpdateEvent,delta,time,this)}},{key:"update",value:function update(delta,time){UpdateWorld(this,delta,time)}},{key:"afterUpdate",value:function afterUpdate(delta,time){Emit(this,WorldAfterUpdateEvent,delta,time,this)}},{key:"preRender",value:function preRender(gameFrame){return true}},{key:"renderGL",value:function renderGL(renderPass){}},{key:"shutdown",value:function shutdown(){RemoveChildren(this);Emit(this,WorldShutdownEvent,this)}},{key:"destroy",value:function destroy(reparentChildren){swcHelpers.get(swcHelpers.getPrototypeOf(_class.prototype),"destroy",this).call(this,reparentChildren);this.shutdown();if(this.camera){this.camera.destroy()}this.camera=null}}]);return _class}(GameObject);function ProcessNode(node,cameraUpdated,isDisplayList){if(isDisplayList){return HasDirtyDisplayList(node)}else if(HasChildren(node)&&(cameraUpdated||WillUpdateTransform(node))){return true}return false}function UpdateNode(id,parentID,checkColor,checkTransform,cx,cy,cright,cbottom,forceUpdate,parentIsDisplayList,renderData){renderData.dirtyQuad++;if(checkColor&&HasDirtyColor(id)){var r=ColorComponent.r[id]/255;var g=ColorComponent.g[id]/255;var b=ColorComponent.b[id]/255;var a=ColorComponent.a[id];SetQuadColor(id,r,g,b,a);ClearDirtyColor(id);renderData.dirtyColor++}if(checkTransform){var hasUpdated=false;if(HasDirtyTransform(id)){UpdateTransforms(id,cx,cy,cright,cbottom,forceUpdate,parentIsDisplayList);hasUpdated=true;renderData.dirtyLocal++}else if(HasDirtyWorldTransform(parentID)){UpdateWorldTransform(id,parentID,cx,cy,cright,cbottom,forceUpdate,parentIsDisplayList);hasUpdated=true;renderData.dirtyWorld++}else if(forceUpdate){SetInViewFromBounds(id,cx,cy,cright,cbottom);renderData.dirtyView++}if(hasUpdated&&parentIsDisplayList){GameObjectCache.get(parentID).onUpdateChild(id)}}}function PreRenderWorld(world2,gameFrame){var start=performance.now();var id=world2.id;var renderData=world2.renderData;renderData.gameFrame=gameFrame;var camera=world2.camera;var cameraUpdated=camera.preRender();Emit(world2,WorldPreRenderEvent,world2);var checkColor=HasDirtyChildColor(id);var checkTransform=HasDirtyChildTransform(id)||cameraUpdated;if(!checkColor&&!checkTransform){return false}var cx=camera.getBoundsX();var cy=camera.getBoundsY();var cright=camera.getBoundsRight();var cbottom=camera.getBoundsBottom();var stack=world2.stack;stack[0]=id;var stackIndex=1;var parentNode=id;var node=GetFirstChildID(id);var isDisplayList=HasCustomDisplayList(node);stackBlock:{while(stackIndex>0){UpdateNode(node,parentNode,checkColor,checkTransform,cx,cy,cright,cbottom,cameraUpdated,isDisplayList,renderData);while(ProcessNode(node,cameraUpdated,isDisplayList)){stack[stackIndex++]=node;parentNode=node;isDisplayList=HasCustomDisplayList(node);node=GetFirstChildID(node);UpdateNode(node,parentNode,checkColor,checkTransform,cx,cy,cright,cbottom,cameraUpdated,isDisplayList,renderData)}var next=GetNextSiblingID(node);var climb=true;while(next&&climb){if(ProcessNode(next,cameraUpdated,isDisplayList)){climb=false;break}else{UpdateNode(next,parentNode,checkColor,checkTransform,cx,cy,cright,cbottom,cameraUpdated,isDisplayList,renderData);next=GetNextSiblingID(next)}}if(climb){while(next===0){node=stack[--stackIndex];if(!node){break stackBlock}next=GetNextSiblingID(node)}parentNode=stack[stackIndex-1];isDisplayList=HasCustomDisplayList(parentNode)}node=next}}ClearDirtyChildColor(id);ClearDirtyChildTransform(id);world2.getNumChildren();renderData.preRenderMs=performance.now()-start;return true}var RENDER_LIST=[];var RENDER_CHILD_TOTAL=0;var PROCESS_TOTAL=0;function GetRenderList(){return RENDER_LIST}function GetRenderChildTotal(){return RENDER_CHILD_TOTAL}function GetProcessTotal(){return PROCESS_TOTAL}function ResetRenderChildTotal(){RENDER_CHILD_TOTAL=0;PROCESS_TOTAL=0;RENDER_LIST.length=0}function RenderGLNode(renderPass,id){var inView=IsInView(id)||WillCacheChildren(id);var gameObject;PROCESS_TOTAL++;if(inView){gameObject=GameObjectCache.get(id);gameObject.renderGL(renderPass);RENDER_CHILD_TOTAL++}if(HasCustomDisplayList(id)){gameObject=GameObjectCache.get(id);gameObject.renderGL(renderPass);RENDER_CHILD_TOTAL++;var children=gameObject.getChildren(renderPass);var numChildren=children.length;for(var i=0;i<numChildren;i++){var childGameObject=children[i];var childID=childGameObject.id;PROCESS_TOTAL++;if(WillRender(childID)){if(GetNumChildren(childID)){RenderGLNode(renderPass,childID)}else{childGameObject.renderGL(renderPass);childGameObject.postRenderGL(renderPass);RENDER_CHILD_TOTAL++}}}gameObject.postRenderGL(renderPass)}else{var numChildren=HasRenderableChildren(id,renderPass.isCameraDirty());if(numChildren){var childID=GetFirstChildID(id);for(var i=0;i<numChildren;i++){PROCESS_TOTAL++;if(WillRender(childID)){if(GetNumChildren(childID)){RenderGLNode(renderPass,childID)}else if(IsInView(childID)){var childGameObject=GameObjectCache.get(childID);childGameObject.renderGL(renderPass);childGameObject.postRenderGL(renderPass);RENDER_CHILD_TOTAL++}}childID=GetNextSiblingID(childID)}}}if(inView){gameObject.postRenderGL(renderPass)}ClearDirtyChildTransform(id);ClearDirtyWorldTransform(id)}function RenderGLWorld(world2,renderPass){SetColor(renderPass,world2.color);Emit(world2,WorldRenderEvent,renderPass,world2);var camera=world2.camera;var renderData=world2.renderData;var start=performance.now();Begin(renderPass,camera);ResetRenderChildTotal();var id=GetFirstChildID(world2.id);while(id>0){if(WillRender(id)){RenderGLNode(renderPass,id)}id=GetNextSiblingID(id)}PopColor(renderPass,world2.color);renderData.renderMs=performance.now()-start;renderData.numChildren=world2.getNumChildren();renderData.rendered=GetRenderChildTotal();renderData.processed=GetProcessTotal();var gameStats=world2.scene.game.renderStats;gameStats.rendered+=renderData.rendered;gameStats.dirtyColor+=renderData.dirtyColor;gameStats.dirtyLocal+=renderData.dirtyLocal;gameStats.dirtyView+=renderData.dirtyView;gameStats.dirtyWorld+=renderData.dirtyWorld;gameStats.dirtyQuad+=renderData.dirtyQuad;gameStats.processed+=renderData.processed;gameStats.renderMs+=renderData.renderMs;gameStats.numChildren=renderData.numChildren;gameStats.preRenderMs+=renderData.preRenderMs;gameStats.updated+=renderData.updated;gameStats.updateMs+=renderData.updateMs;camera.postRender();Emit(world2,WorldPostRenderEvent,renderPass,world2)}var StaticWorld=function(BaseWorld){"use strict";swcHelpers.inherits(_class,BaseWorld);function _class(scene){swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,scene));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"type","StaticWorld");var renderer=RendererInstance.get();_this.camera=new StaticCamera(renderer.width,renderer.height);return _this}swcHelpers.createClass(_class,[{key:"preRender",value:function preRender(gameFrame){return PreRenderWorld(this,gameFrame)}},{key:"renderGL",value:function renderGL(renderPass){RenderGLWorld(this,renderPass)}},{key:"getRenderList",value:function getRenderList(){return GetRenderList()}}]);return _class}(BaseWorld);var World=function(BaseWorld){"use strict";swcHelpers.inherits(_class,BaseWorld);function _class(scene){swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this,scene));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"type","World");var renderer=RendererInstance.get();_this.camera=new WorldCamera(renderer.width,renderer.height);return _this}swcHelpers.createClass(_class,[{key:"preRender",value:function preRender(gameFrame){return PreRenderWorld(this,gameFrame)}},{key:"renderGL",value:function renderGL(renderPass){RenderGLWorld(this,renderPass)}},{key:"getRenderList",value:function getRenderList(){return GetRenderList()}}]);return _class}(BaseWorld);function AddBanner(){var ref=ConfigStore.get(CONFIG_DEFAULTS.BANNER),title=ref.title,version=ref.version,url=ref.url,color=ref.color,background=ref.background;if(title!==""){var str="".concat(title," ").concat(version).trimEnd();console.log("%c".concat(str,"%c ").concat(url),"padding: 4px 16px; color: ".concat(color,"; background: ").concat(background),"")}}function AddGlobalVar(game){var globalVar=ConfigStore.get(CONFIG_DEFAULTS.GLOBAL_VAR);if(globalVar&&window){window[globalVar]=game}}function AddToParent(){var parent=ConfigStore.get(CONFIG_DEFAULTS.PARENT);var canvas=RendererInstance.get().canvas;if(parent&&canvas){AddToDOM(canvas,parent)}}function CreateRenderer(){var renderer=ConfigStore.get(CONFIG_DEFAULTS.RENDERER);if(renderer){new renderer()}}function SetConfigDefaults(){SetBackgroundColor(0);SetBatchSize(2048);SetBanner("Phaser","4.0.0","https://phaser4.io");SetMaxTextures(0);SetDefaultOrigin(0.5,0.5);SetSize(800,600,1);SetWebGLContext({antialias:true,desynchronized:true,preserveDrawingBuffer:true})}var Time=function(){"use strict";function _class(){swcHelpers.classCallCheck(this,_class);swcHelpers.defineProperty(this,"lastTick",0);swcHelpers.defineProperty(this,"elapsed",0);swcHelpers.defineProperty(this,"delta",0);swcHelpers.defineProperty(this,"fps",60);swcHelpers.defineProperty(this,"fpsCount",0);swcHelpers.defineProperty(this,"frame",0);swcHelpers.defineProperty(this,"ms",0);swcHelpers.defineProperty(this,"prevFrame",0);var now=performance.now();this.lastTick=now;this.prevFrame=now}swcHelpers.createClass(_class,[{key:"update",value:function update(time){this.ms=time-this.lastTick}},{key:"updateDelta",value:function updateDelta(time){var now=performance.now();var elapsed2=now-time;this.fpsCount++;if(now>=this.prevFrame+1e3){this.fps=this.fpsCount*1e3/(now-this.prevFrame);this.prevFrame=now;this.fpsCount=0}this.lastTick=now;this.elapsed+=elapsed2;this.delta=1e3/this.fps;this.frame++;GameInstance.setFrame(this.frame);RenderStats.fps=this.fps;RenderStats.delta=1e3/this.fps;return this.frame}},{key:"resetLastTick",value:function resetLastTick(){this.lastTick=performance.now()}}]);return _class}();var Game=function(EventEmitter){"use strict";swcHelpers.inherits(_class,EventEmitter);function _class(){for(var _len=arguments.length,settings=new Array(_len),_key=0;_key<_len;_key++){settings[_key]=arguments[_key]}swcHelpers.classCallCheck(this,_class);var _this;_this=swcHelpers.possibleConstructorReturn(this,swcHelpers.getPrototypeOf(_class).call(this));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"id",addEntity(GameObjectWorld));swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"time",void 0);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"isBooted",false);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"isPaused",false);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"willUpdate",true);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"willRender",true);swcHelpers.defineProperty(swcHelpers.assertThisInitialized(_this),"renderStats",void 0);_this.time=new Time();GameInstance.set(swcHelpers.assertThisInitialized(_this));SetConfigDefaults();DOMContentLoaded(function(){return _this.boot(settings)});return _this}swcHelpers.createClass(_class,[{key:"boot",value:function boot(settings){var _this=this;settings.forEach(function(setting){return setting()});CreateRenderer();CreateTextureManager();CreateSceneManager();AddBanner();AddGlobalVar(this);AddToParent();this.isBooted=true;this.renderStats=CreateWorldRenderData();Emit(this,"boot");requestAnimationFrame(function(now){return _this.step(now)})}},{key:"pause",value:function pause(){this.isPaused=true}},{key:"resume",value:function resume(){this.isPaused=false;this.time.resetLastTick()}},{key:"update",value:function update(delta,time){}},{key:"render",value:function render(renderPass,delta,time){}},{key:"step",value:function step(now){var _this=this;var renderer=RendererInstance.get();var sceneManager=SceneManagerInstance.get();var time=this.time;ResetWorldRenderData(this.renderStats);time.update(now);if(!this.isPaused){var delta=time.delta;if(this.willUpdate){sceneManager.update();this.update(delta,now);Emit(this,"update",delta,now)}if(this.willRender){sceneManager.preRender();renderer.begin(sceneManager.flush);var renderPass=renderer.renderPass;sceneManager.render(renderPass);this.render(renderPass,delta,now);Emit(this,"render",renderPass,delta,now);renderer.end()}}time.updateDelta(now);Emit(this,"step");this.renderStats.fps=time.fps;this.renderStats.delta=time.delta;requestAnimationFrame(function(now2){return _this.step(now2)})}},{key:"destroy",value:function destroy(){}}]);return _class}(EventEmitter);function CreateGame(){for(var _len=arguments.length,settings=new Array(_len),_key=0;_key<_len;_key++){settings[_key]=arguments[_key]}var game=swcHelpers.construct(Game,[].concat(settings));return new Promise(function(resolve){if(game.isBooted){resolve(game)}else{Once(game,"boot",function(){resolve(game)})}})}_exports.Animation=animation_exports;_exports.Camera=camera_exports;_exports.Color=color_exports;_exports.Config=config_exports;_exports.CreateGame=CreateGame;_exports.DOM=dom_exports;_exports.Device=device_exports;_exports.Display=display_exports;_exports.Events=events_exports;_exports.Game=Game;_exports.GameObjects=gameobjects_exports;_exports.Geom=geom_exports;_exports.Input=input_exports2;_exports.Loader=loader_exports;_exports.Math=math_exports;_exports.Scene=Scene;_exports.Scenes=scenes_exports;_exports.Textures=textures_exports;_exports.Time=time_exports;_exports.WebGL1=webgl1_exports;_exports.World=world_exports})
